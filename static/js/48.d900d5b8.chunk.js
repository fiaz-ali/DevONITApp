webpackJsonp([48],{1453:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,c,a=n(3),i=(n.n(a),n(629)),s=n(45),o=n(18),u=n(577),l=n(89),h=n(17),f=n(586),d=n(92),b=n(14),m=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(c,a){function i(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){t.done?c(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(i,s)}o((r=r.apply(t,e||[])).next())})},p=this&&this.__generator||function(t,e){var n,r,c,a,i={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(c=2&a[0]?r.return:a[0]?r.throw||((c=r.return)&&c.call(r),0):r.next)&&!(c=c.call(r,a[1])).done)return c;switch(r=0,c&&(a=[2&a[0],c.value]),a[0]){case 0:case 1:c=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(c=(c=i.trys).length>0&&c[c.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!c||a[1]>c[0]&&a[1]<c[3])){i.label=a[1];break}if(6===a[0]&&i.label<c[1]){i.label=c[1],c=a;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(a);break}c[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=c=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},g=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),c=0;for(e=0;e<n;e++)for(var a=arguments[e],i=0,s=a.length;i<s;i++,c++)r[c]=a[i];return r};function S(){var t=document.getElementById("chatMessagesContainer");t&&(t.scrollTop=t?t.scrollHeight:0)}var T=function(t){function e(e){var n=t.call(this,e)||this;return n.state={chatMessages:[],chatText:"",participants:[],tag:"",issue:""},r=n,n.s3=new s.b,n.fetchContactInfo=n.fetchContactInfo.bind(n),n}return m(e,t),e.prototype.componentDidMount=function(){return v(this,void 0,void 0,function(){var t,e,n,a,i;return p(this,function(s){switch(s.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,a=t.s,e&&n?[4,this.fetchContactInfo()]:[3,3];case 1:return s.sent(),[4,this.getAllMessages()];case 2:s.sent(),(i=document.querySelector("#messageBody")).scrollTop=i.scrollHeight-i.clientHeight,c=window.innerHeight-270,s.label=3;case 3:return a&&a._socket&&a._socket.on&&a._socket.on("new message",function(t){var e=r.state.chatMessages;(0==e.length||e.length>0&&JSON.stringify(e[e.length-1])!=JSON.stringify(t))&&r.state.tag==t.tag&&(e.push(t),r.setState({chatMessages:e},function(){r.saveAllMessages(),S()}))}),[2]}})})},e.prototype.fetchContactInfo=function(){return v(this,void 0,void 0,function(){var t,e,n,r,c,a,s,o=this;return p(this,function(l){switch(l.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,r=t.entityTitle,e&&n?(c=[],a="",s="",r&&"Contact"!=r?[4,Object(i.i)("",r).then(function(t){if(t.length>0){var e=t[0];c=Object(h.g)(e.chatName).split("-_-"),s=Object(h.g)(e.description)}})]:[3,2]):[3,5];case 1:return l.sent(),[3,3];case 2:c=n,l.label=3;case 3:return c=g(c.sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}})),[4,Object(u.n)("",c).then(function(t){t.length>0&&(a+="Chat-_-",a+=t.map(function(t){return Object(h.g)(t.contact)}).join("-_-"),o.setState({participants:t,tag:a,issue:s},function(){return v(o,void 0,void 0,function(){return p(this,function(t){switch(t.label){case 0:return[4,Object(i.v)(a)];case 1:return t.sent(),[2]}})})}))})];case 4:l.sent(),l.label=5;case 5:return[2]}})})},e.prototype.getAllMessages=function(){return v(this,void 0,void 0,function(){var t,e,n;return p(this,function(c){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.GetObject(s.a.CHAT,n+".json",function(t,e){if(t)console.log("Get Object Error Returned",t);else{var n=Object(o.c)(e.Body);if(n){var c=JSON.parse(n);c.length>r.state.chatMessages.length&&r.setState({chatMessages:c}),S()}}}),[2]})})},e.prototype.saveAllMessages=function(){return v(this,void 0,void 0,function(){var t,e,n;return p(this,function(r){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.PutObject(s.a.CHAT,n+".json",JSON.stringify(this.state.chatMessages)),[2]})})},e.prototype.handleChatInput=function(t){this.setState({chatText:t})},e.prototype.handleChatInputKeys=function(t){(13===t.which||"Enter"===t.key)&&t.target.value&&t.target.value.trim()&&(this.setState({chatText:t.target.value.trim()}),this.sendMessage())},e.prototype.sendMessage=function(){return v(this,void 0,void 0,function(){var t,e,n,c,a,s,o,u;return p(this,function(l){return t=this.props.entityTitle,this.state.chatText&&this.state.chatText.trim()&&(e=JSON.parse(b.a.getItem("user")),n=this.state,c=n.participants,a=n.tag,s=this.state.chatText,o={from:e.contact,fromName:e.name,messageText:s,tag:a,timestamp:(new Date).toString()},Object(d.d)(o),(u=this.state.chatMessages).push(o),this.setState({chatMessages:u,chatText:""},function(){Object(i.q)(t,"Chat-_-"+c.map(function(t){return""+t.contact.value}).sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).join("-_-")),r.saveAllMessages()}),S()),[2]})})},e.prototype.render=function(){var t=this,e=this.props.entityTitle,n=this.state,r=n.chatMessages,i=n.chatText,s=n.participants,o=n.issue,u=JSON.parse(b.a.getItem("user")),d=Object(f.b)(u,"task-ticket","write"),m=-1!=s.findIndex(function(t){return Object(h.g)(t.contact)==u.contact});return a.createElement(l.a.Consumer,null,function(n){return a.createElement("div",{className:"container-fluid "},a.createElement("div",{className:"content"},a.createElement("div",{className:"chatHead"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"form-group"},a.createElement("label",{className:"heading"},e," -- ",s.map(function(t){return Object(h.g)(t.name)}).join(" -- "),""!=o?"--"+o:"")))),a.createElement("div",{id:"chatMessagesContainer",className:" padding-10 chatBody"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"card padding-10 scroll",id:"messageBody",style:{height:c,overflowX:"hidden",margin:"0px"}},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"row"},a.createElement("div",{className:"card col-md-12 col-xs-12 padding-10",style:{margin:"0px"}},0==r.length&&a.createElement("div",null," No messages found in this conversation. "),r.map(function(t,e){if(t&&t.from){var n=s.find(function(e){return e.contact.value==t.from});if(n&&n.name)return a.createElement("div",{key:e,className:"padding-10 chat-message "+(t.from==u.contact?"inbound-message":"outbound-message")},a.createElement("div",{className:"message-text padding-5",style:{overflowWrap:"break-word"}},t.messageText),a.createElement("div",{className:"sender-name"},a.createElement("label",null,a.createElement("b",null,n.name.value))),a.createElement("div",{className:"timestamp"},a.createElement("b",null,t.timestamp.ToEasternDateTime())))}}))))),m&&d&&a.createElement("footer",{className:"col-md-12 no-padding"},a.createElement("div",{className:"card",style:{margin:"0px"}},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12 no-padding"},a.createElement("div",{className:"",style:{display:"inline-flex",padding:"0px",width:"100%"}},a.createElement("input",{type:"text",className:"form-control",placeholder:"Type your message here...",name:"chatBox",value:i,style:{height:"97px"},onChange:function(e){return t.handleChatInput(e.target.value)},onKeyPress:function(e){return t.handleChatInputKeys(e)}}),a.createElement("button",{type:"button",className:"btn pull-right btn-primary btn-fill chatButton",onClick:function(){t.sendMessage()}},a.createElement("i",{className:"fa fa-comment"}),"\xa0 Send ")))))))))))})},e}(a.Component);e.default=T},629:function(t,e,n){"use strict";e.l=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,Object(a.e)({},a.a.TASKS.GetTaskTypeList,r.b.TASK)];case 1:return[2,t.sent()]}})})},e.m=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,Object(a.e)({},a.a.TASKS.GetWorkTypeList,r.b.TASK)];case 1:return[2,t.sent()]}})})},e.h=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.e)({buildingName:t,getArchivedOnly:e},a.a.CHATS.GetChats,r.b.TASK)];case 1:return[2,n.sent()]}})})},e.f=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,chatName:e},a.a.CHATS.DeleteChat,r.b.TASK).then(function(){Object(c.b)("Chat Deleted Successfully.")}).catch(function(t){Object(c.a)("Error occured while deleting Chat.")})];case 1:return[2,n.sent()]}})})},e.q=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,chatName:e},a.a.TASKS.UpdateLastMessageOn,r.b.CHAT)];case 1:return[2,n.sent()]}})})},e.v=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({chatName:t},a.a.TASKS.UpdateUnreadCount,r.b.TASK)];case 1:return[2,e.sent()]}})})},e.o=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({buildingName:t,model:e,isEdit:n},a.a.TASKS.UpdateRootTask,r.b.TASK).then(function(){Object(c.b)("Task "+(n?"Updated":"Added")+" Successfully.")}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.i=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(c){switch(c.label){case 0:return[4,Object(a.e)({buildingName:t,taskNumber:e,isArchived:n},a.a.TASKS.GETTASKS,r.b.TASK,!0)];case 1:return[2,c.sent()]}})})},e.j=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(c){switch(c.label){case 0:return[4,Object(a.e)({buildingName:t,parentTask:e,subTaskNumber:n},a.a.TASKS.GetSubTask,r.b.TASK)];case 1:return[2,c.sent()]}})})},e.s=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isDeleted:e},a.a.TASKS.UpdateRootTaskDeleteStatus,r.b.TASK).then(function(){Object(c.b)("Task Deleted Successfully.")}).catch(function(t){Object(c.a)("Error occured while deleting Task.")})];case 1:return[2,n.sent()]}})})},e.u=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({taskID:t,status:e},a.a.TASKS.UpdateTaskStatus,r.b.TASK).then(function(){n||Object(c.b)("Status Updated Successfully.")}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.t=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,startTime:e},a.a.TASKS.UpdateTaskStartTime,r.b.TASK).then(function(){Object(c.b)("Start Time Updated Successfully.")}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.d=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isArchived:e},a.a.TASKS.ArchiveTask,r.b.TASK).then(function(){Object(c.b)((e?"Archived":"Unarchived")+" Successfully.")}).catch(function(t){Object(c.a)("Error occured while Archiving Task.")})];case 1:return[2,n.sent()]}})})},e.c=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,note:e},a.a.TASKS.AddPauseNote,r.b.TASK).then(function(){}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.g=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({taskID:t},a.a.TASKS.DeletePauseNote,r.b.TASK).then(function(){}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,e.sent()]}})})},e.b=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,note:e},a.a.TASKS.AddNote,r.b.TASK).then(function(){Object(c.b)("Note Added Successfully.")}).catch(function(t){Object(c.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.a=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isAcknowledged:e},a.a.TASKS.AcknowledgeRootTask,r.b.TASK).then(function(){Object(c.b)(e?"Acknowledged Successfully.":"Unacknowledged Successfully.")}).catch(function(t){Object(c.a)("Error occured while Acknowledging.")})];case 1:return[2,n.sent()]}})})},e.e=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,checklistID:e},a.a.TASKS.AssignChecklist,r.b.TASK).then(function(){Object(c.b)("Checklist Assigned Successfully.")}).catch(function(t){Object(c.a)("Error occured while Assigning Checklist.")})];case 1:return[2,n.sent()]}})})},e.r=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({email:t,roles:e,fileName:n},a.a.ONEDRIVE.UPDATEPERMISSION,r.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(c.a)("Error occured while update Permission.")})];case 1:return[2,i.sent()]}})})},e.n=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({fileName:t},a.a.ONEDRIVE.REMOVEPERMISSION,r.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(c.a)("Error occured while removing Permission.")})];case 1:return[2,e.sent()]}})})},e.k=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(a.e)({buildingName:t,checklistID:e},a.a.TASKS.GetTaskHavingChecklist,r.b.TASK,!0)];case 1:return[2,n.sent()]}})})},e.p=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({buildingName:t},a.a.TASKS.TriggerTaskManagement,r.b.TASK,"").then(function(t){return t}).catch(function(t){Object(c.a)("Error occured while triggering task automation.")})];case 1:return[2,e.sent()]}})})};var r=n(26),c=n(44),a=n(19),i=(n(14),this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(c,a){function i(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){t.done?c(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(i,s)}o((r=r.apply(t,e||[])).next())})}),s=this&&this.__generator||function(t,e){var n,r,c,a,i={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(c=2&a[0]?r.return:a[0]?r.throw||((c=r.return)&&c.call(r),0):r.next)&&!(c=c.call(r,a[1])).done)return c;switch(r=0,c&&(a=[2&a[0],c.value]),a[0]){case 0:case 1:c=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(c=(c=i.trys).length>0&&c[c.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!c||a[1]>c[0]&&a[1]<c[3])){i.label=a[1];break}if(6===a[0]&&i.label<c[1]){i.label=c[1],c=a;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(a);break}c[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=c=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}}});