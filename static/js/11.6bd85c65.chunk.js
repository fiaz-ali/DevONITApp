webpackJsonp([11],{2965:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),r=(a.n(n),a(127)),i=a(1291),l=a(11),o=a(707),s=a(2966),u=a(20),c=a(2967),m=a(2968),p=a(2969),h=a(2970),g=a(2971),d=a(2972),f=a(2973),v=a(2974),b=a(2975),y=a(2976),x=a(1680),E=(a.n(x),a(744)),D=a(2977),w=a(725),A=a(13),_=a(124),O=a(8),P=a(749),S=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),V=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},j=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},N=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<a;t++)for(var i=arguments[t],l=0,o=i.length;l<o;l++,r++)n[r]=i[l];return n},L=function(e){function t(t){var a=e.call(this,t)||this,n=new Date(new Date(Date.now()).setMinutes(new Date(Date.now()).getMinutes()-30)),r=new Date(Date.now());return a.state={from:n,to:r,dashboardURL:"",insights:[],templatesList:[],selectedTemplate:"",loadingDevices:!0,liveGraphRange:30,filteredInsights:[],showInsights:[],selectedTemplateGraphs:{},showAlarmPoints:!1,insightsLoaded:0,verifyList:[],insightPoints:[],assets:[],isEquipment:!1,filteredAssets:[],showAssets:[]},a}return S(t,e),t.prototype.componentDidMount=function(){return V(this,void 0,void 0,function(){var e;return j(this,function(t){switch(t.label){case 0:return e=JSON.parse(O.a.getItem("user")),[4,Promise.all([Object(_.b)(e.contact),this._fetchInsights(),this._fetchEquipment()])];case 1:return t.sent(),[2]}})})},t.prototype.moreInsights=function(){var e=this.state,t=e.showInsights,a=e.filteredInsights,n=e.isEquipment,r=e.filteredAssets,i=e.showAssets;if(n){var l=r.slice(i.length-1,i.length+4),o=N(i,l);this.setState({showAssets:o},function(){window.dispatchEvent(new Event("reLoadGraph"))})}else{l=a.slice(t.length-1,t.length+4),o=N(t,l);this.setState({showInsights:o},function(){window.dispatchEvent(new Event("reLoadGraph"))})}},t.prototype.loadNextInsight=function(){var e=this.state,t=e.showInsights,a=e.insightsLoaded,n=e.isEquipment,r=e.showAssets;n?a<r.length&&this.setState({insightsLoaded:a+1}):a<t.length&&this.setState({insightsLoaded:a+1})},t.prototype._fetchInsights=function(){return V(this,void 0,void 0,function(){var e,t,a,n,r,s,u=this;return j(this,function(c){switch(c.label){case 0:return e=this.props.buildingName,t=[],a=[],[4,Object(E.o)(e)];case 1:return n=(n=c.sent()).filter(function(e){return"Measure"==e.verifyType}),e?[4,Object(o.w)(e)]:[3,6];case 2:return(r=(r=c.sent()).filter(function(e){var t,a,n,r,i,o,s;return-1!=(null===(t=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===t?void 0:t.toLowerCase().indexOf("thermostat"))||-1!=(null===(a=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===a?void 0:a.toLowerCase().indexOf("ceiling"))||-1!=(null===(n=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===n?void 0:n.toLowerCase().indexOf("intesis"))||-1!=(null===(r=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("ats"))||-1!=(null===(i=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("generator"))||"CBW406"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype)||"CBW418"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype)||-1!=(null===(o=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===o?void 0:o.toLowerCase().indexOf("relayv4"))||-1!=(null===(s=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===s?void 0:s.toLowerCase().indexOf("relayi1"))||"WattNode"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype)}))&&r.length?(s=r.map(function(e){return Object(l.g)(e.moncondevice)}),[4,Object(w.k)(e,"Sensed",s)]):[3,4];case 3:a=c.sent(),c.label=4;case 4:return[4,Object(i.b)(e).then(function(e){if(e&&e.length>0)e.map(function(e){t.push({ontology:Object(l.g)(e.ontology),label:Object(l.g)(e.label),deviceGraphs:Object(l.g)(e.deviceGraphs)})}),u.setState({insightPoints:a,templatesList:t,insights:r,selectedTemplate:(t.length-1).toString(),filteredInsights:[],showInsights:[]},function(){var e=JSON.parse(t[t.length-1].deviceGraphs),a=Object.keys(e),i=null===r||void 0===r?void 0:r.filter(function(e){return a.indexOf(Object(l.g)(e.moncondevice))>-1}),o=i.slice(0,10);u.setState({filteredInsights:i,showInsights:o,selectedTemplateGraphs:e,verifyList:n,loadingDevices:!1})});else{var i=null===r||void 0===r?void 0:r.filter(function(e){return e.moncondevice}),o=i.slice(0,10);u.setState({insightPoints:a,insights:r,filteredInsights:i,showInsights:o,verifyList:n,loadingDevices:!1})}})];case 5:c.sent(),c.label=6;case 6:return[2]}})})},t.prototype._fetchEquipment=function(){return V(this,void 0,void 0,function(){var e;return j(this,function(t){switch(t.label){case 0:return[4,Object(P.g)(this.props.buildingName,A.b.POINT)];case 1:return e=t.sent(),this.setState({assets:e}),[2]}})})},t.prototype.changeAlarmStatus=function(){this.setState({showAlarmPoints:!this.state.showAlarmPoints}),window.dispatchEvent(new Event("ShowAlarms"))},t.prototype.liveGraphRangeChange=function(e){var t=this,a=new Date,n=new Date;n.setMinutes(n.getMinutes()-+e),this.setState({from:n,to:a,liveGraphRange:+e,loadingDevices:!0,insightsLoaded:0},function(){t.setState({loadingDevices:!1})})},t.prototype.selectTemplate=function(e){var t=this,a=this.state,n=a.templatesList,r=a.insights,i=a.verifyList,o=a.assets;if(isNaN(+e))if("default"==e){var s=r,u=s.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1},function(){t.setState({selectedTemplate:e,filteredInsights:s,showInsights:u,loadingDevices:!1})})}else if("equipmentGraphs"==e){var c=o,m=c.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!0},function(){t.setState({selectedTemplate:e,filteredAssets:c,showAssets:m,loadingDevices:!1})})}else{if(!i.find(function(t){return t._id==e}))return;this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1},function(){t.setState({loadingDevices:!1,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],liveGraphRange:1})})}else this.setState({loadingDevices:!0,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],insightsLoaded:0,isEquipment:!1},function(){var a=JSON.parse(n[+e].deviceGraphs),i=Object.keys(a),o=r.filter(function(e){return i.indexOf(Object(l.g)(e.moncondevice))>-1}),s=o.slice(0,10);t.setState({showInsights:s,filteredInsights:o,loadingDevices:!1,selectedTemplateGraphs:a})})},t.prototype.render=function(){var e,t=this,a=this.state,i=a.verifyList,o=a.from,x=a.to,E=a.showInsights,w=a.filteredInsights,A=a.templatesList,_=a.selectedTemplate,O=a.loadingDevices,P=a.liveGraphRange,S=a.selectedTemplateGraphs,V=a.showAlarmPoints,j=a.insightsLoaded,N=a.insightPoints,L=a.isEquipment,R=a.filteredAssets,k=a.showAssets,q=a.insights,C=this.props,F=C.buildingName,K=C.instance;return n.createElement("div",{className:"dashboard"},n.createElement("div",{className:"dashboard-header sticky"},!O&&n.createElement("div",{className:"col-md-4 float-left"},n.createElement("div",{className:"col-md-8 no-padding"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.selectTemplate(e.target.value)},value:_,placeholder:"Select Template"},0==A.length&&n.createElement("option",{value:""},"Select Template"),n.createElement("option",{value:"default"},"All Graphs"),n.createElement("option",{value:"equipmentGraphs"},"Equipment Graphs"),(null===A||void 0===A?void 0:A.length)>0&&A.map(function(e,t){return n.createElement("option",{value:t,key:t},e.label)}),(null===i||void 0===i?void 0:i.length)>0&&i.map(function(e,t){return n.createElement("option",{value:e._id,key:t},e.projectName)}))),n.createElement(r.b,{target:"_blank",to:"/"+K+"/"+F+"/Dashboard/Templates",className:"btn btn-fill btn-secondary btn-secondary-dark margin-left-20 btn-fix-height"},"Create Template")),n.createElement("h3",{className:"dashboard-title"},Object(u.A)(F)),!O&&n.createElement("div",{className:"col-md-4 float-right margin-top-10"},(L&&j==k.length||!L&&j===E.length)&&!i.find(function(e){return e._id==_})&&n.createElement(n.Fragment,null,n.createElement("div",{className:"col-md-3 padding-5"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Show Alarm: \xa0")),n.createElement("div",{className:"padding-5"},n.createElement("label",null,n.createElement("input",{name:"showError",onChange:function(e){t.changeAlarmStatus()},className:"switchDashboard",type:"checkbox",checked:V}),n.createElement("div",null,n.createElement("div",null))))),n.createElement("div",{className:"col-md-5 padding-5 margin-left-20"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Graph Range: \xa0")),n.createElement("div",{className:"col-md-6 no-padding"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.liveGraphRangeChange(e.target.value)},value:P},i.find(function(e){return e._id==_})?n.createElement(n.Fragment,null,n.createElement("option",{value:1},"1 Month"),n.createElement("option",{value:2},"2 Months"),n.createElement("option",{value:3},"3 Months"),n.createElement("option",{value:4},"4 Months"),n.createElement("option",{value:5},"5 Months"),n.createElement("option",{value:6},"6 Months")):n.createElement(n.Fragment,null,n.createElement("option",{value:5},"5 Minutes"),n.createElement("option",{value:15},"15 Minutes"),n.createElement("option",{value:30},"30 Minutes"),n.createElement("option",{value:60},"1 Hour"),n.createElement("option",{value:180},"3 Hours"),n.createElement("option",{value:360},"6 Hours"),n.createElement("option",{value:720},"12 Hours"),n.createElement("option",{value:1440},"24 Hours")))))),O||""!=_||0!=A.length?O?n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"})):i.find(function(e){return e._id==_})?n.createElement("div",{className:""},n.createElement(D.a,{instance:K,buildingName:F,from:o,to:x,projectName:_,measureAnalysis:i.find(function(e){return e._id==_}).measureAnalysis})):L?n.createElement(c.a,{dataLength:k.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:k.length<R.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},k.map(function(e){var a=q.filter(function(t){return Object(l.g)(t.equipmentsRdfsLabel)&&Object(l.g)(t.equipmentsRdfsLabel).indexOf(Object(l.g)(e.ontology))>-1});return a&&a.length?a&&a.length&&a.map(function(a){for(var r,i,u,c,E,D,w,A=-1!=(null===(r=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("thermostat")),_=-1!=(null===(i=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("ceiling")),O=-1!=(null===(u=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),j=-1!=(null===(c=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),L=-1!=(null===(E=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("generator")),R="CBW406"==Object(l.g)(null===a||void 0===a?void 0:a.moncontype),k="CBW418"==Object(l.g)(null===a||void 0===a?void 0:a.moncontype),q=-1!=(null===(D=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayv4")),C=-1!=(null===(w=Object(l.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===w?void 0:w.toLowerCase().indexOf("relayi1")),M="WattNode"==Object(l.g)(null===a||void 0===a?void 0:a.moncontype),G={ontology:Object(l.g)(e.ontology),rdfsLabel:Object(l.g)(e.rdfsLabel)},H=Object(l.g)(a.equipmentsRdfsLabel).split(","),T=Object(l.g)(a.relatedEquipmentsLabel).split(","),U=[],B=0;B<H.length;B++){var I=H[B],W=T&&T[B]?T[B]:"";U.push({ontology:I,rdfsLabel:W})}var z=null===N||void 0===N?void 0:N.filter(function(e){return Object(l.g)(e.monconDevice)==Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)||Object(l.g)(e.sinkSourceAsset)==Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)});return n.createElement(n.Fragment,null,A&&n.createElement(s.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),_&&n.createElement(p.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),O&&n.createElement(h.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,space:Object(l.g)(a.spaceRdfsLabel),zone:Object(l.g)(a.zoneRdfsLabel),floor:Object(l.g)(a.floorRdfsLabel),equipment:U,loadNextInsight:function(){return t.loadNextInsight()},device:a}),j&&n.createElement(g.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),L&&n.createElement(d.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),R&&n.createElement(f.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),k&&n.createElement(v.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),q&&n.createElement(b.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),C&&n.createElement(m.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}),M&&n.createElement(y.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]?S[Object(l.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:U,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:G}))}):n.createElement(n.Fragment,null)}),0==(null===k||void 0===k?void 0:k.length)&&n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Graphs "))):n.createElement(c.a,{dataLength:E.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:E.length<w.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},null===(e=null===E||void 0===E?void 0:E.slice(0,j+1))||void 0===e?void 0:e.map(function(e,a){for(var r,i,u,c,E,D,w,A=-1!=(null===(r=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("thermostat")),_=-1!=(null===(i=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("ceiling")),O=-1!=(null===(u=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),j=-1!=(null===(c=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),L=-1!=(null===(E=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("generator")),R="CBW406"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype),k="CBW418"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype),q=-1!=(null===(D=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayv4")),C=-1!=(null===(w=Object(l.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===w?void 0:w.toLowerCase().indexOf("relayi1")),M="WattNode"==Object(l.g)(null===e||void 0===e?void 0:e.moncontype),G=Object(l.g)(e.equipmentsRdfsLabel).split(","),H=Object(l.g)(e.relatedEquipmentsLabel).split(","),T=[],U=0;U<G.length;U++){var B=G[U],I=H&&H[U]?H[U]:"";T.push({ontology:B,rdfsLabel:I})}var W=null===N||void 0===N?void 0:N.filter(function(t){return Object(l.g)(t.monconDevice)==Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)||Object(l.g)(t.sinkSourceAsset)==Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)}),z=["Refrigerator 1","Refrigerator 2"];return k&&Object(l.g)(e.applicationLabel)&&Object(l.g)(e.applicationLabel).indexOf("3")>-1&&(z=["Refrigerator 3","Refrigerator 4"]),n.createElement(n.Fragment,null,A&&n.createElement(s.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),_&&n.createElement(p.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e,isEquipment:!1,equipment:Object()}),O&&n.createElement(h.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,space:Object(l.g)(e.spaceRdfsLabel),zone:Object(l.g)(e.zoneRdfsLabel),floor:Object(l.g)(e.floorRdfsLabel),equipment:T,loadNextInsight:function(){return t.loadNextInsight()},device:e}),j&&n.createElement(g.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),L&&n.createElement(d.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),R&&n.createElement(f.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),k&&n.createElement(v.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:z,insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),q&&n.createElement(b.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),C&&n.createElement(m.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}),M&&n.createElement(y.a,{buildingName:F,instance:K,from:o,to:x,liveGraphRange:P,graphsList:S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]?S[Object(l.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:T,showAlarmPoints:V,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:W,device:e}))}),0==(null===E||void 0===E?void 0:E.length)&&n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Graphs "))):n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Template Created ")))},t}(n.Component);t.default=L},2966:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(11),o=a(707),s=a(803),u=a(20),c=a(837),m=a(796),p=a(122),h=a(736),g=a(124),d=a(760),f=(a.n(d),a(857)),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),b=this&&this.__assign||function(){return(b=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},x=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},E=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return x(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return x(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(l.g)(e)&&Object(g.g)(Object(l.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,r,i,o,s,u,c,g,d,f,v,b=this;return x(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,o=a.device,Object(p.a)(!0),i&&!e?[3,2]:(s=[],r&&r.length&&r.forEach(function(e){s.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(h.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(o.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(c=t[0].graphData.columns,g=new Date(c[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:s,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===s||void 0===s?void 0:s.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(p.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,u=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=b({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=c.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=b({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this.state,a=t.graphData,n=t.grid,r=new Date;e["@timestamp"]&&(r=new Date(e["@timestamp"]),r=new Date(r.setHours(r.getHours()+10)));var i=this.props.liveGraphRange;if(a&&a.length&&r){for(var l=0;l<a.length;l++){var o=a[l];if(o.graphData.columns&&o.graphData.columns.length){if(o.graphData.columns[0].push(r),e&&Object.keys(e).length)for(var s=Object.keys(e),c=function(t){var a=s[t],n=1;o.sensedKeys&&o.sensedKeys.length&&o.sensedKeys.find(function(e){return e==a})&&(1!=(null===e||void 0===e?void 0:e.tempunits)||"cooltemp"!=a&&"heattemp"!=a&&"spacetemp"!=a?o.graphData.columns[n].push(e[a]):o.graphData.columns[n].push(Object(u.a)(e[a]).toFixed(1)),n++,o.graphData.columns[n].splice(1,1))},m=0;m<s.length;m++)c(m);(r.getTime()-o.graphData.columns[0][2].getTime())/6e4>i&&o.graphData.columns[0].splice(1,1),o.axis.x.tick.values[2]&&o.axis.x.tick.values[1].getTime()&&o.axis.x.tick.values[2].getTime()-o.axis.x.tick.values[1].getTime()<r.getTime()-o.axis.x.tick.values[o.axis.x.tick.values.length-1]&&(o.axis.x.tick.values.splice(0,1),n.x.lines.splice(0,1),r.setSeconds(0),i>10&&r.setMinutes(r.getMinutes()-r.getMinutes()%5),o.axis.x.tick.values.push(r),n.x.lines.push({value:r,class:"grid4"}))}}var p=null===r||void 0===r?void 0:r.toLocaleString();this.setState({grid:n,graphData:a,lastUpdatedAt:p})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},o=0;o<t.length;o++)i(o);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return y(this,void 0,void 0,function(){var t,a,n,r,i,c,m,p,h,d,v,b,y,E,D,w,A,_,O,P,S,V,j,N,L,R,k=this;return x(this,function(x){switch(x.label){case 0:return t=this.props,a=t.from,n=t.to,r=t.device,i=t.showAlarmPoints,c=t.devicePoints,m=t.isEquipment,p=t.equipment,h=this.state,d=h.grid,v=h.graphData,b=h.lastUpdatedAt,y=[],m&&(y=c.filter(function(e){return Object(l.g)(e.relatedEquipment)==p.ontology})),r&&r.moncondevice?(E=Object(l.g)(r.topic),D=[],!m||m&&y.length?[4,Object(o.I)(E,a,n,!1)]:[3,2]):[3,3];case 1:D=x.sent(),x.label=2;case 2:if(A=["x"],(w={cooltemp:["Cool setpoint"],heattemp:["Heat setpoint"],spacetemp:["Space Temp"],fan:["Fan 0: Auto 1: On"],fanstate:["Fan State 1: On"],mode:["Mode 0: Heat 1: Cool 2: Auto"],state:["State 1: Heat 2: Cool"]}).cooltemp.push(null),w.heattemp.push(null),w.spacetemp.push(null),w.fan.push(null),w.fanstate.push(null),w.mode.push(null),w.state.push(null),A.push(new Date(a)),D.length>0&&(null===D||void 0===D||D.forEach(function(e){(null===e||void 0===e?void 0:e.cooltemp)&&(1==e.tempunits?(w.cooltemp.push(Object(u.a)(e.cooltemp).toFixed(1)),w.heattemp.push(Object(u.a)(e.heattemp).toFixed(1)),w.spacetemp.push(Object(u.a)(e.spacetemp).toFixed(1))):(w.cooltemp.push(e.cooltemp),w.heattemp.push(e.heattemp),w.spacetemp.push(e.spacetemp)),w.fan.push(e.fan),w.fanstate.push(e.fanstate),w.mode.push(e.mode),w.state.push(e.state),A.push(new Date(e.timestamp)))})),b=D.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",A.length>1){if(_=Object(s.a)(5,a,n),O="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,O=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",d.x.lines=[],_.forEach(function(e){d.x.lines.push({value:e,class:"grid4"})}),m){for((L=JSON.parse(JSON.stringify(f.a))).name="Thermostat",L.graphData.columns=[A],L.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},L.axis.x.tick.format=O,L.axis.x.tick.values=_,L.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},L.axis.y.label="State, Mode, Fan, Fan State",L.axis.y.tick.values=[0,1,2,3],L.axis.y.tick.max=3,L.axis.y.tick.min=0,L.graphData.x="x",j=0;j<y.length;j++)S=y[j],V=Object(l.g)(S.sensedValue),L.sensedKeys.push(V),L.graphData.columns.push(w[""+V]);L.graphEquipment=this.fetchEquipmentFromPoints(L.name,L.sensedKeys),v.push(L)}else for(j=0;j<1;j++)N="Thermostat",L=JSON.parse(JSON.stringify(f.a)),R=[],L.name=N,L.sensedKeys=["cooltemp","heattemp","spacetemp","fan","fanstate","mode","state"],R=[A,w.cooltemp,w.heattemp,w.spacetemp,w.fan,w.fanstate,w.mode,w.state],L.axis={x:{type:"timeseries",tick:{fit:!1,count:5,values:_,format:O}},y:{label:{text:"Temperature \xb0F",position:"outer-middle"},tick:{fit:!0,values:[0,20,40,60,80,100],count:6,format:function(e){return parseFloat(e).toFixed(1)}},max:100,min:0},y2:{show:!0,label:{text:"State, Mode, Fan, Fan State",position:"outer-middle"},tick:{fit:!0,values:[0,1,2,3],count:6,format:function(e){return parseFloat(e).toFixed(0)}},max:3,min:0}},L.graphData.x="x",L.graphData.columns=R,L.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},L.graphData.colors={"Cool setpoint":"yellow","Heat setpoint":"green","Space Temp":"blue","Fan 0: Auto 1: On":"pink","Fan State 1: On":"yellow","Mode 0: Heat 1: Cool 2: Auto":"magenta","State 1: Heat 2: Cool":"#06cfa4"},L.graphData.types={"Cool setpoint":"line","Heat setpoint":"line","Space Temp":"line","Fan 0: Auto 1: On":"step","Fan State 1: On":"step","Mode 0: Heat 1: Cool 2: Auto":"step","State 1: Heat 2: Cool":"step"},L.graphEquipment=this.fetchEquipmentFromPoints(N,L.sensedKeys),v.push(L);this.props.loadNextInsight(),Object(g.h)(E,this.callLiveUpdate),this.setState({grid:d,graphData:v,lastUpdatedAt:b,loading:!1},function(){i&&k.changeAlarmStatus(!0)})}x.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,o=t.grid,s=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.insightRelEquipment,g=u.showAlarmPoints;return s&&"No Data"==s?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d="";return g&&t.alarmStatus&&("active"==t.alarmStatus?d="alarm-graph":"ack"==t.alarmStatus?d="alarm-ack-graph":"clear"==t.alarmStatus&&(d="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+d,id:"divGraphs"},n.createElement("br",null),g&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/InsightControl/"+Object(l.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",s)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:o,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=E},2967:function(e,t,a){"use strict";var n=a(2),r=a.n(n),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};var l=function(){return(l=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var o={Pixel:"Pixel",Percent:"Percent"},s={unit:o.Percent,value:.8};function u(e){return"number"===typeof e?{unit:o.Percent,value:100*e}:"string"===typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:o.Pixel,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:o.Percent,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),s):(console.warn("scrollThreshold should be string or number"),s)}var c=function(e){function t(t){var a=e.call(this,t)||this;return a.lastScrollTop=0,a.actionTriggered=!1,a.startY=0,a.currentY=0,a.dragging=!1,a.maxPullDownDistance=0,a.getScrollableTarget=function(){return a.props.scrollableTarget instanceof HTMLElement?a.props.scrollableTarget:"string"===typeof a.props.scrollableTarget?document.getElementById(a.props.scrollableTarget):(null===a.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},a.onStart=function(e){a.lastScrollTop||(a.dragging=!0,e instanceof MouseEvent?a.startY=e.pageY:e instanceof TouchEvent&&(a.startY=e.touches[0].pageY),a.currentY=a.startY,a._infScroll&&(a._infScroll.style.willChange="transform",a._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},a.onMove=function(e){a.dragging&&(e instanceof MouseEvent?a.currentY=e.pageY:e instanceof TouchEvent&&(a.currentY=e.touches[0].pageY),a.currentY<a.startY||(a.currentY-a.startY>=Number(a.props.pullDownToRefreshThreshold)&&a.setState({pullToRefreshThresholdBreached:!0}),a.currentY-a.startY>1.5*a.maxPullDownDistance||a._infScroll&&(a._infScroll.style.overflow="visible",a._infScroll.style.transform="translate3d(0px, "+(a.currentY-a.startY)+"px, 0px)")))},a.onEnd=function(){a.startY=0,a.currentY=0,a.dragging=!1,a.state.pullToRefreshThresholdBreached&&(a.props.refreshFunction&&a.props.refreshFunction(),a.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){a._infScroll&&(a._infScroll.style.overflow="auto",a._infScroll.style.transform="none",a._infScroll.style.willChange="unset")})},a.onScrollListener=function(e){"function"===typeof a.props.onScroll&&setTimeout(function(){return a.props.onScroll&&a.props.onScroll(e)},0);var t=a.props.height||a._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;a.actionTriggered||((a.props.inverse?a.isElementAtTop(t,a.props.scrollThreshold):a.isElementAtBottom(t,a.props.scrollThreshold))&&a.props.hasMore&&(a.actionTriggered=!0,a.setState({showLoader:!0}),a.props.next&&a.props.next()),a.lastScrollTop=t.scrollTop)},a.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},a.throttledOnScrollListener=function(e,t,a,n){var r,i=!1,l=0;function o(){r&&clearTimeout(r)}function s(){var s=this,u=Date.now()-l,c=arguments;function m(){l=Date.now(),a.apply(s,c)}i||(n&&!r&&m(),o(),void 0===n&&u>e?m():!0!==t&&(r=setTimeout(n?function(){r=void 0}:m,void 0===n?e-u:e)))}return"boolean"!==typeof t&&(n=a,a=t,t=void 0),s.cancel=function(){o(),i=!0},s}(150,a.onScrollListener).bind(a),a.onStart=a.onStart.bind(a),a.onMove=a.onMove.bind(a),a.onEnd=a.onEnd.bind(a),a}return function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}(t,e),t.prototype.componentDidMount=function(){if("undefined"===typeof this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"===typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!==typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.componentDidUpdate=function(e){this.props.dataLength!==e.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},t.getDerivedStateFromProps=function(e,t){return e.dataLength!==t.prevDataLength?l(l({},t),{prevDataLength:e.dataLength}):null},t.prototype.isElementAtTop=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===o.Pixel?e.scrollTop<=n.value+a-e.scrollHeight+1:e.scrollTop<=n.value/100+a-e.scrollHeight+1},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===o.Pixel?e.scrollTop+a>=e.scrollHeight-n.value:e.scrollTop+a>=n.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=l({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),a=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),n=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return r.a.createElement("div",{style:n,className:"infinite-scroll-component__outerdiv"},r.a.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&r.a.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},r.a.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!a&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(n.Component);t.a=c},2968:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(11),o=a(707),s=a(803),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,o,s,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,o=a.device,Object(m.a)(!0),i&&!e?[3,2]:(s=[],r&&r.length&&r.forEach(function(e){s.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(o.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:s,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===s||void 0===s?void 0:s.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props.showAlarmPoints,o=new Date;e["@timestamp"]&&(o=new Date(e["@timestamp"]),o=new Date(o.setHours(o.getHours()+10)));var s=this.props.liveGraphRange;if(n&&n.length&&o){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(o),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&("import_active_energy_Wh"==a?c.graphData.columns[n].push(+e[a]/1e3):c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(o.getTime()-c.graphData.columns[0][2].getTime())/6e4>s&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<o.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),o.setSeconds(0),s>10&&o.setMinutes(o.getMinutes()-o.getMinutes()%5),c.axis.x.tick.values.push(o),r.x.lines.push({value:o,class:"grid4"}))}}var g=null===o||void 0===o?void 0:o.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:g},function(){if(l){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},o=0;o<t.length;o++)i(o);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.graphsList,c=t.devicePoints,m=t.isEquipment,p=t.equipment,g=this.state,f=g.grid,v=g.graphData,b=g.lastUpdatedAt,x=[],m&&(x=c.filter(function(e){return Object(l.g)(e.relatedEquipment)==p.ontology})),a&&a.moncondevice?(E=Object(l.g)(a.topic),D=[],!m||m&&x.length?[4,Object(o.g)(E,n,r,!1)]:[3,2]):[3,3];case 1:D=y.sent(),y.label=2;case 2:if(A=["x"],(w={i1relay_state:["State"],active_power_Watts:["Watts"],current_Amperes:["Amps"],frequency_Hz:["Freq"],import_active_energy_Wh:["Kilo Watt Hour"],power_factor:["Power Factor"],voltage_volts:["Volts"]}).i1relay_state.push(null),w.active_power_Watts.push(null),w.current_Amperes.push(null),w.frequency_Hz.push(null),w.import_active_energy_Wh.push(null),w.power_factor.push(null),w.voltage_volts.push(null),A.push(new Date(n)),D.length>0&&D.forEach(function(e){e&&(w.i1relay_state.push(e.i1relay_state||"0"),w.active_power_Watts.push(e.active_power_Watts||"0"),w.current_Amperes.push(e.current_Amperes||"0"),w.frequency_Hz.push(e.frequency_Hz||"0"),w.import_active_energy_Wh.push(""+ +e.import_active_energy_Wh/1e3||"0"),w.power_factor.push(e.power_factor||"0"),w.voltage_volts.push(e.voltage_volts||"0"),A.push(new Date(e.timestamp)))}),b=D.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",w.i1relay_state.push(null),w.active_power_Watts.push(null),w.current_Amperes.push(null),w.frequency_Hz.push(null),w.import_active_energy_Wh.push(null),w.power_factor.push(null),w.voltage_volts.push(null),A.push(new Date(r)),A.length>1){if(_=Object(s.a)(5,n,r),O="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,O=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",f.x.lines=[],_.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),m){for((S=JSON.parse(JSON.stringify(d.a))).name="Relay i1",S.graphData.columns=[A],S.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},S.axis.x.tick.format=O,S.axis.x.tick.values=_,S.graphData.x="x",R=0;R<x.length;R++)V=x[R],j=Object(l.g)(V.sensedValue),S.sensedKeys.push(j),S.graphData.columns.push(w[""+j]);S.graphEquipment=this.fetchEquipmentFromPoints(S.name,S.sensedKeys),v.push(S)}else for(N=function(e){var t=u[e],a=JSON.parse(JSON.stringify(d.a)),n=1,r=[];a.name=t,"Totalized Energy"==t?(a.sensedKeys=["import_active_energy_Wh"],r=[A,w.import_active_energy_Wh],a.axis.y.tick.values=[0,10,20,30,40,50],a.axis.y.label="kWh",a.axis.y.max=50,a.axis.y.min=0,n=0):"Frequency and Voltage"==t?(a.sensedKeys=["frequency_Hz","voltage_volts"],r=[A,w.frequency_Hz,w.voltage_volts],a.axis.y.tick.values=[0,50,100,150,200],a.axis.y.label="Hz/Volts",a.axis.y.max=200,a.axis.y.min=0):"Current and Power"==t?(a.sensedKeys=["active_power_Watts","current_Amperes"],r=[A,w.active_power_Watts,w.current_Amperes],a.axis.y.tick.values=[0,20,40,60,80,100],a.axis.y.label="Watts/Amps",a.axis.y.max=100,a.axis.y.min=0):"State and Power Factor"==t&&(a.sensedKeys=["relay_state","power_factor"],r=[A,w.i1relay_state,w.power_factor],a.axis.y.tick.values=[-1,0,1,2],a.axis.y.label="",a.axis.y.max=2,a.axis.y.min=-1,n=2),a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=O,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=L.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},L=this,R=0;R<u.length;R++)N(R);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:f,graphData:v,lastUpdatedAt:b,loading:!1},function(){i&&k.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,o=t.grid,s=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.showAlarmPoints,g=u.insightRelEquipment;return s&&"No Data"==s?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d,f="";return h&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),h&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/RelayControl/"+Object(l.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",s)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:o,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2969:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(707),o=a(1009),s=a(803),u=a(837),c=a(11),m=a(796),p=a(736),h=a(122),g=a(124),d=a(760),f=(a.n(d),a(857)),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),b=this&&this.__assign||function(){return(b=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},x=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},E=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return x(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return x(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(c.g)(e)&&Object(g.g)(Object(c.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,r,i,l,o,s,u,g,d,f,v,b=this;return x(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(h.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(l.moncondevice)],null)]);case 1:return s=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,g=new Date(u[0][1]),s=s.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:s},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=b({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=b({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});i&&Object(c.g)(i.point)&&Object(c.g)(i.relatedEquipment)&&!(r&&r.length&&r.find(function(e){return e.value==Object(c.g)(i.relatedEquipment)}))&&r.push({value:Object(c.g)(i.relatedEquipment),label:Object(c.g)(i.relatedEquipmentLabel),space:Object(c.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return y(this,void 0,void 0,function(){var t,a,n,r,i,u,m,p,h,d,v,b,y,E,D,w,A,_,O,P,S,V,j,N,L,R,k,q,C,F=this;return x(this,function(x){switch(x.label){case 0:return t=this.props,a=t.from,n=t.to,r=t.device,i=t.showAlarmPoints,u=t.graphsList,m=t.devicePoints,p=t.isEquipment,h=t.equipment,d=this.state,v=d.grid,b=d.lastUpdatedAt,y=[],E=[],p&&(E=m.filter(function(e){return Object(c.g)(e.relatedEquipment)==h.ontology})),r&&r.moncondevice?(D=Object(c.g)(r.topic),w=Object(c.g)(r.firmwareVersion),A=Object(c.g)(r.csbCallibration)?parseInt(Object(c.g)(r.csbCallibration)):0,_=[],!p||p&&E.length?[4,Object(l.d)(D,a,n,!1)]:[3,2]):[3,3];case 1:_=x.sent(),x.label=2;case 2:if(P=["x"],(O={temp_celsius:["Temp"],relhumidity_pct:["Humidity"],altitude_m:["Alt."],equiCO2_ppm:["CO2"],tvoc_ppm:["TVOC"],gasResistance_kOhm:["Gas Res"],illuminance_lux:["Illuminance"],motion_sensed:["Motion"],num_BTdev:["Blth Dev."],pressure_hPa:["Pressure"]}).temp_celsius.push(null),O.relhumidity_pct.push(null),O.altitude_m.push(null),O.equiCO2_ppm.push(null),O.tvoc_ppm.push(null),O.gasResistance_kOhm.push(null),O.illuminance_lux.push(null),O.motion_sensed.push(null),O.num_BTdev.push(null),O.pressure_hPa.push(null),P.push(new Date(a)),_.length>0&&_.forEach(function(e){e&&(O.temp_celsius.push(Object(o.a)(e.temp_celsius,w||"",A)),O.relhumidity_pct.push(e.relhumidity_pct||"0"),O.altitude_m.push(e.altitude_m||"0"),O.equiCO2_ppm.push(e.equiCO2_ppm||"0"),O.tvoc_ppm.push(e.tvoc_ppm||"0"),O.pressure_hPa.push(e.pressure_hPa||"0"),O.gasResistance_kOhm.push(e.gasResistance_kOhm||"0"),O.illuminance_lux.push(e.illuminance_lux||"0"),O.motion_sensed.push(e.motion_sensed||"0"),O.num_BTdev.push(e.num_BTdev||"0"),P.push(new Date(e.timestamp)))}),b=_.length>0?null===(e=P[P.length-1])||void 0===e?void 0:e.toLocaleString():"No data",0===_.length&&(O.temp_celsius.push(null),O.relhumidity_pct.push(null),O.altitude_m.push(null),O.equiCO2_ppm.push(null),O.tvoc_ppm.push(null),O.gasResistance_kOhm.push(null),O.illuminance_lux.push(null),O.motion_sensed.push(null),O.num_BTdev.push(null),O.pressure_hPa.push(null),P.push(new Date(n))),P.length>1){if(S=Object(s.a)(5,a,n),V="",S.length>1?(j=((new Date).getTime()-S[0].getTime())/1e3,V=(j/=3600)>24?"%m-%d %H:%M":j<.3?"%H:%M:%S":"%H:%M"):V="%H:%M:%S",v.x.lines=[],S.forEach(function(e){v.x.lines.push({value:e,class:"grid4"})}),p){for((N=JSON.parse(JSON.stringify(f.a))).name="Ceiling Sensor",N.graphData.columns=[P],N.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},N.axis.x.tick.format=V,N.axis.x.tick.values=S,N.graphData.x="x",C=0;C<E.length;C++)L=E[C],R=Object(c.g)(L.sensedValue),N.sensedKeys.push(R),N.graphData.columns.push(O[""+R]);N.graphEquipment=this.fetchEquipmentFromPoints(N.name,N.sensedKeys),y.push(N)}else for(k=function(e){var t=u[e],a=JSON.parse(JSON.stringify(f.a)),n=0,r=[];a.name=t,"Temp & Humidity"==t?(a.axis.y.label="\xb0F / %",n=1,a.axis.y.tick.values=[0,20,40,60,80,100],a.axis.y.max=100,a.sensedKeys=["temp_celsius","relhumidity_pct"],r=[P,O.temp_celsius,O.relhumidity_pct]):"Pressure"==t?(a.axis.y.label="hPa",a.axis.y.tick.values=[0,400,800,1200],a.axis.y.max=1100,a.sensedKeys=["pressure_hPa"],r=[P,O.pressure_hPa]):"Illuminance"==t?(a.axis.y.label="Lux",a.axis.y.tick.values=[0,40,80,120,160,200,240],a.axis.y.max=200,a.sensedKeys=["illuminance_lux"],r=[P,O.illuminance_lux]):"Gas Resistance"==t?(a.axis.y.label="kOhm",a.axis.y.tick.values=[0,600,1200,1800,2400,3e3],a.axis.y.max=3e3,a.sensedKeys=["gasResistance_kOhm"],r=[P,O.gasResistance_kOhm]):"Air Particles"==t?(a.axis.y.label="PPM",a.axis.y.tick.values=[0,4e3,8e3,12e3,16e3],a.axis.y.max=16e3,a.sensedKeys=["equiCO2_ppm","tvoc_ppm"],r=[P,O.equiCO2_ppm,O.tvoc_ppm]):"Other Parameters"==t&&(a.axis.y.label="",a.axis.y.tick.values=[0,10,20,30,40,50],a.axis.y.max=50,a.sensedKeys=["motion_sensed","num_BTdev"],r=[P,O.motion_sensed,O.num_BTdev]),a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.y.min=0,a.axis.x.tick.format=V,a.axis.x.tick.values=S,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=q.fetchEquipmentFromPoints(t,a.sensedKeys),y.push(a)},q=this,C=0;C<u.length;C++)k(C);this.props.loadNextInsight(),Object(g.h)(D,this.callLiveUpdate),this.setState({grid:v,graphData:y,lastUpdatedAt:b,loading:!1},function(){i&&F.changeAlarmStatus(!0)})}x.label=3;case 3:return[2]}})})},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props,s=l.device,u=l.showAlarmPoints,m=new Date,p=Object(c.g)(s.firmwareVersion),h=Object(c.g)(s.csbCallibration)?parseInt(Object(c.g)(s.csbCallibration)):0;e["@timestamp"]&&(m=new Date(e["@timestamp"]),m=new Date(m.setHours(m.getHours()+10)));var g=this.props.liveGraphRange;if(n&&n.length&&m){for(var d=0;d<n.length;d++){var f=n[d];if(f.graphData.columns&&f.graphData.columns.length){if(f.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var v=Object.keys(e),b=function(t){var a=v[t],n=1;f.sensedKeys&&f.sensedKeys.length&&f.sensedKeys.find(function(e){return e==a})&&("temp_celsius"==a?f.graphData.columns[n].push(Object(o.a)(null===e||void 0===e?void 0:e.temp_celsius,p||"",h)):f.graphData.columns[n].push(e[a]),n++,f.graphData.columns[n].splice(1,1))},y=0;y<v.length;y++)b(y);(m.getTime()-f.graphData.columns[0][2].getTime())/6e4>g&&f.graphData.columns[0].splice(1,1),f.axis.x.tick.values[2]&&f.axis.x.tick.values[1].getTime()&&f.axis.x.tick.values[2].getTime()-f.axis.x.tick.values[1].getTime()<m.getTime()-f.axis.x.tick.values[f.axis.x.tick.values.length-1]&&(f.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),m.setSeconds(0),g>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),f.axis.x.tick.values.push(m),r.x.lines.push({value:m,class:"grid4"}))}}var x=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:x},function(){if(u){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,s=this.props,u=s.instance,m=s.buildingName,p=s.device,h=s.showAlarmPoints,g=s.insightRelEquipment;return"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,s,d,f="";return h&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(s=t.graphDataAlarmPoint.columns)||void 0===s?void 0:s.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),h&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+u+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+u+"/"+m+"/Insights/Equipment/Graphs/CeilingSensor/"+Object(c.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=E},2970:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(707),o=a(803),s=a(124),u=a(760),c=(a.n(u),a(11)),m=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),p=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},h=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},g=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:{x:"x",columns:[]},grid:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{fit:!1,count:5,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,lastUpdatedAt:"No Data"},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return m(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){var e=this;return h(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return p(this,void 0,void 0,function(){var e,t=this;return h(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(c.g)(e)&&Object(s.g)(Object(c.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(){},t.prototype.callLiveUpdate=function(e){var t,a=this.state,n=a.graphData,r=a.axis1,i=a.grid;e["@timestamp"]&&(t=new Date(e["@timestamp"]),t=new Date(t.setHours(t.getHours()+10)));var l=this.props.liveGraphRange;if(n.columns.length>1&&t){n.columns[0].splice(1,1),n.columns[0].push(t),n.columns[1].splice(1,1),n.columns[1].push(null===e||void 0===e?void 0:e.setpoint),n.columns[2].splice(1,1),n.columns[2].push(null===e||void 0===e?void 0:e.roomtemp),n.columns[3].splice(1,1),n.columns[3].push(null===e||void 0===e?void 0:e.fanspeed),n.columns[4].splice(1,1),n.columns[4].push(null===e||void 0===e?void 0:e.horizontalvans),n.columns[5].splice(1,1),n.columns[5].push(null===e||void 0===e?void 0:e.usermode),n.columns[6].splice(1,1),n.columns[6].push(null===e||void 0===e?void 0:e.verticalvans),n.columns[7].splice(1,1),n.columns[7].push(null===e||void 0===e?void 0:e.wifiSignal),(t.getTime()-n.columns[0][2].getTime())/6e4>l&&n.columns[0].splice(1,1),r.x.tick.values[2]&&r.x.tick.values[1].getTime()&&r.x.tick.values[2].getTime()-r.x.tick.values[1].getTime()<t.getTime()-r.x.tick.values[r.x.tick.values.length-1]&&(r.x.tick.values.splice(0,1),i.x.lines.splice(0,1),t.setSeconds(0),l>10&&t.setMinutes(t.getMinutes()-t.getMinutes()%5),r.x.tick.values.push(t),i.x.lines.push({value:t,class:"grid4"}));var o=null===t||void 0===t?void 0:t.toLocaleString();this.setState({grid:i,axis1:r,graphData:n,lastUpdatedAt:o})}},t.prototype._fetchData=function(){var e;return p(this,void 0,void 0,function(){var t,a,n,r,i,u,m,p,g,d,f,v,b,y,x,E,D,w,A,_,O,P;return h(this,function(h){switch(h.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=this.state,u=i.grid,m=i.axis1,p=i.graphData,g=i.lastUpdatedAt,a&&a.moncondevice?(d=Object(c.g)(a.topic),[4,Object(l.e)(d,n,r,p.columns.length>1)]):[3,2];case 1:f=h.sent(),v=["setpoint"],y=["mode"],x=["fanspeed"],E=["horizontalvans"],D=["verticalvans"],w=["wifiSignal"],A=["x"],(b=["roomtemp"]).push(null),v.push(null),x.push(null),E.push(null),y.push(null),D.push(null),w.push(null),A.push(new Date(n)),f.length>0&&f.forEach(function(e){e&&(1!=isNaN(e.roomtemp)&&b.push(e.roomtemp),1!=isNaN(e.setpoint)&&v.push(e.setpoint),e.fanspeed?x.push(e.fanspeed):x.push("undefined"),e.horizontalvans?E.push(e.horizontalvans):E.push("undefined"),e.usermode?y.push(e.usermode):y.push("undefined"),e.verticalvans?D.push(e.verticalvans):D.push("undefined"),e.wifiSignal?w.push(e.wifiSignal):w.push("undefined"),A.push(new Date(e.timestamp)))}),g=f.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",b.push(null),v.push(null),x.push(null),E.push(null),y.push(null),D.push(null),w.push(null),A.push(new Date(r)),p={x:"x",columns:[A,v,b,x,E,y,D,w]},m.y.label="\xb0F",_=Object(o.a)(5,n,r),O="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,O=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",u.x.lines=[],_.forEach(function(e){u.x.lines.push({value:e,class:"grid4"})}),m.y.tick.format=function(e){return parseFloat(e).toFixed(2)},m.y.tick.values=[0,20,40,60,80,100],m.y.max=100,m.y.min=0,m.x.tick.format=O,m.x.tick.values=_,this.props.loadNextInsight(),Object(s.h)(d,this.callLiveUpdate),this.setState({grid:u,axis1:m,graphData:p,loading:!1,lastUpdatedAt:g}),h.label=2;case 2:return[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData,r=e.axis1,l=e.grid,o=e.lastUpdatedAt,s=this.props,u=s.instance,m=s.buildingName,p=s.device,h=s.equipment;return"No Data"==o?n.createElement(n.Fragment,null):n.createElement("div",{className:"row col-md-12 device-graphs",id:"divGraphs"},n.createElement("br",null),n.createElement("h5",{className:"no-padding no-margin-color-textalign tooltipDashboard graphHeading"},n.createElement("a",{className:"col-md-8 sentence-break",onClick:function(){window.location.hash=u+"/"+m+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(c.g)(p.moncondevice)}},h.length>0&&h[0].rdfsLabel?h[0].rdfsLabel:"No equipment assigned"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Space: ",Object(c.g)(p.spaceRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Equipment: ",null===h||void 0===h?void 0:h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(p.rdfsLabel)||"No device assigned"," ")),n.createElement("span",{className:"lastUpdated"},"Last: ",o)),t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(i.a,{data:a,size:{height:300},axis:r,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0},colors:{spaceTemp:"red",cooltemp:"blue",fan:"pink"}}))},t}(n.Component);t.a=g},2971:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(715),o=a(803),s=a(124),u=a(760),c=(a.n(u),a(11)),m=a(837),p=a(857),h=a(122),g=a(736),d=a(796),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(c.g)(e)&&Object(s.g)(Object(c.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,o,s,u,m,p,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(h.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(d.e)(g.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(l.moncondevice)],null)]);case 1:return s=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,m=new Date(u[0][1]),s=s.filter(function(e){return new Date(e.timeofalarm)>m})),this.setState({alarmSensedPoints:o,deviceAlarms:s},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(p=[],f=0;f<t.length;f++)v=t[f],p.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:p}),y.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,u=l.graphData,c=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},c){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(c.minimumExtremeValue),b.push(c.minimumNormalValue),y.push(c.maximumNormalValue),x.push(c.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!c.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!c.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!c.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!c.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=c,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=m.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props,s=o.liveGraphRange,u=o.showAlarmPoints;if(n&&n.length&&l){for(var c=0;c<n.length;c++){var m=n[c];if(m.graphData.columns&&m.graphData.columns.length){if(m.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var p=Object.keys(e),h=function(t){var a=p[t],n=1;m.sensedKeys&&m.sensedKeys.length&&m.sensedKeys.find(function(e){return e==a})&&(m.graphData.columns[n].push(e[a]),n++,m.graphData.columns[n].splice(1,1))},g=0;g<p.length;g++)h(g);(l.getTime()-m.graphData.columns[0][2].getTime())/6e4>s&&m.graphData.columns[0].splice(1,1),m.axis.x.tick.values[2]&&m.axis.x.tick.values[1].getTime()&&m.axis.x.tick.values[2].getTime()-m.axis.x.tick.values[1].getTime()<l.getTime()-m.axis.x.tick.values[m.axis.x.tick.values.length-1]&&(m.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),l.setSeconds(0),s>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),m.axis.x.tick.values.push(l),r.x.lines.push({value:l,class:"grid4"}))}}var d=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:d},function(){if(u){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(c.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(c.g)(i.relatedEquipment)})||r.push({value:Object(c.g)(i.relatedEquipment),label:Object(c.g)(i.relatedEquipmentLabel),space:Object(c.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,m,h,g,d,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.devicePoints,u=t.isEquipment,m=t.equipment,h=t.showAlarmPoints,g=this.state,d=g.grid,f=g.lastUpdatedAt,v=[],b=[],u&&(b=i.filter(function(e){return Object(c.g)(e.relatedEquipment)==m.ontology})),a&&a.moncondevice?(x=Object(c.g)(a.topic),E=[],!u||u&&b.length?[4,Object(l.j)(x,n,r,!1)]:[3,2]):[3,3];case 1:E=y.sent(),y.label=2;case 2:if(w=["x"],(D={Normal_Frequency:["Normal Freq"],Emergency_Frequency:["Emergency Freq"]}).Normal_Frequency.push(null),D.Emergency_Frequency.push(null),w.push(new Date(n)),E.length>0&&E.forEach(function(e){e&&(D.Normal_Frequency.push(e.Normal_Frequency||"0"),D.Emergency_Frequency.push(e.Emergency_Frequency||"0"),w.push(new Date(e.timestamp)))}),f=E.length>0?null===(e=w[w.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",D.Normal_Frequency.push(null),D.Emergency_Frequency.push(null),w.push(new Date(r)),w.length>1){if(A=Object(o.a)(5,n,r),_="",A.length>1?(O=((new Date).getTime()-A[0].getTime())/1e3,_=(O/=3600)>24?"%m-%d %H:%M":O<.3?"%H:%M:%S":"%H:%M"):_="%H:%M:%S",d.x.lines=[],A.forEach(function(e){d.x.lines.push({value:e,class:"grid4"})}),u){for((P=JSON.parse(JSON.stringify(p.a))).name="ATS Frequency",P.graphData.columns=[w],P.graphData.x="x",L=0;L<b.length;L++)S=b[L],V=Object(c.g)(S.sensedValue),P.sensedKeys.push(V),P.graphData.columns.push(D[""+V]);P.axis.y.label="Hz",P.axis.y.tick.values=[0,20,40,60,80],P.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},P.axis.x.tick.format=_,P.axis.x.tick.values=A,P.axis.y.max=80,P.axis.y.min=0,P.graphEquipment=this.fetchEquipmentFromPoints(P.name,P.sensedKeys),v.push(P)}else for(j=function(e){var t,a="ATS Frequency",n=JSON.parse(JSON.stringify(p.a));n.name=a,n.axis.y.label="Hz",n.axis.y.tick.values=[0,20,40,60,80],n.axis.y.max=80,n.sensedKeys=["Normal_Frequency","Emergency_Frequency"],t=[w,D.Normal_Frequency,D.Emergency_Frequency],n.axis.y.tick.format=function(e){return parseFloat(e).toFixed(2)},n.axis.y.min=0,n.axis.x.tick.format=_,n.axis.x.tick.values=A,n.graphData.x="x",n.graphData.columns=t,n.graphEquipment=N.fetchEquipmentFromPoints(a,n.sensedKeys),v.push(n)},N=this,L=0;L<1;L++)j(L);this.props.loadNextInsight(),Object(s.h)(x,this.callLiveUpdate),this.setState({grid:d,graphData:v,lastUpdatedAt:f,loading:!1},function(){h&&R.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,s=this.props,u=s.instance,m=s.buildingName,p=s.device,h=s.insightRelEquipment,g=s.showAlarmPoints;return"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,s,d="";return g&&t.alarmStatus&&("active"==t.alarmStatus?d="alarm-graph":"ack"==t.alarmStatus?d="alarm-ack-graph":"clear"==t.alarmStatus&&(d="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(s=t.graphDataAlarmPoint.columns)||void 0===s?void 0:s.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+d,id:"divGraphs"},n.createElement("br",null),g&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+u+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+u+"/"+m+"/Insights/Equipment/Graphs/ATS/"+Object(c.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2972:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(715),o=a(803),s=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,o,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props.showAlarmPoints,o=new Date;e["@timestamp"]&&(o=new Date(e["@timestamp"]),o=new Date(o.setHours(o.getHours()+10)));var s=this.props.liveGraphRange;if(n&&n.length&&o){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(o),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(o.getTime()-c.graphData.columns[0][2].getTime())/6e4>s&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<o.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),o.setSeconds(0),s>10&&o.setMinutes(o.getMinutes()-o.getMinutes()%5),c.axis.x.tick.values.push(o),r.x.lines.push({value:o,class:"grid4"}))}}var g=null===o||void 0===o?void 0:o.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:g},function(){if(l){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.graphsList,c=t.devicePoints,m=t.isEquipment,p=t.equipment,g=this.state,f=g.grid,v=g.graphData,b=g.lastUpdatedAt,x=[],m&&(x=c.filter(function(e){return Object(s.g)(e.relatedEquipment)==p.ontology})),a&&a.moncondevice?(E=Object(s.g)(a.topic),D=[],!m||m&&x.length?[4,Object(l.m)(E,n,r,!1)]:[3,2]):[3,3];case 1:D=y.sent(),y.label=2;case 2:if(A=["x"],(w={GenVAB_Volts:["VAB"],GenVBC_Volts:["VBC"],GenVCA_Volts:["VCA"],GenVAN_Volts:["VA"],GenVBN_Volts:["VB"],GenVCN_Volts:["VC"],BusVoltage_Volts:["Bus Voltage"],GenIA_Amps:["Gen IA"],GenIB_Amps:["Gen IB"],GenIC_Amps:["Gen IC"],GenKVA_A_KiloVA:["Gen kVA A"],GenKVA__B_KiloVA:["Gen kVA B"],GenKVA_C_KiloVA:["Gen kVA C"],GenKVA_Total_KiloVA:["Gen kVA Total"],Gen_A_kW:["Gen kW A"],Gen_B_kW:["Gen kW B"],Gen_C_kW:["Gen kW C"],Gen_Total_kW:["Gen kW Total"],GenPFLagging:["Gen Power Factor"],ActiveSpeedSource:["Act speed"],EngineSpeed_rpm:["Engine Speed"],EngineLoad_pct:["Engine Load"],CoolantTemp_F:["Coolant Temp"],OilPressure_psi:["Oil Press"],BatteryVoltage_DeciVolt:["Battery Volt"],FuelLevel:["Fuel Level"],ECUCoolantLevel:["ECU Coolant level"],CoolDownTimeRemaining_mins:["Cool Down Time Rem."],UnexpectedShutdown:["Unexp. Shutdown"],GlobalAlarm:["Global Alarm"],AutoRestartFailure:["Auto Restart Fail"],FuelLeakDetect:["Fuel Leak Det."],BatteryChargerFailure:["Battery Chg. Fail"],TransferFail:["Transfer Fail"],LowCoolantLevel:["Low Coolant level"],ECUShutdown:["ECU Shutdown"],EmergencyShutdown:["Emerg. Shut"],Overcrank:["Overcrank"],LossofECUComms:["Loss of ECU Comms"],GlobalSenderFail:["Global Sender Fail"],LowFuelLevel:["Low Fuel Level"],LowOilPressure:["Low Oil Press"],HighCoolantTemp:["High Coolant"]}).GenVAB_Volts.push(null),w.GenVBC_Volts.push(null),w.GenVCA_Volts.push(null),w.GenVAN_Volts.push(null),w.GenVBN_Volts.push(null),w.GenVCN_Volts.push(null),w.BusVoltage_Volts.push(null),w.GenIA_Amps.push(null),w.GenIB_Amps.push(null),w.GenIC_Amps.push(null),w.GenKVA_A_KiloVA.push(null),w.GenKVA__B_KiloVA.push(null),w.GenKVA_C_KiloVA.push(null),w.GenKVA_Total_KiloVA.push(null),w.Gen_A_kW.push(null),w.Gen_B_kW.push(null),w.Gen_C_kW.push(null),w.Gen_Total_kW.push(null),w.GenPFLagging.push(null),w.ActiveSpeedSource.push(null),w.EngineSpeed_rpm.push(null),w.EngineLoad_pct.push(null),w.CoolantTemp_F.push(null),w.OilPressure_psi.push(null),w.BatteryVoltage_DeciVolt.push(null),w.FuelLevel.push(null),w.ECUCoolantLevel.push(null),w.CoolDownTimeRemaining_mins.push(null),w.UnexpectedShutdown.push(null),w.GlobalAlarm.push(null),w.AutoRestartFailure.push(null),w.FuelLeakDetect.push(null),w.BatteryChargerFailure.push(null),w.TransferFail.push(null),w.LowCoolantLevel.push(null),w.ECUShutdown.push(null),w.EmergencyShutdown.push(null),w.Overcrank.push(null),w.LossofECUComms.push(null),w.GlobalSenderFail.push(null),w.LowFuelLevel.push(null),w.LowOilPressure.push(null),w.HighCoolantTemp.push(null),A.push(new Date(n)),D.length>0&&D.forEach(function(e){e&&(w.GenVAB_Volts.push(e.GenVAB_Volts||0),w.GenVBC_Volts.push(e.GenVBC_Volts||0),w.GenVCA_Volts.push(e.GenVCA_Volts||0),w.GenVAN_Volts.push(e.GenVAN_Volts||0),w.GenVBN_Volts.push(e.GenVBN_Volts||0),w.GenVCN_Volts.push(e.GenVCN_Volts||0),w.BusVoltage_Volts.push(e.BusVoltage_Volts||0),w.GenIA_Amps.push(e.GenIA_Amps||0),w.GenIB_Amps.push(e.GenIB_Amps||0),w.GenIC_Amps.push(e.GenIC_Amps||0),w.GenKVA_A_KiloVA.push(e.GenKVA_A_KiloVA||0),w.GenKVA__B_KiloVA.push(e.GenKVA__B_KiloVA||0),w.GenKVA_C_KiloVA.push(e.GenKVA_C_KiloVA||0),w.GenKVA_Total_KiloVA.push(e.GenKVA_Total_KiloVA||0),w.Gen_A_kW.push(e.Gen_A_kW||0),w.Gen_B_kW.push(e.Gen_B_kW||0),w.Gen_C_kW.push(e.Gen_C_kW||0),w.Gen_Total_kW.push(e.Gen_Total_kW||0),w.GenPFLagging.push(e.GenPFLagging||0),w.ActiveSpeedSource.push(e.ActiveSpeedSource||0),w.EngineSpeed_rpm.push(e.EngineSpeed_rpm||0),w.EngineLoad_pct.push(e.EngineLoad_pct||0),w.CoolantTemp_F.push(e.CoolantTemp_F||0),w.OilPressure_psi.push(e.OilPressure_psi||0),w.BatteryVoltage_DeciVolt.push(e.BatteryVoltage_DeciVolt||0),w.FuelLevel.push(e.FuelLevel||0),w.ECUCoolantLevel.push(e.ECUCoolantLevel||0),w.CoolDownTimeRemaining_mins.push(e.CoolDownTimeRemaining_mins||0),w.UnexpectedShutdown.push(e.UnexpectedShutdown||0),w.GlobalAlarm.push(e.GlobalAlarm||0),w.AutoRestartFailure.push(e.AutoRestartFailure||0),w.FuelLeakDetect.push(e.FuelLeakDetect||0),w.BatteryChargerFailure.push(e.BatteryChargerFailure||0),w.TransferFail.push(e.TransferFail||0),w.LowCoolantLevel.push(e.LowCoolantLevel||0),w.ECUShutdown.push(e.ECUShutdown||0),w.EmergencyShutdown.push(e.EmergencyShutdown||0),w.Overcrank.push(e.Overcrank||0),w.LossofECUComms.push(e.LossofECUComms||0),w.GlobalSenderFail.push(e.GlobalSenderFail||0),w.LowFuelLevel.push(e.LowFuelLevel||0),w.LowOilPressure.push(e.LowOilPressure||0),w.HighCoolantTemp.push(e.HighCoolantTemp||0),A.push(new Date(e.timestamp)))}),b=D.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",w.GenVAB_Volts.push(null),w.GenVBC_Volts.push(null),w.GenVCA_Volts.push(null),w.GenVAN_Volts.push(null),w.GenVBN_Volts.push(null),w.GenVCN_Volts.push(null),w.BusVoltage_Volts.push(null),w.GenIA_Amps.push(null),w.GenIB_Amps.push(null),w.GenIC_Amps.push(null),w.GenKVA_A_KiloVA.push(null),w.GenKVA__B_KiloVA.push(null),w.GenKVA_C_KiloVA.push(null),w.GenKVA_Total_KiloVA.push(null),w.Gen_A_kW.push(null),w.Gen_B_kW.push(null),w.Gen_C_kW.push(null),w.Gen_Total_kW.push(null),w.GenPFLagging.push(null),w.ActiveSpeedSource.push(null),w.EngineSpeed_rpm.push(null),w.EngineLoad_pct.push(null),w.CoolantTemp_F.push(null),w.OilPressure_psi.push(null),w.BatteryVoltage_DeciVolt.push(null),w.FuelLevel.push(null),w.ECUCoolantLevel.push(null),w.CoolDownTimeRemaining_mins.push(null),w.UnexpectedShutdown.push(null),w.GlobalAlarm.push(null),w.AutoRestartFailure.push(null),w.FuelLeakDetect.push(null),w.BatteryChargerFailure.push(null),w.TransferFail.push(null),w.LowCoolantLevel.push(null),w.ECUShutdown.push(null),w.EmergencyShutdown.push(null),w.Overcrank.push(null),w.LossofECUComms.push(null),w.GlobalSenderFail.push(null),w.LowFuelLevel.push(null),w.LowOilPressure.push(null),w.HighCoolantTemp.push(null),A.push(new Date(r)),A.length>1){if(_=Object(o.a)(5,n,r),O="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,O=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",f.x.lines=[],_.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),m){for((S=JSON.parse(JSON.stringify(d.a))).name="Baslor Generator",S.graphData.columns=[A],S.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},S.axis.x.tick.format=O,S.axis.x.tick.values=_,S.graphData.x="x",R=0;R<x.length;R++)V=x[R],j=Object(s.g)(V.sensedValue),S.sensedKeys.push(j),S.graphData.columns.push(w[""+j]);S.graphEquipment=this.fetchEquipmentFromPoints(S.name,S.sensedKeys),v.push(S)}else for(N=function(e){var t=u[e],a=JSON.parse(JSON.stringify(d.a)),n=0,r=[];a.name=t,"Voltages"==t?(a.axis.y.label="Volts",a.axis.y.tick.values=[0,50,100,150,200,250],a.axis.y.max=250,a.axis.y.min=0,a.sensedKeys=["GenVAB_Volts","GenVBC_Volts","GenVCA_Volts","GenVAN_Volts","GenVBN_Volts","GenVCN_Volts","BusVoltage_Volts"],r=[A,w.GenVAB_Volts,w.GenVBC_Volts,w.GenVCA_Volts,w.GenVAN_Volts,w.GenVBN_Volts,w.GenVCN_Volts,w.BusVoltage_Volts]):"Currents"==t?(a.axis.y.label="Amps",a.axis.y.tick.values=[0,10,20,30,40,50],a.axis.y.max=50,a.axis.y.min=0,n=1,a.sensedKeys=["GenIA_Amps","GenIB_Amps","GenIC_Amps"],r=[A,w.GenIA_Amps,w.GenIB_Amps,w.GenIC_Amps]):"Powers"==t?(a.axis.y.label="Watts",a.axis.y.tick.values=[0,20,40,60,80,100],a.axis.y.max=100,a.axis.y.min=0,n=1,a.sensedKeys=["GenKVA_A_KiloVA","GenKVA__B_KiloVA","GenKVA_C_KiloVA","GenKVA_Total_KiloVA","Gen_A_kW","Gen_B_kW","Gen_C_kW","Gen_Total_kW"],r=[A,w.GenKVA_A_KiloVA,w.GenKVA__B_KiloVA,w.GenKVA_C_KiloVA,w.GenKVA_Total_KiloVA,w.Gen_A_kW,w.Gen_B_kW,w.Gen_C_kW,w.Gen_Total_kW]):"Power Factor"==t?(a.axis.y.label="",a.axis.y.tick.values=[-1,0,1],a.axis.y.max=1,a.axis.y.min=-1,a.sensedKeys=["GenPFLagging"],r=[A,w.GenPFLagging]):"Other Parameters"==t?(a.axis.y.label="",a.axis.y.tick.values=[0,40,80,120,160,160],a.axis.y.max=160,a.axis.y.min=0,a.sensedKeys=["ActiveSpeedSource","EngineSpeed_rpm","EngineLoad_pct","CoolantTemp_F","OilPressure_psi","BatteryVoltage_DeciVolt","FuelLevel","ECUCoolantLevel","CoolDownTimeRemaining_mins"],r=[A,w.ActiveSpeedSource,w.EngineSpeed_rpm,w.EngineLoad_pct,w.CoolantTemp_F,w.OilPressure_psi,w.BatteryVoltage_DeciVolt,w.FuelLevel,w.ECUCoolantLevel,w.CoolDownTimeRemaining_mins]):"Binary Parameters"==t&&(a.axis.y.label="",a.axis.y.tick.values=[-1,0,1],a.axis.y.max=1,a.axis.y.min=-1,a.sensedKeys=["UnexpectedShutdown","GlobalAlarm","AutoRestartFailure","FuelLeakDetect","BatteryChargerFailure","TransferFail","LowCoolantLevel","ECUShutdown","EmergencyShutdown","Overcrank","LossofECUComms","GlobalSenderFail","LowFuelLevel","LowOilPressure","HighCoolantTemp"],r=[A,w.UnexpectedShutdown,w.GlobalAlarm,w.AutoRestartFailure,w.FuelLeakDetect,w.BatteryChargerFailure,w.TransferFail,w.LowCoolantLevel,w.ECUShutdown,w.EmergencyShutdown,w.Overcrank,w.LossofECUComms,w.GlobalSenderFail,w.LowFuelLevel,w.LowOilPressure,w.HighCoolantTemp]),a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=O,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=L.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},L=this,R=0;R<u.length;R++)N(R);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:f,graphData:v,lastUpdatedAt:b,loading:!1},function(){i&&k.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.showAlarmPoints,g=u.insightRelEquipment;return o&&"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d,f="";return h&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),h&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/Generator/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2973:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(715),o=a(803),s=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,o,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props.showAlarmPoints,o=new Date;e["@timestamp"]&&(o=new Date(e["@timestamp"]),o=new Date(o.setHours(o.getHours()+10)));var s=this.props.liveGraphRange;if(n&&n.length&&o){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(o),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(o.getTime()-c.graphData.columns[0][2].getTime())/6e4>s&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<o.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),o.setSeconds(0),s>10&&o.setMinutes(o.getMinutes()-o.getMinutes()%5),c.axis.x.tick.values.push(o),r.x.lines.push({value:o,class:"grid4"}))}}var g=null===o||void 0===o?void 0:o.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:g},function(){if(l){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.graphsList,c=t.devicePoints,m=t.isEquipment,p=t.equipment,g=this.state,f=g.grid,v=g.lastUpdatedAt,b=[],x=[],m&&(x=c.filter(function(e){return Object(s.g)(e.relatedEquipment)==p.ontology})),a&&a.moncondevice?(E=Object(s.g)(a.topic),D=[],!m||m&&x.length?[4,Object(l.k)(E,n,r,!1)]:[3,2]):[3,3];case 1:D=y.sent(),y.label=2;case 2:if(A=["x"],(w={register1:["Register"],t3frontRefrigerator1:["Front"],t4backRefrigerator1:["Back"],t5evapfanRefrigerator1:["Evaporator Fan"],t6comprinRefrigerator1:["Compressor In"],t7comproutRefrigerator1:["Compressor Out"],t8probeRefrigerator1:["Solid"],t3frontRefrigerator2:["Front"],t4backRefrigerator2:["Back"],t5evapfanRefrigerator2:["Evaporator Fan"],t6comprinRefrigerator2:["Compressor In"],t7comproutRefrigerator2:["Compressor Out"],t8probeRefrigerator2:["Solid"],t3frontRefrigerator3:["Front"],t4backRefrigerator3:["Back"],t5evapfanRefrigerator3:["Evaporator Fan"],t6comprinRefrigerator3:["Compressor In"],t7comproutRefrigerator3:["Compressor Out"],t8probeRefrigerator3:["Solid"],t3frontRefrigerator4:["Front"],t4backRefrigerator4:["Back"],t5evapfanRefrigerator4:["Evaporator Fan"],t6comprinRefrigerator4:["Compressor In"],t7comproutRefrigerator4:["Compressor Out"],t8probeRefrigerator4:["Solid"]}).register1.push(null),w.t3frontRefrigerator1.push(null),w.t4backRefrigerator1.push(null),w.t5evapfanRefrigerator1.push(null),w.t6comprinRefrigerator1.push(null),w.t7comproutRefrigerator1.push(null),w.t8probeRefrigerator1.push(null),w.t3frontRefrigerator2.push(null),w.t4backRefrigerator2.push(null),w.t5evapfanRefrigerator2.push(null),w.t6comprinRefrigerator2.push(null),w.t7comproutRefrigerator2.push(null),w.t8probeRefrigerator2.push(null),w.t3frontRefrigerator3.push(null),w.t4backRefrigerator3.push(null),w.t5evapfanRefrigerator3.push(null),w.t6comprinRefrigerator3.push(null),w.t7comproutRefrigerator3.push(null),w.t8probeRefrigerator3.push(null),w.t3frontRefrigerator4.push(null),w.t4backRefrigerator4.push(null),w.t5evapfanRefrigerator4.push(null),w.t6comprinRefrigerator4.push(null),w.t7comproutRefrigerator4.push(null),w.t8probeRefrigerator4.push(null),A.push(new Date(n)),D.length>0&&D.forEach(function(e){e&&(w.register1.push(""+e.register1||"0"),w.t3frontRefrigerator1.push(""+e.t3frontRefrigerator1||"0"),w.t4backRefrigerator1.push(""+e.t4backRefrigerator1||"0"),w.t5evapfanRefrigerator1.push(""+e.t5evapfanRefrigerator1||"0"),w.t6comprinRefrigerator1.push(""+e.t6comprinRefrigerator1||"0"),w.t7comproutRefrigerator1.push(""+e.t7comproutRefrigerator1||"0"),w.t8probeRefrigerator1.push(""+e.t8probeRefrigerator1||"0"),w.t3frontRefrigerator2.push(""+e.t3frontRefrigerator2||"0"),w.t4backRefrigerator2.push(""+e.t4backRefrigerator2||"0"),w.t5evapfanRefrigerator2.push(""+e.t5evapfanRefrigerator2||"0"),w.t6comprinRefrigerator2.push(""+e.t6comprinRefrigerator2||"0"),w.t7comproutRefrigerator2.push(""+e.t7comproutRefrigerator2||"0"),w.t8probeRefrigerator2.push(""+e.t8probeRefrigerator2||"0"),w.t3frontRefrigerator3.push(""+e.t3frontRefrigerator3||"0"),w.t4backRefrigerator3.push(""+e.t4backRefrigerator3||"0"),w.t5evapfanRefrigerator3.push(""+e.t5evapfanRefrigerator3||"0"),w.t6comprinRefrigerator3.push(""+e.t6comprinRefrigerator3||"0"),w.t7comproutRefrigerator3.push(""+e.t7comproutRefrigerator3||"0"),w.t8probeRefrigerator3.push(""+e.t8probeRefrigerator3||"0"),w.t3frontRefrigerator4.push(""+e.t3frontRefrigerator4||"0"),w.t4backRefrigerator4.push(""+e.t4backRefrigerator4||"0"),w.t5evapfanRefrigerator4.push(""+e.t5evapfanRefrigerator4||"0"),w.t6comprinRefrigerator4.push(""+e.t6comprinRefrigerator4||"0"),w.t7comproutRefrigerator4.push(""+e.t7comproutRefrigerator4||"0"),w.t8probeRefrigerator4.push(""+e.t8probeRefrigerator4||"0"),A.push(new Date(e.timestamp)))}),v=D.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",w.register1.push(null),w.t3frontRefrigerator1.push(null),w.t4backRefrigerator1.push(null),w.t5evapfanRefrigerator1.push(null),w.t6comprinRefrigerator1.push(null),w.t7comproutRefrigerator1.push(null),w.t8probeRefrigerator1.push(null),w.t3frontRefrigerator2.push(null),w.t4backRefrigerator2.push(null),w.t5evapfanRefrigerator2.push(null),w.t6comprinRefrigerator2.push(null),w.t7comproutRefrigerator2.push(null),w.t8probeRefrigerator2.push(null),w.t3frontRefrigerator3.push(null),w.t4backRefrigerator3.push(null),w.t5evapfanRefrigerator3.push(null),w.t6comprinRefrigerator3.push(null),w.t7comproutRefrigerator3.push(null),w.t8probeRefrigerator3.push(null),w.t3frontRefrigerator4.push(null),w.t4backRefrigerator4.push(null),w.t5evapfanRefrigerator4.push(null),w.t6comprinRefrigerator4.push(null),w.t7comproutRefrigerator4.push(null),w.t8probeRefrigerator4.push(null),A.push(new Date(r)),A.length>1){if(_=Object(o.a)(5,n,r),O="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,O=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",f.x.lines=[],_.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),m){for((S=JSON.parse(JSON.stringify(d.a))).name="Temperatures",S.graphData.columns=[A],S.graphData.x="x",R=0;R<x.length;R++)V=x[R],j=Object(s.g)(V.sensedValue),S.sensedKeys.push(j),S.graphData.columns.push(w[""+j]);S.axis.y.tick.values=[0,20,40,60,80,100],S.axis.y.label="\xb0F",S.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},S.axis.y.max=100,S.axis.y.min=0,S.axis.x.tick.format=O,S.axis.x.tick.values=_,S.graphEquipment=this.fetchEquipmentFromPoints(S.name,S.sensedKeys),b.push(S)}else for(N=function(e){var t=u[e],a=JSON.parse(JSON.stringify(d.a)),n=[];a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["t3frontRefrigerator1","t4backRefrigerator1","t5evapfanRefrigerator1","t6comprinRefrigerator1","t7comproutRefrigerator1","t8probeRefrigerator1"],n=[A,w.register1,w.t3frontRefrigerator1,w.t4backRefrigerator1,w.t5evapfanRefrigerator1,w.t6comprinRefrigerator1,w.t7comproutRefrigerator1,w.t8probeRefrigerator1]):"Refrigerator 2"==t?(a.sensedKeys=["t3frontRefrigerator2","t4backRefrigerator2","t5evapfanRefrigerator2","t6comprinRefrigerator2","t7comproutRefrigerator2","t8probeRefrigerator2"],n=[A,w.register1,w.t3frontRefrigerator2,w.t4backRefrigerator2,w.t5evapfanRefrigerator2,w.t6comprinRefrigerator2,w.t7comproutRefrigerator2,w.t8probeRefrigerator2]):"Refrigerator 3"==t?(a.sensedKeys=["t3frontRefrigerator3","t4backRefrigerator3","t5evapfanRefrigerator3","t6comprinRefrigerator3","t7comproutRefrigerator3","t8probeRefrigerator3"],n=[A,w.register1,w.t3frontRefrigerator3,w.t4backRefrigerator3,w.t5evapfanRefrigerator3,w.t6comprinRefrigerator3,w.t7comproutRefrigerator3,w.t8probeRefrigerator3]):"Refrigerator 2"==t&&(a.sensedKeys=["t3frontRefrigerator4","t4backRefrigerator4","t5evapfanRefrigerator4","t6comprinRefrigerator4","t7comproutRefrigerator4","t8probeRefrigerator4"],n=[A,w.register1,w.t3frontRefrigerator4,w.t4backRefrigerator4,w.t5evapfanRefrigerator4,w.t6comprinRefrigerator4,w.t7comproutRefrigerator4,w.t8probeRefrigerator4]),a.axis.y.tick.values=[0,20,40,60,80,100],a.axis.y.label="\xb0F",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.y.max=100,a.axis.y.min=0,a.axis.x.tick.format=O,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=L.fetchEquipmentFromPoints(t,a.sensedKeys),b.push(a)},L=this,R=0;R<u.length;R++)N(R);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:f,graphData:b,lastUpdatedAt:v,loading:!1},function(){i&&k.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.showAlarmPoints,g=u.insightRelEquipment;return"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d,f="";return h&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),h&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/CBW406/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2974:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(715),o=a(803),s=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,o,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props.showAlarmPoints,o=new Date;e["@timestamp"]&&(o=new Date(e["@timestamp"]),o=new Date(o.setHours(o.getHours()+10)));var s=this.props.liveGraphRange;if(n&&n.length&&o){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(o),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(o.getTime()-c.graphData.columns[0][2].getTime())/6e4>s&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<o.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),o.setSeconds(0),s>10&&o.setMinutes(o.getMinutes()-o.getMinutes()%5),c.axis.x.tick.values.push(o),r.x.lines.push({value:o,class:"grid4"}))}}var g=null===o||void 0===o?void 0:o.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:g},function(){if(l){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k,q,C,F,K,M,G=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.graphsList,c=t.devicePoints,m=t.isEquipment,p=t.equipment,g=this.state,f=g.grid,v=g.graphData,b=g.lastUpdatedAt,x=[],m&&(x=c.filter(function(e){return Object(s.g)(e.relatedEquipment)==p.ontology})),a&&a.moncondevice?(E=Object(s.g)(a.topic),D=[],!m||m&&x.length?[4,Object(l.l)(E,n,r,!1)]:[3,2]):[3,3];case 1:D=y.sent(),y.label=2;case 2:if(A=["x"],(w={a13comprcurrRefrigerator1:["Compressor"],a14efmcurrRefrigerator1:["EFM"],a15prRefrigerator1:["Pressure Sensor"],a16doorRefrigerator1:["Door Contact"],a13comprcurrRefrigerator2:["Compressor"],a14efmcurrRefrigerator2:["EFM"],a15prRefrigerator2:["Pressure Sensor"],a16doorRefrigerator2:["Door Contact"],register1:["Register"],serialNumber:["Serial Number"],minRecRefresh:["Refresh"],a13comprcurrRefrigerator3:["Compressor"],a14efmcurrRefrigerator3:["EFM"],a15prRefrigerator3:["Pressure Sensor"],a16doorRefrigerator3:["Door Contact"],a13comprcurrRefrigerator4:["Compressor"],a14efmcurrRefrigerator4:["EFM"],a15prRefrigerator4:["Pressure Sensor"],a16doorRefrigerator4:["Door Contact"],amalgamatedWattsRefrigerator1:["Amalgamated Watts"],amalgamatedWattsRefrigerator2:["Amalgamated Watts"],amalgamatedWattsRefrigerator3:["Amalgamated Watts"],amalgamatedWattsRefrigerator4:["Amalgamated Watts"]}).a13comprcurrRefrigerator1.push(null),w.a14efmcurrRefrigerator1.push(null),w.a15prRefrigerator1.push(null),w.a16doorRefrigerator1.push(null),w.a13comprcurrRefrigerator2.push(null),w.a14efmcurrRefrigerator2.push(null),w.a15prRefrigerator2.push(null),w.a16doorRefrigerator2.push(null),w.a13comprcurrRefrigerator3.push(null),w.a14efmcurrRefrigerator3.push(null),w.a15prRefrigerator3.push(null),w.a16doorRefrigerator3.push(null),w.a13comprcurrRefrigerator4.push(null),w.a14efmcurrRefrigerator4.push(null),w.a15prRefrigerator4.push(null),w.a16doorRefrigerator4.push(null),w.register1.push(null),w.serialNumber.push(null),w.minRecRefresh.push(null),w.amalgamatedWattsRefrigerator1.push(null),w.amalgamatedWattsRefrigerator2.push(null),w.amalgamatedWattsRefrigerator3.push(null),w.amalgamatedWattsRefrigerator4.push(null),A.push(new Date(n)),_=!1,O=!1,P=!1,S=!1,D.length>0&&D.forEach(function(e){e&&(w.a13comprcurrRefrigerator1.push(""+e.a13comprcurrRefrigerator1||null),w.a14efmcurrRefrigerator1.push(""+e.a14efmcurrRefrigerator1||null),w.a15prRefrigerator1.push(""+e.a15prRefrigerator1||null),w.a16doorRefrigerator1.push(""+e.a16doorRefrigerator1||null),w.a13comprcurrRefrigerator2.push(""+e.a13comprcurrRefrigerator2||null),w.a14efmcurrRefrigerator2.push(""+e.a14efmcurrRefrigerator2||null),w.a15prRefrigerator2.push(""+e.a15prRefrigerator2||null),w.a16doorRefrigerator2.push(""+e.a16doorRefrigerator2||null),w.a13comprcurrRefrigerator3.push(""+e.a13comprcurrRefrigerator3||null),w.a14efmcurrRefrigerator3.push(""+e.a14efmcurrRefrigerator3||null),w.a15prRefrigerator3.push(""+e.a15prRefrigerator3||null),w.a16doorRefrigerator3.push(""+e.a16doorRefrigerator3||null),w.a13comprcurrRefrigerator4.push(""+e.a13comprcurrRefrigerator4||null),w.a14efmcurrRefrigerator4.push(""+e.a14efmcurrRefrigerator4||null),w.a15prRefrigerator4.push(""+e.a15prRefrigerator4||null),w.a16doorRefrigerator4.push(""+e.a16doorRefrigerator4||null),w.register1.push(""+e.register1||null),w.serialNumber.push(""+e.serialNumber||null),w.minRecRefresh.push(""+e.minRecRefresh||null),w.amalgamatedWattsRefrigerator1.push(""+360*e.a13comprcurrRefrigerator1||"0"),w.amalgamatedWattsRefrigerator2.push(""+360*e.a13comprcurrRefrigerator2||"0"),w.amalgamatedWattsRefrigerator3.push(""+360*e.a13comprcurrRefrigerator3||"0"),w.amalgamatedWattsRefrigerator4.push(""+360*e.a13comprcurrRefrigerator4||"0"),A.push(new Date(e.timestamp)),_=e.a14efmcurrRefrigerator1<-5,O=e.a14efmcurrRefrigerator2<-5,P=e.a14efmcurrRefrigerator3<-5,S=e.a14efmcurrRefrigerator4<-5)}),b=D.length>0?null===(e=A[A.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",w.a13comprcurrRefrigerator1.push(null),w.a14efmcurrRefrigerator1.push(null),w.a15prRefrigerator1.push(null),w.a16doorRefrigerator1.push(null),w.a13comprcurrRefrigerator2.push(null),w.a14efmcurrRefrigerator2.push(null),w.a15prRefrigerator2.push(null),w.a16doorRefrigerator2.push(null),w.a13comprcurrRefrigerator3.push(null),w.a14efmcurrRefrigerator3.push(null),w.a15prRefrigerator3.push(null),w.a16doorRefrigerator3.push(null),w.a13comprcurrRefrigerator4.push(null),w.a14efmcurrRefrigerator4.push(null),w.a15prRefrigerator4.push(null),w.a16doorRefrigerator4.push(null),w.register1.push(null),w.serialNumber.push(null),w.minRecRefresh.push(null),w.amalgamatedWattsRefrigerator1.push(null),w.amalgamatedWattsRefrigerator2.push(null),w.amalgamatedWattsRefrigerator3.push(null),w.amalgamatedWattsRefrigerator4.push(null),A.push(new Date(r)),A.length>1){if(V=Object(o.a)(5,n,r),j="",V.length>1?(N=((new Date).getTime()-V[0].getTime())/1e3,j=(N/=3600)>24?"%m-%d %H:%M":N<.3?"%H:%M:%S":"%H:%M"):j="%H:%M:%S",f.x.lines=[],V.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),m){for((L=JSON.parse(JSON.stringify(d.a))).name="Analog Values",L.graphData.columns=[A],L.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},L.axis.x.tick.format=j,L.axis.x.tick.values=V,L.graphData.x="x",R="",M=0;M<x.length;M++)k=x[M],q=Object(s.g)(k.sensedValue),L.sensedKeys.push(q),L.graphData.columns.push(w[""+q]),R=q.substr(q.length-1);L.graphEquipment=this.fetchEquipmentFromPoints(L.name,L.sensedKeys),C="1"==R?_:"2"==R?_:"3"==R?P:"4"==R&&S,L.axis.y.tick.values=C?[-20,-10,0,10,20]:[0,5,10,15,20],L.axis.y.label="Amps,PSI",L.axis.y.max=L.axis.y.tick.values[L.axis.y.tick.values.length-1],L.axis.y.min=L.axis.y.tick.values[0],v.push(L)}else for(F=function(e){var t=u[e],a=JSON.parse(JSON.stringify(d.a)),n=[];a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["a13comprcurrRefrigerator1","a14efmcurrRefrigerator1","a15prRefrigerator1","a16doorRefrigerator1"],n=[A,w.a13comprcurrRefrigerator1,w.a14efmcurrRefrigerator1,w.a15prRefrigerator1,w.a16doorRefrigerator1],a.axis.y.tick.values=_?[-20,-10,0,10,20]:[0,5,10,15,20],a.axis.y.label="Amps"):"Refrigerator 2"==t?(a.sensedKeys=["a13comprcurrRefrigerator2","a14efmcurrRefrigerator2","a15prRefrigerator2","a16doorRefrigerator2"],n=[A,w.a13comprcurrRefrigerator2,w.a14efmcurrRefrigerator2,w.a15prRefrigerator2,w.a16doorRefrigerator2],a.axis.y.tick.values=O?[-20,-10,0,10,20]:[0,5,10,15,20],a.axis.y.label="Amps"):"Refrigerator 3"==t?(a.sensedKeys=["a13comprcurrRefrigerator3","a14efmcurrRefrigerator3","a15prRefrigerator3","a16doorRefrigerator3"],n=[A,w.a13comprcurrRefrigerator3,w.a14efmcurrRefrigerator3,w.a15prRefrigerator3,w.a16doorRefrigerator3],a.axis.y.tick.values=P?[-20,-10,0,10,20]:[0,5,10,15,20],a.axis.y.label="Amps"):"Refrigerator 4"==t&&(a.sensedKeys=["a13comprcurrRefrigerator4","a14efmcurrRefrigerator4","a15prRefrigerator4","a16doorRefrigerator4"],n=[A,w.a13comprcurrRefrigerator4,w.a14efmcurrRefrigerator4,w.a15prRefrigerator4,w.a16doorRefrigerator4]),a.axis.y.tick.values=S?[-20,-10,0,10,20]:[0,5,10,15,20],a.axis.y.label="Amps,PSI",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1],a.axis.y.min=a.axis.y.tick.values[0],a.axis.x.tick.format=j,a.axis.x.tick.values=V,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=K.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},K=this,M=0;M<u.length;M++)F(M);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:f,graphData:v,lastUpdatedAt:b,loading:!1},function(){i&&G.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.showAlarmPoints,h=u.device,g=u.insightRelEquipment;return o&&"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d,f="";return p&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),p&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/CompressorControl/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:p&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2975:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(707),o=a(11),s=a(803),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,s,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(m.a)(!0),i&&!e?[3,2]:(s=[],r&&r.length&&r.forEach(function(e){s.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:s,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===s||void 0===s?void 0:s.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this.state,a=t.graphData,n=t.grid,r=new Date;e["@timestamp"]&&(r=new Date(e["@timestamp"]),r=new Date(r.setHours(r.getHours()+10)));var i=this.props.liveGraphRange,o=Object(l.a)(parseInt(null===e||void 0===e?void 0:e.v4relay_state));3==o.length?o="0"+o:2==o.length?o="00"+o:1==o.length&&(o="000"+o);var s=o[3],u=o[2],c=o[1],m=o[0];if(a&&a.length&&r){for(var p=0;p<a.length;p++){var h=a[p];if(h.graphData.columns&&h.graphData.columns.length){if(h.graphData.columns[0].push(r),e&&Object.keys(e).length)for(var g=Object.keys(e),d=function(t){var a=g[t],n=1;h.sensedKeys&&h.sensedKeys.length&&h.sensedKeys.find(function(e){return e==a})&&("v4relay_state"==a?(h.graphData.columns[8].splice(1,1),h.graphData.columns[8].push(s||"0"),h.graphData.columns[9].splice(1,1),h.graphData.columns[9].push(u||"0"),h.graphData.columns[10].splice(1,1),h.graphData.columns[10].push(c||"0"),h.graphData.columns[11].splice(1,1),h.graphData.columns[11].push(m||"0")):(h.graphData.columns[n].splice(1,1),h.graphData.columns[n].push(e[a]),n++))},f=0;f<g.length;f++)d(f);(r.getTime()-h.graphData.columns[0][2].getTime())/6e4>i&&h.graphData.columns[0].splice(1,1),h.axis.x.tick.values[2]&&h.axis.x.tick.values[1].getTime()&&h.axis.x.tick.values[2].getTime()-h.axis.x.tick.values[1].getTime()<r.getTime()-h.axis.x.tick.values[h.axis.x.tick.values.length-1]&&(h.axis.x.tick.values.splice(0,1),n.x.lines.splice(0,1),r.setSeconds(0),i>10&&r.setMinutes(r.getMinutes()-r.getMinutes()%5),h.axis.x.tick.values.push(r),n.x.lines.push({value:r,class:"grid4"}))}}var v=null===r||void 0===r?void 0:r.toLocaleString();this.setState({grid:n,graphData:a,lastUpdatedAt:v})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(o.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(o.g)(i.relatedEquipment)})||r.push({value:Object(o.g)(i.relatedEquipment),label:Object(o.g)(i.relatedEquipmentLabel),space:Object(o.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k,q,C,F,K,M,G,H,T,U,B=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.devicePoints,c=t.isEquipment,m=t.equipment,p=this.state,g=p.grid,f=p.graphData,v=p.lastUpdatedAt,b=[],c&&(b=u.filter(function(e){return Object(o.g)(e.relatedEquipment)==m.ontology})),a&&a.moncondevice?(x=Object(o.g)(a.topic),E=Object(o.g)(a.moncondevice),D=[],!c||c&&b.length?[4,Object(l.h)(x,n,r,!1)]:[3,2]):[3,4];case 1:D=y.sent(),y.label=2;case 2:return[4,Object(l.z)(E)];case 3:if(w=y.sent(),A=[],w[0]?(_=w[0],O=Object(o.g)(_.relayNames),A=O.split(",")):(A.push("Relay 1"),A.push("Relay 2"),A.push("Relay 3"),A.push("Relay 4")),P={mAmps_relay1:[A[0]+" Amp"],mAmps_relay2:[A[1]+" Amp"],mAmps_relay3:[A[2]+" Amp"],mAmps_relay4:[A[3]+" Amp"],nominal_src_volts:["Nom. Source Volts"],power_Wt_relay1:[A[0]+" Watts"],power_Wt_relay2:[A[1]+" Watts"],power_Wt_relay3:[A[2]+" Watts"],Relay1_State:[A[0]+" State"],Relay2_State:[A[1]+" State"],Relay3_State:[A[2]+" State"],Relay4_State:[A[3]+" State"]},S=["x"],P.mAmps_relay1.push(null),P.mAmps_relay2.push(null),P.mAmps_relay3.push(null),P.mAmps_relay4.push(null),P.nominal_src_volts.push(null),P.power_Wt_relay1.push(null),P.power_Wt_relay2.push(null),P.power_Wt_relay3.push(null),P.Relay1_State.push(null),P.Relay2_State.push(null),P.Relay3_State.push(null),P.Relay4_State.push(null),S.push(new Date(n)),D.length>0)for(U=0;U<D.length;U++)(null===(V=D[U])||void 0===V?void 0:V.mAmps_relay1)&&(P.mAmps_relay1.push(V.mAmps_relay1||"0"),P.mAmps_relay2.push(V.mAmps_relay2||"0"),P.mAmps_relay3.push(V.mAmps_relay3||"0"),P.mAmps_relay4.push(V.mAmps_relay4||"0"),P.nominal_src_volts.push(V.nominal_src_volts||"0"),P.power_Wt_relay1.push(V.power_Wt_relay1||"0"),P.power_Wt_relay2.push(V.power_Wt_relay2||"0"),P.power_Wt_relay3.push(V.power_Wt_relay3||"0"),j=Object(l.a)(parseInt(V.v4relay_state)),S.push(new Date(V.timestamp)),3==j.length?j="0"+j:2==j.length?j="00"+j:1==j.length&&(j="000"+j),N=j[3],L=j[2],R=j[1],k=j[0],P.Relay1_State.push(N||"0"),P.Relay2_State.push(L||"0"),P.Relay3_State.push(R||"0"),P.Relay4_State.push(k||"0"));if(v=D.length>0?null===(e=S[S.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",P.mAmps_relay1.push(null),P.mAmps_relay2.push(null),P.mAmps_relay3.push(null),P.mAmps_relay4.push(null),P.nominal_src_volts.push(null),P.power_Wt_relay1.push(null),P.power_Wt_relay2.push(null),P.power_Wt_relay3.push(null),P.Relay1_State.push(null),P.Relay2_State.push(null),P.Relay3_State.push(null),P.Relay4_State.push(null),S.push(new Date(r)),S.length>1){if(q=Object(s.a)(5,n,r),C="",q.length>1?(F=((new Date).getTime()-q[0].getTime())/1e3,C=(F/=3600)>24?"%m-%d %H:%M":F<.3?"%H:%M:%S":"%H:%M"):C="%H:%M:%S",g.x.lines=[],q.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((K=JSON.parse(JSON.stringify(d.a))).name="Relay V4",K.graphData.columns=[S],K.axis.x.tick.format=C,K.axis.x.tick.values=q,K.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},K.axis.y.tick.values=[0,50,100,150,200,250,300],K.axis.y.max=300,K.axis.y.min=0,K.graphData.x="x",U=0;U<b.length;U++)M=b[U],G=Object(o.g)(M.sensedValue),K.sensedKeys.push(G),"v4relay_state"==G?(K.graphData.columns.push(P.Relay1_State),K.graphData.columns.push(P.Relay2_State),K.graphData.columns.push(P.Relay3_State),K.graphData.columns.push(P.Relay4_State)):K.graphData.columns.push(P[""+G]);K.graphEquipment=this.fetchEquipmentFromPoints(K.name,K.sensedKeys),f.push(K)}else for(H=function(e){var t,a=JSON.parse(JSON.stringify(d.a));a.name="Relay V4",a.axis.y.label="Amp, W, On/Off, Volts",a.axis.y.tick.values=[0,50,100,150,200,250,300],a.axis.y.max=300,a.sensedKeys=["mAmps_relay1","mAmps_relay2","mAmps_relay3","mAmps_relay4","power_Wt_relay1","power_Wt_relay2","power_Wt_relay3","v4relay_state","nominal_src_volts"],t=[S,P.mAmps_relay1,P.mAmps_relay2,P.mAmps_relay3,P.mAmps_relay4,P.power_Wt_relay1,P.power_Wt_relay2,P.power_Wt_relay3,P.Relay1_State,P.Relay2_State,P.Relay3_State,P.Relay4_State,P.nominal_src_volts],a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(0)},a.axis.y.min=0,a.axis.x.tick.format=C,a.axis.x.tick.values=q,a.graphData.x="x",a.graphData.columns=t,a.graphEquipment=T.fetchEquipmentFromPoints("Relay V4",a.sensedKeys),f.push(a)},T=this,U=0;U<1;U++)H(U);this.props.loadNextInsight(),Object(h.h)(x,this.callLiveUpdate),this.setState({grid:g,graphData:f,lastUpdatedAt:v,loading:!1},function(){i&&B.changeAlarmStatus(!0)})}y.label=4;case 4:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,s=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.insightRelEquipment,g=u.showAlarmPoints;return s&&"No Data"==s?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d="";return g&&t.alarmStatus&&("active"==t.alarmStatus?d="alarm-graph":"ack"==t.alarmStatus?d="alarm-ack-graph":"clear"==t.alarmStatus&&(d="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+d,id:"divGraphs"},n.createElement("br",null),g&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/RelayControl/"+Object(o.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",s)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2976:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),l=a(715),o=a(803),s=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},x=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return y(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return y(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,l,o,u,h,g,d,f,v,b=this;return y(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,l=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(b.selectAlarmPoint(r,i,!1))}b.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,l=n.state,o=l.alarmSensedPoints,s=l.deviceAlarms,c=l.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&s.length>0&&s.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],b=["Low"],y=["High"],x=["High-High"],E=0;E<e.graphData.columns[0].length-1;E++)f.push(m.minimumExtremeValue),b.push(m.minimumNormalValue),y.push(m.maximumNormalValue),x.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,b,e.graphData.columns[g+1],y,x],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[g+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(i={},i[e.graphData.columns[g+1][0]]="#e3e3e3",i)})}if(a){var D=n.state.graphData;D.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:D,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,r=a.grid,i=a.alarmSensedPoints,l=this.props.showAlarmPoints,o=new Date;e["@timestamp"]&&(o=new Date(e["@timestamp"]),o=new Date(o.setHours(o.getHours()+10)));var s=this.props.liveGraphRange;if(n&&n.length&&o){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(o),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&("EnergySumNR"==a||"EnergyPosSumNR"==a?c.graphData.columns[n].push(parseFloat(e[""+a])/1e3):c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(o.getTime()-c.graphData.columns[0][2].getTime())/6e4>s&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<o.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),r.x.lines.splice(0,1),o.setSeconds(0),s>10&&o.setMinutes(o.getMinutes()-o.getMinutes()%5),c.axis.x.tick.values.push(o),r.x.lines.push({value:o,class:"grid4"}))}}var g=null===o||void 0===o?void 0:o.toLocaleString();this.setState({grid:r,graphData:n,lastUpdatedAt:g},function(){if(l){for(var e=[],a=function(a){var r=n[a],l=r.sensedKeys&&r.sensedKeys.length&&i.length>0&&i.filter(function(e){return r.sensedKeys.includes(e.sensedValue)}),o=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:(null===l||void 0===l?void 0:l.length)>0?l[l.length-1].sensedValue:"";e.push(t.selectAlarmPoint(r,o,!1))},r=0;r<n.length;r++)a(r);t.setState({graphData:e})}})}},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)i(l);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e;return b(this,void 0,void 0,function(){var t,a,n,r,i,u,c,m,p,g,f,v,b,x,E,D,w,A,_,O,P,S,V,j,N,L,R,k,q=this;return y(this,function(y){switch(y.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.showAlarmPoints,u=t.graphsList,c=t.devicePoints,m=t.isEquipment,p=t.equipment,g=this.state,f=g.grid,v=g.graphData,b=g.lastUpdatedAt,x=[],m&&(x=c.filter(function(e){return Object(s.g)(e.relatedEquipment)==p.ontology})),a&&a.moncondevice?(E=Object(s.g)(a.topic),(D=E?E.split(","):[]).length&&D[0]?(w=[],!m||m&&x.length?[4,Object(l.n)(D[0],n,r)]:[3,2]):[3,3]):[3,3];case 1:w=y.sent(),y.label=2;case 2:if(_=["x"],(A={EnergySum:["Enerygy Sum"],EnergyPosSum:["Energy POS SUM"],EnergySumNR:["Energy Sum NR"],EnergyPosSumNR:["Energy Pos Sum NR"],PowerSum:["Power Sum"],PowerA:["Power A"],PowerB:["Power B"],PowerC:["Power C"],VoltA:["Volts A"],VoltB:["Volts B"],VoltC:["Volts C"],VoltAvgLL:["Volts Avg LL"],VoltAB:["Volts AB"],VoltAC:["Volts AC"],VoltBC:["Volts BC"],Freq:["Frequency"]}).EnergySum.push(null),A.EnergyPosSum.push(null),A.EnergySumNR.push(null),A.EnergyPosSumNR.push(null),A.PowerSum.push(null),A.PowerA.push(null),A.PowerB.push(null),A.PowerC.push(null),A.VoltA.push(null),A.VoltB.push(null),A.VoltC.push(null),A.VoltAvgLL.push(null),A.VoltAB.push(null),A.VoltAC.push(null),A.VoltBC.push(null),A.Freq.push(null),_.push(new Date(n)),w.length>0&&w.forEach(function(e){e&&(A.EnergySum.push(e.EnergySum||"0"),A.EnergyPosSum.push(e.EnergyPosSum||"0"),A.EnergySumNR.push(""+ +e.EnergySumNR/1e3||"0"),A.EnergyPosSumNR.push(""+ +e.EnergyPosSumNR/1e3||"0"),A.PowerSum.push(e.PowerSum||"0"),A.PowerA.push(e.PowerA||"0"),A.PowerB.push(e.PowerB||"0"),A.PowerC.push(e.PowerC||"0"),A.VoltA.push(e.VoltA||"0"),A.VoltB.push(e.VoltB||"0"),A.VoltC.push(e.VoltC||"0"),A.VoltAvgLL.push(e.VoltAvgLL||"0"),A.VoltAB.push(e.VoltAB||"0"),A.VoltAC.push(e.VoltAC||"0"),A.VoltBC.push(e.VoltBC||"0"),A.Freq.push(e.Freq||"0"),_.push(new Date(e.timestamp)))}),b=w.length>0?null===(e=_[_.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",A.EnergySum.push(null),A.EnergyPosSum.push(null),A.EnergySumNR.push(null),A.EnergyPosSumNR.push(null),A.PowerSum.push(null),A.PowerA.push(null),A.PowerB.push(null),A.PowerC.push(null),A.VoltA.push(null),A.VoltB.push(null),A.VoltC.push(null),A.VoltAvgLL.push(null),A.VoltAB.push(null),A.VoltAC.push(null),A.VoltBC.push(null),A.Freq.push(null),_.push(new Date(r)),_.length>1){if(O=Object(o.a)(5,n,r),P="",O.length>1?(S=((new Date).getTime()-O[0].getTime())/1e3,P=(S/=3600)>24?"%m-%d %H:%M":S<.3?"%H:%M:%S":"%H:%M"):P="%H:%M:%S",f.x.lines=[],O.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),m){for((V=JSON.parse(JSON.stringify(d.a))).name="Wattnode",V.graphData.columns=[_],V.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},V.axis.x.tick.format=P,V.axis.x.tick.values=O,V.graphData.x="x",k=0;k<x.length;k++)j=x[k],N=Object(s.g)(j.sensedValue),V.sensedKeys.push(N),V.graphData.columns.push(A[""+N]);V.graphEquipment=this.fetchEquipmentFromPoints(V.name,V.sensedKeys),v.push(V)}else for(L=function(e){var t=u[e],a=JSON.parse(JSON.stringify(d.a)),n=1,r=[];a.name=t,"Power"==t?(a.axis.y.label="Watts",a.axis.y.tick.values=[0,1e4,2e4,3e4,4e4],a.axis.y.max=4e4,a.sensedKeys=["PowerA","PowerB","PowerC","PowerSum"],r=[_,A.PowerA,A.PowerB,A.PowerC,A.PowerSum]):"Phase Voltage"==t?(n=0,a.axis.y.label="Volts",a.axis.y.tick.values=[0,50,100,150,200,250],a.axis.y.max=250,a.sensedKeys=["VoltAB","VoltBC","VoltAC"],r=[_,A.VoltAB,A.VoltBC,A.VoltAC]):"Voltage"==t?(n=0,a.axis.y.label="Volts",a.axis.y.tick.values=[0,50,100,150],a.axis.y.max=150,a.sensedKeys=["VoltA","VoltB","VoltC"],r=[_,A.VoltA,A.VoltB,A.VoltC]):"Frequency"==t?(a.axis.y.label="Hz",a.axis.y.tick.values=[0,20,40,60,80],a.axis.y.max=80,a.sensedKeys=["Freq"],r=[_,A.Freq]):"Energy Sum Resettable"==t?(a.axis.y.label="MWh",a.axis.y.tick.values=[0,40,80,120,160],a.axis.y.max=160,a.sensedKeys=["EnergySumNR"],r=[_,A.EnergySumNR]):"Positive Energy Sum Non-resettable"==t&&(a.axis.y.label="MWh",a.axis.y.tick.values=[0,40,80,120,160],a.axis.y.max=160,a.sensedKeys=["EnergyPosSumNR"],r=[_,A.EnergyPosSumNR]),a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.y.min=0,a.axis.x.tick.format=P,a.axis.x.tick.values=O,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=R.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},R=this,k=0;k<u.length;k++)L(k);this.props.loadNextInsight(),Object(h.h)(D,this.callLiveUpdate),this.setState({grid:f,graphData:v,lastUpdatedAt:b,loading:!1},function(){i&&q.changeAlarmStatus(!0)})}y.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=this.props,c=u.instance,m=u.buildingName,p=u.device,h=u.showAlarmPoints,g=u.insightRelEquipment;return o&&"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var r,u,d,f="";return h&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(r=t.graphData.columns)||void 0===r?void 0:r.length)||(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),h&&n.createElement("div",{className:"alarm-limit-select"},"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",id:"spaces",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+c+"/"+m+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+c+"/"+m+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(s.g)(p.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(p.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(p.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),a?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(d=t.graphDataAlarmPoint.columns)||void 0===d?void 0:d.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=x},2977:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(744)),i=a(1014),l=a(772),o=a.n(l),s=a(760),u=(a.n(s),a(715)),c=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),m=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function l(e){try{s(n.next(e))}catch(e){i(e)}}function o(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(l,o)}s((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var a,n,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},h=function(e){function t(t){var a=e.call(this,t)||this;return a.state={asisData:[],seasonList:[],graphData1:{x:"Date",columns:[],type:"bar"},grid1:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphData2:{x:"Date",columns:[],type:"bar"},grid2:{x:{lines:[{}]},y:{show:!0}},axis2:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}},y2:{show:!0,label:"$",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,selectedSeason:""},a._fetchData=a._fetchData.bind(a),a}return c(t,e),t.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){return p(this,function(e){return this._fetchData(),[2]})})},t.prototype.fetchVeifyDetail=function(e){return m(this,void 0,void 0,function(){return p(this,function(e){return[2]})})},t.prototype._fetchData=function(){return m(this,void 0,void 0,function(){var e,t,a=this;return p(this,function(n){switch(n.label){case 0:return e=this.props.buildingName,t=this.props.projectName,[4,Object(r.o)(e,"",t).then(function(e){return m(a,void 0,void 0,function(){var t,a,n,l,o,s,u,c,m,h,g,d,f,v,b=this;return p(this,function(p){switch(p.label){case 0:return e&&e[0]&&e[0].ontology?(t=[],0,0,0,0,a=[],n=e[0],[4,Object(r.l)(n.ontology)]):[3,7];case 1:if(!((l=p.sent())&&l.length>0))return[3,7];for((t=l.sort(function(e,t){return e.seasonSequence>t.seasonSequence?1:t.seasonSequence>e.seasonSequence?-1:0})).map(function(e){var t=e.analysisName+": "+(e.seasonType&&"both"==e.seasonType.toLocaleLowerCase().trim()?e.seasonType+": "+("cooling"==e.selectedAnalysis?"Cooling":"Heating"):e.seasonType);a.push({label:t,value:e.ontology})}),o=0;o<t.length;o++)s=t[o],s.totalConsumedEnergyASIS,s.totalConsumedEnergyECM,s.totalConsumedEnergyCostASIS,s.totalConsumedEnergyCostECM;return 0==n.measureAnalysis.length?n.measureAnalysis=[{staticSeasonName:"Summer",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Fall",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Winter",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Spring",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value}]:n.measureAnalysis.length,u=[],c=[],t&&t.length>0?(m=[],h=[],(g=t.sort(function(e,t){return new Date(e.asisStartDate)>new Date(t.asisStartDate)?1:new Date(t.asisStartDate)>new Date(e.asisStartDate)?-1:0}))&&g.length>0?(d=g[0],[4,Object(r.k)(d.importDataASISOntology).then(function(e){u=e?e[0].fileData:[]})]):[3,6]):[3,7];case 2:return p.sent(),[4,Object(r.k)(d.importDataECMOntology).then(function(e){c=e?e[0].fileData:[]})];case 3:return p.sent(),[4,Object(i.c)(u,new Date(d.asisStartDate),new Date(d.asisEndDate),d.noaaStation.value,parseFloat(d.basepointCD),parseFloat(d.basepointHD),d.isMeasureFile)];case 4:return f=p.sent(),[4,Object(i.c)(c,new Date(d.ecmStartDate),new Date(d.ecmEndDate),d.noaaStation.value,parseFloat(d.basepointCD),parseFloat(d.basepointHD),d.isMeasureFile)];case 5:v=p.sent(),m.push.apply(m,f),h.push.apply(h,v),p.label=6;case 6:this.setState({seasonList:t,asisData:u},function(){b.energyConsumptionGraph()}),p.label=7;case 7:return[2]}})})}).catch(function(e){console.log(e)})];case 1:return n.sent(),[2]}})})},t.prototype.energyConsumptionGraph=function(){return m(this,void 0,void 0,function(){var e,t,a,n,r,i,l,o,s,c,m,h,g,d,f,v,b,y,x,E,D,w,A,_;return p(this,function(p){switch(p.label){case 0:e=this.state.asisData,t=this.state,a=t.graphData1,n=t.axis1,r=t.grid1,i=t.graphData2,l=t.axis2,o=t.grid2,s=new Date,c=new Date,s.setMonth(s.getMonth()-1),s.setHours(0,0,0,0),m=["ECM Energy Consumption (Metered)"],h=["Date"],g=["Asis Consumption (Projected)"],d=["Energy Saving"],f=["Energy Savings $ at 10.42 cents per unit"],v=["Tons CO2 emission reduction at 0.000709 tons per unit"],b=new Date(s),p.label=1;case 1:return b<=c?((y=new Date(b)).setHours(23,59,59,0),[4,Object(u.n)("michaels/5_125/wn_basicreg1",b,y,!1)]):[3,4];case 2:x=p.sent(),E=x[0],D=x[x.length-1],E&&D?m.push(""+(D.EnergyPosSum-E.EnergyPosSum)):m.push("0"),h.push(new Date(b)),p.label=3;case 3:return b.setDate(b.getDate()+1),[3,1];case 4:for(w=function(t){var a=new Date(h[t]),n=0;e.filter(function(e){if(+e.Date.split("/")[1]==a.getDate())return e}).forEach(function(e){n+=+e.ValueSum}),g.push(n),r.x.lines.push({value:a,class:"grid4"}),o.x.lines.push({value:a,class:"grid4"})},A=1;A<h.length-1;A++)w(A);for(A=1;A<g.length-1;A++)+g[A]&&+m[A]?(_=+g[A]-+m[A],d.push(_),f.push(.01042*_),v.push(709e-6*_)):(d.push(0),f.push(0));return a={x:"Date",columns:[h,m,g],type:"bar"},i={x:"Date",columns:[h,d,f],groups:[["Energy Saving"]],axes:{"Energy Savings $ at 10.42 cents per unit":"y"},type:"bar",types:{"Energy Savings $ at 10.42 cents per unit":"line"}},n.y.label="KwH",l.y.tick.values=[-2e3,-1e3,0,1e3,2e3],l.y.tick.max=2e3,l.y.tick.min=-2e3,l.y2.tick.values=[-40,-20,0,20,40],l.y2.tick.max=40,l.y2.tick.min=-40,this.setState({loading:!1,graphData1:a,axis1:n,grid1:r,graphData2:i,grid2:o}),[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData1,r=e.grid1,i=e.axis1,l=e.graphData2,s=e.axis2,u=e.grid2;return n.createElement(n.Fragment,null,n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(o.a,{data:a,size:{height:500},axis:i,grid:r,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})),n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(o.a,{data:l,size:{height:500},axis:s,grid:u,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})))},t}(n.Component);t.a=h},837:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n={sensedValue:"",maximumExtremeValue:"",minimumExtremeValue:"",maximumNormalValue:"",minimumNormalValue:"",generateMaximumExtremeValue:!0,generateMaximumNormalValue:!0,generateMinimumExtremeValue:!0,generateMinimumNormalValue:!0}},857:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a(837),r={name:"",graphData:{x:"x",columns:[]},axis:{x:{type:"timeseries",tick:{fit:!1,count:5,multiline:!0,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphDataAlarmPoint:{x:"x",columns:[]},graphEquipment:Object(),alarmStatus:"",selectedAlarmPoint:n.a,sensedKeys:[]}}});