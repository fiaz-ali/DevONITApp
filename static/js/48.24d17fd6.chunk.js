webpackJsonp([48],{1461:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a,c=n(3),i=(n.n(c),n(629)),s=n(45),o=n(18),u=n(578),l=n(89),h=n(17),f=n(584),d=n(92),b=n(14),m=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,c){function i(t){try{o(r.next(t))}catch(t){c(t)}}function s(t){try{o(r.throw(t))}catch(t){c(t)}}function o(t){t.done?a(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(i,s)}o((r=r.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){var n,r,a,c,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},g=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),a=0;for(e=0;e<n;e++)for(var c=arguments[e],i=0,s=c.length;i<s;i++,a++)r[a]=c[i];return r};function S(){var t=document.getElementById("chatMessagesContainer");t&&(t.scrollTop=t?t.scrollHeight:0)}var T=function(t){function e(e){var n=t.call(this,e)||this;return n.state={chatMessages:[],chatText:"",participants:[],tag:"",issue:""},r=n,n.s3=new s.b,n.fetchContactInfo=n.fetchContactInfo.bind(n),n}return m(e,t),e.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){var t,e,n,c,i;return v(this,function(s){switch(s.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,c=t.s,e&&n?[4,this.fetchContactInfo()]:[3,3];case 1:return s.sent(),[4,this.getAllMessages()];case 2:s.sent(),(i=document.querySelector("#messageBody")).scrollTop=i.scrollHeight-i.clientHeight,a=window.innerHeight-270,s.label=3;case 3:return c&&c._socket&&c._socket.on&&c._socket.on("new message",function(t){var e=r.state.chatMessages;(0==e.length||e.length>0&&JSON.stringify(e[e.length-1])!=JSON.stringify(t))&&r.state.tag==t.tag&&(e.push(t),r.setState({chatMessages:e},function(){r.saveAllMessages(),S()}))}),[2]}})})},e.prototype.fetchContactInfo=function(){return p(this,void 0,void 0,function(){var t,e,n,r,a,c,s,o=this;return v(this,function(l){switch(l.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,r=t.entityTitle,e&&n?(a=[],c="",s="",r&&"Contact"!=r?[4,Object(i.i)("",r).then(function(t){if(t.length>0){var e=t[0];a=Object(h.g)(e.chatName).split("-_-"),s=Object(h.g)(e.description)}})]:[3,2]):[3,5];case 1:return l.sent(),[3,3];case 2:a=n,l.label=3;case 3:return a=g(a.sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}})),[4,Object(u.n)("",a).then(function(t){t.length>0&&(c+="Chat-_-",c+=t.map(function(t){return Object(h.g)(t.contact)}).join("-_-"),o.setState({participants:t,tag:c,issue:s},function(){return p(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Object(i.u)(c)];case 1:return t.sent(),[2]}})})}))})];case 4:l.sent(),l.label=5;case 5:return[2]}})})},e.prototype.getAllMessages=function(){return p(this,void 0,void 0,function(){var t,e,n;return v(this,function(a){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.GetObject(s.a.CHAT,n+".json",function(t,e){if(t)console.log("Get Object Error Returned",t);else{var n=Object(o.c)(e.Body);if(n){var a=JSON.parse(n);a.length>r.state.chatMessages.length&&r.setState({chatMessages:a}),S()}}}),[2]})})},e.prototype.saveAllMessages=function(){return p(this,void 0,void 0,function(){var t,e,n;return v(this,function(r){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.PutObject(s.a.CHAT,n+".json",JSON.stringify(this.state.chatMessages)),[2]})})},e.prototype.handleChatInput=function(t){this.setState({chatText:t})},e.prototype.handleChatInputKeys=function(t){(13===t.which||"Enter"===t.key)&&t.target.value&&t.target.value.trim()&&(this.setState({chatText:t.target.value.trim()}),this.sendMessage())},e.prototype.sendMessage=function(){return p(this,void 0,void 0,function(){var t,e,n,a,c,s,o,u;return v(this,function(l){return t=this.props.entityTitle,this.state.chatText&&this.state.chatText.trim()&&(e=JSON.parse(b.a.getItem("user")),n=this.state,a=n.participants,c=n.tag,s=this.state.chatText,o={from:e.contact,fromName:e.name,messageText:s,tag:c,timestamp:(new Date).toString()},Object(d.d)(o),(u=this.state.chatMessages).push(o),this.setState({chatMessages:u,chatText:""},function(){Object(i.p)(t,"Chat-_-"+a.map(function(t){return""+t.contact.value}).sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).join("-_-")),r.saveAllMessages()}),S()),[2]})})},e.prototype.render=function(){var t=this,e=this.props.entityTitle,n=this.state,r=n.chatMessages,i=n.chatText,s=n.participants,o=n.issue,u=JSON.parse(b.a.getItem("user")),d=Object(f.b)(u,"task-ticket","write"),m=-1!=s.findIndex(function(t){return Object(h.g)(t.contact)==u.contact});return c.createElement(l.a.Consumer,null,function(n){return c.createElement("div",{className:"container-fluid "},c.createElement("div",{className:"content"},c.createElement("div",{className:"chatHead"},c.createElement("div",{className:"col-md-12"},c.createElement("div",{className:"form-group"},c.createElement("label",{className:"heading"},e," -- ",s.map(function(t){return Object(h.g)(t.name)}).join(" -- "),""!=o?"--"+o:"")))),c.createElement("div",{id:"chatMessagesContainer",className:" padding-10 chatBody"},c.createElement("div",{className:"col-md-12"},c.createElement("div",{className:"card padding-10 scroll",id:"messageBody",style:{height:a,overflowX:"hidden",margin:"0px"}},c.createElement("div",{className:"container-fluid"},c.createElement("div",{className:"row"},c.createElement("div",{className:"card col-md-12 col-xs-12 padding-10",style:{margin:"0px"}},0==r.length&&c.createElement("div",null," No messages found in this conversation. "),r.map(function(t,e){if(t&&t.from){var n=s.find(function(e){return e.contact.value==t.from});if(n&&n.name)return c.createElement("div",{key:e,className:"padding-10 chat-message "+(t.from==u.contact?"inbound-message":"outbound-message")},c.createElement("div",{className:"message-text padding-5",style:{overflowWrap:"break-word"}},t.messageText),c.createElement("div",{className:"sender-name"},c.createElement("label",null,c.createElement("b",null,n.name.value))),c.createElement("div",{className:"timestamp"},c.createElement("b",null,t.timestamp.ToEasternDateTime())))}}))))),m&&d&&c.createElement("footer",{className:"col-md-12 no-padding"},c.createElement("div",{className:"card",style:{margin:"0px"}},c.createElement("div",{className:"container-fluid"},c.createElement("div",{className:"row"},c.createElement("div",{className:"col-md-12 no-padding"},c.createElement("div",{className:"",style:{display:"inline-flex",padding:"0px",width:"100%"}},c.createElement("input",{type:"text",className:"form-control",placeholder:"Type your message here...",name:"chatBox",value:i,style:{height:"97px"},onChange:function(e){return t.handleChatInput(e.target.value)},onKeyPress:function(e){return t.handleChatInputKeys(e)}}),c.createElement("button",{type:"button",className:"btn pull-right btn-primary btn-fill chatButton",onClick:function(){t.sendMessage()}},c.createElement("i",{className:"fa fa-comment"}),"\xa0 Send ")))))))))))})},e}(c.Component);e.default=T},629:function(t,e,n){"use strict";e.k=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,Object(c.e)({},c.a.TASKS.GetTaskTypeList,r.b.TASK)];case 1:return[2,t.sent()]}})})},e.l=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,Object(c.e)({},c.a.TASKS.GetWorkTypeList,r.b.TASK)];case 1:return[2,t.sent()]}})})},e.h=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.e)({buildingName:t,getArchivedOnly:e},c.a.CHATS.GetChats,r.b.TASK)];case 1:return[2,n.sent()]}})})},e.f=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,chatName:e},c.a.CHATS.DeleteChat,r.b.TASK).then(function(){Object(a.b)("Chat Deleted Successfully.")}).catch(function(t){Object(a.a)("Error occured while deleting Chat.")})];case 1:return[2,n.sent()]}})})},e.p=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,chatName:e},c.a.TASKS.UpdateLastMessageOn,r.b.CHAT)];case 1:return[2,n.sent()]}})})},e.u=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(c.f)({chatName:t},c.a.TASKS.UpdateUnreadCount,r.b.TASK)];case 1:return[2,e.sent()]}})})},e.n=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(c.f)({buildingName:t,model:e,isEdit:n},c.a.TASKS.UpdateRootTask,r.b.TASK).then(function(){Object(a.b)("Task "+(n?"Updated":"Added")+" Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.i=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(a){switch(a.label){case 0:return[4,Object(c.e)({buildingName:t,taskNumber:e,isArchived:n},c.a.TASKS.GETTASKS,r.b.TASK,!0)];case 1:return[2,a.sent()]}})})},e.j=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(a){switch(a.label){case 0:return[4,Object(c.e)({buildingName:t,parentTask:e,subTaskNumber:n},c.a.TASKS.GetSubTask,r.b.TASK)];case 1:return[2,a.sent()]}})})},e.r=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,isDeleted:e},c.a.TASKS.UpdateRootTaskDeleteStatus,r.b.TASK).then(function(){Object(a.b)("Task Deleted Successfully.")}).catch(function(t){Object(a.a)("Error occured while deleting Task.")})];case 1:return[2,n.sent()]}})})},e.t=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(c.f)({taskID:t,status:e},c.a.TASKS.UpdateTaskStatus,r.b.TASK).then(function(){n||Object(a.b)("Status Updated Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.s=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,startTime:e},c.a.TASKS.UpdateTaskStartTime,r.b.TASK).then(function(){Object(a.b)("Start Time Updated Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.d=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,isArchived:e},c.a.TASKS.ArchiveTask,r.b.TASK).then(function(){Object(a.b)((e?"Archived":"Unarchived")+" Successfully.")}).catch(function(t){Object(a.a)("Error occured while Archiving Task.")})];case 1:return[2,n.sent()]}})})},e.c=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,note:e},c.a.TASKS.AddPauseNote,r.b.TASK).then(function(){}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.g=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(c.f)({taskID:t},c.a.TASKS.DeletePauseNote,r.b.TASK).then(function(){}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,e.sent()]}})})},e.b=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,note:e},c.a.TASKS.AddNote,r.b.TASK).then(function(){Object(a.b)("Note Added Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.a=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,isAcknowledged:e},c.a.TASKS.AcknowledgeRootTask,r.b.TASK).then(function(){Object(a.b)(e?"Acknowledged Successfully.":"Unacknowledged Successfully.")}).catch(function(t){Object(a.a)("Error occured while Acknowledging.")})];case 1:return[2,n.sent()]}})})},e.e=function(t,e){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,Object(c.f)({taskID:t,checklistID:e},c.a.TASKS.AssignChecklist,r.b.TASK).then(function(){Object(a.b)("Checklist Assigned Successfully.")}).catch(function(t){Object(a.a)("Error occured while Assigning Checklist.")})];case 1:return[2,n.sent()]}})})},e.q=function(t,e,n){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,Object(c.f)({email:t,roles:e,fileName:n},c.a.ONEDRIVE.UPDATEPERMISSION,r.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(a.a)("Error occured while update Permission.")})];case 1:return[2,i.sent()]}})})},e.m=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(c.f)({fileName:t},c.a.ONEDRIVE.REMOVEPERMISSION,r.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(a.a)("Error occured while removing Permission.")})];case 1:return[2,e.sent()]}})})},e.o=function(t){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Object(c.f)({buildingName:t},c.a.TASKS.TriggerTaskManagement,r.b.TASK,"").then(function(t){return t}).catch(function(t){Object(a.a)("Error occured while triggering task automation.")})];case 1:return[2,e.sent()]}})})};var r=n(26),a=n(44),c=n(19),i=(n(14),this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,c){function i(t){try{o(r.next(t))}catch(t){c(t)}}function s(t){try{o(r.throw(t))}catch(t){c(t)}}function o(t){t.done?a(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(i,s)}o((r=r.apply(t,e||[])).next())})}),s=this&&this.__generator||function(t,e){var n,r,a,c,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}}});