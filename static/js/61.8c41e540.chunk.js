webpackJsonp([61],{1743:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=a(3),s=(a.n(n),a(1223)),o=a(99),c=a(754),l=a(21),i=a(600),d=a(1082),m=a(612),u=a(10),h=a(607),p=a(1224),v=a.n(p),f=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),b=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))(function(n,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function c(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(o,c)}l((r=r.apply(e,t||[])).next())})},g=this&&this.__generator||function(e,t){var a,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(s){return function(c){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{a=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},E=a(1263),O=function(e){function t(t){var a=e.call(this,t)||this;return a.state={PurchaseOrder:Object(),isEdit:!1,WOList:[],_peoples:[],contactObj:Object(),shipToItems:[],newVendorDropDown:"",purchasedFromAddress:"",shipToAddress:"",showBarcodeScanner:!1,ScannedBarcode:"",EnteredBarcode:""},r=a,a.handleTaxChange=a.handleTaxChange.bind(a),a.handleItems=a.handleItems.bind(a),a.handleShippingChange=a.handleShippingChange.bind(a),a.handleOtherChange=a.handleOtherChange.bind(a),a.setPurchaseOrderTotal=a.setPurchaseOrderTotal.bind(a),a.handlePOFormChange=a.handlePOFormChange.bind(a),a._savePurchaseOrder=a._savePurchaseOrder.bind(a),a._fetchPurchaseOrder=a._fetchPurchaseOrder.bind(a),a.handlePOFormAddressChange=a.handlePOFormAddressChange.bind(a),a.createVendor=a.createVendor.bind(a),a.handleVendorChange=a.handleVendorChange.bind(a),a.setPurchasedFromAddress=a.setPurchasedFromAddress.bind(a),a.setShipToAddress=a.setShipToAddress.bind(a),a}return f(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this._getWorkOrdersList()]:[3,5];case 1:return e.sent(),[4,this._fetchPurchaseOrder()];case 2:return e.sent(),[4,this.fetchShipToItems()];case 3:return e.sent(),[4,this.fetchVendors()];case 4:e.sent(),e.label=5;case 5:return[2]}})})},t.prototype.setPurchasedFromAddress=function(e){return b(this,void 0,void 0,function(){var t,a,r,n;return g(this,function(s){return t=this.state,a=t._peoples,r=t.purchasedFromAddress,n=a.find(function(t){return Object(l.g)(t.contact)==e}),r=n&&n.name?Object(l.g)(n.street)+", "+Object(l.g)(n.city)+", "+Object(l.g)(n.state):"",this.setState({purchasedFromAddress:r}),[2]})})},t.prototype.setShipToAddress=function(e){return b(this,void 0,void 0,function(){var t,a,r,n;return g(this,function(s){return t=this.state,a=t.shipToItems,r=t.shipToAddress,n=a.find(function(t){return Object(l.g)(t.value)==e}),r=n&&n.name?Object(l.g)(n.street)+", "+Object(l.g)(n.city)+", "+Object(l.g)(n.state):"",this.setState({shipToAddress:r}),[2]})})},t.prototype.fetchShipToItems=function(){return b(this,void 0,void 0,function(){var e,t=this;return g(this,function(a){switch(a.label){case 0:return e=this.props.buildingName,Object(o.a)(!0),[4,Object(c.d)(this.props.buildingName).then(function(a){t.setState({shipToItems:a},function(){return b(t,void 0,void 0,function(){var t=this;return g(this,function(a){return setTimeout(function(){return b(t,void 0,void 0,function(){var t;return g(this,function(a){return t=r.state.PurchaseOrder,r.setShipToAddress(t.shipToCompany?t.shipToCompany:e),[2]})})},500),[2]})})})}).catch(function(e){return e})];case 1:return a.sent(),Object(o.a)(!1),[2]}})})},t.prototype.fetchVendors=function(){return b(this,void 0,void 0,function(){var e,t,a=this;return g(this,function(r){switch(r.label){case 0:return e=[],Object(o.a)(!0),[4,Object(h.n)(this.props.buildingName)];case 1:return(t=r.sent())&&t.length>0&&(e=t.filter(function(e){return"Vendor"==Object(l.g)(e.group)}),this.setState({_peoples:e},function(){return b(a,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.state.PurchaseOrder.purchasedFromCompany?[4,this.setPurchasedFromAddress(this.state.PurchaseOrder.purchasedFromCompany)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})),Object(o.a)(!1),[2]}})})},t.prototype.createVendor=function(){return b(this,void 0,void 0,function(){var e,t,a=this;return g(this,function(r){switch(r.label){case 0:return e=this.state.PurchaseOrder,(t=this.state.contactObj).role="3",t.group="Vendor",t.groups=[{label:"Vendor",value:"Vendor"}],t.facilityAssignedTo=[{value:this.props.buildingName,label:""}],t?(Object(o.a)(!0),[4,Object(h.g)(this.props.buildingName,t,!1).then(function(r){var n=a.state.newVendorDropDown;n&&n.length>0&&(e[n]=a.state.contactObj.contact),t.contact="",t.name="",t.mobile="",t.zipcode="",t.email="",t.streetAddress="",t.company="",t.city="",t.state=""})]):[3,2];case 1:r.sent(),Object(o.a)(!1),this.setState({contactObj:t,PurchaseOrder:e},function(){a.fetchVendors(),a.fetchShipToItems()}),r.label=2;case 2:return[2]}})})},t.prototype._getWorkOrdersList=function(){return b(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return Object(o.a)(!0),[4,Object(c.e)(this.props.buildingName).then(function(t){e.setState({WOList:t})}).catch(function(e){return e})];case 1:return t.sent(),Object(o.a)(!1),[2]}})})},t.prototype._fetchPurchaseOrder=function(){return b(this,void 0,void 0,function(){var e,t,a=this;return g(this,function(r){switch(r.label){case 0:return e={poID:"",title:"",status:"",relatedwo:"",purchasedFromCompany:"",shipToCompany:this.props.buildingName,items:[{ontology:"",rdfsLabel:"",quantity:0,units:"",description:"",unitPrice:0,total:0}],shippedVia:"",tax:0,createdDate:"",shipping:0,other:0,total:0},t=!!this.props.purchaseOrderNo,e.poID=(new Date).PO_Number(),this.props.purchaseOrderNo?[4,Object(c.c)(this.props.buildingName,this.props.purchaseOrderNo).then(function(r){if(r&&r.length>0){var n=r[0];e.poID=Object(l.g)(n.poid),e.title=Object(l.g)(n.title),e.status=Object(l.g)(n.status),e.relatedwo=Object(l.g)(n.relatedwo),e.purchasedFromCompany=Object(l.g)(n.purchasedfromcompany),e.shipToCompany=Object(l.g)(n.shiptocompany),e.shippedVia=Object(l.g)(n.shippedvia),e.tax=parseInt(Object(l.g)(n.tax)),e.createdDate=Object(l.g)(n.createddate),e.shipping=parseInt(Object(l.g)(n.shipping)),e.other=parseInt(Object(l.g)(n.other)),e.total=parseInt(Object(l.g)(n.total)),a.setState({PurchaseOrder:e,isEdit:t},function(){return b(a,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return[4,Object(c.b)(this.props.buildingName,this.props.purchaseOrderNo).then(function(t){if(t&&t.length>0){for(var a=e.state.PurchaseOrder,r=[],n=Object(),s=0;s<t.length;s++)(n=Object()).ontology=t[s].ontology&&t[s].ontology.value,n.rdfsLabel=t[s].rdfsLabel&&t[s].rdfsLabel.value,n.quantity=parseInt(t[s].quantity&&t[s].quantity.value),n.units=t[s].units&&t[s].units.value,n.description=t[s].description&&t[s].description.value,n.unitPrice=parseInt(t[s].unitprice&&t[s].unitprice.value),n.total=parseInt(t[s].total&&t[s].total.value),r.push(n);a.items=r,e.setState({PurchaseOrder:a})}})];case 1:return t.sent(),[2]}})})})}})]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.setState({PurchaseOrder:e,isEdit:t}),[2]}})})},t.prototype.handleTaxChange=function(e){if(!this.props.isView){var t=this.state.PurchaseOrder;t.tax=parseFloat(parseFloat(e.toString()).toFixed(4)),this.setState({PurchaseOrder:t}),this.setPurchaseOrderTotal()}},t.prototype.handleItems=function(e){if(!this.props.isView){var t=this.state.PurchaseOrder;t.items=e,this.setState({PurchaseOrder:t}),this.setPurchaseOrderTotal()}},t.prototype.handleShippingChange=function(e){if(!this.props.isView){var t=this.state.PurchaseOrder;t.shipping=parseFloat(parseFloat(e.toString()).toFixed(2)),this.setState({PurchaseOrder:t}),this.setPurchaseOrderTotal()}},t.prototype.handleOtherChange=function(e){if(!this.props.isView){var t=this.state.PurchaseOrder;t.other=parseFloat(parseFloat(e.toString()).toFixed(2)),this.setState({PurchaseOrder:t}),this.setPurchaseOrderTotal()}},t.prototype.setPurchaseOrderTotal=function(){for(var e=this.state.PurchaseOrder,t=0,a=0;a<e.items.length;a++)t+=e.items[a].total;var r=e.tax?e.tax:0,n=e.shipping?e.shipping:0,s=e.other?e.other:0;e.total=t+t*r/100+n+s,this.setState({PurchaseOrder:e})},t.prototype.handlePOFormChange=function(e){if(!this.props.isView)if("addVendor"==e.target.value)this.setState({newVendorDropDown:e.target.name},function(){document.getElementById("btnOpenVendorForm").click()});else{var t=this.state.PurchaseOrder,a=e.target.name;t[""+a]=e.target.value,this.setState({PurchaseOrder:t}),"purchasedFromCompany"==a?this.setPurchasedFromAddress(e.target.value):"shipToCompany"==a&&this.setShipToAddress(e.target.value)}},t.prototype.handlePOFormAddressChange=function(e,t){if(!this.props.isView){var a=this.state.PurchaseOrder,r=t.target.name;a[""+e][""+r]=t.target.value,this.setState({PurchaseOrder:a})}},t.prototype.handleVendorChange=function(e){this.setState({contactObj:e})},t.prototype._savePurchaseOrder=function(){return b(this,void 0,void 0,function(){var e,t,a,r,n,s;return g(this,function(l){switch(l.label){case 0:return e=this.props,t=e.instance,a=e.buildingName,e.isView?[3,3]:(r=this.state,n=r.PurchaseOrder,s=r.isEdit,n&&n.poID?(Object(o.a)(!0),[4,Object(c.a)(a,n.poID)]):[3,3]);case 1:return l.sent(),s||(n.createdDate=new Date(Date.now()).toString()),[4,Object(c.f)(a,n,s)];case 2:l.sent(),Object(o.a)(!1),window.location.hash=t+"/"+a+"/PurchaseOrders",l.label=3;case 3:return[2]}})})},t.prototype.render=function(){var e=this,t=this.state,a=t.PurchaseOrder,r=t.WOList,o=t._peoples,c=t.contactObj,h=t.shipToItems,p=t.shipToAddress,f=t.purchasedFromAddress,b=this.props,g=b.isView,O=b.instance,N=b.buildingName,y=a.title&&a.shipToCompany&&a.purchasedFromCompany&&!0,w=c&&c.name&&c.contact&&!0,P=JSON.parse(u.a.getItem("user")),C=Object(m.b)(P,"work-po","write");return n.createElement("div",{className:"content "+(C&&g?"overlay":"")},n.createElement("div",{className:"card"},n.createElement("button",{type:"button",id:"btnOpenVendorForm",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#vendorFormDialog"}," ."),n.createElement(i.a,{id:"vendorFormDialog",onSaveButtonClick:function(){e.createVendor()},saveButtonText:"Save",disableSaveButton:!w},n.createElement(d.a,{instance:O,buildingName:N,isEdit:!1,contactObj:c,handleVendorChange:this.handleVendorChange})),n.createElement("div",{className:"container-fluid"},n.createElement("div",{className:"header"},n.createElement("div",{className:"col-md-9"},n.createElement("h4",{className:"title"},"Create Purchase Order")),n.createElement("div",{className:"col-md-3"},g&&C&&n.createElement("button",{className:"btn-sm btn-success btn-fill pull-right",onClick:function(){window.location.hash=O+"/"+N+"/PurchaseOrder/"+a.poID+"/Edit"}},n.createElement("i",{className:"fa fa-edit"})," Edit"))),n.createElement("br",null),n.createElement("br",null),n.createElement("div",{className:"row padding-10"},n.createElement("div",{className:"col-md-12"},a.poID&&n.createElement(E,{value:a.poID}))),n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"row form-group"},n.createElement("div",{className:"col-md-2 col-xs-12"},n.createElement("label",{htmlFor:"pOrder"},"Purchase Order #")),n.createElement("div",{className:"col-md-4 col-xs-12"},n.createElement("input",{disabled:!0,id:"pOrder",type:"text",className:"form-control",name:"title",value:a.poID})),n.createElement("div",{className:"col-md-2 col-xs-12"},n.createElement("label",{htmlFor:"status"},"Status")),n.createElement("div",{className:"col-md-4 col-xs-12"},n.createElement("select",{className:"form-control",id:"status",name:"status",value:a.status,onChange:function(t){return e.handlePOFormChange(t)}},n.createElement("option",{value:""},"Select Status"),n.createElement("option",null,"Open"),n.createElement("option",null,"In Progress"),n.createElement("option",null,"On Hold"),n.createElement("option",null,"Complete"),n.createElement("option",null,"Cancel"))))),n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"row form-group"},n.createElement("div",{className:"col-md-2 col-xs-12"},n.createElement("label",{htmlFor:"title"},"Title:")),n.createElement("div",{className:"col-md-4 col-xs-12"},n.createElement("input",{type:"text",id:"title",name:"title",className:"form-control",value:a.title,placeholder:"Title",onChange:function(t){return e.handlePOFormChange(t)}})),n.createElement("div",{className:"col-md-2 col-xs-12"},n.createElement("label",{htmlFor:"relatedWO"},"Related WO #")),n.createElement("div",{className:"col-md-4 col-xs-12"},n.createElement("select",{className:"form-control",id:"relatedWO",name:"relatedwo",value:a.relatedwo,onChange:function(t){return e.handlePOFormChange(t)}},n.createElement("option",{value:""},"Select Related"),r.map(function(e,t){return n.createElement("option",{value:e.value,key:t},e.value," ")}))))),n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"headingText"},"Purchased From"),n.createElement("div",{className:"row padding-10"},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"purchasedFromCompany"},"Company:"))),n.createElement("div",{className:"col-md-4"},n.createElement("select",{className:"form-control",id:"purchasedFromCompany",name:"purchasedFromCompany",value:a.purchasedFromCompany,onChange:function(t){return e.handlePOFormChange(t)}},n.createElement("option",{value:""},"Select"),n.createElement("option",{value:"addVendor",key:-1},"New Vendor"),n.createElement("hr",null),o.map(function(e,t){return n.createElement("option",{value:Object(l.g)(e.contact),key:t},Object(l.g)(e.name)," ",Object(l.g)(e.company)," ")}))),n.createElement("div",{className:"col-md-1"},n.createElement("label",null,n.createElement("i",{className:"fa fas fa-asterisk"}))),n.createElement("div",null,n.createElement("div",{className:"col-md-5"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"purchasedFromAddress"},"Address:"),n.createElement("br",null),n.createElement("span",null,f)))))),n.createElement("div",{className:"headingText"},"Ship To"),n.createElement("div",{className:"row padding-10"},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"shipToCompany"},"Name:"))),n.createElement("div",{className:"col-md-4"},n.createElement("select",{className:"form-control",id:"shipToCompany",name:"shipToCompany",value:a.shipToCompany,onChange:function(t){return e.handlePOFormChange(t)}},n.createElement("option",{value:""},"Select"),n.createElement("option",{value:"addVendor",key:-1},"New Vendor"),n.createElement("hr",null),h.map(function(e,t){return n.createElement("option",{value:e.value.value,key:t},e.name.value," ")}))),n.createElement("div",{className:"col-md-1"},n.createElement("label",null,n.createElement("i",{className:"fa fas fa-asterisk"}))),n.createElement("div",null,n.createElement("div",{className:"col-md-5"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"shipToAddress"},"Address:"),n.createElement("br",null),n.createElement("span",null,p)))))),n.createElement("div",{className:"row padding-10"},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"bctext"},"Enter Barcode text"))),n.createElement("div",{className:"col-md-4"},n.createElement("input",{type:"text",className:"form-control",name:"",value:this.state.EnteredBarcode,onChange:function(t){e.setState({EnteredBarcode:t.target.value})}})),n.createElement("div",{className:"col-md-6"},this.state.EnteredBarcode&&n.createElement(E,{value:this.state.EnteredBarcode})))),n.createElement("div",{className:"row padding-10"},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-2"},n.createElement("div",{className:"form-group"},n.createElement("button",{className:"btn btn-primary",onClick:function(){e.setState({showBarcodeScanner:!e.state.showBarcodeScanner})}},this.state.showBarcodeScanner?"Hide":"Show"," Barcode Scanner"))),n.createElement("div",{className:"col-md-6"},this.state.showBarcodeScanner&&n.createElement(v.a,{width:500,height:500,onUpdate:function(t,a){a&&a.text&&(e.setState({ScannedBarcode:a.text,showBarcodeScanner:!1}),console.log(a.text))}})),n.createElement("div",{className:"col-md-4"},n.createElement("p",null,this.state.ScannedBarcode))))),n.createElement("div",{className:"col-md-12"},"\xa0"),n.createElement("div",{className:"col-md-12"},n.createElement(s.a,{name:"itemsList",items:a.items,onItemChange:this.handleItems,isView:g})),n.createElement("div",{className:"col-md-12"},"\xa0"),n.createElement("div",{className:"col-md-10 col-sm-6 col-xs-12 labelDynamic"},n.createElement("label",{htmlFor:"tax"},"Tax: (%)")),n.createElement("div",{className:"col-md-2 col-sm-6 col-xs-12"},n.createElement("div",{className:"form-group"},n.createElement("input",{type:"number",className:"form-control",placeholder:"Tax in %",name:"tax",value:a.tax,onChange:function(t){return e.handleTaxChange(parseFloat(t.target.value))}}))),n.createElement("div",{className:"col-md-4 col-sm-6 col-xs-12 labelDynamic"},n.createElement("label",{htmlFor:"shippedVia"},"Shipped Via:")),n.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12"},n.createElement("div",{className:"form-group"},n.createElement("select",{className:"form-control",value:a.shippedVia,id:"shippedVia",name:"shippedVia",onChange:function(t){return e.handlePOFormChange(t)}},n.createElement("option",{value:""},"Select Shipping Via"),n.createElement("option",null,"DHL"),n.createElement("option",null,"FedEx"),n.createElement("option",null,"UPS")))),n.createElement("div",{className:"col-md-3 col-sm-6 col-xs-12 labelDynamic"},n.createElement("label",{htmlFor:"shipping"},"Shipping: ($)")),n.createElement("div",{className:"col-md-2 col-sm-6 col-xs-12"},n.createElement("div",{className:"form-group"},n.createElement("input",{type:"number",className:"form-control",value:a.shipping,placeholder:"Shipping",name:"shipping",onChange:function(t){return e.handleShippingChange(parseFloat(t.target.value))}}))),n.createElement("div",{className:"col-md-10 col-sm-6 col-xs-12 labelDynamic"},n.createElement("label",{htmlFor:"other"},"Other: ($)")),n.createElement("div",{className:"col-md-2 col-sm-6 col-xs-12"},n.createElement("div",{className:"form-group"},n.createElement("input",{type:"number",className:"form-control",value:a.other,placeholder:"Other",name:"other",onChange:function(t){return e.handleOtherChange(parseFloat(t.target.value))}}))),n.createElement("div",{className:"col-md-10 col-sm-6 col-xs-12 labelDynamic"},n.createElement("label",{htmlFor:"total"},"Total: ($)")),n.createElement("div",{className:"col-md-2 col-sm-6 col-xs-12"},n.createElement("div",{className:"form-group"},n.createElement("input",{type:"number",disabled:!0,className:"form-control",value:a.total,placeholder:"Total",name:"total"}))),!g&&n.createElement("div",{className:"col-md-12 inline-flex"},n.createElement("button",{disabled:!y,className:"btn btn-primary btn-fill",onClick:function(t){return e._savePurchaseOrder()}},n.createElement("i",{className:"fa fa-save"})," Save"),n.createElement("button",{className:"btn btn-secondary btn-fill",onClick:function(e){window.location.hash="/"+O+"/"+N+"/PurchaseOrders"}},n.createElement("i",{className:"fa fa-window-close"})," Cancel")))))},t}(n.Component);t.default=O}});