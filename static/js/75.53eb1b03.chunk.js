webpackJsonp([75],{603:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c,a,r=n(2),i=(n.n(r),n(822)),s=n(39),o=n(12),u=n(107),l=n(16),h=n(8),f=n(60),d=n(118),b=n(9),p=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function c(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(c.prototype=n.prototype,new c)}}(),m=this&&this.__awaiter||function(t,e,n,c){return new(n||(n=Promise))(function(a,r){function i(t){try{o(c.next(t))}catch(t){r(t)}}function s(t){try{o(c.throw(t))}catch(t){r(t)}}function o(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,s)}o((c=c.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){var n,c,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,c&&(a=2&r[0]?c.return:r[0]?c.throw||((a=c.return)&&a.call(c),0):c.next)&&!(a=a.call(c,r[1])).done)return a;switch(c=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,c=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){i.label=r[1];break}if(6===r[0]&&i.label<a[1]){i.label=a[1],a=r;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=e.call(t,i)}catch(t){r=[6,t],c=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function g(){var t=document.getElementById("chatMessagesContainer");t&&(t.scrollTop=t?t.scrollHeight:0)}var S=function(t){function e(e){var n=t.call(this,e)||this;return n.state={chatMessages:[],chatText:"",participants:[],tag:"",issue:""},c=n,n.s3=new s.b,n.fetchContactInfo=n.fetchContactInfo.bind(n),n}return p(e,t),e.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){var t,e,n,r,i;return v(this,function(s){switch(s.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,r=t.s,e&&n?[4,this.fetchContactInfo()]:[3,3];case 1:return s.sent(),[4,this.getAllMessages()];case 2:s.sent(),(i=document.querySelector("#messageBody")).scrollTop=i.scrollHeight-i.clientHeight,a=window.innerHeight-270,s.label=3;case 3:return r&&r._socket&&r._socket.on&&r._socket.on("new message",function(t){var e=c.state.chatMessages;(0==e.length||e.length>0&&JSON.stringify(e[e.length-1])!=JSON.stringify(t))&&c.state.tag==t.tag&&(e.push(t),c.setState({chatMessages:e},function(){c.saveAllMessages(),g()}))}),[2]}})})},e.prototype.fetchContactInfo=function(){return m(this,void 0,void 0,function(){var t,e,n,c,a,r,s,o=this;return v(this,function(l){switch(l.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,c=t.entityTitle,e&&n?(a=[],r="",s="",c&&"Contact"!=c?[4,Object(i.i)("",c).then(function(t){if(t.length>0){var e=t[0];a=Object(h.g)(e.chatName).split("-_-"),s=Object(h.g)(e.description)}})]:[3,2]):[3,5];case 1:return l.sent(),[3,3];case 2:a=n,l.label=3;case 3:return a=a.sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).slice(),[4,Object(u.m)("",a).then(function(t){t.length>0&&(r+="Chat-_-",r+=t.map(function(t){return Object(h.g)(t.contact)}).join("-_-"),o.setState({participants:t,tag:r,issue:s},function(){return m(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Object(i.w)(r)];case 1:return t.sent(),[2]}})})}))})];case 4:l.sent(),l.label=5;case 5:return[2]}})})},e.prototype.getAllMessages=function(){return m(this,void 0,void 0,function(){var t,e,n;return v(this,function(a){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.GetObject(s.a.CHAT,n+".json",function(t,e){if(t)console.log("Get Object Error Returned",t);else{var n=Object(o.c)(e.Body);if(n){var a=JSON.parse(n);a.length>c.state.chatMessages.length&&c.setState({chatMessages:a}),g()}}}),[2]})})},e.prototype.saveAllMessages=function(){return m(this,void 0,void 0,function(){var t,e,n;return v(this,function(c){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.PutObject(s.a.CHAT,n+".json",JSON.stringify(this.state.chatMessages)),[2]})})},e.prototype.handleChatInput=function(t){this.setState({chatText:t})},e.prototype.handleChatInputKeys=function(t){(13===t.which||"Enter"===t.key)&&t.target.value&&t.target.value.trim()&&(this.setState({chatText:t.target.value.trim()}),this.sendMessage())},e.prototype.sendMessage=function(){return m(this,void 0,void 0,function(){var t,e,n,a,r,s,o,u;return v(this,function(l){return t=this.props.entityTitle,this.state.chatText&&this.state.chatText.trim()&&(e=JSON.parse(b.a.getItem("user")),n=this.state,a=n.participants,r=n.tag,s=this.state.chatText,o={from:e.contact,fromName:e.name,messageText:s,tag:r,timestamp:(new Date).toString()},Object(d.c)(o),(u=this.state.chatMessages).push(o),this.setState({chatMessages:u,chatText:""},function(){Object(i.q)(t,"Chat-_-"+a.map(function(t){return""+t.contact.value}).sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).join("-_-")),c.saveAllMessages()}),g()),[2]})})},e.prototype.render=function(){var t=this,e=this.props.entityTitle,n=this.state,c=n.chatMessages,i=n.chatText,s=n.participants,o=n.issue,u=JSON.parse(b.a.getItem("user")),d=Object(f.b)(u,"task-ticket","write"),p=-1!=s.findIndex(function(t){return Object(h.g)(t.contact)==u.contact});return r.createElement(l.AppContext.Consumer,null,function(n){return r.createElement("div",{className:"container-fluid "},r.createElement("div",{className:"content"},r.createElement("div",{className:"chatHead"},r.createElement("div",{className:"col-md-12"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"heading"},e," -- ",s.map(function(t){return Object(h.g)(t.name)}).join(" -- "),""!=o?"--"+o:"")))),r.createElement("div",{id:"chatMessagesContainer",className:" padding-10 chatBody"},r.createElement("div",{className:"col-md-12"},r.createElement("div",{className:"card padding-10 scroll",id:"messageBody",style:{height:a,overflowX:"hidden",margin:"0px"}},r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"row"},r.createElement("div",{className:"card col-md-12 col-xs-12 padding-10",style:{margin:"0px"}},0==c.length&&r.createElement("div",null," No messages found in this conversation. "),c.map(function(t,e){if(t&&t.from){var n=s.find(function(e){return e.contact.value==t.from});if(n&&n.name)return r.createElement("div",{key:e,className:"padding-10 chat-message "+(t.from==u.contact?"inbound-message":"outbound-message")},r.createElement("div",{className:"message-text padding-5",style:{overflowWrap:"break-word"}},t.messageText),r.createElement("div",{className:"sender-name"},r.createElement("label",null,r.createElement("b",null,n.name.value))),r.createElement("div",{className:"timestamp"},r.createElement("b",null,t.timestamp.ToEasternDateTime())))}}))))),p&&d&&r.createElement("footer",{className:"col-md-12 no-padding"},r.createElement("div",{className:"card",style:{margin:"0px"}},r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12 no-padding"},r.createElement("div",{className:"",style:{display:"inline-flex",padding:"0px",width:"100%"}},r.createElement("input",{type:"text",className:"form-control",placeholder:"Type your message here...",name:"chatBox",value:i,style:{height:"97px"},onChange:function(e){return t.handleChatInput(e.target.value)},onKeyPress:function(e){return t.handleChatInputKeys(e)}}),r.createElement("button",{type:"button",className:"btn pull-right btn-primary btn-fill chatButton",onClick:function(){t.sendMessage()}},r.createElement("i",{className:"fa fa-comment"}),"\xa0 Send ")))))))))))})},e}(r.Component);e.default=S},822:function(t,e,n){"use strict";e.n=function(){var t=JSON.parse(i.a.getItem("user"));return!(!t||t.workingStatus&&"Not Working"!=t.workingStatus)&&(!!document.getElementById("btnStatus")&&(document.getElementById("btnStatus").click(),!0))},e.l=function(){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Object(r.e)({},r.a.TASKS.GetTaskTypeList,c.b.TASK)];case 1:return[2,t.sent()]}})})},e.m=function(){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Object(r.e)({},r.a.TASKS.GetWorkTypeList,c.b.TASK)];case 1:return[2,t.sent()]}})})},e.h=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.e)({buildingName:t,getArchivedOnly:e},r.a.CHATS.GetChats,c.b.TASK)];case 1:return[2,n.sent()]}})})},e.f=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,chatName:e},r.a.CHATS.DeleteChat,c.b.TASK).then(function(){Object(a.b)("Chat Deleted Successfully.")}).catch(function(t){Object(a.a)("Error occured while deleting Chat.")})];case 1:return[2,n.sent()]}})})},e.q=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,chatName:e},r.a.TASKS.UpdateLastMessageOn,c.b.CHAT)];case 1:return[2,n.sent()]}})})},e.w=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(r.f)({chatName:t},r.a.TASKS.UpdateUnreadCount,c.b.TASK)];case 1:return[2,e.sent()]}})})},e.p=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(r.f)({buildingName:t,model:e,isEdit:n},r.a.TASKS.UpdateRootTask,c.b.TASK).then(function(){Object(a.b)("Task "+(n?"Updated":"Added")+" Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.i=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(a){switch(a.label){case 0:return[4,Object(r.e)({buildingName:t,taskNumber:e,isArchived:n},r.a.TASKS.GETTASKS,c.b.TASK,!0)];case 1:return[2,a.sent()]}})})},e.j=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(a){switch(a.label){case 0:return[4,Object(r.e)({buildingName:t,parentTask:e,subTaskNumber:n},r.a.TASKS.GetSubTask,c.b.TASK)];case 1:return[2,a.sent()]}})})},e.s=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,isDeleted:e},r.a.TASKS.UpdateRootTaskDeleteStatus,c.b.TASK).then(function(){Object(a.b)("Task Deleted Successfully.")}).catch(function(t){Object(a.a)("Error occured while deleting Task.")})];case 1:return[2,n.sent()]}})})},e.v=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(r.f)({taskID:t,status:e},r.a.TASKS.UpdateTaskStatus,c.b.TASK).then(function(){n||Object(a.b)("Status Updated Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.u=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,startTime:e},r.a.TASKS.UpdateTaskStartTime,c.b.TASK).then(function(){Object(a.b)("Start Time Updated Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.d=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,isArchived:e},r.a.TASKS.ArchiveTask,c.b.TASK).then(function(){Object(a.b)((e?"Archived":"Unarchived")+" Successfully.")}).catch(function(t){Object(a.a)("Error occured while Archiving Task.")})];case 1:return[2,n.sent()]}})})},e.c=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,note:e},r.a.TASKS.AddPauseNote,c.b.TASK).then(function(){}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.g=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(r.f)({taskID:t},r.a.TASKS.DeletePauseNote,c.b.TASK).then(function(){}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,e.sent()]}})})},e.b=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,note:e},r.a.TASKS.AddNote,c.b.TASK).then(function(){Object(a.b)("Note Added Successfully.")}).catch(function(t){Object(a.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.a=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,isAcknowledged:e},r.a.TASKS.AcknowledgeRootTask,c.b.TASK).then(function(){Object(a.b)(e?"Acknowledged Successfully.":"Unacknowledged Successfully.")}).catch(function(t){Object(a.a)("Error occured while Acknowledging.")})];case 1:return[2,n.sent()]}})})},e.e=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.f)({taskID:t,checklistID:e},r.a.TASKS.AssignChecklist,c.b.TASK).then(function(){Object(a.b)("Checklist Assigned Successfully.")}).catch(function(t){Object(a.a)("Error occured while Assigning Checklist.")})];case 1:return[2,n.sent()]}})})},e.t=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(r.f)({taskID:t,status:e},r.a.TASKS.UpdateTaskOrStageStatus,c.b.TASK).then(function(){n||Object(a.b)("Status Updated Successfully.")}).catch(function(t){Object(a.a)("Error occured while update Status.")})];case 1:return[2,i.sent()]}})})},e.r=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(r.f)({email:t,roles:e,fileName:n},r.a.ONEDRIVE.UPDATEPERMISSION,c.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(a.a)("Error occured while update Status.")})];case 1:return[2,i.sent()]}})})},e.o=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(r.f)({fileName:t},r.a.ONEDRIVE.REMOVEPERMISSION,c.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(a.a)("Error occured while update Status.")})];case 1:return[2,e.sent()]}})})},e.k=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(r.e)({buildingName:t,checklistID:e},r.a.TASKS.GetTaskHavingChecklist,c.b.TASK,!0)];case 1:return[2,n.sent()]}})})};var c=n(7),a=n(6),r=n(5),i=n(9),s=this&&this.__awaiter||function(t,e,n,c){return new(n||(n=Promise))(function(a,r){function i(t){try{o(c.next(t))}catch(t){r(t)}}function s(t){try{o(c.throw(t))}catch(t){r(t)}}function o(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,s)}o((c=c.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,c,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,c&&(a=2&r[0]?c.return:r[0]?c.throw||((a=c.return)&&a.call(c),0):c.next)&&!(a=a.call(c,r[1])).done)return a;switch(c=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,c=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){i.label=r[1];break}if(6===r[0]&&i.label<a[1]){i.label=a[1],a=r;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(r);break}a[2]&&i.ops.pop(),i.trys.pop();continue}r=e.call(t,i)}catch(t){r=[6,t],c=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}}});