webpackJsonp([57],{1046:function(e,t,n){"use strict";t.b=function(e,t,n,o){return i(this,void 0,void 0,function(){return a(this,function(i){switch(i.label){case 0:return[4,Object(r.f)({modelId:e,newModel:t,oldModel:n,user:o},r.a.HistorianArchive.SaveHistorianArchive,"")];case 1:return[2,i.sent()]}})})},t.a=function(e){return i(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,Object(r.d)(r.a.HistorianArchive.GetHistorianArchive,"modelID="+e)];case 1:return[2,t.sent()]}})})};var r=n(9),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,c)}s((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}},876:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=(n.n(r),n(15)),a=n(21),o=n(12),c=n(1046),s=n(187),l=n(7),u=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,c)}s((r=r.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={archive:[],versionToRestore:Object(),historianArchiveDifferences:[],sourceTimestamp:Object(),targetTimestamp:Object(),user:"",peopleList:Object()},n.getHistorianArchive=n.getHistorianArchive.bind(n),n.restoreHistorian=n.restoreHistorian.bind(n),n.getPeopleList=n.getPeopleList.bind(n),n}return u(t,e),t.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return this.props.buildingName&&this.props.instance&&this.props.ObjectId?(Object(i.a)(!0),[4,this.getHistorianArchive()]):[3,3];case 1:return e.sent(),[4,this.getPeopleList()];case 2:e.sent(),Object(i.a)(!1),e.label=3;case 3:return[2]}})})},t.prototype.getPeopleList=function(){return m(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return[4,Object(s.m)(this.props.buildingName)];case 1:return e=t.sent(),this.setState({peopleList:e}),[2]}})})},t.prototype.getHistorianArchive=function(){return m(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return[4,Object(c.a)(this.props.ObjectId)];case 1:return e=t.sent(),this.setState({archive:e}),[2]}})})},t.prototype.difference=function(e,t){return m(this,void 0,void 0,function(){var n,r,i,a,o,c;return d(this,function(s){switch(s.label){case 0:return n=this.state.peopleList,e&&e.model&&t&&t.model?(r=JSON.parse(e.model),i=JSON.parse(t.model),[4,this.getDifference(r,i)]):[3,2];case 1:a=s.sent(),o=n.find(function(t){return Object(l.g)(t.contact)==e.createdBy}),c=o&&o.name?Object(l.g)(o.name):"",this.setState({historianArchiveDifferences:a,sourceTimestamp:e.timestamp,targetTimestamp:t.timestamp,user:c},function(){document.getElementById("btnShowDifference").click()}),s.label=2;case 2:return[2]}})})},t.prototype.getDifference=function(e,t,n){return m(this,void 0,Promise,function(){var r,i=this;return d(this,function(a){return r=[],Object.keys(e).forEach(function(a){return m(i,void 0,void 0,function(){var i,o,c,s;return d(this,function(l){switch(l.label){case 0:return i=e&&e[a]?e[a]:"",o=t&&t[a]?t[a]:"","object"!=typeof i?[3,3]:JSON.stringify(i)==JSON.stringify(o)?[3,2]:(c=isNaN(a)?a:n||"",[4,this.getDifference(i,o,c)]);case 1:s=l.sent(),r.push.apply(r,s),l.label=2;case 2:return[3,4];case 3:i!=o&&"value"!=a&&r.push({key:n?n+("label"!=a?" - "+a:""):a,source:i||"",target:o||""}),l.label=4;case 4:return[2]}})})}),[2,r]})})},t.prototype.restoreHistorian=function(){return m(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return(e=this.state.versionToRestore)&&e.model&&this.props.restoreSelectedVersion(e),[4,this.getHistorianArchive()];case 1:return t.sent(),[2]}})})},t.prototype.render=function(){var e=this,t=this.props.instance,n=this.state,i=n.archive,c=n.versionToRestore,s=n.historianArchiveDifferences,l=n.sourceTimestamp,u=n.targetTimestamp,m=n.user;return r.createElement("div",{className:"card",id:"HistorianArchiveList"},r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"content"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("h3",null,"Historian Archive"))),r.createElement("br",null),r.createElement("div",{className:"row no-margin"},r.createElement("div",{className:"hidden-xs col-md-10 col-md-offset-1 col-md-offset-right-1 no-padding cell_border",style:{marginBottom:"0px"}},r.createElement("div",{className:"col-md-12 bgcol trim-data headingText",style:{padding:"10px"}},"Timestamp"))),r.createElement("div",{className:"dataCard"},r.createElement("div",{className:"hidden"}),i&&i.length>0&&i.map(function(t,n){return r.createElement("div",{className:"col-md-10 cell_border no-padding col-md-offset-1 col-md-offset-right-1 clickable"},r.createElement("div",{className:"row no-margin hover"},r.createElement("div",{className:"col-md-4 padding-10"},r.createElement("span",{className:"hidden visible-xs-inline headingText"},"Timestamp"),"  ",t.timestamp.ToEasternDateTime()),r.createElement("div",{className:"col-md-8"},0!=n&&r.createElement("button",{className:"btn btn-sm btn-success btn-fill pull-right margin-5 mr-0",title:"Restore this version",onClick:function(n){e.setState({versionToRestore:t},function(){document.getElementById("btnConfirmRestore").click()})}},"Restore this version  "),n!=i.length-1&&r.createElement("button",{className:"btn btn-sm btn-primary btn-fill pull-right margin-5 mr-0",title:"Difference with previous version",onClick:function(r){n!=i.length-1&&e.difference(t,i[n+1])}},"Difference with previous version   "),0!=n&&r.createElement("button",{className:" btn btn-sm btn-primary btn-fill pull-right margin-5 mr-0",title:"Difference with latest version",onClick:function(r){0!=n&&e.difference(t,i[0])}},"Difference with latest version   "))))})),r.createElement("button",{id:"btnConfirmRestore",style:{display:"none"},"data-toggle":"modal","data-target":"#ConfirmRestoreDialog"},"."),r.createElement(a.a,{instance:t,id:"ConfirmRestoreDialog",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmationText:'Are you sure to Restore "'+(c&&c.timestamp?c.timestamp.ToEasternDateTime():"")+'" Version?',heading:"Confirm...",onConfirmButtonClick:function(){e.restoreHistorian()}}),r.createElement("button",{type:"button",id:"btnShowDifference",className:"hidden","data-toggle":"modal","data-target":"#ShowDifference"}," "),r.createElement(o.a,{id:"ShowDifference",heading:"Difference",saveButtonText:"Done",onSaveButtonClick:function(){},isEditForm:!0},r.createElement("div",{className:"scroll-y",style:{maxHeight:500}},r.createElement("div",{className:"container-fluid",style:{paddingLeft:"0px"}},r.createElement("div",{className:"content",style:{paddingTop:"0px"}},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12",style:{margin:"0px 10px"}},r.createElement("p",{className:"padding-5 small pull-left cell_border hover",style:{borderRadius:"5px",background:"rgb(220 220 220 / 21%)",color:"black"}},r.createElement("b",{style:{color:"gray"}},"Updated By: \xa0")," ",m,", (",new Date(l&&l).ToEasternDateTime(),")")),s&&s.length>0&&l&&u&&r.createElement("div",{className:"col-md-12",style:{margin:"10px"}},r.createElement("div",{className:"col-md-6 cell_border no-padding center",style:{background:"#dcdcdc94",borderRadius:"50px"}},r.createElement("h4",{className:"margin-10"},l&&l.ToEasternDateTime())),r.createElement("div",{className:"col-md-6 cell_border no-padding center",style:{background:"gainsboro",borderRadius:"50px"}},r.createElement("h4",{className:"margin-10"},u&&u.ToEasternDateTime()))),s&&s.length>0&&s.map(function(e){return r.createElement("div",{className:"col-md-12",style:{margin:"10px"}},r.createElement("div",{className:"col-md-12 no-padding cell_border border-radius"},r.createElement("div",{className:"col-md-12 padding-10 center cell_border",style:{background:"ghostwhite"}},r.createElement("h5",{className:"no-margin",style:{textTransform:"uppercase",padding:"2px"}},r.createElement("b",null,"Attribute:")," ",r.createElement("span",{className:"text-primary"},e.key))),r.createElement("div",{className:"col-md-6 padding-10 center cell_border",style:{background:"#dcdcdc94"}},e.source?e.source:"-"),r.createElement("div",{className:"col-md-6 padding-10 center cell_border",style:{background:"gainsboro"}},e.target?e.target:"-")))})))))))),r.createElement("br",null),r.createElement("br",null),r.createElement("br",null),r.createElement("br",null),r.createElement("br",null),r.createElement("br",null))))},t}(r.Component);t.default=f}});