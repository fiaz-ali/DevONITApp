webpackJsonp([48],{2912:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(2),s=(n.n(o),n(656)),r=n(117),l=n(11),i=n(652),c=n(662),u=n(22),d=n(53),m=n(2913),h=n(122),f=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{i(a.next(e))}catch(e){s(e)}}function l(e){try{i(a.throw(e))}catch(e){s(e)}}function i(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(r,l)}i((a=a.apply(e,t||[])).next())})},g=this&&this.__generator||function(e,t){var n,a,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},b=function(e){function t(t){var n=e.call(this,t)||this;return n.state={tenantAlertObj:Object(),tenantAlerts:[],sortOrder:1,itemToDelete:Object(),_tenantList:[],message:"",refreshChild:!1},a=n,n.s3=new d.b,n.getAllAlertLogs=n.getAllAlertLogs.bind(n),n.onDeleteLogItem=n.onDeleteLogItem.bind(n),n.deleteLogItem=n.deleteLogItem.bind(n),n.sortAlertLogList=n.sortAlertLogList.bind(n),n._fetchTenantList=n._fetchTenantList.bind(n),n.handleTenantAlerts=n.handleTenantAlerts.bind(n),n.sendAlertsToTenants=n.sendAlertsToTenants.bind(n),n.saveAlertLog=n.saveAlertLog.bind(n),n.handleReuseMessage=n.handleReuseMessage.bind(n),n}return f(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this.getAllAlertLogs()]:[3,3];case 1:return e.sent(),[4,this._fetchTenantList()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype._fetchTenantList=function(){return p(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return Object(r.a)(!0),[4,Object(c.u)(this.props.buildingName).then(function(t){e.setState({_tenantList:t})}).catch(function(e){return e})];case 1:return t.sent(),Object(r.a)(!1),[2]}})})},t.prototype.getAllAlertLogs=function(){return p(this,void 0,void 0,function(){return g(this,function(e){return this.state,this.s3.GetObject(d.a.DOCUMENT(),"AlertLog.json",function(e,t){if(e)console.log("Get Object Error Returned",e);else{var n=Object(u.f)(t.Body);if(n){var o=JSON.parse(n);o.length>0&&a.setState({tenantAlerts:o})}}}),[2]})})},t.prototype.onDeleteLogItem=function(e){this.setState({itemToDelete:e},function(){document.getElementById("btnConfirm").click()})},t.prototype.deleteLogItem=function(){return p(this,void 0,void 0,function(){var e,t,n,a,o,s=this;return g(this,function(l){return e=this.state,t=e.itemToDelete,n=e.tenantAlerts,Object(r.a)(!0),a=n,t&&t.contact&&t.date&&-1!=(o=a.findIndex(function(e){return e.contact==t.contact&&e.date==t.date}))&&(a.splice(o,1),this.setState({tenantAlerts:a},function(){s.s3.PutObject(d.a.DOCUMENT(),"AlertLog.json",JSON.stringify(s.state.tenantAlerts))})),[2]})})},t.prototype.sortAlertLogList=function(e,t){var n=this.state.tenantAlerts,a=this.state.sortOrder,o=n.sort(function(n,o){if(n&&o){var s="",r="";switch(e){case"Contact":n.contact&&o.contact&&(s=n.contact,r=o.contact,a=t||1);break;case"Alert":n.alertMessage&&o.alertMessage&&(s=n.alertMessage,r=o.alertMessage,a=t||1);break;case"Group":n.group&&o.group&&(s=n.group,r=o.group);break;case"Date":n.date&&o.date&&(s=n.date,r=o.date)}var l=0;return s.toLocaleLowerCase()<r.toLocaleLowerCase()?l=-1:s.toLocaleLowerCase()>r.toLocaleLowerCase()&&(l=1),l*a}});this.setState({tenantAlerts:o,sortOrder:-1*a})},t.prototype.handleTenantAlerts=function(e){this.setState({tenantAlertObj:e})},t.prototype.sendAlertsToTenants=function(){return p(this,void 0,void 0,function(){var e,t=this;return g(this,function(n){return e=this.state.tenantAlertObj,(new h.a).SendSMS_Multiple(e.contactNumbers,e.message,this.props.instance,!1,function(){t.saveAlertLog()}),[2]})})},t.prototype.handleReuseMessage=function(e){this.setState({message:e.alertMessage},function(){document.getElementById("btnsendAlertModal").click()})},t.prototype.saveAlertLog=function(){return p(this,void 0,void 0,function(){var e,t,n,a,o,s=this;return g(this,function(i){return e=this.state,t=e.tenantAlertObj,n=e._tenantList,a=e.tenantAlerts,o=a,t.contactNumbers&&t.contactNumbers.length&&(t.contactNumbers.map(function(e){n.map(function(n){Object(l.g)(n.mobile)==e&&o.push({alertMessage:t.message,group:Object(l.g)(n.group),date:(new Date).toString(),contact:e,site:s.props.buildingName})})}),this.setState({tenantAlerts:o},function(){Object(r.a)(!0),s.s3.PutObject(d.a.DOCUMENT(),"AlertLog.json",JSON.stringify(s.state.tenantAlerts)),Object(r.a)(!1)})),[2]})})},t.prototype.render=function(){var e=this,t=this.state,n=t.tenantAlerts,r=t.message,l=t.refreshChild,c=this.props,u=c.buildingName,d=c.instance,h=n.filter(function(e){return e.site==a.props.buildingName});return o.createElement("div",{className:"content",id:"chats"},o.createElement("div",{className:"container-fluid"},o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-12 "},o.createElement("div",{className:"dropdown pull-right"},o.createElement("button",{type:"button",style:{marginRight:3},className:"btn btn-dark btn-fill pull-right","data-toggle":"modal","data-target":"#sendAlertModal"},o.createElement("i",{className:"fa fa-bell"}),o.createElement("span",{className:"hidden-xs"},"Send Alerts")),o.createElement(i.a,{id:"sendAlertModal",heading:"Send Alert To Customers",saveButtonText:"Send",onSaveButtonClick:function(){e.sendAlertsToTenants()},disableSaveButton:!1},o.createElement(m.a,{instance:d,buildingName:u,handleTenantAlerts:this.handleTenantAlerts,refresh:l}))))),o.createElement("div",{className:"row no-padding"},o.createElement("div",{className:"col-md-12 no-padding"},o.createElement("br",null),o.createElement("div",{className:"card padding-10",id:"PastAlertsList",style:{paddingTop:"0px"}},o.createElement("div",{className:"content",style:{paddingTop:"10px"}},o.createElement("div",{className:"dataCard"},o.createElement("button",{type:"button",id:"btnOpenTenantForm",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#tenantFormDialog"}," ."),o.createElement("button",{id:"btnConfirm",style:{display:"none"},"data-toggle":"modal","data-target":"#ConfirmDeleteDialog"},"."),o.createElement(s.a,{instance:this.props.instance,id:"ConfirmDeleteDialog",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmationText:"Are you sure to delete this Log Item?",heading:"Confirm...",onConfirmButtonClick:function(){e.deleteLogItem()}}),o.createElement("button",{type:"button",id:"btnsendAlertModal",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#sendAlertModal"}," ."),o.createElement(i.a,{id:"sendAlertModal",heading:"Send Alert To Customers",saveButtonText:"Send",onSaveButtonClick:function(){e.sendAlertsToTenants()},disableSaveButton:!1},o.createElement(m.a,{instance:d,buildingName:u,handleTenantAlerts:this.handleTenantAlerts,message:r})),o.createElement("div",{className:"row hidden-sm hidden-xs no-padding"},o.createElement("div",{className:"col-md-9 col-sm-12  no-padding dataCard"},o.createElement("div",{className:"col-md-3 col-sm-12 small headingText grid-header-left",onClick:function(){return e.sortAlertLogList("Contact")}},o.createElement("i",{className:"fa fas fa-sort"}),"Contact"),o.createElement("div",{className:"col-md-3 col-sm-12 small headingText grid-header",onClick:function(){return e.sortAlertLogList("Alert")}},o.createElement("i",{className:"fa fas fa-sort"}),"Alert"),o.createElement("div",{className:"col-md-2 col-sm-12 small headingText grid-header",onClick:function(){return e.sortAlertLogList("Group")}},o.createElement("i",{className:"fa fas fa-sort"}),"Group"),o.createElement("div",{className:"col-md-2 col-sm-12 small headingText grid-header",onClick:function(){return e.sortAlertLogList("Date")}},o.createElement("i",{className:"fa fas fa-sort"}),"Date")),o.createElement("div",{className:"col-md-2 col-sm-12  headingText"})),h.map(function(t,n){return o.createElement("div",{key:n,className:"row clickable"},o.createElement("div",{className:"col-md-9 col-sm-12 "},o.createElement("div",{className:"col-md-3 col-sm-12 small trim-data",title:t.contact},o.createElement("span",{className:"hidden visible-sm-inline visible-xs-inline headingText"},"Contact"),t.contact),o.createElement("div",{className:"col-md-3 col-sm-12 small trim-data",title:t.alertMessage},o.createElement("span",{className:"hidden visible-sm-inline visible-xs-inline headingText"},"Alert"),t.alertMessage),o.createElement("div",{className:"col-md-2 col-sm-12 small trim-data",title:t.group},o.createElement("span",{className:"hidden visible-sm-inline visible-xs-inline headingText"},"Group"),t.group),o.createElement("div",{className:"col-md-2 col-sm-12 small trim-data",title:t.date?new Date(t.date).YYMMDDHHMM():""},o.createElement("span",{className:"hidden visible-sm-inline visible-xs-inline headingText"},"Date"),t.date?new Date(t.date).YYMMDDHHMM():"")),o.createElement("div",{className:"col-md-3 col-sm-12  col-xs-12"},o.createElement("button",{className:"btn-xs btn-danger btn-fill",onClick:function(n){e.onDeleteLogItem(t)}},o.createElement("i",{className:"fa fa-trash"})," Delete"),o.createElement("button",{className:"btn-xs btn-success btn-fill",onClick:function(n){e.handleReuseMessage(t)}},o.createElement("i",{className:"fa fa-edit"})," Reuse Message")))}))))))))},t}(o.Component);t.default=b},2913:function(e,t,n){"use strict";var a=n(2),o=(n.n(a),n(658)),s=n(662),r=n(11),l=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),i=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(o,s){function r(e){try{i(a.next(e))}catch(e){s(e)}}function l(e){try{i(a.throw(e))}catch(e){s(e)}}function i(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(r,l)}i((a=a.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,a,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},u=function(e){function t(t){var n=e.call(this,t)||this;return n.state={tenantAlertObj:Object(),tenantDropDownList:[],zonesDropDownList:[],zonesList:[],tenantsList:[],contactList:[]},n.onRadioRoleChange=n.onRadioRoleChange.bind(n),n.onMessageChange=n.onMessageChange.bind(n),n.handleMultiTenantChange=n.handleMultiTenantChange.bind(n),n.handleMultiZoneChange=n.handleMultiZoneChange.bind(n),n._fetchTenantList=n._fetchTenantList.bind(n),n._fetchZonesList=n._fetchZonesList.bind(n),n.handleIncludeSecondaryContactChange=n.handleIncludeSecondaryContactChange.bind(n),n.filterZoneContactsList=n.filterZoneContactsList.bind(n),n}return l(t,e),t.prototype.componentDidMount=function(){return i(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this._fetchTenantList()]:[3,3];case 1:return e.sent(),[4,this._fetchZonesList()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e){return i(this,void 0,void 0,function(){var t,n;return c(this,function(a){switch(a.label){case 0:return t=this.props.refresh,n=this.state.tenantAlertObj,e.refresh==t?[3,2]:[4,this._fetchTenantList()];case 1:a.sent(),a.label=2;case 2:return e.message&&(n.message=e.message,this.setState({tenantAlertObj:n})),[2]}})})},t.prototype.onRadioRoleChange=function(e){var t=this,n=this.state.tenantAlertObj;n.role=e,this.setState({tenantAlertObj:n},function(){t.filterZoneContactsList()}),this.props.handleTenantAlerts(n)},t.prototype.handleMultiTenantChange=function(e){var t=this.state,n=t.contactList,a=t.tenantsList,o=this.state.tenantAlertObj,s=o.contactNumbers?o.contactNumbers:[];e.map(function(e){var t=Object(r.g)(a.find(function(t){return t.userName.value==e.value}).mobile);s.find(function(e){return e==t})||s.push(t)}),o.additionalContacts=e,o.contactNumbers=s,this.setState({tenantAlertObj:o,contactList:n}),this.props.handleTenantAlerts(o)},t.prototype.handleMultiZoneChange=function(e){var t=this,n=this.state.tenantAlertObj;n.zones=e,this.setState({tenantAlertObj:n},function(){t.filterZoneContactsList()}),this.props.handleTenantAlerts(n)},t.prototype.handleIncludeSecondaryContactChange=function(e){var t=this,n=this.state.tenantAlertObj;n.includeSecondaryContacts=e,this.setState({tenantAlertObj:n},function(){t.filterZoneContactsList()}),this.props.handleTenantAlerts(n)},t.prototype.onMessageChange=function(e){var t=this.state.tenantAlertObj;t.message=e,this.setState({tenantAlertObj:t}),this.props.handleTenantAlerts(t)},t.prototype._fetchTenantList=function(){return i(this,void 0,void 0,function(){var e=this;return c(this,function(t){switch(t.label){case 0:return[4,Object(s.u)(this.props.buildingName).then(function(t){var n=t.map(function(e){return{value:e.userName.value,label:e.name.value}});e.setState({tenantDropDownList:n,tenantsList:t})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype._fetchZonesList=function(){return i(this,void 0,void 0,function(){var e=this;return c(this,function(t){switch(t.label){case 0:return[4,Object(s.h)(this.props.buildingName).then(function(t){var n=[];t.map(function(e){n.find(function(t){return t.value==e.zone.value})||n.push({value:e.zone.value,label:e.rdfsLabel.value})}),e.setState({zonesDropDownList:n,zonesList:t})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.filterZoneContactsList=function(){var e=this.state,t=e.zonesList,n=e.tenantAlertObj,a=n.contactNumbers?n.contactNumbers:[],o=n.role?n.role:"both",s=!!n.includeSecondaryContacts&&n.includeSecondaryContacts;n.zones&&n.zones.map(function(e){("owns"==o&&1==s?t.filter(function(t){return("owns"==t.role.value||"owns2"==t.role.value)&&e.value==t.zone.value}):"owns"==o&&0==s?t.filter(function(t){return"owns"==t.role.value&&e.value==t.zone.value}):"occupies"==o&&1==s?t.filter(function(t){return("occupies"==t.role.value||"occupies2"==t.role.value)&&e.value==t.zone.value}):"occupies"==o&&0==s?t.filter(function(t){return"occupies"==t.role.value&&e.value==t.zone.value}):"both"==o&&1==s?t.filter(function(t){return e.value==t.zone.value}):"both"==o&&0==s?t.filter(function(t){return"occupies2"!=t.role.value&&"owns2"!=t.role.value&&e.value==t.zone.value}):t).map(function(e){a.find(function(t){return t==Object(r.g)(e.mobile)})||a.push(Object(r.g)(e.mobile))})}),n.contactNumbers=a,this.setState({tenantAlertObj:n}),this.props.handleTenantAlerts(n)},t.prototype.render=function(){var e=this,t=(this.props,this.state),n=t.tenantAlertObj,s=t.tenantDropDownList,r=t.zonesDropDownList;return a.createElement("div",{className:"content"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"zones"},"Select Affected Zones:"))),a.createElement("div",{className:"col-md-8"},a.createElement("div",{className:"form-group"},a.createElement(o.a,{closeMenuOnSelect:!1,isMulti:!0,value:n.zones,onChange:this.handleMultiZoneChange,placeholder:"Select Affected Zones",options:r}))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"spaces"},"Select Additional Contacts:"))),a.createElement("div",{className:"col-md-8"},a.createElement("div",{className:"form-group"},a.createElement(o.a,{closeMenuOnSelect:!1,isMulti:!0,value:n.additionalContacts,onChange:this.handleMultiTenantChange,placeholder:"Select Additional Contacts",options:s}))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:""},"Contact Role:"))),a.createElement("div",{className:"col-md-8"},a.createElement("div",{className:"form-group"},a.createElement("label",{className:"radio-inline"}," ",a.createElement("input",{type:"radio",name:"rdOwner",value:"owns",checked:"owns"==n.role,onChange:function(t){e.onRadioRoleChange(t.target.value)}}),"Owners"),a.createElement("label",{className:"radio-inline"}," ",a.createElement("input",{type:"radio",name:"rdOccupant",value:"occupies",checked:"occupies"==n.role,onChange:function(t){e.onRadioRoleChange(t.target.value)}}),"Occupants"),a.createElement("label",{className:"radio-inline"}," ",a.createElement("input",{type:"radio",name:"rdBoth",value:"both",checked:"both"==n.role,onChange:function(t){e.onRadioRoleChange(t.target.value)}}),"Both"))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"include"},"Include secondary contacts:"))),a.createElement("div",{className:"col-md-1"},a.createElement("div",{className:"form-group"},a.createElement("input",{id:"include",type:"checkbox",className:"form-control",checked:n.includeSecondaryContacts,onChange:function(t){return e.handleIncludeSecondaryContactChange(t.target.checked)}}))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"col-md-4"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"message"},"Message:"))),a.createElement("div",{className:"col-md-8"},a.createElement("div",{className:"form-group"},a.createElement("textarea",{className:"form-control",id:"message",value:n.message,rows:5,onChange:function(t){e.onMessageChange(t.target.value)}}))))))},t}(a.Component);t.a=u}});