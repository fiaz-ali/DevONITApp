webpackJsonp([65],{961:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,l=n(1),r=(n.n(l),n(26)),i=n(25),s=n(5),o=n(8),c=n(103),u=n(14),m=n(21),d=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var l in t=arguments[n])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},p=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(l,r){function i(e){try{o(a.next(e))}catch(e){r(e)}}function s(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){e.done?l(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(i,s)}o((a=a.apply(e,t||[])).next())})},y=this&&this.__generator||function(e,t){var n,a,l,r,i={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(l=2&r[0]?a.return:r[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,r[1])).done)return l;switch(a=0,l&&(r=[2&r[0],l.value]),r[0]){case 0:case 1:l=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,a=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(l=(l=i.trys).length>0&&l[l.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!l||r[1]>l[0]&&r[1]<l[3])){i.label=r[1];break}if(6===r[0]&&i.label<l[1]){i.label=l[1],l=r;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(r);break}l[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e],a=0}finally{n=l=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},b=0,f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={CeilingSensorBoardInfo:Object(),Old_RelayBoardInfo:Object(),RelayBoardInfo:Object(),I1RelayBoardInfo:Object(),modelChanged:!1,Moncon:{monitoringControl:"",monitoringControlDeviceType:"",deviceName:"",floor:"",rdfsLabel:"",manufacturer:"",model:"",location:"",computingDevice:"",networkDevice:"",computerControllerIPAddress:"",connectionType:"",notes:"",wirelessConfig:{ipAddress:"",controllerIPAddress:"",thermostatMacAddress:"",ssid:"",password:""},isSchedule:!1,relatedEquipment:[],deviceNumber:"",enclosure:""},EquipmentList:[],currentChange:"",detailsExpanded:!1,spaces:[],relayControlStatusDesc:"",scheduleSelected:!1,relayisOn:!1,relayisOnNo:0,relayCensorStatus:Object(),relay1Status:!1,relay2Status:!1,relay3Status:!1,relay4Status:!1,I1RelayStatus:!1,relayControlStatus:"Manual",relayControlType:"",isOptimizeControl:!1,isOptimizeControlStatus:"",RelayBoardControl:Object(),relayOptimizeSettings:"",I4RelayBoardInfo:Object(),relayNoOptimize:0,devices:[],callInterval:!0},n,n.fetchDevices=n.fetchDevices.bind(n),n._fetchData=n._fetchData.bind(n),n._fetchCeilingSensorBoardInfo=n._fetchCeilingSensorBoardInfo.bind(n),n._fetchRelayCensorStatus=n._fetchRelayCensorStatus.bind(n),n._fetchV4RelayBoardInfo=n._fetchV4RelayBoardInfo.bind(n),n._fetchI1RelayBoardInfo=n._fetchI1RelayBoardInfo.bind(n),n._fetchI4RelayBoardInfo=n._fetchI4RelayBoardInfo.bind(n),n.fetchRelayControlSettings=n.fetchRelayControlSettings.bind(n),n.saveRelayStatusChanges=n.saveRelayStatusChanges.bind(n),n.setOptimizeSettings=n.setOptimizeSettings.bind(n),n.cancelSend=n.cancelSend.bind(n),n.resetChanges=n.resetChanges.bind(n),n.applyChanges=n.applyChanges.bind(n),n.handleChange=n.handleChange.bind(n),n.handleRelayOnOff=n.handleRelayOnOff.bind(n),n.handleRelayControlStatus=n.handleRelayControlStatus.bind(n),n.handleScheduleSelection=n.handleScheduleSelection.bind(n),n.setIntervalStart=n.setIntervalStart.bind(n),n}return d(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this._fetchData()]:[3,4];case 1:return e.sent(),[4,this.fetchDevices()];case 2:return e.sent(),[4,this.resetChanges(!0)];case 3:e.sent(),e.label=4;case 4:return this.setIntervalStart(),[2]}})})},t.prototype.setIntervalStart=function(){var e=this;a&&clearInterval(a),setInterval(function(){b++},1e3),a=setInterval(function(){var t=e.state,n=t.callInterval;!t.modelChanged&&n&&b>=15&&(e.resetChanges(!1),Object(u.a)(!1))},5e3)},t.prototype.componentWillUnmount=function(){return p(this,void 0,void 0,function(){return y(this,function(e){return clearInterval(a),[2]})})},t.prototype.fetchDevices=function(){return p(this,void 0,void 0,function(){var e,t;return y(this,function(n){switch(n.label){case 0:return(e=this.props.buildingName)?[4,Object(r.r)(e)]:[3,2];case 1:t=n.sent(),this.setState({devices:t}),n.label=2;case 2:return[2]}})})},t.prototype._fetchData=function(){return p(this,void 0,void 0,function(){var e,t,n,a,l,r,o,c,d,h,b,f,g=this;return y(this,function(v){switch(v.label){case 0:return e=this.state,t=e.scheduleSelected,n=e.relayControlType,a=this.props,l=a.RelayDeviceName,r=a.buildingName,l?(Object(u.a)(!0),[4,Object(m.g)(this.props.buildingName)]):[3,3];case 1:return o=v.sent(),c=o&&o.length>0&&o.map(function(e){return{value:Object(s.g)(e.ontology),label:Object(s.g)(e.rdfsLabel)}}),d=Object(),[4,Object(i.f)(l,r)];case 2:d=v.sent(),t=d.isSchedule,n=d.monitoringControlDeviceType,localStorage.getItem(d.deviceID)&&localStorage.getItem(d.deviceID).length>0&&(h=localStorage.getItem(d.deviceID))&&"undefined"!=h&&(-1!=n.indexOf("OneRelay")?(b=JSON.parse(localStorage.getItem(d.deviceID)),this.setState({I1RelayBoardInfo:b,modelChanged:!1,currentChange:""})):(f=JSON.parse(localStorage.getItem(d.deviceID)),this.setState({RelayBoardInfo:f,modelChanged:!1,currentChange:""}))),this.setState({Moncon:d,EquipmentList:c,scheduleSelected:t,relayControlType:n},function(){return p(g,void 0,void 0,function(){return y(this,function(e){return this._fetchRelayCensorStatus(!0),-1!=n.toLowerCase().indexOf("i1")?this._fetchI1RelayBoardInfo(!0):this._fetchV4RelayBoardInfo(!0),this._fetchCeilingSensorBoardInfo(!0),this.fetchRelayControlSettings(),[2]})})}),Object(u.a)(!1),v.label=3;case 3:return[2]}})})},t.prototype._fetchCeilingSensorBoardInfo=function(e){return p(this,void 0,void 0,function(){var t,n,a,l=this;return y(this,function(s){return e&&Object(u.a)(!0),t=this.state.Moncon,n=this.props.buildingName,a="",t.sensors&&t.sensors.map(function(e){return p(l,void 0,void 0,function(){var t,l;return y(this,function(s){switch(s.label){case 0:return a=e.value,t=Object(),[4,Object(i.f)(a,n)];case 1:return"CeilingSensor"!=(t=s.sent()).monitoringControlDeviceType?[3,3]:[4,Object(r.l)(t).then(function(e){return!e||e&&e.error?(Object(o.a)("Error occurred while fetching ceiling sensor board info."),Object()):e}).catch(function(e){return Object()})];case 2:return l=s.sent(),this.setState({CeilingSensorBoardInfo:l,modelChanged:!1,currentChange:""}),[2];case 3:return[2]}})})}),e&&Object(u.a)(!1),[2]})})},t.prototype._fetchI1RelayBoardInfo=function(e){return p(this,void 0,void 0,function(){var t,n,a;return y(this,function(l){switch(l.label){case 0:return e&&Object(u.a)(!0),t=this.state.Moncon,n=this.state.I1RelayStatus,[4,Object(r.e)(t.deviceName,new Date,new Date,!0).then(function(e){return!e||e&&e.error?(Object(o.a)("Error occurred while fetching relay board info."),Object()):(e[e.length-1]&&localStorage.setItem(t.deviceID,JSON.stringify(e[e.length-1])),e[e.length-1])}).catch(function(e){return Object()})];case 1:return(a=l.sent())&&a.i1relay_state&&a.i1relay_state[0]&&(n="1"==a.i1relay_state[0]),a&&a.i1relay_state&&0==a.i1relay_state[0]&&(n=!1),this.setState({I1RelayBoardInfo:a,modelChanged:!1,currentChange:"",I1RelayStatus:n}),e&&Object(u.a)(!1),[2]}})})},t.prototype._fetchV4RelayBoardInfo=function(e){return p(this,void 0,void 0,function(){var t,n,a,l,i,s,c,m,d;return y(this,function(p){switch(p.label){case 0:return e&&Object(u.a)(!0),t=this.state.Moncon,n=this.state,a=n.relay1Status,l=n.relay2Status,i=n.relay3Status,s=n.relay4Status,c=Object(),[4,Object(r.f)(t.deviceName,new Date,new Date,!0).then(function(e){return!e||e&&e.error?(Object(o.a)("Error occurred while fetching relay board info."),Object()):(e[e.length-1]&&localStorage.setItem(t.deviceID,JSON.stringify(e[e.length-1])),e[e.length-1])}).catch(function(e){return Object()})];case 1:return(c=p.sent())&&c.v4relay_state&&(m=this.ConvertDecimalToBinary(parseInt(c.v4relay_state)),d=m.split(","),a="1"==d[0],l="1"==d[1],i="1"==d[2],s="1"==d[3]),this.setState({RelayBoardInfo:c,Old_RelayBoardInfo:h({},c),modelChanged:!1,currentChange:"",relay1Status:a,relay2Status:l,relay3Status:i,relay4Status:s}),e&&Object(u.a)(!1),[2]}})})},t.prototype._fetchI4RelayBoardInfo=function(e){return p(this,void 0,void 0,function(){var t,n,a,l,i,s,c;return y(this,function(m){switch(m.label){case 0:return e&&Object(u.a)(!0),t=this.state.Moncon,n=this.state,a=n.relay1Status,l=n.relay2Status,i=n.relay3Status,s=n.relay4Status,c=Object(),[4,Object(r.n)(t).then(function(e){return!e||e&&e.error?(Object(o.a)("Error occurred while fetching relay board info."),Object()):(e&&localStorage.setItem(t.deviceID,JSON.stringify(e)),e)}).catch(function(e){return Object()})];case 1:return c=m.sent(),a=120==c.voltage_volts_Ch1,l=120==c.voltage_volts_Ch2,i=120==c.voltage_volts_Ch3,s=120==c.voltage_volts_Ch4,this.setState({modelChanged:!1,currentChange:"",relay1Status:a,relay2Status:l,relay3Status:i,relay4Status:s,I4RelayBoardInfo:c}),e&&Object(u.a)(!1),[2]}})})},t.prototype._fetchRelayCensorStatus=function(e){return p(this,void 0,void 0,function(){var t,n,a,l=this;return y(this,function(i){switch(i.label){case 0:return e&&Object(u.a)(!0),t=this.props,n=t.buildingName,a=t.RelayDeviceName,[4,Object(r.u)(n,a).then(function(e){var t=e[0];if(!t)return l.setState({relay1Status:!1,relay2Status:!1,relay3Status:!1,relay4Status:!1,relayOptimizeSettings:"Normal,Normal,Normal,Normal,"}),Object();var n=Object();n.relayStatus=[],n.controlStatus=Object(s.g)(t.controlStatus),n.deviceType=Object(s.g)(t.deviceType);var a=l.state,r=a.relay1Status,i=a.relay2Status,o=a.relay3Status,c=a.relay4Status,u=a.relayControlStatus,m=a.I1RelayStatus,d=a.relayOptimizeSettings,h=Object(s.g)(t.relayStatus).split(",");-1!=n.deviceType.indexOf("OneRelay")?(h&&(n.relayStatus=h),u=Object(s.g)(t.controlStatus),l.setState({I1RelayStatus:m,relayControlStatus:u})):(h&&(n.relayStatus=h),u=Object(s.g)(t.controlStatus),l.setState({relay1Status:r,relay2Status:i,relay3Status:o,relay4Status:c,relayControlStatus:u}));var p="Optimize"==n.controlStatus||"Normal"==n.controlStatus;(d=Object(s.g)(t.relayOptimizeSettings))&&",,,,"!=d&&""!=d||(d=-1==n.deviceType.indexOf("OneRelay")?"Normal,Normal,Normal,Normal,":"Normal"),l.setState({isOptimizeControl:p,isOptimizeControlStatus:p?n.controlStatus:"",relayOptimizeSettings:d})}).catch(function(e){return Object()})];case 1:return i.sent(),e&&Object(u.a)(!1),[2]}})})},t.prototype.fetchRelayControlSettings=function(){return p(this,void 0,void 0,function(){var e,t,n,a,l,i;return y(this,function(o){switch(o.label){case 0:return e=this.props.RelayDeviceName,t=this.state,n=t.relayControlType,a=t.RelayBoardControl,[4,Object(r.v)(e)];case 1:return(l=o.sent())[0]?(i=l[0],n&&-1==n.indexOf("OneRelay")?a.relays="1,2,3,4":a.relays="OneRelay",a.controlChoice=Object(s.g)(i.controlChoice),a.relayNames=Object(s.g)(i.relayNames),a.lightingTypes=Object(s.g)(i.lightingTypes),a.sensors=Object(s.g)(i.sensors),a.activeRelayStatus=Object(s.g)(i.activeRelayStatus)):n&&-1==n.indexOf("OneRelay")?(a.relays="1,2,3,4",a.controlChoice="0,0,0,0",a.relayNames="Relay 1,Relay 2,Relay 3,Relay 4",a.lightingTypes="0,0,0,0",a.sensors="0,0,0,0",a.activeRelayStatus="active,active,active,active"):(a.relays="OneRelay",a.controlChoice="0",a.relayNames="Relay",a.sensors="0",a.lightingTypes="0",a.activeRelayStatus="active"),this.setState({RelayBoardControl:a}),[2]}})})},t.prototype.ConvertDecimalToBinary=function(e){for(var t=[],n=e;n>0;)n%2==0?t.push("0"):t.push("1"),n=Math.floor(n/2);if(-1==this.state.relayControlType.indexOf("OneRelay"))for(var a=4-t.length,l=0;l<a;l++)t.push("0");return t.join(",")},t.prototype.handleRelayOnOff=function(e,t){var n=this.state,a=n.relay1Status,l=n.relay2Status,r=n.relay3Status,i=n.relay4Status;1==t&&(a=e),2==t&&(l=e),3==t&&(r=e),4==t&&(i=e),this.setState({modelChanged:!0,relayisOnNo:t,relayisOn:e,relay1Status:a,relay2Status:l,relay3Status:r,relay4Status:i})},t.prototype.handleI1RelayOnOff=function(e){this.setState({I1RelayStatus:e,modelChanged:!0})},t.prototype.handleChange=function(e,t){var n=this.state.RelayBoardInfo;n[e]=t,this.setState({RelayBoardInfo:n,modelChanged:!0,currentChange:e})},t.prototype.handleRelayOptimizeSettings=function(e,t,n){return void 0===n&&(n=!0),p(this,void 0,void 0,function(){var a,l,r,i,s,o;return y(this,function(c){return a=this.state,l=a.relayOptimizeSettings,r=a.isOptimizeControl,i=a.modelChanged,s=a.relayNoOptimize,(o=l.split(","))[t]=e,r=!0,i=n,l=o.join(","),s=t+1,this.setState({isOptimizeControlStatus:e,relayOptimizeSettings:l,isOptimizeControl:r,modelChanged:i,relayNoOptimize:s}),[2]})})},t.prototype.handleRelayControlStatus=function(e){return p(this,void 0,void 0,function(){var t=this;return y(this,function(n){switch(n.label){case 0:return[4,this.saveRelayStatusChanges(e).then(function(){return p(t,void 0,void 0,function(){var t,n,a;return y(this,function(l){return this.setState({relayControlStatus:e,isOptimizeControl:!1}),"Schedule"!=e&&"Manual"!=e||(t=this.state,n=t.isOptimizeControl,a=t.modelChanged,n=!0,a=!0,this.setState({isOptimizeControlStatus:e,isOptimizeControl:n,modelChanged:a})),[2]})})})];case 1:return n.sent(),[2]}})})},t.prototype.cancelSend=function(){var e=this.state,t=e.relay1Status,n=e.relay2Status,a=e.relay3Status,l=e.relay4Status,r=e.I1RelayStatus,i=e.relayCensorStatus,s=e.relayControlType,o=e.relayOptimizeSettings,c=e.isOptimizeControl,u=e.relayNoOptimize;if(-1!=s.indexOf("OneRelay"))r=!r,this.setState({I1RelayStatus:r,modelChanged:!1,isOptimizeControl:!1});else{if(i&&i.relayStatus&&i.relayStatus.length>0&&(t="1"==i.relayStatus[0],n="1"==i.relayStatus[1],a="1"==i.relayStatus[2],l="1"==i.relayStatus[3],this.setState({relay1Status:t,relay2Status:n,relay3Status:a,relay4Status:l})),c){var m=o.split(",");m[u]="Normal"==m[u]?"Optimize":"Normal",o=m.join(",")}this.setState({modelChanged:!1,isOptimizeControl:!1,currentChange:"",relayOptimizeSettings:o,relayNoOptimize:0})}},t.prototype.setOptimizeSettings=function(){return p(this,void 0,void 0,function(){var e,t,n,a=this;return y(this,function(l){switch(l.label){case 0:return e=this.props,t=e.buildingName,n=e.RelayDeviceName,[4,Object(r.b)(t,n).then(function(e){return p(a,void 0,void 0,function(){var t,a,l,i,c,u,m,d,h,b,f,g,v,O,C,S,E,_=this;return y(this,function(N){switch(N.label){case 0:return t=Object(),e[0]?(t.device=Object(s.g)(e[0].device),t.A1=Object(s.g)(e[0].A1),t.A2=Object(s.g)(e[0].A2),t.B1=Object(s.g)(e[0].B1),t.B2=Object(s.g)(e[0].B2),t.C1=Object(s.g)(e[0].C1),t.C2=Object(s.g)(e[0].C2),t.D1=Object(s.g)(e[0].D1),t.D2=Object(s.g)(e[0].D2),t.E1=Object(s.g)(e[0].E1),t.E2=Object(s.g)(e[0].E2),t.F1=Object(s.g)(e[0].F1),t.F2=Object(s.g)(e[0].F2),t.G1=Object(s.g)(e[0].G1),t.G2=Object(s.g)(e[0].G2)):(t.device=n,t.A1="0",t.A2="0",t.B1="0",t.B2="0",t.C1="0",t.C2="0",t.D1="0",t.D2="0",t.E1="0",t.E2="0",t.F1="0",t.F2="0",t.G1="0",t.G2="0"),a=Object(),l=Object(),i=this.state,c=i.Moncon,u=i.relayNoOptimize,m=i.relayControlType,d=i.relayOptimizeSettings,h=i.RelayBoardControl,b=i.devices,f=i.relayControlStatus,g=d.split(","),a.isOptimize="Optimize"==g[u-1],a.isOptimize?(a.varA=parseInt(t.A2),a.varB=parseInt(t.B2),a.varC=parseInt(t.C2),a.varD=parseInt(t.D2),a.varE=parseInt(t.E2),a.varF=parseInt(t.F2),a.varG=parseInt(t.G2)):(a.varA=parseInt(t.A1),a.varB=parseInt(t.B1),a.varC=parseInt(t.C1),a.varD=parseInt(t.D1),a.varE=parseInt(t.E1),a.varF=parseInt(t.F1),a.varG=parseInt(t.G1)),a.deviceID=c.deviceName,a.relaynum=""+u,a.rlb_add=c.boardAddress,c.wirelessConfig.ipAddress&&(a.controllerPI=c.wirelessConfig.ipAddress,l.controllerPI=c.wirelessConfig.ipAddress),c.wirelessConfig.controllerIPAddress&&(a.controllerPI=c.wirelessConfig.controllerIPAddress,l.controllerPI=c.wirelessConfig.controllerIPAddress),-1!=m.toLowerCase().indexOf("v1")?a.rlb_ver="v1":-1!=m.toLowerCase().indexOf("v4")?a.rlb_ver="v4":-1!=m.toLowerCase().indexOf("i1")?a.rlb_ver="i1":-1!=m.toLowerCase().indexOf("i4")&&(a.rlb_ver="i4"),v=[],O=[],C=[],S=[],v=h.controlChoice&&h.controlChoice.split(","),O=h.lightingTypes&&h.lightingTypes.split(","),C=h.sensors&&h.sensors.split(","),S=h.relayNames&&h.relayNames.split(","),l.sched="Schedule"==f,l.controltype=l.sched?v[u-1]:"10",l.lighting_type=O[u-1],l.relaynum=""+u,l.rlb_ver=a.rlb_ver,l.rlb_add=c.boardAddress,l.deviceID=c.deviceName,C&&C[u-1]?(E=b.find(function(e){return Object(s.g)(e.moncondevice)==C[u-1]}),l.csb_add=E?Object(s.g)(E.boardAddress):"9999"):l.csb_add="9999",l.lighting_type&&"0"!=l.lighting_type&&l.controltype&&"0"!=l.controltype?(Object(r.G)(l,a).then(function(e){return p(_,void 0,void 0,function(){return y(this,function(t){return e?Object(o.b)("Settings posted successfully. "):e.error&&Object(o.a)(e.reason),[2]})})}).catch(function(e){Object(o.a)("Some error orccured. ")}),"A"!=O[u-1]?[3,3]:"0"!=C[u-1]?[3,3]:a.isOptimize?[4,this.handleRelayOnOff(!1,u)]:[3,3]):(Object(o.a)("Save the control settings for "+S[u-1]+" before posting settings"),[2]);case 1:return N.sent(),[4,this.applyChanges()];case 2:N.sent(),N.label=3;case 3:return[2]}})})})];case 1:return l.sent(),[2]}})})},t.prototype.resetChanges=function(e){return p(this,void 0,void 0,function(){var t=this;return y(this,function(n){return this.setState({modelChanged:!1,isOptimizeControl:!1,currentChange:"",callInterval:!1},function(){return p(t,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return t=this.state.relayControlType,[4,this._fetchRelayCensorStatus(e)];case 1:return n.sent(),-1!=t.toLowerCase().indexOf("i1")?this._fetchI1RelayBoardInfo(e):this._fetchV4RelayBoardInfo(e),[4,this._fetchCeilingSensorBoardInfo(e)];case 2:return n.sent(),this.setState({callInterval:!0}),[2]}})})}),[2]})})},t.prototype.handleScheduleSelection=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,Object(r.N)(this.props.RelayDeviceName,e)];case 1:return t.sent(),e?Object(o.b)("Successfully Selected Schedule"):Object(o.b)("Successfully unSelected Schedule"),[2]}})})},t.prototype.saveRelayStatusChanges=function(e){return p(this,void 0,void 0,function(){var t,n,a,l,i,s,c,m,d,h,p,b,f;return y(this,function(y){return Object(u.a)(!0),t=this.props,n=t.buildingName,a=t.RelayDeviceName,l=this.state,i=l.relay1Status,s=l.relay2Status,c=l.relay3Status,m=l.relay4Status,d=l.relayCensorStatus,h=l.relayControlType,p=l.I1RelayStatus,b=l.relayOptimizeSettings,f=[],-1!=h.indexOf("OneRelay")?f.push(p?"1":"0"):(f.push(i?"1":"0"),f.push(s?"1":"0"),f.push(c?"1":"0"),f.push(m?"1":"0")),d.relayStatus=f,d.controlStatus=e,d.deviceType=h,d.device=a,d.relayOptimizeSettings=b.split(","),Object(r.L)(n,d).then(function(e){}).catch(function(e){Object(o.a)("Some error orccured. ")}),Object(u.a)(!1),[2]})})},t.prototype.applyChanges=function(){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){return Object(u.a)(!0),this.setState({modelChanged:!1,currentChange:""},function(){return p(e,void 0,void 0,function(){var e,t,n,l,i,s,c,m,d,h,f,g,v,O,C,S,E=this;return y(this,function(_){switch(_.label){case 0:if(b=0,a&&clearInterval(a),Object(u.a)(!0),e=this.state,t=e.Moncon,n=e.relayisOnNo,l=e.relayisOn,i=e.relayControlStatus,s=e.I1RelayStatus,c=e.relayControlType,m=e.isOptimizeControl,d=e.isOptimizeControlStatus,h=e.relayOptimizeSettings,f=e.RelayBoardControl,"Schedule"!=d&&"Manual"!=d)return[3,6];"Schedule"==d&&this.handleScheduleSelection(!0),g=-1==c.indexOf("OneRelay")?4:1,v=h.split(","),O=f.activeRelayStatus&&f.activeRelayStatus.split(","),C=0,_.label=1;case 1:return C<g?"active"!=O[C]?[3,4]:[4,this.handleRelayOptimizeSettings(v[C],C,!1)]:[3,5];case 2:return _.sent(),v[C]=d,h=v.join(","),S=C+1,[4,this.setState({isOptimizeControlStatus:d,relayOptimizeSettings:h,relayNoOptimize:S},function(){return p(E,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return[4,this.setOptimizeSettings()];case 1:return e.sent(),[2]}})})})];case 3:_.sent(),_.label=4;case 4:return C++,[3,1];case 5:return[3,8];case 6:return this.state.scheduleSelected&&this.handleScheduleSelection(!1),[4,this.saveRelayStatusChanges(i)];case 7:_.sent(),m?this.setOptimizeSettings():-1!=c.indexOf("OneRelay")?-1!=c.indexOf("V1")||Object(r.C)(t,s).then(function(e){return p(E,void 0,void 0,function(){return y(this,function(t){return e?Object(o.b)("Changes applied successfully. "):e.error&&Object(o.a)(e.reason),[2]})})}).catch(function(e){Object(o.a)("Some error orccured. ")}):-1!=c.indexOf("V4")?Object(r.I)(t,!1,l,n).then(function(e){return p(E,void 0,void 0,function(){return y(this,function(t){return e?Object(o.b)("Changes applied successfully. "):e.error&&Object(o.a)(e.reason),[2]})})}).catch(function(e){Object(o.a)("Some error orccured. ")}):Object(r.D)(t,!1,l,n).then(function(e){return p(E,void 0,void 0,function(){return y(this,function(t){return e?Object(o.b)("Changes applied successfully. "):e.error&&Object(o.a)(e.reason),[2]})})}).catch(function(e){Object(o.a)("Some error orccured. ")}),_.label=8;case 8:return this.setState({isOptimizeControl:!1}),this.setIntervalStart(),Object(u.a)(!1),[2]}})})}),[2]})})},t.prototype.render=function(){var e,t,n,a,r=this,i=this.state,s=i.CeilingSensorBoardInfo,o=i.Moncon,u=i.modelChanged,m=i.currentChange,d=i.detailsExpanded,h=i.RelayBoardInfo,p=i.relayControlStatus,y=i.relayisOn,b=i.relayisOnNo,f=i.relay1Status,g=i.relay2Status,v=i.relay3Status,O=i.relay4Status,C=i.relayControlType,S=i.I1RelayBoardInfo,E=i.I1RelayStatus,_=i.isOptimizeControl,N=i.isOptimizeControlStatus,R=i.RelayBoardControl,I=i.relayOptimizeSettings,w=i.I4RelayBoardInfo,j=this.props,z=j.instance,x=j.buildingName,A=j.RelayDeviceName,B=j.type,D="Local"!=p;return e=R.relayNames&&R.relayNames.split(","),t=R.lightingTypes&&R.lightingTypes.split(","),n=I&&I.split(","),a=R.activeRelayStatus&&R.activeRelayStatus.split(","),l.createElement("div",{className:"content"},l.createElement("div",{className:"container-fluid"},l.createElement("div",{className:"row"},l.createElement("div",{className:"col-md-12"},l.createElement(c.a,{InsightName:A,ControlName:"RelayControl",buildingName:x,instance:z,type:B}),l.createElement("div",{className:"card",id:"InsightsList"},l.createElement("div",{className:"container-fluid"},l.createElement("div",{className:"header"},l.createElement("h3",{className:"title"},l.createElement("strong",null,o.rdfsLabel)," "),l.createElement("h4",{className:"title"},l.createElement("strong",null,this.props.type.toUpperCase(),":",o&&o.relatedEquipment.map(function(e,t){return l.createElement("span",{key:t},t+1==o.relatedEquipment.length?"":",")}))))),l.createElement("div",{className:"content"},l.createElement("div",{className:"row"},-1!=C.indexOf("OneRelay")&&l.createElement(l.Fragment,null,l.createElement("div",{className:"col-md-8 InsightRow"},l.createElement("div",{className:"row"},l.createElement("div",{className:"col-md-6 col-xs-12"},l.createElement("h4",{className:"padding-5 margin-5"},"Power Watts: ",l.createElement("b",null,S&&S.active_power_Watts?S.active_power_Watts:0," ")),l.createElement("h4",{className:"padding-5 margin-5"},"Amperes: ",l.createElement("b",null,S&&S.current_Amperes?S.current_Amperes:0)),l.createElement("h4",{className:"padding-5 margin-5"},"Frequency Hz: ",l.createElement("b",null,S&&S.frequency_Hz?S.frequency_Hz:0))),l.createElement("div",{className:"col-md-6 col-xs-12"},l.createElement("h4",{className:"padding-5 margin-5"},"Energy Watt/Hour: ",l.createElement("b",null,S&&S.import_active_energy_Wh?S.import_active_energy_Wh:0," ")),l.createElement("h4",{className:"padding-5 margin-5"},"Power Factor: ",l.createElement("b",null,S&&S.power_factor?S.power_factor:0)),l.createElement("h4",{className:"padding-5 margin-5"},"Voltage volts: ",l.createElement("b",null,S&&S.voltage_volts?S.voltage_volts:0))))),l.createElement("div",{className:"col-md-4 col-xs-12 InsightRow"},l.createElement("h4",{className:"padding-5 margin-5"},"Source Volts: ",l.createElement("b",null,h&&h.nominal_src_volts?h.nominal_src_volts:0," ")),l.createElement("h4",{className:"padding-5 margin-5"},"Illumiance: ",l.createElement("b",null,s&&s.illuminance_lux?s.illuminance_lux:0," Lumens")),l.createElement("h4",{className:"padding-5 margin-5"},"Motion Sensed: ",l.createElement("b",null,s&&s.illuminance_lux&&s.motion_sensed>0?"True":"False")))),-1==C.indexOf("OneRelay")&&l.createElement("div",{className:"col-md-12 InsightRow"},l.createElement("table",{className:"table table-striped"},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null),l.createElement("th",null,l.createElement("b",null,"Amperes")),l.createElement("th",null,l.createElement("b",null,"Power Watt")),-1!=C.toLowerCase().indexOf("i4")&&l.createElement(l.Fragment,null,l.createElement("th",null,l.createElement("b",null,"Frequency")),l.createElement("th",null,l.createElement("b",null,"Energy")),l.createElement("th",null,l.createElement("b",null,"Power Factor")),l.createElement("th",null,l.createElement("b",null,"Voltage"))),l.createElement("th",null,"Manual"==p?"Status":""),t&&t.length>0&&(1==t.length?"0"!=t[0]:"0"!=t[0]&&"0"!=t[1]&&"0"!=t[2]&&"0"!=t[3])&&l.createElement("th",null,"Optimize Settings"))),l.createElement("tbody",null,a&&"inactive"!=a[0]&&l.createElement("tr",null,l.createElement("td",null,l.createElement("b",null,e&&e[0])),-1!=C.toLowerCase().indexOf("v4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,h&&h.mAmps_relay1?h.mAmps_relay1:0," A")),l.createElement("td",null,l.createElement("b",null,h&&h.power_Wt_relay1?h.power_Wt_relay1:0," W"))),-1!=C.toLowerCase().indexOf("i4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,w&&w.current_Amperes_Ch1?w.current_Amperes_Ch1:0," A")),l.createElement("td",null,l.createElement("b",null,w&&w.active_power_Watts_Ch1?w.active_power_Watts_Ch1:0," W")),l.createElement("td",null,l.createElement("b",null,w&&w.frequency_Hz_Ch1?w.active_power_Watts_Ch1:0," Hz")),l.createElement("td",null,l.createElement("b",null,w&&w.import_active_energy_Wh_Ch1?w.active_power_Watts_Ch1:0," Wh")),l.createElement("td",null,l.createElement("b",null,w&&w.power_factor_Ch1?w.active_power_Watts_Ch1:0)),l.createElement("td",null,l.createElement("b",null,w&&w.voltage_volts_Ch1?w.active_power_Watts_Ch1:0," volts"))),l.createElement("td",null,"Manual"==p&&l.createElement(l.Fragment,null,l.createElement("button",{type:"button",className:f?"btn":"btn btn-fill",disabled:u,onClick:function(){r.handleRelayOnOff(!1,1)}},"Off"),l.createElement("button",{type:"button",className:f?"btn btn-fill":"btn",disabled:u,onClick:function(){r.handleRelayOnOff(!0,1)}},"On"))),l.createElement("td",null,t&&"0"!=t[0]&&"C"!=t[0]&&l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:n&&"Normal"==n[0]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Normal",0)}},"Normal"),l.createElement("button",{type:"button",className:n&&"Optimize"==n[0]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Optimize",0)}},"Optimize")))),a&&"inactive"!=a[1]&&l.createElement("tr",null,l.createElement("td",null,l.createElement("b",null,e&&e[1])),-1!=C.toLowerCase().indexOf("v4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,h&&h.mAmps_relay2?h.mAmps_relay2:0," A")),l.createElement("td",null,l.createElement("b",null,h&&h.power_Wt_relay2?h.power_Wt_relay2:0," W"))),-1!=C.toLowerCase().indexOf("i4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,w&&w.current_Amperes_Ch2?w.current_Amperes_Ch2:0," A")),l.createElement("td",null,l.createElement("b",null,w&&w.active_power_Watts_Ch2?w.active_power_Watts_Ch2:0," W")),l.createElement("td",null,l.createElement("b",null,w&&w.frequency_Hz_Ch2?w.active_power_Watts_Ch2:0," Hz")),l.createElement("td",null,l.createElement("b",null,w&&w.import_active_energy_Wh_Ch2?w.active_power_Watts_Ch2:0," Wh")),l.createElement("td",null,l.createElement("b",null,w&&w.power_factor_Ch2?w.active_power_Watts_Ch2:0)),l.createElement("td",null,l.createElement("b",null,w&&w.voltage_volts_Ch2?w.active_power_Watts_Ch2:0," volts"))),l.createElement("td",null,"Manual"==p&&l.createElement(l.Fragment,null,l.createElement("button",{type:"button",className:g?"btn":"btn btn-fill",disabled:u,onClick:function(){r.handleRelayOnOff(!1,2)}},"Off"),l.createElement("button",{type:"button",className:g?"btn btn-fill":"btn",disabled:u,onClick:function(){r.handleRelayOnOff(!0,2)}},"On"))),l.createElement("td",null,t&&"0"!=t[1]&&"C"!=t[1]&&l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:n&&"Normal"==n[1]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Normal",1)}},"Normal"),l.createElement("button",{type:"button",className:n&&"Optimize"==n[1]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Optimize",1)}},"Optimize")))),a&&"inactive"!=a[2]&&l.createElement("tr",null,l.createElement("td",null,l.createElement("b",null,e&&e[2])),-1!=C.toLowerCase().indexOf("v4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,h&&h.mAmps_relay3?h.mAmps_relay3:0," A")),l.createElement("td",null,l.createElement("b",null,h&&h.power_Wt_relay3?h.power_Wt_relay3:0," W"))),-1!=C.toLowerCase().indexOf("i4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,w&&w.current_Amperes_Ch3?w.current_Amperes_Ch3:0," A")),l.createElement("td",null,l.createElement("b",null,w&&w.active_power_Watts_Ch3?w.active_power_Watts_Ch3:0," W")),l.createElement("td",null,l.createElement("b",null,w&&w.frequency_Hz_Ch3?w.active_power_Watts_Ch3:0," Hz")),l.createElement("td",null,l.createElement("b",null,w&&w.import_active_energy_Wh_Ch3?w.active_power_Watts_Ch3:0," Wh")),l.createElement("td",null,l.createElement("b",null,w&&w.power_factor_Ch3?w.active_power_Watts_Ch3:0)),l.createElement("td",null,l.createElement("b",null,w&&w.voltage_volts_Ch3?w.active_power_Watts_Ch3:0," volts"))),l.createElement("td",null,"Manual"==p&&l.createElement(l.Fragment,null,l.createElement("button",{type:"button",className:v?"btn":"btn btn-fill",disabled:u,onClick:function(){r.handleRelayOnOff(!1,3)}},"Off"),l.createElement("button",{type:"button",className:v?"btn btn-fill":"btn",disabled:u,onClick:function(){r.handleRelayOnOff(!0,3)}},"On"))),l.createElement("td",null,t&&"0"!=t[2]&&"C"!=t[2]&&l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:n&&"Normal"==n[2]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Normal",2)}},"Normal"),l.createElement("button",{type:"button",className:n&&"Optimize"==n[2]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Optimize",2)}},"Optimize")))),a&&"inactive"!=a[3]&&l.createElement("tr",null,l.createElement("td",null,l.createElement("b",null,e&&e[3])),-1!=C.toLowerCase().indexOf("v4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,h&&h.mAmps_relay4?h.mAmps_relay4:0," A")),l.createElement("td",null,l.createElement("b",null,"-"))),-1!=C.toLowerCase().indexOf("i4")&&l.createElement(l.Fragment,null,l.createElement("td",null,l.createElement("b",null,w&&w.current_Amperes_Ch4?w.current_Amperes_Ch4:0," A")),l.createElement("td",null,l.createElement("b",null,w&&w.active_power_Watts_Ch4?w.active_power_Watts_Ch4:0," W")),l.createElement("td",null,l.createElement("b",null,w&&w.frequency_Hz_Ch4?w.active_power_Watts_Ch4:0," Hz")),l.createElement("td",null,l.createElement("b",null,w&&w.import_active_energy_Wh_Ch4?w.active_power_Watts_Ch4:0," Wh")),l.createElement("td",null,l.createElement("b",null,w&&w.power_factor_Ch4?w.active_power_Watts_Ch4:0)),l.createElement("td",null,l.createElement("b",null,w&&w.voltage_volts_Ch4?w.active_power_Watts_Ch4:0," volts"))),l.createElement("td",null,"Manual"==p&&l.createElement(l.Fragment,null,l.createElement("button",{type:"button",className:O?"btn":"btn btn-fill",disabled:u,onClick:function(){r.handleRelayOnOff(!1,4)}},"Off"),l.createElement("button",{type:"button",className:O?"btn btn-fill":"btn",disabled:u,onClick:function(){r.handleRelayOnOff(!0,4)}},"On"))),l.createElement("td",null,t&&"0"!=t[3]&&"C"!=t[3]&&l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:n&&"Normal"==n[3]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Normal",3)}},"Normal"),l.createElement("button",{type:"button",className:n&&"Optimize"==n[3]?"btn btn-fill":"btn",disabled:_,onClick:function(){r.handleRelayOptimizeSettings("Optimize",3)}},"Optimize"))))))),l.createElement("div",{className:"col-md-8 col-xs-12 InsightRow"},-1!=C.indexOf("OneRelay")&&l.createElement(l.Fragment,null,l.createElement("div",{className:"col-md-6"},"Manual"==p&&l.createElement(l.Fragment,null,l.createElement("div",{className:"RelayHeading"},"Relay Status"),l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:E?"btn":"btn btn-fill",disabled:u,onClick:function(){r.handleI1RelayOnOff(!1)}},"Off"),l.createElement("button",{type:"button",className:E?"btn btn-fill":"btn",disabled:u,onClick:function(){r.handleI1RelayOnOff(!0)}},"On")))),t&&"0"!=t[0]&&"C"!=t[0]&&l.createElement("div",{className:"col-md-6"},l.createElement("div",{className:"RelayHeading"},"Optimize Settings"),l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:n&&"Normal"==n[0]?"btn btn-fill":"btn",onClick:function(){r.handleRelayOptimizeSettings("Normal",0)}},"Normal"),l.createElement("button",{type:"button",className:n&&"Optimize"==n[0]?"btn btn-fill":"btn",onClick:function(){r.handleRelayOptimizeSettings("Optimize",0)}},"Optimize")))),-1==C.indexOf("OneRelay")&&l.createElement(l.Fragment,null,l.createElement("div",{className:"col-md-4"},l.createElement("h4",{className:"padding-5 margin-5"},"Source Volts: ",l.createElement("b",null,h&&h.nominal_src_volts?h.nominal_src_volts:0," "))),l.createElement("div",{className:"col-md-4"},l.createElement("h4",{className:"padding-5 margin-5"},"Illumiance: ",l.createElement("b",null,s&&s.illuminance_lux?s.illuminance_lux:0," Lumens"))),l.createElement("div",{className:"col-md-4"},l.createElement("h4",{className:"padding-5 margin-5"},"Motion Sensed: ",l.createElement("b",null,s&&s.illuminance_lux&&s.motion_sensed>0?"True":"False"))))),l.createElement("div",{className:"col-md-4 col-xs-12 InsightRow"},l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:"Local"==p?"btn btn-success btn-fill":"btn btn-success",disabled:""!=m&&"state"!=m,onClick:function(){r.handleRelayControlStatus("Local")}},"Local"),l.createElement("button",{type:"button",className:D?"btn btn-success btn-fill":"btn btn-success",disabled:""!=m&&"state"!=m,onClick:function(){r.handleRelayControlStatus("Manual")}},"Remote"),l.createElement("button",{type:"button",className:"Manual"==p?"btn btn-success btn-fill":"btn btn-success",disabled:!D,onClick:function(){r.handleRelayControlStatus("Manual")}},"Manual"),l.createElement("button",{type:"button",className:"Schedule"==p?"btn btn-success btn-fill":"btn btn-success",disabled:!D,onClick:function(){r.handleRelayControlStatus("Schedule")}},"Schedule")))),l.createElement("div",{className:"accordion row padding-10",id:"accordionExample",style:{paddingLeft:"30px",border:"1px solid #80808066",margin:"10px",borderRadius:"7px"}},l.createElement("div",{className:"",id:"headingOne"},l.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOne",style:{border:0,left:"-25px",position:"relative"},"aria-expanded":"true","aria-controls":"collapseOne",onClick:function(){r.setState({detailsExpanded:!d})}},l.createElement("i",{className:d?"fa fa-minus":"fa fa-plus","aria-hidden":"true"}))),l.createElement("div",{id:"collapseOne",className:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionExample"},l.createElement("div",{className:"col-md-6 col-xs-12 padding-10"},l.createElement("h5",{className:"title"},l.createElement("strong",null,"IP Address:")," ",o.wirelessConfig&&o.wirelessConfig.ipAddress),l.createElement("h5",{className:"title"},l.createElement("strong",null,"Controller IP Address:")," ",o.wirelessConfig&&o.wirelessConfig.controllerIPAddress),l.createElement("h5",{className:"title"},l.createElement("strong",null,"Manufacturer:")," ",o.manufacturer),l.createElement("h5",{className:"title"},l.createElement("strong",null,"Model:")," ",o.model),l.createElement("h5",{className:"title"},l.createElement("strong",null,"Board Address:")," ",o.boardAddress),l.createElement("h5",{className:"title"},l.createElement("strong",null,"Device ID:")," ",o.deviceID?o.deviceID:"")))),l.createElement("div",{className:u?"InsightApplyChanges":"hidden"},_?l.createElement("h4",null,"Do you want to apply these changes (Optimize Settings: ",N,") ?"):l.createElement("h4",null,"Do you want to apply these changes (Relay ",-1!=C.indexOf("OneRelay")?" : "+(E?"on":"off"):b+" : "+(y?"on":"off"),")?"),l.createElement("div",null,l.createElement("button",{type:"button",className:"btn btn-fill btn-secondary",onClick:function(){return r.cancelSend()}},"Cancel"),"\xa0",l.createElement("button",{type:"button",className:"btn btn-fill btn-danger",onClick:function(){return r.resetChanges(!0)}},"Reset"),"\xa0",l.createElement("button",{type:"button",className:"btn btn-fill btn-primary",onClick:function(){return r.applyChanges()}},"Apply Changes")))))))))},t}(l.Component);t.default=f}});