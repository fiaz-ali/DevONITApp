webpackJsonp([67],{2951:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s,i=a(2),c=(a.n(i),a(125)),o=a(57),r=a(20),l=a(58),d=a(126),u=a(11),h=a(8),m=a(60),p=a(698),g=a(743),f=a(13),b=a(21),v=a(737),y=a(943),O=a(1291),T=a(122),N=a(1653),E=a(130),x=a(971),j=a(1652),w=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),C=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,i){function c(e){try{r(n.next(e))}catch(e){i(e)}}function o(e){try{r(n.throw(e))}catch(e){i(e)}}function r(e){e.done?s(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(c,o)}r((n=n.apply(e,t||[])).next())})},S=this&&this.__generator||function(e,t){var a,n,s,i,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){c.label=i[1];break}if(6===i[0]&&c.label<s[1]){c.label=s[1],s=i;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(i);break}s[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],n=0}finally{a=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},I=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<a;t++)for(var i=arguments[t],c=0,o=i.length;c<o;c++,s++)n[s]=i[c];return n},M=y.a,_=function(e){function t(t){var a=e.call(this,t)||this;return a.state={chatMessages:[],chatText:"",participants:[],tag:"",issue:"",chat:Object(),chatPage:0,showUploader:!1,files:[],documentList:[],documentObj:{docOntology:"",entityOntology:a.props.entityTitle?[{label:a.props.entityTitle,value:a.props.entityTitle}]:[],entityType:"Chat",documentType:"Media",documentSubtype:"",rdfsLabel:"",s3FileName:"",entryTimeStamp:"",enteredBy:"",enteredByName:"",linkToDocument:"",building:a.props.buildingName,buildingName:""},isOpen:!1,documentName:"",showVideoChat:!1,showOutGoing:!1,showNotAvailable:!1,stream:void 0,incomingStream:void 0,showIncoming:!1,hideIncomingCall:!1,callAccepted:!1,allParticipants:[],isSubTask:!1,chatTitle:Object(r.y)(a.props.entityTitle),textFieldHeight:0,isFetching:!1,chat_id:"",last_index:0,ImageUrl:"",flag:!1},n=a,a.s3=new o.b,a.fetchContactInfo=a.fetchContactInfo.bind(a),a.handlefileAttached=a.handlefileAttached.bind(a),a.addNewMessage=a.addNewMessage.bind(a),a.handleScroll=a.handleScroll.bind(a),a}return w(t,e),t.prototype.componentDidMount=function(){return C(this,void 0,void 0,function(){var e,t,a,n,i,r,d,p,g,f,b,v,y,O,N,E,x,j,w,C,I,M,_,B,k,L,F,A,D,U,P,R,G,z,H,J=this;return S(this,function(S){switch(S.label){case 0:return s=!0,e=this.state,t=e.participants,a=e.chat,n=e.chatMessages,i=e.chatPage,r=e.allParticipants,s=!0,Object(T.a)(!0),[4,Object(l.z)()];case 1:return d=S.sent(),this.props.contact?(p=d.find(function(e){return Object(u.g)(e.contact)===J.props.contact}),g=p&&p.profileImage&&this.s3.GetSignedURL(o.a.DOCUMENT(),Object(u.g)(p.profileImage)),this.setState({ImageUrl:g,chatTitle:p.name.value,flag:!0}),(f=JSON.parse(h.a.getItem("user"))).contact?(b="",b=f.contact.localeCompare(Object(u.g)(this.props.contact))<0?Object(u.g)(this.props.contact)+f.contact:(f.contact.localeCompare(Object(u.g)(this.props.contact)),f.contact+Object(u.g)(this.props.contact)),[4,Object(c.v)(b)]):[3,6]):[3,6];case 2:return(v=S.sent())?[4,Object(m.h)(v.participants[0])]:[3,6];case 3:return y=S.sent(),t.push(y),[4,Object(m.h)(v.participants[1])];case 4:return O=S.sent(),t.push(O),a=v,[4,Object(c.y)(a._id,i)];case 5:G=(G=S.sent()).reverse(),n=G,S.label=6;case 6:return N=""!==this.props.assignedBy&&d.find(function(e){return Object(u.g)(e.contact)==J.props.assignedBy}),(E=[])[0]=Object(),N&&(E[0].assignedTo=N.contact,E[0].assignedToName=N.name),x=""===this.props.assignedBy,N?(w=E,[3,9]):[3,7];case 7:return[4,Object(c.x)(this.props.buildingName,this.props.parentTask)];case 8:w=S.sent(),S.label=9;case 9:return j=w,[4,Object(c.x)(this.props.buildingName,this.props.entityTitle)];case 10:for(C=S.sent(),M=0;M<j.length;M++)for(_=j[M],B=Object(u.g)(_.assignedToName),k=Object(u.g)(_.assignedTo),L=B.split(", "),F=k.split(", "),I=function(e){var t=L[e],a=F[e];r&&r.length>0&&r.find(function(e){return e.assignedTo==a})||r.push({assignedName:t,assignedTo:a})},D=0;D<L.length;D++)I(D);for(M=0;M<C.length;M++)for(_=C[M],B=Object(u.g)(_.assignedToName),k=Object(u.g)(_.assignedTo),L=B.split(", "),F=k.split(", "),A=function(e){var t=L[e],a=F[e];r&&r.length>0&&r.find(function(e){return e.assignedTo==a})||r.push({assignedName:t,assignedTo:a})},D=0;D<L.length;D++)A(D);return[4,Object(c.v)(this.props.entityTitle)];case 11:return U=S.sent(),P=Object(),R=Object(),U?(P.assignedTo=U.participants[0].assignedTo,P.assignedToName=U.participants[0].assignedToName,t.push(P),R.assignedTo=U.participants[1].assignedTo,R.assignedToName=U.participants[1].assignedToName,t.push(R),a=U,this.setState({chat_id:a._id}),[4,Object(c.y)(a._id,i)]):[3,13];case 12:return G=(G=S.sent()).reverse(),(z=(n=G)[n.length-1])&&(z.isRead||Object(c.c)(z.chatId).then(function(e){var t=document.getElementById("unReadMessage");if(t)var a=setInterval(function(){t.click(),clearInterval(a)},500)})),[3,14];case 13:P.assignedTo=Object(u.g)(j[0].assignedTo),P.assignedToName=Object(u.g)(j[0].assignedToName),t.push(P),R.assignedTo=Object(u.g)(C[0].assignedTo),R.assignedToName=Object(u.g)(C[0].assignedToName),t.push(R),S.label=14;case 14:return this.VideoChat(),this.setState({chat:a,chatMessages:n,participants:t,isSubTask:x,allParticipants:r}),(H=document.getElementById("messageBody"))&&(H.scrollTo({top:H.scrollTop+H.offsetHeight}),H.addEventListener("scroll",this.handleScroll)),this.scrollChat(),Object(T.a)(!1),[2]}})})},t.prototype.componentDidUpdate=function(){this.state.isFetching&&this.getMoreMessages()},t.prototype.handleScroll=function(){return C(this,void 0,void 0,function(){var e,t;return S(this,function(a){switch(a.label){case 0:return(e=document.getElementById("messageBody"))?0!==e.scrollTop?[3,2]:[4,Object(c.A)(this.state.chat_id)]:[3,3];case 1:return t=a.sent(),this.state.chatMessages.length===t?this.setState({isFetching:!1}):this.setState({isFetching:!0}),[3,3];case 2:this.setState({isFetching:!1}),a.label=3;case 3:return[2]}})})},t.prototype.fetchData=function(){return C(this,void 0,void 0,function(){var e,t,a,n,s;return S(this,function(i){switch(i.label){case 0:return e=this.state,t=e.chat,a=e.chatPage,[4,Object(c.y)(t._id,a)];case 1:return n=(n=i.sent()).reverse(),s=[],s=n,this.setState({chatMessages:s}),[2]}})})},t.prototype.VideoChat=function(e,t){return C(this,void 0,void 0,function(){var e,t,a,n,s=this;return S(this,function(i){return e=m.T,t=setInterval(function(){m.a&&(s.setState({showIncoming:!0}),clearInterval(t))},250),a=setInterval(function(){m._0&&(s.setState({hideIncomingCall:!0,callAccepted:!0,incomingStream:m._0}),clearInterval(a))},250),n=setInterval(function(){if(m.r){if(s.state.stream)s.state.stream.getTracks().forEach(function(e){e.stop()});s.setState({showOutGoing:!1,showIncoming:!1,hideIncomingCall:!1,stream:null}),Object(m.s)(),Object(m.X)(),window.location.reload(),clearInterval(n)}},250),this.setState({mySocketId:e}),[2]})})},t.prototype.initiatingCall=function(){return C(this,void 0,void 0,function(){var e,t;return S(this,function(a){return e=JSON.parse(h.a.getItem("user")),t=this.state.participants.find(function(t){return t.assignedTo!==e.contact}),this.props.setUserCalling(e.contact),this.props.setUserToCall(t.assignedTo),window.open("#"+this.props.instance+"/"+this.props.buildingName+"/VideoCallWindow/FullScreen/true/"+this.state.chat._id,"_blank","height="+screen.height+", width="+screen.width),localStorage.setItem("userToCallContact",t.assignedTo),localStorage.setItem("userToCall_Name",t.assignedToName),localStorage.setItem("userCallingContact",e.contact),[2]})})},t.prototype.getLatestMessages=function(e){return C(this,void 0,void 0,function(){var e,t,a;return S(this,function(n){return e=this.state.chatMessages,t=m.x,(a=I(e)).push(t),m.x.chatId==this.state.chat._id&&this.setState({chatMessages:a}),[2]})})},t.prototype.addNewMessage=function(){return C(this,void 0,void 0,function(){var e,t,a,n,s,i,o,r,l=this;return S(this,function(d){switch(d.label){case 0:return m.W!==this.props.entityTitle?(Object(m.Y)(),[2]):(e=this.state,t=e.chatMessages,a=e.participants,n=m.x,(s=I(t)).push(n),a=[],this.state.chat._id?[3,2]:[4,Object(c.a)(m.x.chatId)]);case 1:return i=d.sent(),o=Object(),r=Object(),o.assignedTo=i.participants[0].assignedTo,o.assignedToName=i.participants[0].assignedToName,a.push(o),r.assignedTo=i.participants[1].assignedTo,r.assignedToName=i.participants[1].assignedToName,a.push(r),this.setState({chatMessages:s,chat:i,participants:a},function(){Object(m.Y)(),l.scrollChat(),Object(c.c)(l.state.chatMessages[0].chatId)}),[3,3];case 2:this.setState({chatMessages:s},function(){Object(m.Y)(),l.scrollChat(),Object(c.c)(l.state.chatMessages[0].chatId)}),d.label=3;case 3:return[2]}})})},t.prototype.handleTitleChange=function(e){var t=this.state.documentObj;t.rdfsLabel=e,this.setState({documentObj:t},function(){t.rdfsLabel?document.getElementById("fileTitle").style.boxShadow="0px 0px 15px gainsboro":document.getElementById("fileTitle").style.boxShadow="0px 0px 15px red"})},t.prototype.saveDoc=function(){return C(this,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return[4,Object(v.f)(this.state.documentObj).then(function(){})];case 1:return e.sent(),[2]}})})},t.prototype._fetchDocs=function(){var e=this,t=this.props,a=t.buildingName,n=t.entityTitle;Object(v.d)(a,["Chat"],[n]).then(function(t){e.setState({documentList:t})})},t.prototype.handlefileAttached=function(e){var t=this,a=this.state.documentObj;if(e.length>0){var n=this.state.files,s=JSON.parse(h.a.getItem("user"));n||(n=[]);var i=e[0].name.split(".").pop(),c=(new Date).YYMMDDHHMMSS2()+"-"+a.rdfsLabel+"."+i.toLowerCase();c=c.replace(new RegExp(" ","g"),"-"),a.s3FileName=c,a.enteredBy=s.contact,Object(f.g)(e),this.setState({files:e,documentObj:a},function(){return C(t,void 0,void 0,function(){return S(this,function(e){return[2]})})})}},t.prototype.saveImage=function(){return C(this,void 0,void 0,function(){var e,t,a,n,s,i=this;return S(this,function(c){switch(c.label){case 0:return(e=this.state.documentObj).entityOntology&&e.entityOntology.length?(t=new o.b,(a=Object(f.d)())&&a.length?(n=a[0],s=n,[4,t.UploadFile(o.a.DOCUMENT(),e.s3FileName,s,function(t,a){t?Object(b.a)("Attachment failed to upload"):(i.sendMessage(e.s3FileName,e.rdfsLabel),i.saveDoc().then(function(){i._fetchDocs(),i.setState({files:[],documentObj:Object()},function(){return C(i,void 0,void 0,function(){return S(this,function(e){return[2]})})})}),Object(b.b)("Attachment Uploaded Successfully"))})]):[3,2]):[3,3];case 1:c.sent(),c.label=2;case 2:return[3,4];case 3:Object(b.a)("To Upload Attachments, You need to save Form first "),c.label=4;case 4:return[2]}})})},t.prototype.componentWillUnmount=function(){var e=document.getElementById("messageBody");e&&e.removeEventListener("scroll",this.handleScroll),clearInterval(void 0)},t.prototype.fetchContactInfo=function(){return C(this,void 0,void 0,function(){var e,t,a,n,s,i,o,r=this;return S(this,function(d){switch(d.label){case 0:return e=this.props,t=e.buildingName,a=e.contactIDs,n=e.entityTitle,t&&a?(s=[],i="",o="",n&&"Contact"!=n?[4,Object(c.p)("",n).then(function(e){if(e.length>0){var t=e[0];s=Object(u.g)(t.chatName).split("-_-"),o=Object(u.g)(t.description)}})]:[3,2]):[3,5];case 1:return d.sent(),[3,3];case 2:s=a,d.label=3;case 3:return s=I(s.sort(function(e,t){if(e&&t){var a=0;return e<t&&(a=-1),e>t&&(a=1),1*a}})),[4,Object(l.z)("",s).then(function(e){e.length>0&&(i+="Chat-_-",i+=e.map(function(e){return Object(u.g)(e.contact)}).join("-_-"),r.setState({tag:i,issue:o},function(){return C(r,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return[4,Object(c.O)(i)];case 1:return e.sent(),[2]}})})}))})];case 4:d.sent(),d.label=5;case 5:return[2]}})})},t.prototype.getAllMessages=function(){return C(this,void 0,void 0,function(){var e,t,a;return S(this,function(s){return e=this.state,t=e.participants,a=e.tag,t&&t.length&&this.s3.GetObject(o.a.CHAT(),a+".json",function(e,t){if(e)console.log("Get Object Error Returned",e);else{var a=Object(r.i)(t.Body);if(a){var s=JSON.parse(a);s.length>n.state.chatMessages.length&&n.setState({chatMessages:s}),this.scrollChat()}}}),[2]})})},t.prototype.saveAllMessages=function(){return C(this,void 0,void 0,function(){var e,t,a;return S(this,function(n){return e=this.state,t=e.participants,a=e.tag,t&&t.length&&this.s3.PutObject(o.a.CHAT(),a+".json",JSON.stringify(this.state.chatMessages)),[2]})})},t.prototype.handleChatInput=function(e){if(0==e.indexOf(" ")){var t=e.trim();this.setState({chatText:t})}else this.setState({chatText:e})},t.prototype.handleChatInputKeys=function(e){var t=e.which||e.keyCode;13===t&&e.shiftKey?$("#txt-area-more").css("height","42px !important"):13!==t&&"Enter"!==e.key||!e.target.value||""==e.target.value.trim()?13!==t&&"Enter"!==e.key||""!=e.target.value.trim()||e.preventDefault():(this.setState({chatText:e.target.value.trim()}),s&&this.sendMessage(),s=!1,setTimeout(function(){s=!0},500))},t.prototype.scrollChat=function(){var e=document.getElementById("messageBody");e&&(e.scrollTop=e.scrollHeight)},t.prototype.sendMessage=function(e,t){return C(this,void 0,void 0,function(){var a,n,s,i,o,r,l,d,p,g,f=this;return S(this,function(b){switch(b.label){case 0:return a=this.state,n=a.chatText,s=a.chat,i=a.chatMessages,o=a.participants,r=JSON.parse(h.a.getItem("user")),l=[],this.state.flag?(d="",d=r.contact.localeCompare(Object(u.g)(this.props.contact))<0?Object(u.g)(this.props.contact)+r.contact:(r.contact.localeCompare(Object(u.g)(this.props.contact)),r.contact+Object(u.g)(this.props.contact)),s._id?[3,4]:[4,Object(c.k)(o,d,d,"")]):[3,7];case 1:return(p=b.sent())._id?[4,Object(j.a)(r,n,d,o,p._id,!0,r.contact,t,e,!0)]:[3,3];case 2:b.sent(),this.setState({chatMessages:i,chatText:"",chat:p},function(){f.scrollChat()}),b.label=3;case 3:return[3,6];case 4:return[4,Object(j.a)(r,n,d,o,s._id,!0,r.contact,t,e,!0)];case 5:b.sent(),this.setState({chatMessages:i,chatText:""},function(){f.scrollChat()}),b.label=6;case 6:return[3,14];case 7:return s._id?[3,11]:[4,Object(c.k)(this.state.participants,this.props.entityTitle,this.props.entityTitle,this.props.parentTask).then(function(e){return e})];case 8:return(p=b.sent())._id?[4,Object(c.e)(p._id,r.contact,r.name,t||n,e||"")]:[3,10];case 9:(g=b.sent())._id&&(l=this.state.participants.filter(function(e){return e.assignedTo!==r.contact}).map(function(e){return e.assignedTo}),i.push(g),this.setState({chatText:"",chatMessages:i,chat:p})),Object(m.E)(g,l,this.props.entityTitle,!1,r.contact).then(function(e){var t=document.getElementById("unReadMessage");t&&t.click()}),b.label=10;case 10:return[3,13];case 11:return[4,Object(c.e)(s._id,r.contact,r.name,t||n,e||"")];case 12:(g=b.sent())._id&&(l=this.state.participants.filter(function(e){return e.assignedTo!==r.contact}).map(function(e){return e.assignedTo}),i.push(g),this.setState({chatText:"",chatMessages:i})),Object(m.E)(g,l,this.props.entityTitle,!1,r.contact).then(function(e){var t=document.getElementById("unReadMessage");t&&t.click()}),b.label=13;case 13:this.scrollChat(),b.label=14;case 14:return document.getElementById("newInputMessage")&&document.getElementById("newInputMessage").click(),[2]}})})},t.prototype.getMoreMessages=function(){return C(this,void 0,void 0,function(){var e,t,a,n,s,i,o,r=this;return S(this,function(l){switch(l.label){case 0:return e=this.state,t=e.chatPage,a=e.chat,n=e.chatMessages,t+=1,[4,Object(c.y)(a._id,t)];case 1:return(s=l.sent()).length>0&&(i=[],s&&s.reverse(),s.map(function(e){i.push(e)}),n.map(function(e){i.push(e)}),o=this.state.chatMessages[0]._id,setTimeout(function(){var e=document.getElementById("messageBody");e&&(e.scrollTo({top:200}),r.setState({chatPage:t,chatMessages:i,isFetching:!1},function(){document.getElementById("message_"+o)&&document.getElementById("message_"+o).scrollIntoView()}))},3e3)),[2]}})})},t.prototype.render=function(){var e,t=this,a=(this.props,this.state),n=a.chatMessages,c=a.chatText,r=a.documentObj,l=a.files,f=a.isOpen,b=a.showOutGoing,v=a.showNotAvailable,y=a.showIncoming,T=a.hideIncomingCall,E=a.allParticipants,x=a.chatTitle,j=a.ImageUrl,w=a.flag,I=JSON.parse(h.a.getItem("user")),_=new o.b,B=!1,k=this.state.participants.find(function(e){return e.assignedTo!==I.contact});return i.createElement(d.a.Consumer,null,function(a){return i.createElement("div",null,v&&i.createElement(O.a,{buildingName:t.props.buildingName,endButtonText:"Close",notAvailable:!0,caller:k,onEndCallFunctionality:function(){t.setState({showNotAvailable:!1})}}),b&&i.createElement(O.a,{buildingName:t.props.buildingName,hideIncomingCall:T,endButtonText:"End Call",caller:k,showOutgoing:!0,onAcceptingReceivingCall:function(){},onShareScreen:function(){navigator.mediaDevices.getDisplayMedia().then(function(e){document.querySelector("video").srcObject=e,Object(m.Q)(k.assignedTo,e,t.state.stream,!0)})},onEndCallFunctionality:function(){t.state.stream&&t.state.stream.getTracks().forEach(function(e){e.stop()});t.setState({showOutGoing:!1,hideIncomingCall:!1,stream:null}),Object(m.s)(),Object(m.X)(),Object(m.n)(I.contact,k.assignedTo),Object(m.q)(),window.location.reload()}},t.state.callAccepted&&i.createElement(N.a,{myVideo:t.state.stream,incomingStream:t.state.incomingStream})),i.createElement("div",{className:"container-fluid "},!v&&!y&&!b&&i.createElement("div",{className:"content"},i.createElement("div",{id:"chatMessagesContainer",className:"card padding-10 chatBody"},i.createElement("div",{className:"col-md-12"},i.createElement("div",{className:"chatHead"},i.createElement("div",{className:"row card"},i.createElement("div",{className:"col-md-10"},i.createElement("div",{style:{display:"flex",alignContent:"center"}},i.createElement("div",null,w&&j&&""!=j&&i.createElement("img",{className:"img-circle ",src:j,alt:"userProfile",style:{height:"45px",width:"45px",marginRight:"10px",marginTop:"10px"}}),w&&!j&&i.createElement("img",{className:"img-circle ",src:"assets/img/default-avatar.png",alt:"avatar",style:{height:"45px",width:"45px",marginRight:"10px",border:"1px solid silver",marginTop:"10px"}})),w&&i.createElement("div",{style:{marginTop:"23px"}},i.createElement("b",null,x," ")),!w&&i.createElement("div",{className:"mt-2"},i.createElement("b",null,x," "))),i.createElement("div",{className:"form-group"},i.createElement("h6",{className:"heading"},E&&E.length>0&&E.map(function(e){return e.assignedName}).join(", ")))),i.createElement("div",{className:"col-md-2 padding-10"},i.createElement("button",{title:"Video Call",type:"button",className:"pull-right btn-video-call-msg",onClick:function(){t.setState({},function(){return C(t,void 0,void 0,function(){return S(this,function(e){return this.initiatingCall(),[2]})})})}},i.createElement("i",{className:"fa fa-video-camera"}),"\xa0")))),i.createElement("div",{className:"padding-10 scroll",id:"messageBody",style:{height:"65vh",overflowX:"hidden",overflowY:"scroll",margin:"0px"}},i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-12 col-xs-12 padding-10",style:{margin:"0px"}},0==n.length&&i.createElement("div",null," No messages found in this conversation. "),t.state.isFetching?"Loading Messages ...":"",n&&n.map(function(a,n){var s="";if(a&&a.from){var c="";if(""!=a.attachmentImage){B=!1;var r=a.attachmentImage;e=Object(u.g)(a.attachmentImage).split(".").pop(),s=_.GetSignedURL(o.a.DOCUMENT(),r),r?r.toLowerCase().indexOf(".mp4")>0?(c="assets/img/video-icon.png",!0):r.toLowerCase().indexOf(".pdf")>0?(c="assets/img/pdf-file-icon.png",!0):r.toLowerCase().indexOf(".xls")>0||r.toLowerCase().indexOf(".csv")>0?(c="assets/img/file-icon.png",!0):r.toLowerCase().indexOf(".docx")>0||r.toLowerCase().indexOf(".txt")>0?(c="assets/img/doc-file-icon.png",!0):r.toLowerCase().indexOf(".png")>0||r.toLowerCase().indexOf(".jpeg")>0||r.toLowerCase().indexOf(".jpg")>0||r.toLowerCase().indexOf(".svg")>0||r.toLowerCase().indexOf(".tiff")>0?(c=s,B=!0):(c="assets/img/file-icon.png",!0,B=!1):c=s}return a.isVideoCall?i.createElement(i.Fragment,null,i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-4"}),i.createElement("div",{className:"col-md-4 mt-4 mb-4"},i.createElement("div",{className:"missed-call-notification"},i.createElement("i",{className:"fas fa-phone-slash",style:{color:"red",marginRight:"5px"}}),i.createElement("b",{style:{color:"rgb(54 54 54)",fontFamily:"Lato",fontSize:"12px"}},a.from==I.contact?"Call not answered":"Missed call"," at \xa0",new Date(a.createdAt).onitDateFormat(!0)))),i.createElement("div",{className:"col-md-4"}))):i.createElement("div",{className:"col-md-12"},i.createElement("div",{key:n,id:"message_"+a._id,style:{padding:"10px 10px 10px 20px"},className:"chat-message "+(a.from==I.contact?"inbound-message":"outbound-message")},""==c?i.createElement("div",{className:"message-text padding-5",style:{overflowWrap:"break-word"}},a.messageText):i.createElement(i.Fragment,null,i.createElement("div",{className:"row",style:{display:"flex"}},i.createElement("div",{style:{display:"grid"}},i.createElement("div",{className:"col-md-3"},B?i.createElement("img",{src:c,style:{cursor:"pointer",width:"auto",height:"50px"},onClick:function(){t.setState({isOpen:!0,documentName:a.attachmentImage})}}):i.createElement("img",{src:c,style:{cursor:"pointer",width:"auto",height:"50px"}})),i.createElement("span",{style:{textAlign:"center",marginTop:"10px",fontSize:"10px"}},a.messageText,".",e)),i.createElement("div",{className:"col-md-9"},i.createElement("br",null),i.createElement("a",{className:"anchor-black",href:s,download:!0},"Download")))),i.createElement("div",{style:{display:"flex",marginTop:"10px"}},i.createElement("div",{className:"sender-name"},i.createElement("p",{style:{fontSize:"13px",fontFamily:"Lato",margin:"3px 0px 0px 0px",fontWeight:"bold",textTransform:"capitalize"}},a.fromName)),i.createElement("div",{className:"timestamp",style:{fontSize:"10px",fontFamily:"Lato",marginTop:"5px",color:"#757575"}},new Date(a.createdAt).onitDateFormat(!0)))))}}))))),i.createElement("footer",{className:"padding-10"},i.createElement("div",{className:"no-margin"},i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md-12 no-padding"},i.createElement("div",{className:"",style:{display:"inline-flex",padding:"0px",width:"100%"}},!t.state.chat.isArchived&&i.createElement(i.Fragment,null,i.createElement("div",{className:"input-group",style:{width:"100%"}},i.createElement("input",{className:"form-control txt-area-chat-more z-index-0",id:"txt-area-more",placeholder:"Type your message here...",name:"chatBox",value:c,type:"text",onChange:function(e){return t.handleChatInput(e.target.value)},onKeyPress:function(e){return t.handleChatInputKeys(e)}}),i.createElement("span",{className:"input-group-addon txt-area-chat"},i.createElement("button",{title:"Upload File","data-toggle":"modal","data-target":"#filesUploadDailogeBox",className:"btn-upload-file-chat",onClick:function(){var e={docOntology:"",entityOntology:t.props.entityTitle?[{label:t.props.entityTitle,value:t.props.entityTitle}]:t.state.chat._id?[{label:t.state.chat._id,value:t.state.chat._id}]:[],entityType:"Chat",documentType:"Media",documentSubtype:"",rdfsLabel:"",s3FileName:"",entryTimeStamp:"",enteredBy:"",enteredByName:"",linkToDocument:"",building:t.props.buildingName,buildingName:""};t.setState({documentObj:e,files:[]})}},i.createElement("i",{className:"fa fa-paperclip"}),"\xa0"))),i.createElement("button",{disabled:""==t.state.chatText.trim(),type:"button",className:"pull-right btn-chat-msg ml-3",onClick:function(){return C(t,void 0,void 0,function(){return S(this,function(e){switch(e.label){case 0:return s?[4,this.sendMessage()]:[3,2];case 1:e.sent(),e.label=2;case 2:return s=!1,setTimeout(function(){s=!0},500),[2]}})})}},i.createElement("i",{className:"fa fa-paper-plane"}),"\xa0"))),i.createElement("div",{className:"row"},i.createElement("div",{className:""},i.createElement(p.a,{id:"filesUploadDailogeBox",heading:"File Upload",saveButtonText:"Upload",isEditForm:!1,cancelButtonId:"closeAttachmentDialogue",onSaveButtonClick:function(){t.saveImage()},disableSaveButton:!r.rdfsLabel||0==l.length},i.createElement("div",{className:"card no-margin"},i.createElement("div",{className:"container-fluid dataCard"},i.createElement("div",{className:"content"},i.createElement("div",{className:"row padding-10"},i.createElement("div",{className:"col-md-12"},i.createElement("div",{className:"col-md-3 headingText padding-10",style:{textAlign:"center"}},"Title:"),i.createElement("div",{className:"col-md-9"},i.createElement("input",{id:"fileTitle",onChange:function(e){t.handleTitleChange(e.target.value)},type:"text",name:"fileTitle",value:r.rdfsLabel,className:"form-control"})))),i.createElement("div",{className:"row padding-10"},i.createElement("div",{className:"col-md-12"},i.createElement("div",{className:"col-md-3 headingText padding-10 center",style:{marginTop:"10%"}},"File Upload:"),i.createElement("div",{className:"col-md-9",onClick:function(){r.rdfsLabel?document.getElementById("fileTitle").style.boxShadow="0px 0px 15px gainsboro":document.getElementById("fileTitle").style.boxShadow="0px 0px 15px red"}},i.createElement(g.a,{disable:!r.rdfsLabel,single:!0,handleAttachedFile:t.handlefileAttached,files:l}))))))))))))),f&&i.createElement("div",null,i.createElement(M,{mainSrc:_.GetSignedURL(o.a.DOCUMENT(),t.state.documentName),onCloseRequest:function(){t.setState({isOpen:!1,documentName:""})},onMovePrevRequest:function(){},onMoveNextRequest:function(){}})))))))),i.createElement("button",{type:"button",id:"addNewMessage",className:"hidden",onClick:function(){t.addNewMessage()}},"."),i.createElement("button",{type:"button",id:"showIncomingChatInChatWindow",className:"hidden",onClick:function(){t.getLatestMessages(m.x._id)}},"."),i.createElement("button",{type:"button",id:"onlineChatMessage",className:"hidden",onClick:function(){t.fetchData()}},"."))})},t}(i.Component);t.default=Object(E.b)(void 0,function(e){return{setUserCalling:function(t){return e(Object(x.c)(t))},setUserToCall:function(t){return e(Object(x.d)(t))},setIsOnCall:function(t){return e(Object(x.a)(t))}}})(_)}});