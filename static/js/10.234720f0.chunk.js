webpackJsonp([10],{2965:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),r=(a.n(n),a(127)),i=a(1291),s=a(11),o=a(707),l=a(2966),u=a(20),c=a(2967),m=a(2968),p=a(2969),h=a(2970),d=a(2971),g=a(2972),f=a(2973),y=a(2974),v=a(2975),x=a(2976),b=a(1680),A=(a.n(b),a(744)),E=a(2977),D=a(725),w=a(13),S=a(124),_=a(8),O=a(749),V=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),L=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},P=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},N=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<a;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,r++)n[r]=i[s];return n},R=function(e){function t(t){var a=e.call(this,t)||this,n=new Date(new Date(Date.now()).setMinutes(new Date(Date.now()).getMinutes()-30)),r=new Date(Date.now());return a.state={from:n,to:r,dashboardURL:"",insights:[],templatesList:[],selectedTemplate:"",loadingDevices:!0,liveGraphRange:30,filteredInsights:[],showInsights:[],selectedTemplateGraphs:{},showAlarmPoints:!1,enableYAxis:!1,insightsLoaded:0,verifyList:[],insightPoints:[],assets:[],isEquipment:!1,filteredAssets:[],showAssets:[],isAnyGraphLoaded:[],showAllGraphs:!1},a.isGraphLoaded=a.isGraphLoaded.bind(a),a}return V(t,e),t.prototype.componentDidMount=function(){return L(this,void 0,void 0,function(){var e;return P(this,function(t){switch(t.label){case 0:return e=JSON.parse(_.a.getItem("user")),[4,Promise.all([Object(S.b)(e.contact),this._fetchInsights(),this._fetchEquipment()])];case 1:return t.sent(),[2]}})})},t.prototype.moreInsights=function(){var e=this.state,t=e.showInsights,a=e.filteredInsights,n=e.isEquipment,r=e.filteredAssets,i=e.showAssets;if(n){var s=r.slice(i.length-1,i.length+4),o=N(i,s);this.setState({showAssets:o},function(){window.dispatchEvent(new Event("reLoadGraph"))})}else{s=a.slice(t.length-1,t.length+4),o=N(t,s);this.setState({showInsights:o},function(){window.dispatchEvent(new Event("reLoadGraph"))})}},t.prototype.loadNextInsight=function(){var e=this.state,t=e.showInsights,a=e.insightsLoaded,n=e.isEquipment,r=e.showAssets;n?a<r.length&&this.setState({insightsLoaded:a+1}):a<t.length&&this.setState({insightsLoaded:a+1})},t.prototype._fetchInsights=function(){return L(this,void 0,void 0,function(){var e,t,a,n,r,l,u=this;return P(this,function(c){switch(c.label){case 0:return e=this.props.buildingName,t=[],a=[],[4,Object(A.o)(e)];case 1:return n=(n=c.sent()).filter(function(e){return"Measure"==e.verifyType}),e?[4,Object(o.w)(e)]:[3,6];case 2:return(r=(r=c.sent()).filter(function(e){var t,a,n,r,i,o,l;return-1!=(null===(t=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===t?void 0:t.toLowerCase().indexOf("thermostat"))||-1!=(null===(a=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===a?void 0:a.toLowerCase().indexOf("ceiling"))||-1!=(null===(n=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===n?void 0:n.toLowerCase().indexOf("intesis"))||-1!=(null===(r=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("ats"))||-1!=(null===(i=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("generator"))||"CBW406"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)||"CBW418"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)||-1!=(null===(o=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===o?void 0:o.toLowerCase().indexOf("relayv4"))||-1!=(null===(l=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===l?void 0:l.toLowerCase().indexOf("relayi1"))||"WattNode"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)}))&&r.length?(l=r.map(function(e){return Object(s.g)(e.moncondevice)}),[4,Object(D.l)(e,"Sensed",l)]):[3,4];case 3:a=c.sent(),c.label=4;case 4:return[4,Object(i.b)(e).then(function(e){if(e&&e.length>0)e.map(function(e){t.push({ontology:Object(s.g)(e.ontology),label:Object(s.g)(e.label),deviceGraphs:Object(s.g)(e.deviceGraphs)})}),u.setState({insightPoints:a,templatesList:t,insights:r,selectedTemplate:(t.length-1).toString(),filteredInsights:[],showInsights:[]},function(){var e=JSON.parse(t[t.length-1].deviceGraphs),a=Object.keys(e),i=null===r||void 0===r?void 0:r.filter(function(e){return a.indexOf(Object(s.g)(e.moncondevice))>-1}),o=i.slice(0,10);u.setState({filteredInsights:i,showInsights:o,selectedTemplateGraphs:e,verifyList:n,loadingDevices:!1})});else{var i=null===r||void 0===r?void 0:r.filter(function(e){return e.moncondevice}),o=i.slice(0,10);u.setState({insightPoints:a,insights:r,filteredInsights:i,showInsights:o,verifyList:n,loadingDevices:!1})}})];case 5:c.sent(),c.label=6;case 6:return[2]}})})},t.prototype._fetchEquipment=function(){return L(this,void 0,void 0,function(){var e;return P(this,function(t){switch(t.label){case 0:return[4,Object(O.g)(this.props.buildingName,w.b.POINT)];case 1:return e=t.sent(),this.setState({assets:e}),[2]}})})},t.prototype.changeAlarmStatus=function(){this.setState({showAlarmPoints:!this.state.showAlarmPoints}),window.dispatchEvent(new Event("ShowAlarms"))},t.prototype.changeYAxisStatus=function(){this.setState({enableYAxis:!this.state.enableYAxis})},t.prototype.liveGraphRangeChange=function(e){var t=this,a=new Date,n=new Date;n.setMinutes(n.getMinutes()-+e),this.setState({from:n,to:a,liveGraphRange:+e,loadingDevices:!0,insightsLoaded:0},function(){t.setState({loadingDevices:!1})})},t.prototype.selectTemplate=function(e){var t=this,a=this.state,n=a.templatesList,r=a.insights,i=a.verifyList,o=a.assets;if(isNaN(+e))if("default"==e){var l=r,u=l.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1,isAnyGraphLoaded:[]},function(){t.setState({selectedTemplate:e,filteredInsights:l,showInsights:u,loadingDevices:!1,isAnyGraphLoaded:[],showAllGraphs:!1})})}else if("defaultAll"==e){var c=r,m=c.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1,isAnyGraphLoaded:[]},function(){t.setState({selectedTemplate:e,filteredInsights:c,showInsights:m,loadingDevices:!1,isAnyGraphLoaded:[],showAllGraphs:!0})})}else if("equipmentGraphsAll"==e){var p=o,h=p.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!0,isAnyGraphLoaded:[]},function(){t.setState({selectedTemplate:e,filteredAssets:p,showAssets:h,loadingDevices:!1,isAnyGraphLoaded:[],showAllGraphs:!0})})}else if("equipmentGraphs"==e){var d=o,g=d.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!0,isAnyGraphLoaded:[]},function(){t.setState({selectedTemplate:e,filteredAssets:d,showAssets:g,loadingDevices:!1,isAnyGraphLoaded:[],showAllGraphs:!1})})}else{if(!i.find(function(t){return t._id==e}))return;this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1,isAnyGraphLoaded:[]},function(){t.setState({loadingDevices:!1,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],liveGraphRange:1,isAnyGraphLoaded:[]})})}else this.setState({loadingDevices:!0,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],insightsLoaded:0,isEquipment:!1,isAnyGraphLoaded:[]},function(){var a=JSON.parse(n[+e].deviceGraphs),i=Object.keys(a),o=r.filter(function(e){return i.indexOf(Object(s.g)(e.moncondevice))>-1}),l=o.slice(0,10);t.setState({showInsights:l,filteredInsights:o,loadingDevices:!1,selectedTemplateGraphs:a,isAnyGraphLoaded:[]})})},t.prototype.isGraphLoaded=function(e){this.setState({isAnyGraphLoaded:N(this.state.isAnyGraphLoaded,[e])})},t.prototype.render=function(){var e,t=this,a=this.state,i=a.verifyList,o=a.from,b=a.to,A=a.showInsights,D=a.filteredInsights,w=a.templatesList,S=a.selectedTemplate,_=a.loadingDevices,O=a.liveGraphRange,V=a.selectedTemplateGraphs,L=a.showAlarmPoints,P=a.insightsLoaded,N=a.insightPoints,R=a.isEquipment,j=a.filteredAssets,k=a.showAssets,K=a.insights,F=a.enableYAxis,C=a.isAnyGraphLoaded,G=a.showAllGraphs,q=this.props,M=q.buildingName,T=q.instance,B=!C||!C.length||(null===C||void 0===C?void 0:C.find(function(e){return 1==e}));return n.createElement("div",{className:"dashboard"},n.createElement("div",{className:"dashboard-header sticky"},!_&&n.createElement("div",{className:"col-md-4 float-left"},n.createElement("div",{className:"col-md-8 no-padding"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.selectTemplate(e.target.value)},value:S,placeholder:"Select Template"},0==w.length&&n.createElement("option",{value:""},"Select Template"),n.createElement("option",{value:"default"},"Insight Graphs"),n.createElement("option",{value:"defaultAll"},"All Insight Graphs"),n.createElement("option",{value:"equipmentGraphs"},"Equipment Graphs"),n.createElement("option",{value:"equipmentGraphsAll"},"All Equipment Graphs"),(null===w||void 0===w?void 0:w.length)>0&&w.map(function(e,t){return n.createElement("option",{value:t,key:t},e.label)}),(null===i||void 0===i?void 0:i.length)>0&&i.map(function(e,t){return n.createElement("option",{value:e._id,key:t},e.projectName)}))),n.createElement(r.b,{target:"_blank",to:"/"+T+"/"+M+"/Dashboard/Templates",className:"btn btn-fill btn-secondary btn-secondary-dark margin-left-20 btn-fix-height"},"Create Template")),n.createElement("h3",{className:"dashboard-title"},Object(u.A)(M)),!_&&n.createElement("div",{className:"col-md-4 float-right margin-top-10"},n.createElement("div",{className:"col-md-3 padding-5 mr-5"},(R&&P==k.length||!R&&P===A.length)&&!i.find(function(e){return e._id==S})&&n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-7"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Show Alarm:")),n.createElement("div",{className:"col-md-5 no-padding"},n.createElement("label",null,n.createElement("input",{name:"showError",onChange:function(e){t.changeAlarmStatus()},className:"switchDashboard",type:"checkbox",checked:L}),n.createElement("div",null,n.createElement("div",null)))))),n.createElement("div",{className:"col-md-4 padding-5 mr-5"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-7 text-align-end"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Y axis:")),n.createElement("div",{className:"col-md-5 no-padding"},n.createElement("label",null,n.createElement("input",{onChange:function(e){t.changeYAxisStatus()},className:"switchDashboard",type:"checkbox",checked:F}),n.createElement("div",null,n.createElement("div",null)))))),n.createElement("div",{className:"col-md-5 padding-5"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-4 no-padding text-align-end"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"X axis:")),n.createElement("div",{className:"col-md-8"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.liveGraphRangeChange(e.target.value)},value:O},i.find(function(e){return e._id==S})?n.createElement(n.Fragment,null,n.createElement("option",{value:1},"1 Month"),n.createElement("option",{value:2},"2 Months"),n.createElement("option",{value:3},"3 Months"),n.createElement("option",{value:4},"4 Months"),n.createElement("option",{value:5},"5 Months"),n.createElement("option",{value:6},"6 Months")):n.createElement(n.Fragment,null,n.createElement("option",{value:5},"5 Mins"),n.createElement("option",{value:15},"15 Mins"),n.createElement("option",{value:30},"30 Mins"),n.createElement("option",{value:60},"1 Hour"),n.createElement("option",{value:180},"3 Hours"),n.createElement("option",{value:360},"6 Hours"),n.createElement("option",{value:720},"12 Hours"),n.createElement("option",{value:1440},"24 Hours")))))))),_||""!=S||0!=w.length?_?n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"})):i.find(function(e){return e._id==S})?n.createElement("div",{className:""},n.createElement(E.a,{instance:T,buildingName:M,from:o,to:b,projectName:S,measureAnalysis:i.find(function(e){return e._id==S}).measureAnalysis})):R?n.createElement(c.a,{dataLength:k.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:k.length<j.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},k.map(function(e){var a=K.filter(function(t){return Object(s.g)(t.equipmentsRdfsLabel)&&Object(s.g)(t.equipmentsRdfsLabel).indexOf(Object(s.g)(e.ontology))>-1});return a&&a.length?a&&a.length&&a.map(function(a){for(var r,i,u,c,A,E,D,w=-1!=(null===(r=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("thermostat")),S=-1!=(null===(i=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("ceiling")),_=-1!=(null===(u=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),P=-1!=(null===(c=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),R=-1!=(null===(A=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===A?void 0:A.toLowerCase().indexOf("generator")),j="CBW406"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),k="CBW418"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),K=-1!=(null===(E=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("relayv4")),C=-1!=(null===(D=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayi1")),q="WattNode"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),B={ontology:Object(s.g)(e.ontology),rdfsLabel:Object(s.g)(e.rdfsLabel)},Y=Object(s.g)(a.equipmentsRdfsLabel).split(","),H=Object(s.g)(a.relatedEquipmentsLabel).split(","),W=[],I=0;I<Y.length;I++){var U=Y[I],z=H&&H[I]?H[I]:"";W.push({ontology:U,rdfsLabel:z})}var J=null===N||void 0===N?void 0:N.filter(function(e){return Object(s.g)(e.monconDevice)==Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)||Object(s.g)(e.sinkSourceAsset)==Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)});return n.createElement(n.Fragment,null,w&&n.createElement(l.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),S&&n.createElement(p.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),_&&n.createElement(h.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,space:Object(s.g)(a.spaceRdfsLabel),zone:Object(s.g)(a.zoneRdfsLabel),floor:Object(s.g)(a.floorRdfsLabel),equipment:W,loadNextInsight:function(){return t.loadNextInsight()},device:a,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),P&&n.createElement(d.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),R&&n.createElement(g.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),j&&n.createElement(f.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),k&&n.createElement(y.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),K&&n.createElement(v.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),C&&n.createElement(m.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),q&&n.createElement(x.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?V[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:W,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:J,device:a,isEquipment:!0,equipment:B,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}))}):n.createElement(n.Fragment,null)}),(0==(null===k||void 0===k?void 0:k.length)||!B)&&n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," ",0==(null===k||void 0===k?void 0:k.length)?"No graphs":"No latest data for graphs"," "))):n.createElement(c.a,{dataLength:A.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:A.length<D.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},null===(e=null===A||void 0===A?void 0:A.slice(0,P+1))||void 0===e?void 0:e.map(function(e,a){for(var r,i,u,c,A,E,D,w=-1!=(null===(r=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("thermostat")),S=-1!=(null===(i=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("ceiling")),_=-1!=(null===(u=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),P=-1!=(null===(c=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),R=-1!=(null===(A=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===A?void 0:A.toLowerCase().indexOf("generator")),j="CBW406"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),k="CBW418"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),K=-1!=(null===(E=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("relayv4")),C=-1!=(null===(D=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayi1")),q="WattNode"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),B=Object(s.g)(e.equipmentsRdfsLabel).split(","),Y=Object(s.g)(e.relatedEquipmentsLabel).split(","),H=[],W=0;W<B.length;W++){var I=B[W],U=Y&&Y[W]?Y[W]:"";H.push({ontology:I,rdfsLabel:U})}var z=null===N||void 0===N?void 0:N.filter(function(t){return Object(s.g)(t.monconDevice)==Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)||Object(s.g)(t.sinkSourceAsset)==Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)}),J=["Refrigerator 1","Refrigerator 2"];return k&&Object(s.g)(e.applicationLabel)&&Object(s.g)(e.applicationLabel).indexOf("3")>-1&&(J=["Refrigerator 3","Refrigerator 4"]),n.createElement(n.Fragment,null,w&&n.createElement(l.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),S&&n.createElement(p.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,isEquipment:!1,equipment:Object(),enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),_&&n.createElement(h.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,space:Object(s.g)(e.spaceRdfsLabel),zone:Object(s.g)(e.zoneRdfsLabel),floor:Object(s.g)(e.floorRdfsLabel),equipment:H,loadNextInsight:function(){return t.loadNextInsight()},device:e,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),P&&n.createElement(d.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),R&&n.createElement(g.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),j&&n.createElement(f.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),k&&n.createElement(y.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:J,insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),K&&n.createElement(v.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),C&&n.createElement(m.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}),q&&n.createElement(x.a,{buildingName:M,instance:T,from:o,to:b,liveGraphRange:O,graphsList:V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?V[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:H,showAlarmPoints:L,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:e,enableYAxis:F,isGraphLoaded:t.isGraphLoaded,showAllGraphs:G}))})):n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Template Created ")))},t}(n.Component);t.default=R},2966:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(11),o=a(707),l=a(837),u=a(20),c=a(838),m=a(797),p=a(122),h=a(736),d=a(124),g=a(760),f=(a.n(g),a(857)),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(s.g)(e)&&Object(d.g)(Object(s.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,o,l,u,c,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,o=a.device,Object(p.a)(!0),i&&!e?[3,2]:(l=[],r&&r.length&&r.forEach(function(e){l.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(h.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(o.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(c=t[0].graphData.columns,d=new Date(c[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(p.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,u=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=c.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,o=n.alarmSensedPoints,l=this.props,c=l.showAlarmPoints,m=l.device,p=new Date,h=Object(s.g)(m.moncontype),d=f.c.filter(function(e){return h.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(p=new Date(e["@timestamp"]));var g=this.props.liveGraphRange;if(r&&r.length&&p){for(var y=0;y<r.length;y++){var v=r[y],x=v.graphData.columns.map(function(e){return e[0]});if(v.graphData.columns&&v.graphData.columns.length){if(v.graphData.columns[0].push(p),e&&Object.keys(e).length)for(var b=Object.keys(e),A=function(a){var n=b[a];if(v.sensedKeys&&v.sensedKeys.length&&v.sensedKeys.find(function(e){return e==n})){var r=null===(t=d.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=x.findIndex(function(e){return e==r});1!=(null===e||void 0===e?void 0:e.tempunits)||"cooltemp"!=n&&"heattemp"!=n&&"spacetemp"!=n?v.graphData.columns[i].push(e[n]):v.graphData.columns[i].push(Object(u.a)(e[n]).toFixed(1)),v.graphData.columns[i].splice(1,1)}}},E=0;E<b.length;E++)A(E);(p.getTime()-v.graphData.columns[0][2].getTime())/6e4>g&&v.graphData.columns[0].splice(1,1),v.axis.x.tick.values[2]&&v.axis.x.tick.values[1].getTime()&&v.axis.x.tick.values[2].getTime()-v.axis.x.tick.values[1].getTime()<p.getTime()-v.axis.x.tick.values[v.axis.x.tick.values.length-1]&&(v.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),p.setSeconds(0),g>10&&p.setMinutes(p.getMinutes()-p.getMinutes()%5),v.axis.x.tick.values.push(p),i.x.lines.push({value:p,class:"grid4"}))}}var D=null===p||void 0===p?void 0:p.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:D},function(){if(c){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&o.length>0&&o.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),s=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,s,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,o,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(s.g)(r.moncontype),(o=f.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&o.value&&(n.axis.y.tick.values=o.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,o,c,m,p,h,d,g,f,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,o=r.buildingName,c=r.device,m=r.isEquipment,p=r.equipment,h=this.state.graphYAxisSettings,d="",g="",f="",m?(f="equipment",d=p.ontology,g=p.rdfsLabel):(f="device",d=Object(s.g)(c.moncondevice),g=Object(s.g)(c.rdfsLabel)),y=h.find(function(t){return t.graphName==e}),v=Object(u.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:o,ontology:v,assetOntology:d,ontologyLabel:g,ontologyAssetType:f,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,o;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(s.g)(r.moncondevice),[4,Object(l.a)(t,i)];case 1:return o=u.sent(),this.setState({graphYAxisSettings:o}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},o=0;o<t.length;o++)i(o);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,c,m,p,h,g,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.from,a=e.to,n=e.device,r=e.showAlarmPoints,i=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,h=e.showAllGraphs,g=this.state,y=g.grid,v=g.graphData,x=g.lastUpdatedAt,A=g.graphYAxisSettings,E=[],c&&(E=i.filter(function(e){return Object(s.g)(e.relatedEquipment)==m.ontology})),n&&n.moncondevice?(D=Object(s.g)(n.moncontype),w=Object(s.g)(n.topic),S=f.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=f.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),O=[],!c||c&&E.length?[4,Object(o.I)(w,t,a,!1)]:[3,2]):[3,3];case 1:O=b.sent(),b.label=2;case 2:if(V={cooltemp:[_.find(function(e){return"cooltemp"==e.sensedKey}).des],heattemp:[_.find(function(e){return"heattemp"==e.sensedKey}).des],spacetemp:[_.find(function(e){return"spacetemp"==e.sensedKey}).des],fan:[_.find(function(e){return"fan"==e.sensedKey}).des],fanstate:[_.find(function(e){return"fanstate"==e.sensedKey}).des],mode:[_.find(function(e){return"mode"==e.sensedKey}).des],state:[_.find(function(e){return"state"==e.sensedKey}).des]},L=["x"],V.cooltemp.push(null),V.heattemp.push(null),V.spacetemp.push(null),V.fan.push(null),V.fanstate.push(null),V.mode.push(null),V.state.push(null),L.push(new Date(t)),O.length>0&&(null===O||void 0===O||O.forEach(function(e){(null===e||void 0===e?void 0:e.cooltemp)&&(1==e.tempunits?(V.cooltemp.push(Object(u.a)(e.cooltemp).toFixed(1)),V.heattemp.push(Object(u.a)(e.heattemp).toFixed(1)),V.spacetemp.push(Object(u.a)(e.spacetemp).toFixed(1))):(V.cooltemp.push(e.cooltemp),V.heattemp.push(e.heattemp),V.spacetemp.push(e.spacetemp)),V.fan.push(e.fan),V.fanstate.push(e.fanstate),V.mode.push(e.mode),V.state.push(e.state),L.push(new Date(e.timestamp)))})),x=O.length>0?null===(M=L[L.length-1])||void 0===M?void 0:M.toLocaleString():"No Data",L.length>1){if(P=Object(l.c)(5,t,a),N="",P.length>1?(R=((new Date).getTime()-P[0].getTime())/1e3,N=(R/=3600)>24?"%m-%d %H:%M":R<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",y.x.lines=[],P.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((j=JSON.parse(JSON.stringify(f.a))).name="Thermostat",j.graphData.columns=[L],j.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},j.axis.x.tick.format=N,j.axis.x.tick.values=P,j.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},j.axis.y.label="State, Mode, Fan, Fan State",j.axis.y.tick.values=[0,1,2,3],j.axis.y.tick.max=3,j.axis.y.tick.min=0,j.graphData.x="x",q=0;q<E.length;q++)k=E[q],K=Object(s.g)(k.sensedValue),j.sensedKeys.push(K),j.graphData.columns.push(V[""+K]);S.find(function(e){return e.name==j.name})&&(j.axis.y.tick.values=S.find(function(e){return e.name==j.name}).value,j.axis.y.min=j.axis.y.tick.values[0],j.axis.y.max=j.axis.y.tick.values[j.axis.y.tick.values.length-1]),A&&A.length&&(F=A.find(function(e){return e.graphName==j.name}))&&F.yAxisSettings&&("Fixed"==F.yAxisSettings?(delete j.axis.y.tick.values,j.axis.y.min=F.yAxisMin,j.axis.y.max=F.yAxisMax):"Floating"==F.yAxisSettings&&(delete j.axis.y.tick.values,delete j.axis.y.max,delete j.axis.y.min),j.yAxisSettings=F.yAxisSettings,j.yAxisFixedValues={max:F.yAxisMax,min:F.yAxisMin}),j.graphEquipment=this.fetchEquipmentFromPoints(j.name,j.sensedKeys),v.push(j)}else for(C=function(e){var t,a="Thermostat",n=JSON.parse(JSON.stringify(f.a));if(n.name=a,n.sensedKeys=["cooltemp","heattemp","spacetemp","fan","fanstate","mode","state"],t=[L,V.cooltemp,V.heattemp,V.spacetemp,V.fan,V.fanstate,V.mode,V.state],n.axis={x:{type:"timeseries",tick:{fit:!1,count:5,values:P,format:N}},y:{label:{text:"Temperature \xb0F",position:"outer-middle"},tick:{fit:!0,values:[0,20,40,60,80,100],count:6,format:function(e){return parseFloat(e).toFixed(1)}},max:100,min:0},y2:{show:!0,label:{text:"State, Mode, Fan, Fan State",position:"outer-middle"},tick:{fit:!0,values:[0,1,2,3],count:6,format:function(e){return parseFloat(e).toFixed(0)}},max:3,min:0}},S.find(function(e){return e.name==a})&&(n.axis.y.tick.values=S.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),A&&A.length){var r=A.find(function(e){return e.graphName==a});r&&r.yAxisSettings&&("Fixed"==r.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=r.yAxisMin,n.axis.y.max=r.yAxisMax):"Floating"==r.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=r.yAxisSettings,n.yAxisFixedValues={max:r.yAxisMax,min:r.yAxisMin})}n.graphData.x="x",n.graphData.columns=t,n.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},n.graphData.colors={"Cool setpoint":"yellow","Heat setpoint":"green","Space Temp":"blue","Fan 0: Auto 1: On":"pink","Fan State 1: On":"yellow","Mode 0: Heat 1: Cool 2: Auto":"magenta","State 1: Heat 2: Cool":"#06cfa4"},n.graphData.types={"Cool setpoint":"line","Heat setpoint":"line","Space Temp":"line","Fan 0: Auto 1: On":"step","Fan State 1: On":"step","Mode 0: Heat 1: Cool 2: Auto":"step","State 1: Heat 2: Cool":"step"},n.graphEquipment=G.fetchEquipmentFromPoints(a,n.sensedKeys),v.push(n)},G=this,q=0;q<1;q++)C(q);this.props.loadNextInsight(),Object(d.h)(w,this.callLiveUpdate),this.setState({grid:y,graphData:v,lastUpdatedAt:x,loading:!1},function(){p(!!h||O.length>0),r&&T.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,o=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.insightRelEquipment,g=c.showAlarmPoints,f=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=l||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/InsightControl/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:o,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2967:function(e,t,a){"use strict";var n=a(2),r=a.n(n),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};var s=function(){return(s=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var o={Pixel:"Pixel",Percent:"Percent"},l={unit:o.Percent,value:.8};function u(e){return"number"===typeof e?{unit:o.Percent,value:100*e}:"string"===typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:o.Pixel,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:o.Percent,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),l):(console.warn("scrollThreshold should be string or number"),l)}var c=function(e){function t(t){var a=e.call(this,t)||this;return a.lastScrollTop=0,a.actionTriggered=!1,a.startY=0,a.currentY=0,a.dragging=!1,a.maxPullDownDistance=0,a.getScrollableTarget=function(){return a.props.scrollableTarget instanceof HTMLElement?a.props.scrollableTarget:"string"===typeof a.props.scrollableTarget?document.getElementById(a.props.scrollableTarget):(null===a.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},a.onStart=function(e){a.lastScrollTop||(a.dragging=!0,e instanceof MouseEvent?a.startY=e.pageY:e instanceof TouchEvent&&(a.startY=e.touches[0].pageY),a.currentY=a.startY,a._infScroll&&(a._infScroll.style.willChange="transform",a._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},a.onMove=function(e){a.dragging&&(e instanceof MouseEvent?a.currentY=e.pageY:e instanceof TouchEvent&&(a.currentY=e.touches[0].pageY),a.currentY<a.startY||(a.currentY-a.startY>=Number(a.props.pullDownToRefreshThreshold)&&a.setState({pullToRefreshThresholdBreached:!0}),a.currentY-a.startY>1.5*a.maxPullDownDistance||a._infScroll&&(a._infScroll.style.overflow="visible",a._infScroll.style.transform="translate3d(0px, "+(a.currentY-a.startY)+"px, 0px)")))},a.onEnd=function(){a.startY=0,a.currentY=0,a.dragging=!1,a.state.pullToRefreshThresholdBreached&&(a.props.refreshFunction&&a.props.refreshFunction(),a.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){a._infScroll&&(a._infScroll.style.overflow="auto",a._infScroll.style.transform="none",a._infScroll.style.willChange="unset")})},a.onScrollListener=function(e){"function"===typeof a.props.onScroll&&setTimeout(function(){return a.props.onScroll&&a.props.onScroll(e)},0);var t=a.props.height||a._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;a.actionTriggered||((a.props.inverse?a.isElementAtTop(t,a.props.scrollThreshold):a.isElementAtBottom(t,a.props.scrollThreshold))&&a.props.hasMore&&(a.actionTriggered=!0,a.setState({showLoader:!0}),a.props.next&&a.props.next()),a.lastScrollTop=t.scrollTop)},a.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},a.throttledOnScrollListener=function(e,t,a,n){var r,i=!1,s=0;function o(){r&&clearTimeout(r)}function l(){var l=this,u=Date.now()-s,c=arguments;function m(){s=Date.now(),a.apply(l,c)}i||(n&&!r&&m(),o(),void 0===n&&u>e?m():!0!==t&&(r=setTimeout(n?function(){r=void 0}:m,void 0===n?e-u:e)))}return"boolean"!==typeof t&&(n=a,a=t,t=void 0),l.cancel=function(){o(),i=!0},l}(150,a.onScrollListener).bind(a),a.onStart=a.onStart.bind(a),a.onMove=a.onMove.bind(a),a.onEnd=a.onEnd.bind(a),a}return function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}(t,e),t.prototype.componentDidMount=function(){if("undefined"===typeof this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"===typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!==typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.componentDidUpdate=function(e){this.props.dataLength!==e.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},t.getDerivedStateFromProps=function(e,t){return e.dataLength!==t.prevDataLength?s(s({},t),{prevDataLength:e.dataLength}):null},t.prototype.isElementAtTop=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===o.Pixel?e.scrollTop<=n.value+a-e.scrollHeight+1:e.scrollTop<=n.value/100+a-e.scrollHeight+1},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===o.Pixel?e.scrollTop+a>=e.scrollHeight-n.value:e.scrollTop+a>=n.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=s({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),a=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),n=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return r.a.createElement("div",{style:n,className:"infinite-scroll-component__outerdiv"},r.a.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&r.a.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},r.a.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!a&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(n.Component);t.a=c},2968:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(11),o=a(707),l=a(837),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,o,l,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,o=a.device,Object(m.a)(!0),i&&!e?[3,2]:(l=[],r&&r.length&&r.forEach(function(e){l.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(o.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,o=n.alarmSensedPoints,l=this.props,u=l.showAlarmPoints,c=l.device,m=new Date,p=Object(s.g)(c.moncontype),h=g.c.filter(function(e){return p.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(m=new Date(e["@timestamp"]));var d=this.props.liveGraphRange;if(r&&r.length&&m){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=h.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});"import_active_energy_Wh"==n?y.graphData.columns[i].push(+e[n]/1e3):y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(m.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<m.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),m.setSeconds(0),d>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),y.axis.x.tick.values.push(m),i.x.lines.push({value:m,class:"grid4"}))}}var E=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(u){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&o.length>0&&o.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),s=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,s,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,o,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(s.g)(r.moncontype),(o=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&o.value&&(n.axis.y.tick.values=o.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,o,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,o=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(s.g)(u.moncondevice),d=Object(s.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:o,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,o;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(s.g)(r.moncondevice),[4,Object(l.a)(t,i)];case 1:return o=u.sent(),this.setState({graphYAxisSettings:o}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(s.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(s.g)(i.relatedEquipment)})||r.push({value:Object(s.g)(i.relatedEquipment),label:Object(s.g)(i.relatedEquipmentLabel),space:Object(s.g)(i.relatedEquipmentSpaceLabel)})},o=0;o<t.length;o++)i(o);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,d=e.showAllGraphs,f=this.state,y=f.grid,v=f.graphData,x=f.lastUpdatedAt,A=f.graphYAxisSettings,E=[],c&&(E=u.filter(function(e){return Object(s.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(D=Object(s.g)(t.moncontype),w=Object(s.g)(t.topic),S=g.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=g.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),O=[],!c||c&&E.length?[4,Object(o.g)(w,a,n,!1)]:[3,2]):[3,3];case 1:O=b.sent(),b.label=2;case 2:if(V={i1relay_state:[_.find(function(e){return"i1relay_state"==e.sensedKey}).des],active_power_Watts:[_.find(function(e){return"active_power_Watts"==e.sensedKey}).des],current_Amperes:[_.find(function(e){return"current_Amperes"==e.sensedKey}).des],frequency_Hz:[_.find(function(e){return"frequency_Hz"==e.sensedKey}).des],import_active_energy_Wh:[_.find(function(e){return"import_active_energy_Wh"==e.sensedKey}).des],power_factor:[_.find(function(e){return"power_factor"==e.sensedKey}).des],voltage_volts:[_.find(function(e){return"voltage_volts"==e.sensedKey}).des]},L=["x"],V.i1relay_state.push(null),V.active_power_Watts.push(null),V.current_Amperes.push(null),V.frequency_Hz.push(null),V.import_active_energy_Wh.push(null),V.power_factor.push(null),V.voltage_volts.push(null),L.push(new Date(a)),O.length>0&&O.forEach(function(e){e&&(V.i1relay_state.push(e.i1relay_state||"0"),V.active_power_Watts.push(e.active_power_Watts||"0"),V.current_Amperes.push(e.current_Amperes||"0"),V.frequency_Hz.push(e.frequency_Hz||"0"),V.import_active_energy_Wh.push(""+ +e.import_active_energy_Wh/1e3||"0"),V.power_factor.push(e.power_factor||"0"),V.voltage_volts.push(e.voltage_volts||"0"),L.push(new Date(e.timestamp)))}),x=O.length>0?null===(M=L[L.length-1])||void 0===M?void 0:M.toLocaleString():"No Data",V.i1relay_state.push(null),V.active_power_Watts.push(null),V.current_Amperes.push(null),V.frequency_Hz.push(null),V.import_active_energy_Wh.push(null),V.power_factor.push(null),V.voltage_volts.push(null),L.push(new Date(n)),L.length>1){if(P=Object(l.c)(5,a,n),N="",P.length>1?(R=((new Date).getTime()-P[0].getTime())/1e3,N=(R/=3600)>24?"%m-%d %H:%M":R<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",y.x.lines=[],P.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((j=JSON.parse(JSON.stringify(g.a))).name="Relay i1",j.graphData.columns=[L],j.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},j.axis.x.tick.format=N,j.axis.x.tick.values=P,j.graphData.x="x",q=0;q<E.length;q++)k=E[q],K=Object(s.g)(k.sensedValue),j.sensedKeys.push(K),j.graphData.columns.push(V[""+K]);S.find(function(e){return e.name==j.name})&&(j.axis.y.tick.values=S.find(function(e){return e.name==j.name}).value,j.axis.y.min=j.axis.y.tick.values[0],j.axis.y.max=j.axis.y.tick.values[j.axis.y.tick.values.length-1]),A&&A.length&&(F=A.find(function(e){return e.graphName==j.name}))&&F.yAxisSettings&&("Fixed"==F.yAxisSettings?(delete j.axis.y.tick.values,j.axis.y.min=F.yAxisMin,j.axis.y.max=F.yAxisMax):"Floating"==F.yAxisSettings&&(delete j.axis.y.tick.values,delete j.axis.y.max,delete j.axis.y.min),j.yAxisSettings=F.yAxisSettings,j.yAxisFixedValues={max:F.yAxisMax,min:F.yAxisMin}),j.graphEquipment=this.fetchEquipmentFromPoints(j.name,j.sensedKeys),v.push(j)}else for(C=function(e){var t=i[e],a=JSON.parse(JSON.stringify(g.a)),n=1,r=[];if(a.name=t,"Totalized Energy"==t?(a.sensedKeys=["import_active_energy_Wh"],r=[L,V.import_active_energy_Wh],a.axis.y.label="kWh",n=0):"Frequency and Voltage"==t?(a.sensedKeys=["frequency_Hz","voltage_volts"],r=[L,V.frequency_Hz,V.voltage_volts],a.axis.y.label="Hz/Volts"):"Current and Power"==t?(a.sensedKeys=["active_power_Watts","current_Amperes"],r=[L,V.active_power_Watts,V.current_Amperes],a.axis.y.label="Watts/Amps"):"State and Power Factor"==t&&(a.sensedKeys=["relay_state","power_factor"],r=[L,V.i1relay_state,V.power_factor],a.axis.y.label="",n=2),S.find(function(e){return e.name==t})&&(a.axis.y.tick.values=S.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),A&&A.length){var s=A.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=N,a.axis.x.tick.values=P,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=G.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},G=this,q=0;q<i.length;q++)C(q);this.props.loadNextInsight(),Object(h.h)(w,this.callLiveUpdate),this.setState({grid:y,graphData:v,lastUpdatedAt:x,loading:!1},function(){p(!!d||O.length>0),r&&T.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,o=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.showAlarmPoints,g=c.insightRelEquipment,f=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=l||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,f="";return d&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/RelayControl/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:d&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:o,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2969:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(707),o=a(1009),l=a(837),u=a(838),c=a(11),m=a(797),p=a(736),h=a(122),d=a(124),g=a(760),f=(a.n(g),a(857)),y=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},A=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},E=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return A(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return A(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(c.g)(e)&&Object(d.g)(Object(c.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,r,i,s,o,l,u,d,g,f,y,v=this;return A(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(h.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(s.moncondevice)],null)]);case 1:return l=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,d=new Date(u[0][1]),l=l.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:o,deviceAlarms:l},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],v=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),v.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],v,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.changeYAxisSettings=function(e,t){return b(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return A(this,function(l){switch(l.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(c.g)(r.moncontype),(s=f.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return l.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return b(r,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return b(this,void 0,void 0,function(){var r,i,s,o,u,m,p,h,d,g,f,v,x,b=this;return A(this,function(A){switch(A.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,o=r.device,u=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",u?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(c.g)(o.moncondevice),d=Object(c.g)(o.rdfsLabel)),f=p.find(function(t){return t.graphName==e}),v=Object(y.F)(12),f&&f.ontology&&(v=f.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(x).then(function(){b.fetchGraphYAxisSettings()})];case 1:return A.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return b(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return A(this,function(o){switch(o.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(c.g)(r.moncondevice),[4,Object(l.a)(t,i)];case 1:return s=o.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});i&&Object(c.g)(i.point)&&Object(c.g)(i.relatedEquipment)&&!(r&&r.length&&r.find(function(e){return e.value==Object(c.g)(i.relatedEquipment)}))&&r.push({value:Object(c.g)(i.relatedEquipment),label:Object(c.g)(i.relatedEquipmentLabel),space:Object(c.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return b(e,void 0,void 0,function(){var e,t,a,n,r,i,u,m,p,h,g,y,v,x,b,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T,B,Y,H=this;return A(this,function(A){switch(A.label){case 0:return e=this.props,t=e.from,a=e.to,n=e.device,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,m=e.isEquipment,p=e.equipment,h=e.isGraphLoaded,g=e.showAllGraphs,y=this.state,v=y.grid,x=y.lastUpdatedAt,b=y.graphYAxisSettings,E=[],D=[],m&&(D=u.filter(function(e){return Object(c.g)(e.relatedEquipment)==p.ontology})),n&&n.moncondevice?(w=Object(c.g)(n.moncontype),S=Object(c.g)(n.topic),_=Object(c.g)(n.firmwareVersion),O=Object(c.g)(n.csbCallibration)?parseInt(Object(c.g)(n.csbCallibration)):0,V=f.b.filter(function(e){return w.toLowerCase().indexOf(e.type.toLowerCase())>-1}),L=f.c.filter(function(e){return w.toLowerCase().indexOf(e.type.toLowerCase())>-1}),P=[],!m||m&&D.length?[4,Object(s.d)(S,t,a,!1)]:[3,2]):[3,3];case 1:P=A.sent(),A.label=2;case 2:if(N={temp_celsius:[L.find(function(e){return"temp_celsius"==e.sensedKey}).des],relhumidity_pct:[L.find(function(e){return"relhumidity_pct"==e.sensedKey}).des],altitude_m:[L.find(function(e){return"altitude_m"==e.sensedKey}).des],equiCO2_ppm:[L.find(function(e){return"equiCO2_ppm"==e.sensedKey}).des],tvoc_ppm:[L.find(function(e){return"tvoc_ppm"==e.sensedKey}).des],gasResistance_kOhm:[L.find(function(e){return"gasResistance_kOhm"==e.sensedKey}).des],illuminance_lux:[L.find(function(e){return"illuminance_lux"==e.sensedKey}).des],motion_sensed:[L.find(function(e){return"motion_sensed"==e.sensedKey}).des],num_BTdev:[L.find(function(e){return"num_BTdev"==e.sensedKey}).des],pressure_hPa:[L.find(function(e){return"pressure_hPa"==e.sensedKey}).des]},R=["x"],N.temp_celsius.push(null),N.relhumidity_pct.push(null),N.altitude_m.push(null),N.equiCO2_ppm.push(null),N.tvoc_ppm.push(null),N.gasResistance_kOhm.push(null),N.illuminance_lux.push(null),N.motion_sensed.push(null),N.num_BTdev.push(null),N.pressure_hPa.push(null),R.push(new Date(t)),P.length>0&&P.forEach(function(e){e&&(N.temp_celsius.push(Object(o.a)(e.temp_celsius,_||"",O)),N.relhumidity_pct.push(e.relhumidity_pct||"0"),N.altitude_m.push(e.altitude_m||"0"),N.equiCO2_ppm.push(e.equiCO2_ppm||"0"),N.tvoc_ppm.push(e.tvoc_ppm||"0"),N.pressure_hPa.push(e.pressure_hPa||"0"),N.gasResistance_kOhm.push(e.gasResistance_kOhm||"0"),N.illuminance_lux.push(e.illuminance_lux||"0"),N.motion_sensed.push(e.motion_sensed||"0"),N.num_BTdev.push(e.num_BTdev||"0"),R.push(new Date(e.timestamp)))}),x=P.length>0?null===(Y=R[R.length-1])||void 0===Y?void 0:Y.toLocaleString():"No Data",0===P.length&&(N.temp_celsius.push(null),N.relhumidity_pct.push(null),N.altitude_m.push(null),N.equiCO2_ppm.push(null),N.tvoc_ppm.push(null),N.gasResistance_kOhm.push(null),N.illuminance_lux.push(null),N.motion_sensed.push(null),N.num_BTdev.push(null),N.pressure_hPa.push(null),R.push(new Date(a))),R.length>1){if(j=Object(l.c)(5,t,a),k="",j.length>1?(K=((new Date).getTime()-j[0].getTime())/1e3,k=(K/=3600)>24?"%m-%d %H:%M":K<.3?"%H:%M:%S":"%H:%M"):k="%H:%M:%S",v.x.lines=[],j.forEach(function(e){v.x.lines.push({value:e,class:"grid4"})}),m){for((F=JSON.parse(JSON.stringify(f.a))).name="Ceiling Sensor",F.graphData.columns=[R],F.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},F.axis.x.tick.format=k,F.axis.x.tick.values=j,F.graphData.x="x",B=0;B<D.length;B++)C=D[B],G=Object(c.g)(C.sensedValue),F.sensedKeys.push(G),F.graphData.columns.push(N[""+G]);F.graphEquipment=this.fetchEquipmentFromPoints(F.name,F.sensedKeys),V.find(function(e){return e.name==F.name})&&(F.axis.y.tick.values=V.find(function(e){return e.name==F.name}).value,F.axis.y.min=F.axis.y.tick.values[0],F.axis.y.max=F.axis.y.tick.values[F.axis.y.tick.values.length-1]),b&&b.length&&(q=b.find(function(e){return e.graphName==F.name}))&&q.yAxisSettings&&("Fixed"==q.yAxisSettings?(delete F.axis.y.tick.values,F.axis.y.min=q.yAxisMin,F.axis.y.max=q.yAxisMax):"Floating"==q.yAxisSettings&&(delete F.axis.y.tick.values,delete F.axis.y.max,delete F.axis.y.min),F.yAxisSettings=q.yAxisSettings,F.yAxisFixedValues={max:q.yAxisMax,min:q.yAxisMin}),E.push(F)}else for(M=function(e){var t=i[e],a=JSON.parse(JSON.stringify(f.a)),n=0,r=[];if(a.name=t,"Temp & Humidity"==t?(a.axis.y.label="\xb0F / %",n=1,a.sensedKeys=["temp_celsius","relhumidity_pct"],r=[R,N.temp_celsius,N.relhumidity_pct]):"Pressure"==t?(a.axis.y.label="hPa",a.sensedKeys=["pressure_hPa"],r=[R,N.pressure_hPa]):"Illuminance"==t?(a.axis.y.label="Lux",a.sensedKeys=["illuminance_lux"],r=[R,N.illuminance_lux]):"Gas Resistance"==t?(a.axis.y.label="kOhm",a.sensedKeys=["gasResistance_kOhm"],r=[R,N.gasResistance_kOhm]):"Air Particles"==t?(a.axis.y.label="PPM",a.sensedKeys=["equiCO2_ppm","tvoc_ppm"],r=[R,N.equiCO2_ppm,N.tvoc_ppm]):"Other Parameters"==t&&(a.axis.y.label="",a.sensedKeys=["motion_sensed","num_BTdev"],r=[R,N.motion_sensed,N.num_BTdev]),V.find(function(e){return e.name==t})&&(a.axis.y.tick.values=V.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),b&&b.length){var s=b.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=k,a.axis.x.tick.values=j,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=T.fetchEquipmentFromPoints(t,a.sensedKeys),E.push(a)},T=this,B=0;B<i.length;B++)M(B);this.props.loadNextInsight(),Object(d.h)(S,this.callLiveUpdate),this.setState({grid:v,graphData:E,lastUpdatedAt:x,loading:!1},function(){h(!!g||P.length>0),r&&H.changeAlarmStatus(!0)})}A.label=3;case 3:return[2]}})})})},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,l=this.props,u=l.device,m=l.showAlarmPoints,p=new Date,h=Object(c.g)(u.firmwareVersion),d=Object(c.g)(u.csbCallibration)?parseInt(Object(c.g)(u.csbCallibration)):0,g=Object(c.g)(u.moncontype),y=f.c.filter(function(e){return g.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(p=new Date(e["@timestamp"]));var v=this.props.liveGraphRange;if(r&&r.length&&p){for(var x=0;x<r.length;x++){var b=r[x],A=b.graphData.columns.map(function(e){return e[0]});if(b.graphData.columns&&b.graphData.columns.length){if(b.graphData.columns[0].push(p),e&&Object.keys(e).length)for(var E=Object.keys(e),D=function(a){var n=E[a];if(b.sensedKeys&&b.sensedKeys.length&&b.sensedKeys.find(function(e){return e==n})){var r=null===(t=y.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=A.findIndex(function(e){return e==r});"temp_celsius"==n?b.graphData.columns[i].push(Object(o.a)(null===e||void 0===e?void 0:e.temp_celsius,h||"",d)):b.graphData.columns[i].push(e[n]),b.graphData.columns[i].splice(1,1)}}},w=0;w<E.length;w++)D(w);(p.getTime()-b.graphData.columns[0][2].getTime())/6e4>v&&b.graphData.columns[0].splice(1,1),b.axis.x.tick.values[2]&&b.axis.x.tick.values[1].getTime()&&b.axis.x.tick.values[2].getTime()-b.axis.x.tick.values[1].getTime()<p.getTime()-b.axis.x.tick.values[b.axis.x.tick.values.length-1]&&(b.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),p.setSeconds(0),v>10&&p.setMinutes(p.getMinutes()-p.getMinutes()%5),b.axis.x.tick.values.push(p),i.x.lines.push({value:p,class:"grid4"}))}}var S=null===p||void 0===p?void 0:p.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:S},function(){if(m){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,l=t.enableYAxis,u=this.props,m=u.instance,p=u.buildingName,h=u.device,d=u.showAlarmPoints,g=u.insightRelEquipment,f=u.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,u,f="";return d&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(d||l)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),l&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CeilingSensor/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:d&&(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=E},2970:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(707),o=a(837),l=a(124),u=a(760),c=(a.n(u),a(11)),m=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),p=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},h=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},d=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:{x:"x",columns:[]},grid:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{fit:!1,count:5,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,lastUpdatedAt:"No Data"},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return m(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){var e=this;return h(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return p(this,void 0,void 0,function(){var e,t=this;return h(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(c.g)(e)&&Object(l.g)(Object(c.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(){},t.prototype.callLiveUpdate=function(e){var t,a=this.state,n=a.graphData,r=a.axis1,i=a.grid;e["@timestamp"]&&(t=new Date(e["@timestamp"]),t=new Date(t.setHours(t.getHours()+10)));var s=this.props.liveGraphRange;if(n.columns.length>1&&t){n.columns[0].splice(1,1),n.columns[0].push(t),n.columns[1].splice(1,1),n.columns[1].push(null===e||void 0===e?void 0:e.setpoint),n.columns[2].splice(1,1),n.columns[2].push(null===e||void 0===e?void 0:e.roomtemp),n.columns[3].splice(1,1),n.columns[3].push(null===e||void 0===e?void 0:e.fanspeed),n.columns[4].splice(1,1),n.columns[4].push(null===e||void 0===e?void 0:e.horizontalvans),n.columns[5].splice(1,1),n.columns[5].push(null===e||void 0===e?void 0:e.usermode),n.columns[6].splice(1,1),n.columns[6].push(null===e||void 0===e?void 0:e.verticalvans),n.columns[7].splice(1,1),n.columns[7].push(null===e||void 0===e?void 0:e.wifiSignal),(t.getTime()-n.columns[0][2].getTime())/6e4>s&&n.columns[0].splice(1,1),r.x.tick.values[2]&&r.x.tick.values[1].getTime()&&r.x.tick.values[2].getTime()-r.x.tick.values[1].getTime()<t.getTime()-r.x.tick.values[r.x.tick.values.length-1]&&(r.x.tick.values.splice(0,1),i.x.lines.splice(0,1),t.setSeconds(0),s>10&&t.setMinutes(t.getMinutes()-t.getMinutes()%5),r.x.tick.values.push(t),i.x.lines.push({value:t,class:"grid4"}));var o=null===t||void 0===t?void 0:t.toLocaleString();this.setState({grid:i,axis1:r,graphData:n,lastUpdatedAt:o})}},t.prototype._fetchData=function(){var e;return p(this,void 0,void 0,function(){var t,a,n,r,i,u,m,p,d,g,f,y,v,x,b,A,E,D,w,S,_,O,V,L;return h(this,function(h){switch(h.label){case 0:return t=this.props,a=t.device,n=t.from,r=t.to,i=t.isGraphLoaded,u=t.showAllGraphs,m=this.state,p=m.grid,d=m.axis1,g=m.graphData,f=m.lastUpdatedAt,a&&a.moncondevice?(y=Object(c.g)(a.topic),[4,Object(s.e)(y,n,r,g.columns.length>1)]):[3,2];case 1:v=h.sent(),x=["setpoint"],A=["mode"],E=["fanspeed"],D=["horizontalvans"],w=["verticalvans"],S=["wifiSignal"],_=["x"],(b=["roomtemp"]).push(null),x.push(null),E.push(null),D.push(null),A.push(null),w.push(null),S.push(null),_.push(new Date(n)),v.length>0&&v.forEach(function(e){e&&(1!=isNaN(e.roomtemp)&&b.push(e.roomtemp),1!=isNaN(e.setpoint)&&x.push(e.setpoint),e.fanspeed?E.push(e.fanspeed):E.push("undefined"),e.horizontalvans?D.push(e.horizontalvans):D.push("undefined"),e.usermode?A.push(e.usermode):A.push("undefined"),e.verticalvans?w.push(e.verticalvans):w.push("undefined"),e.wifiSignal?S.push(e.wifiSignal):S.push("undefined"),_.push(new Date(e.timestamp)))}),f=v.length>0?null===(e=_[_.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",b.push(null),x.push(null),E.push(null),D.push(null),A.push(null),w.push(null),S.push(null),_.push(new Date(r)),g={x:"x",columns:[_,x,b,E,D,A,w,S]},d.y.label="\xb0F",O=Object(o.c)(5,n,r),V="",O.length>1?(L=((new Date).getTime()-O[0].getTime())/1e3,V=(L/=3600)>24?"%m-%d %H:%M":L<.3?"%H:%M:%S":"%H:%M"):V="%H:%M:%S",p.x.lines=[],O.forEach(function(e){p.x.lines.push({value:e,class:"grid4"})}),d.y.tick.format=function(e){return parseFloat(e).toFixed(2)},d.y.tick.values=[0,20,40,60,80,100],d.y.max=100,d.y.min=0,d.x.tick.format=V,d.x.tick.values=O,this.props.loadNextInsight(),Object(l.h)(y,this.callLiveUpdate),this.setState({grid:p,axis1:d,graphData:g,loading:!1,lastUpdatedAt:f},function(){i(!!u||v.length>0)}),h.label=2;case 2:return[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData,r=e.axis1,s=e.grid,o=e.lastUpdatedAt,l=this.props,u=l.instance,m=l.buildingName,p=l.device,h=l.equipment,d=l.showAllGraphs;return"No Data"!=o||d?n.createElement("div",{className:"row col-md-12 device-graphs",id:"divGraphs"},n.createElement("br",null),n.createElement("h5",{className:"no-padding no-margin-color-textalign tooltipDashboard graphHeading"},n.createElement("a",{className:"col-md-8 sentence-break",onClick:function(){window.location.hash=u+"/"+m+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(c.g)(p.moncondevice)}},h.length>0&&h[0].rdfsLabel?h[0].rdfsLabel:"No equipment assigned"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Space: ",Object(c.g)(p.spaceRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Equipment: ",null===h||void 0===h?void 0:h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(p.rdfsLabel)||"No device assigned"," ")),n.createElement("span",{className:"lastUpdated"},"Last: ",o)),t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(i.a,{data:a,size:{height:300},axis:r,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0},colors:{spaceTemp:"red",cooltemp:"blue",fan:"pink"}})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=d},2971:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(715),o=a(837),l=a(124),u=a(760),c=(a.n(u),a(11)),m=a(838),p=a(857),h=a(122),d=a(736),g=a(797),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(c.g)(e)&&Object(l.g)(Object(c.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,o,l,u,m,p,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(h.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(g.e)(d.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(s.moncondevice)],null)]);case 1:return l=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,m=new Date(u[0][1]),l=l.filter(function(e){return new Date(e.timeofalarm)>m})),this.setState({alarmSensedPoints:o,deviceAlarms:l},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(p=[],f=0;f<t.length;f++)y=t[f],p.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:p}),x.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,u=s.graphData,c=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},c){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(c.minimumExtremeValue),y.push(c.minimumNormalValue),x.push(c.maximumNormalValue),b.push(c.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!c.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!c.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!c.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!c.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=c,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=m.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,o=this.props.device,l=new Date,u=Object(c.g)(o.moncontype),m=p.c.filter(function(e){return u.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(l=new Date(e["@timestamp"]));var h=this.props,d=h.liveGraphRange,g=h.showAlarmPoints;if(r&&r.length&&l){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=m.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(l.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<l.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),d>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),y.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var E=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(g){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return b(this,function(l){switch(l.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(c.g)(r.moncontype),(s=p.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return l.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,l,u,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,l=r.device,u=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",u?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(c.g)(l.moncondevice),d=Object(c.g)(l.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(l){switch(l.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(c.g)(r.moncondevice),[4,Object(o.a)(t,i)];case 1:return s=l.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(c.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(c.g)(i.relatedEquipment)})||r.push({value:Object(c.g)(i.relatedEquipment),label:Object(c.g)(i.relatedEquipmentLabel),space:Object(c.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,m,h,d,g,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.devicePoints,i=e.isEquipment,u=e.equipment,m=e.showAlarmPoints,h=e.isGraphLoaded,d=e.showAllGraphs,g=this.state,f=g.grid,y=g.lastUpdatedAt,v=g.graphYAxisSettings,x=[],A=[],i&&(A=r.filter(function(e){return Object(c.g)(e.relatedEquipment)==u.ontology})),t&&t.moncondevice?(E=Object(c.g)(t.moncontype),D=Object(c.g)(t.topic),w=p.b.filter(function(e){return E.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=p.c.filter(function(e){return E.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=[],!i||i&&A.length?[4,Object(s.j)(D,a,n,!1)]:[3,2]):[3,3];case 1:_=b.sent(),b.label=2;case 2:if(O={Normal_Frequency:[S.find(function(e){return"Normal_Frequency"==e.sensedKey}).des],Emergency_Frequency:[S.find(function(e){return"Emergency_Frequency"==e.sensedKey}).des]},V=["x"],O.Normal_Frequency.push(null),O.Emergency_Frequency.push(null),V.push(new Date(a)),_.length>0&&_.forEach(function(e){e&&(O.Normal_Frequency.push(e.Normal_Frequency||"0"),O.Emergency_Frequency.push(e.Emergency_Frequency||"0"),V.push(new Date(e.timestamp)))}),y=_.length>0?null===(q=V[V.length-1])||void 0===q?void 0:q.toLocaleString():"No Data",O.Normal_Frequency.push(null),O.Emergency_Frequency.push(null),V.push(new Date(n)),V.length>1){if(L=Object(o.c)(5,a,n),P="",L.length>1?(N=((new Date).getTime()-L[0].getTime())/1e3,P=(N/=3600)>24?"%m-%d %H:%M":N<.3?"%H:%M:%S":"%H:%M"):P="%H:%M:%S",f.x.lines=[],L.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),i){for((R=JSON.parse(JSON.stringify(p.a))).name="ATS Frequency",R.graphData.columns=[V],R.graphData.x="x",G=0;G<A.length;G++)j=A[G],k=Object(c.g)(j.sensedValue),R.sensedKeys.push(k),R.graphData.columns.push(O[""+k]);w.find(function(e){return e.name==R.name})&&(R.axis.y.tick.values=w.find(function(e){return e.name==R.name}).value,R.axis.y.min=R.axis.y.tick.values[0],R.axis.y.max=R.axis.y.tick.values[R.axis.y.tick.values.length-1]),v&&v.length&&(K=v.find(function(e){return e.graphName==R.name}))&&K.yAxisSettings&&("Fixed"==K.yAxisSettings?(delete R.axis.y.tick.values,R.axis.y.min=K.yAxisMin,R.axis.y.max=K.yAxisMax):"Floating"==K.yAxisSettings&&(delete R.axis.y.tick.values,delete R.axis.y.max,delete R.axis.y.min),R.yAxisSettings=K.yAxisSettings,R.yAxisFixedValues={max:K.yAxisMax,min:K.yAxisMin}),R.axis.y.label="Hz",R.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},R.axis.x.tick.format=P,R.axis.x.tick.values=L,R.graphEquipment=this.fetchEquipmentFromPoints(R.name,R.sensedKeys),x.push(R)}else for(F=function(e){var t,a="ATS Frequency",n=JSON.parse(JSON.stringify(p.a));if(n.name=a,n.axis.y.label="Hz",2,n.sensedKeys=["Normal_Frequency","Emergency_Frequency"],t=[V,O.Normal_Frequency,O.Emergency_Frequency],w.find(function(e){return e.name==a})&&(n.axis.y.tick.values=w.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),v&&v.length){var r=v.find(function(e){return e.graphName==a});r&&r.yAxisSettings&&("Fixed"==r.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=r.yAxisMin,n.axis.y.max=r.yAxisMax):"Floating"==r.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=r.yAxisSettings,n.yAxisFixedValues={max:r.yAxisMax,min:r.yAxisMin})}n.axis.y.tick.format=function(e){return parseFloat(e).toFixed(2)},n.axis.x.tick.format=P,n.axis.x.tick.values=L,n.graphData.x="x",n.graphData.columns=t,n.graphEquipment=C.fetchEquipmentFromPoints(a,n.sensedKeys),x.push(n)},C=this,G=0;G<1;G++)F(G);this.props.loadNextInsight(),Object(l.h)(D,this.callLiveUpdate),this.setState({grid:f,graphData:x,lastUpdatedAt:y,loading:!1},function(){h(!!d||_.length>0),m&&M.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,l=t.enableYAxis,u=this.props,m=u.instance,p=u.buildingName,h=u.device,d=u.insightRelEquipment,g=u.showAlarmPoints,f=u.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,u="";return g&&t.alarmStatus&&("active"==t.alarmStatus?u="alarm-graph":"ack"==t.alarmStatus?u="alarm-ack-graph":"clear"==t.alarmStatus&&(u="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+u,id:"divGraphs"},n.createElement("br",null),(g||l)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),l&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/ATS/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2972:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(715),o=a(837),l=a(11),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,o,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(s.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,o=this.props,u=o.showAlarmPoints,c=o.device,m=new Date,p=Object(l.g)(c.moncontype),h=g.c.filter(function(e){return p.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(m=new Date(e["@timestamp"]));var d=this.props.liveGraphRange;if(r&&r.length&&m){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=h.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(m.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<m.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),m.setSeconds(0),d>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),y.axis.x.tick.values.push(m),i.x.lines.push({value:m,class:"grid4"}))}}var E=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(u){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(l.g)(r.moncontype),(s=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(l.g)(u.moncondevice),d=Object(l.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(l.g)(r.moncondevice),[4,Object(o.a)(t,i)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,d=e.showAllGraphs,f=this.state,y=f.grid,v=f.graphData,x=f.lastUpdatedAt,A=f.graphYAxisSettings,E=[],c&&(E=u.filter(function(e){return Object(l.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(D=Object(l.g)(t.moncontype),w=Object(l.g)(t.topic),S=g.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=g.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),O=[],!c||c&&E.length?[4,Object(s.m)(w,a,n,!1)]:[3,2]):[3,3];case 1:O=b.sent(),b.label=2;case 2:if(V={GenVAB_Volts:[_.find(function(e){return"GenVAB_Volts"==e.sensedKey}).des],GenVBC_Volts:[_.find(function(e){return"GenVBC_Volts"==e.sensedKey}).des],GenVCA_Volts:[_.find(function(e){return"GenVCA_Volts"==e.sensedKey}).des],GenVAN_Volts:[_.find(function(e){return"GenVAN_Volts"==e.sensedKey}).des],GenVBN_Volts:[_.find(function(e){return"GenVBN_Volts"==e.sensedKey}).des],GenVCN_Volts:[_.find(function(e){return"GenVCN_Volts"==e.sensedKey}).des],BusVoltage_Volts:[_.find(function(e){return"BusVoltage_Volts"==e.sensedKey}).des],GenIA_Amps:[_.find(function(e){return"GenIA_Amps"==e.sensedKey}).des],GenIB_Amps:[_.find(function(e){return"GenIB_Amps"==e.sensedKey}).des],GenIC_Amps:[_.find(function(e){return"GenIC_Amps"==e.sensedKey}).des],GenKVA_A_KiloVA:[_.find(function(e){return"GenKVA_A_KiloVA"==e.sensedKey}).des],GenKVA__B_KiloVA:[_.find(function(e){return"GenKVA__B_KiloVA"==e.sensedKey}).des],GenKVA_C_KiloVA:[_.find(function(e){return"GenKVA_C_KiloVA"==e.sensedKey}).des],GenKVA_Total_KiloVA:[_.find(function(e){return"GenKVA_Total_KiloVA"==e.sensedKey}).des],Gen_A_kW:[_.find(function(e){return"Gen_A_kW"==e.sensedKey}).des],Gen_B_kW:[_.find(function(e){return"Gen_B_kW"==e.sensedKey}).des],Gen_C_kW:[_.find(function(e){return"Gen_C_kW"==e.sensedKey}).des],Gen_Total_kW:[_.find(function(e){return"Gen_Total_kW"==e.sensedKey}).des],GenPFLagging:[_.find(function(e){return"GenPFLagging"==e.sensedKey}).des],ActiveSpeedSource:[_.find(function(e){return"ActiveSpeedSource"==e.sensedKey}).des],EngineSpeed_rpm:[_.find(function(e){return"EngineSpeed_rpm"==e.sensedKey}).des],EngineLoad_pct:[_.find(function(e){return"EngineLoad_pct"==e.sensedKey}).des],CoolantTemp_F:[_.find(function(e){return"CoolantTemp_F"==e.sensedKey}).des],OilPressure_psi:[_.find(function(e){return"OilPressure_psi"==e.sensedKey}).des],BatteryVoltage_DeciVolt:[_.find(function(e){return"BatteryVoltage_DeciVolt"==e.sensedKey}).des],FuelLevel:[_.find(function(e){return"FuelLevel"==e.sensedKey}).des],ECUCoolantLevel:[_.find(function(e){return"ECUCoolantLevel"==e.sensedKey}).des],CoolDownTimeRemaining_mins:[_.find(function(e){return"CoolDownTimeRemaining_mins"==e.sensedKey}).des],UnexpectedShutdown:[_.find(function(e){return"UnexpectedShutdown"==e.sensedKey}).des],GlobalAlarm:[_.find(function(e){return"GlobalAlarm"==e.sensedKey}).des],AutoRestartFailure:[_.find(function(e){return"AutoRestartFailure"==e.sensedKey}).des],FuelLeakDetect:[_.find(function(e){return"FuelLeakDetect"==e.sensedKey}).des],BatteryChargerFailure:[_.find(function(e){return"BatteryChargerFailure"==e.sensedKey}).des],TransferFail:[_.find(function(e){return"TransferFail"==e.sensedKey}).des],LowCoolantLevel:[_.find(function(e){return"LowCoolantLevel"==e.sensedKey}).des],ECUShutdown:[_.find(function(e){return"ECUShutdown"==e.sensedKey}).des],EmergencyShutdown:[_.find(function(e){return"EmergencyShutdown"==e.sensedKey}).des],Overcrank:[_.find(function(e){return"Overcrank"==e.sensedKey}).des],LossofECUComms:[_.find(function(e){return"LossofECUComms"==e.sensedKey}).des],GlobalSenderFail:[_.find(function(e){return"GlobalSenderFail"==e.sensedKey}).des],LowFuelLevel:[_.find(function(e){return"LowFuelLevel"==e.sensedKey}).des],LowOilPressure:[_.find(function(e){return"LowOilPressure"==e.sensedKey}).des],HighCoolantTemp:[_.find(function(e){return"HighCoolantTemp"==e.sensedKey}).des]},L=["x"],V.GenVAB_Volts.push(null),V.GenVBC_Volts.push(null),V.GenVCA_Volts.push(null),V.GenVAN_Volts.push(null),V.GenVBN_Volts.push(null),V.GenVCN_Volts.push(null),V.BusVoltage_Volts.push(null),V.GenIA_Amps.push(null),V.GenIB_Amps.push(null),V.GenIC_Amps.push(null),V.GenKVA_A_KiloVA.push(null),V.GenKVA__B_KiloVA.push(null),V.GenKVA_C_KiloVA.push(null),V.GenKVA_Total_KiloVA.push(null),V.Gen_A_kW.push(null),V.Gen_B_kW.push(null),V.Gen_C_kW.push(null),V.Gen_Total_kW.push(null),V.GenPFLagging.push(null),V.ActiveSpeedSource.push(null),V.EngineSpeed_rpm.push(null),V.EngineLoad_pct.push(null),V.CoolantTemp_F.push(null),V.OilPressure_psi.push(null),V.BatteryVoltage_DeciVolt.push(null),V.FuelLevel.push(null),V.ECUCoolantLevel.push(null),V.CoolDownTimeRemaining_mins.push(null),V.UnexpectedShutdown.push(null),V.GlobalAlarm.push(null),V.AutoRestartFailure.push(null),V.FuelLeakDetect.push(null),V.BatteryChargerFailure.push(null),V.TransferFail.push(null),V.LowCoolantLevel.push(null),V.ECUShutdown.push(null),V.EmergencyShutdown.push(null),V.Overcrank.push(null),V.LossofECUComms.push(null),V.GlobalSenderFail.push(null),V.LowFuelLevel.push(null),V.LowOilPressure.push(null),V.HighCoolantTemp.push(null),L.push(new Date(a)),O.length>0&&O.forEach(function(e){e&&(V.GenVAB_Volts.push(e.GenVAB_Volts||0),V.GenVBC_Volts.push(e.GenVBC_Volts||0),V.GenVCA_Volts.push(e.GenVCA_Volts||0),V.GenVAN_Volts.push(e.GenVAN_Volts||0),V.GenVBN_Volts.push(e.GenVBN_Volts||0),V.GenVCN_Volts.push(e.GenVCN_Volts||0),V.BusVoltage_Volts.push(e.BusVoltage_Volts||0),V.GenIA_Amps.push(e.GenIA_Amps||0),V.GenIB_Amps.push(e.GenIB_Amps||0),V.GenIC_Amps.push(e.GenIC_Amps||0),V.GenKVA_A_KiloVA.push(e.GenKVA_A_KiloVA||0),V.GenKVA__B_KiloVA.push(e.GenKVA__B_KiloVA||0),V.GenKVA_C_KiloVA.push(e.GenKVA_C_KiloVA||0),V.GenKVA_Total_KiloVA.push(e.GenKVA_Total_KiloVA||0),V.Gen_A_kW.push(e.Gen_A_kW||0),V.Gen_B_kW.push(e.Gen_B_kW||0),V.Gen_C_kW.push(e.Gen_C_kW||0),V.Gen_Total_kW.push(e.Gen_Total_kW||0),V.GenPFLagging.push(e.GenPFLagging||0),V.ActiveSpeedSource.push(e.ActiveSpeedSource||0),V.EngineSpeed_rpm.push(e.EngineSpeed_rpm||0),V.EngineLoad_pct.push(e.EngineLoad_pct||0),V.CoolantTemp_F.push(e.CoolantTemp_F||0),V.OilPressure_psi.push(e.OilPressure_psi||0),V.BatteryVoltage_DeciVolt.push(e.BatteryVoltage_DeciVolt||0),V.FuelLevel.push(e.FuelLevel||0),V.ECUCoolantLevel.push(e.ECUCoolantLevel||0),V.CoolDownTimeRemaining_mins.push(e.CoolDownTimeRemaining_mins||0),V.UnexpectedShutdown.push(e.UnexpectedShutdown||0),V.GlobalAlarm.push(e.GlobalAlarm||0),V.AutoRestartFailure.push(e.AutoRestartFailure||0),V.FuelLeakDetect.push(e.FuelLeakDetect||0),V.BatteryChargerFailure.push(e.BatteryChargerFailure||0),V.TransferFail.push(e.TransferFail||0),V.LowCoolantLevel.push(e.LowCoolantLevel||0),V.ECUShutdown.push(e.ECUShutdown||0),V.EmergencyShutdown.push(e.EmergencyShutdown||0),V.Overcrank.push(e.Overcrank||0),V.LossofECUComms.push(e.LossofECUComms||0),V.GlobalSenderFail.push(e.GlobalSenderFail||0),V.LowFuelLevel.push(e.LowFuelLevel||0),V.LowOilPressure.push(e.LowOilPressure||0),V.HighCoolantTemp.push(e.HighCoolantTemp||0),L.push(new Date(e.timestamp)))}),x=O.length>0?null===(M=L[L.length-1])||void 0===M?void 0:M.toLocaleString():"No Data",V.GenVAB_Volts.push(null),V.GenVBC_Volts.push(null),V.GenVCA_Volts.push(null),V.GenVAN_Volts.push(null),V.GenVBN_Volts.push(null),V.GenVCN_Volts.push(null),V.BusVoltage_Volts.push(null),V.GenIA_Amps.push(null),V.GenIB_Amps.push(null),V.GenIC_Amps.push(null),V.GenKVA_A_KiloVA.push(null),V.GenKVA__B_KiloVA.push(null),V.GenKVA_C_KiloVA.push(null),V.GenKVA_Total_KiloVA.push(null),V.Gen_A_kW.push(null),V.Gen_B_kW.push(null),V.Gen_C_kW.push(null),V.Gen_Total_kW.push(null),V.GenPFLagging.push(null),V.ActiveSpeedSource.push(null),V.EngineSpeed_rpm.push(null),V.EngineLoad_pct.push(null),V.CoolantTemp_F.push(null),V.OilPressure_psi.push(null),V.BatteryVoltage_DeciVolt.push(null),V.FuelLevel.push(null),V.ECUCoolantLevel.push(null),V.CoolDownTimeRemaining_mins.push(null),V.UnexpectedShutdown.push(null),V.GlobalAlarm.push(null),V.AutoRestartFailure.push(null),V.FuelLeakDetect.push(null),V.BatteryChargerFailure.push(null),V.TransferFail.push(null),V.LowCoolantLevel.push(null),V.ECUShutdown.push(null),V.EmergencyShutdown.push(null),V.Overcrank.push(null),V.LossofECUComms.push(null),V.GlobalSenderFail.push(null),V.LowFuelLevel.push(null),V.LowOilPressure.push(null),V.HighCoolantTemp.push(null),L.push(new Date(n)),L.length>1){if(P=Object(o.c)(5,a,n),N="",P.length>1?(R=((new Date).getTime()-P[0].getTime())/1e3,N=(R/=3600)>24?"%m-%d %H:%M":R<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",y.x.lines=[],P.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((j=JSON.parse(JSON.stringify(g.a))).name="Generator",j.graphData.columns=[L],j.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},j.axis.x.tick.format=N,j.axis.x.tick.values=P,j.graphData.x="x",q=0;q<E.length;q++)k=E[q],K=Object(l.g)(k.sensedValue),j.sensedKeys.push(K),j.graphData.columns.push(V[""+K]);S.find(function(e){return e.name==j.name})&&(j.axis.y.tick.values=S.find(function(e){return e.name==j.name}).value,j.axis.y.min=j.axis.y.tick.values[0],j.axis.y.max=j.axis.y.tick.values[j.axis.y.tick.values.length-1]),A&&A.length&&(F=A.find(function(e){return e.graphName==j.name}))&&F.yAxisSettings&&("Fixed"==F.yAxisSettings?(delete j.axis.y.tick.values,j.axis.y.min=F.yAxisMin,j.axis.y.max=F.yAxisMax):"Floating"==F.yAxisSettings&&(delete j.axis.y.tick.values,delete j.axis.y.max,delete j.axis.y.min),j.yAxisSettings=F.yAxisSettings,j.yAxisFixedValues={max:F.yAxisMax,min:F.yAxisMin}),j.graphEquipment=this.fetchEquipmentFromPoints(j.name,j.sensedKeys),v.push(j)}else for(C=function(e){var t=i[e],a=JSON.parse(JSON.stringify(g.a)),n=0,r=[];if(a.name=t,"Voltages"==t?(a.axis.y.label="Volts",a.sensedKeys=["GenVAB_Volts","GenVBC_Volts","GenVCA_Volts","GenVAN_Volts","GenVBN_Volts","GenVCN_Volts","BusVoltage_Volts"],r=[L,V.GenVAB_Volts,V.GenVBC_Volts,V.GenVCA_Volts,V.GenVAN_Volts,V.GenVBN_Volts,V.GenVCN_Volts,V.BusVoltage_Volts]):"Currents"==t?(a.axis.y.label="Amps",n=1,a.sensedKeys=["GenIA_Amps","GenIB_Amps","GenIC_Amps"],r=[L,V.GenIA_Amps,V.GenIB_Amps,V.GenIC_Amps]):"Powers"==t?(a.axis.y.label="Watts",n=1,a.sensedKeys=["GenKVA_A_KiloVA","GenKVA__B_KiloVA","GenKVA_C_KiloVA","GenKVA_Total_KiloVA","Gen_A_kW","Gen_B_kW","Gen_C_kW","Gen_Total_kW"],r=[L,V.GenKVA_A_KiloVA,V.GenKVA__B_KiloVA,V.GenKVA_C_KiloVA,V.GenKVA_Total_KiloVA,V.Gen_A_kW,V.Gen_B_kW,V.Gen_C_kW,V.Gen_Total_kW]):"Power Factor"==t?(a.axis.y.label="",a.sensedKeys=["GenPFLagging"],r=[L,V.GenPFLagging]):"Other Parameters"==t?(a.axis.y.label="",a.sensedKeys=["ActiveSpeedSource","EngineSpeed_rpm","EngineLoad_pct","CoolantTemp_F","OilPressure_psi","BatteryVoltage_DeciVolt","FuelLevel","ECUCoolantLevel","CoolDownTimeRemaining_mins"],r=[L,V.ActiveSpeedSource,V.EngineSpeed_rpm,V.EngineLoad_pct,V.CoolantTemp_F,V.OilPressure_psi,V.BatteryVoltage_DeciVolt,V.FuelLevel,V.ECUCoolantLevel,V.CoolDownTimeRemaining_mins]):"Binary Parameters"==t&&(a.axis.y.label="",a.sensedKeys=["UnexpectedShutdown","GlobalAlarm","AutoRestartFailure","FuelLeakDetect","BatteryChargerFailure","TransferFail","LowCoolantLevel","ECUShutdown","EmergencyShutdown","Overcrank","LossofECUComms","GlobalSenderFail","LowFuelLevel","LowOilPressure","HighCoolantTemp"],r=[L,V.UnexpectedShutdown,V.GlobalAlarm,V.AutoRestartFailure,V.FuelLeakDetect,V.BatteryChargerFailure,V.TransferFail,V.LowCoolantLevel,V.ECUShutdown,V.EmergencyShutdown,V.Overcrank,V.LossofECUComms,V.GlobalSenderFail,V.LowFuelLevel,V.LowOilPressure,V.HighCoolantTemp]),S.find(function(e){return e.name==t})&&(a.axis.y.tick.values=S.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),A&&A.length){var s=A.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=N,a.axis.x.tick.values=P,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=G.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},G=this,q=0;q<i.length;q++)C(q);this.props.loadNextInsight(),Object(h.h)(w,this.callLiveUpdate),this.setState({grid:y,graphData:v,lastUpdatedAt:x,loading:!1},function(){p(!!d||O.length>0),r&&T.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.showAlarmPoints,g=c.insightRelEquipment,f=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,f="";return d&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/Generator/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:d&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2973:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(715),o=a(837),l=a(11),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(l.g)(r.moncontype),(s=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(l.g)(u.moncondevice),d=Object(l.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(l.g)(r.moncondevice),[4,Object(o.a)(t,i)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,o,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(s.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,o=this.props,u=o.showAlarmPoints,c=o.device,m=Object(l.g)(c.moncontype),p=g.c.filter(function(e){return m.toLowerCase().indexOf(e.type.toLowerCase())>-1}),h=new Date;e["@timestamp"]&&(h=new Date(e["@timestamp"]));var d=this.props.liveGraphRange;if(r&&r.length&&h){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(h),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=p.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(h.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<h.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),h.setSeconds(0),d>10&&h.setMinutes(h.getMinutes()-h.getMinutes()%5),y.axis.x.tick.values.push(h),i.x.lines.push({value:h,class:"grid4"}))}}var E=null===h||void 0===h?void 0:h.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(u){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,d=e.showAllGraphs,f=this.state,y=f.grid,v=f.lastUpdatedAt,x=f.graphYAxisSettings,A=[],E=[],c&&(E=u.filter(function(e){return Object(l.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(D=Object(l.g)(t.moncontype),w=Object(l.g)(t.topic),S=g.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=g.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),O=[],!c||c&&E.length?[4,Object(s.k)(w,a,n,!1)]:[3,2]):[3,3];case 1:O=b.sent(),b.label=2;case 2:if(V={register1:[_.find(function(e){return"register1"==e.sensedKey}).des],t3frontRefrigerator1:[_.find(function(e){return"t3frontRefrigerator1"==e.sensedKey}).des],t4backRefrigerator1:[_.find(function(e){return"t4backRefrigerator1"==e.sensedKey}).des],t5evapfanRefrigerator1:[_.find(function(e){return"t5evapfanRefrigerator1"==e.sensedKey}).des],t6comprinRefrigerator1:[_.find(function(e){return"t6comprinRefrigerator1"==e.sensedKey}).des],t7comproutRefrigerator1:[_.find(function(e){return"t7comproutRefrigerator1"==e.sensedKey}).des],t8probeRefrigerator1:[_.find(function(e){return"t8probeRefrigerator1"==e.sensedKey}).des],t3frontRefrigerator2:[_.find(function(e){return"t3frontRefrigerator2"==e.sensedKey}).des],t4backRefrigerator2:[_.find(function(e){return"t4backRefrigerator2"==e.sensedKey}).des],t5evapfanRefrigerator2:[_.find(function(e){return"t5evapfanRefrigerator2"==e.sensedKey}).des],t6comprinRefrigerator2:[_.find(function(e){return"t6comprinRefrigerator2"==e.sensedKey}).des],t7comproutRefrigerator2:[_.find(function(e){return"t7comproutRefrigerator2"==e.sensedKey}).des],t8probeRefrigerator2:[_.find(function(e){return"t8probeRefrigerator2"==e.sensedKey}).des],t3frontRefrigerator3:[_.find(function(e){return"t3frontRefrigerator3"==e.sensedKey}).des],t4backRefrigerator3:[_.find(function(e){return"t4backRefrigerator3"==e.sensedKey}).des],t5evapfanRefrigerator3:[_.find(function(e){return"t5evapfanRefrigerator3"==e.sensedKey}).des],t6comprinRefrigerator3:[_.find(function(e){return"t6comprinRefrigerator3"==e.sensedKey}).des],t7comproutRefrigerator3:[_.find(function(e){return"t7comproutRefrigerator3"==e.sensedKey}).des],t8probeRefrigerator3:[_.find(function(e){return"t8probeRefrigerator3"==e.sensedKey}).des],t3frontRefrigerator4:[_.find(function(e){return"t3frontRefrigerator4"==e.sensedKey}).des],t4backRefrigerator4:[_.find(function(e){return"t4backRefrigerator4"==e.sensedKey}).des],t5evapfanRefrigerator4:[_.find(function(e){return"t5evapfanRefrigerator4"==e.sensedKey}).des],t6comprinRefrigerator4:[_.find(function(e){return"t6comprinRefrigerator4"==e.sensedKey}).des],t7comproutRefrigerator4:[_.find(function(e){return"t7comproutRefrigerator4"==e.sensedKey}).des],t8probeRefrigerator4:[_.find(function(e){return"t8probeRefrigerator4"==e.sensedKey}).des]},L=["x"],V.register1.push(null),V.t3frontRefrigerator1.push(null),V.t4backRefrigerator1.push(null),V.t5evapfanRefrigerator1.push(null),V.t6comprinRefrigerator1.push(null),V.t7comproutRefrigerator1.push(null),V.t8probeRefrigerator1.push(null),V.t3frontRefrigerator2.push(null),V.t4backRefrigerator2.push(null),V.t5evapfanRefrigerator2.push(null),V.t6comprinRefrigerator2.push(null),V.t7comproutRefrigerator2.push(null),V.t8probeRefrigerator2.push(null),V.t3frontRefrigerator3.push(null),V.t4backRefrigerator3.push(null),V.t5evapfanRefrigerator3.push(null),V.t6comprinRefrigerator3.push(null),V.t7comproutRefrigerator3.push(null),V.t8probeRefrigerator3.push(null),V.t3frontRefrigerator4.push(null),V.t4backRefrigerator4.push(null),V.t5evapfanRefrigerator4.push(null),V.t6comprinRefrigerator4.push(null),V.t7comproutRefrigerator4.push(null),V.t8probeRefrigerator4.push(null),L.push(new Date(a)),O.length>0&&O.forEach(function(e){e&&(V.register1.push(""+e.register1||"0"),V.t3frontRefrigerator1.push(""+e.t3frontRefrigerator1||"0"),V.t4backRefrigerator1.push(""+e.t4backRefrigerator1||"0"),V.t5evapfanRefrigerator1.push(""+e.t5evapfanRefrigerator1||"0"),V.t6comprinRefrigerator1.push(""+e.t6comprinRefrigerator1||"0"),V.t7comproutRefrigerator1.push(""+e.t7comproutRefrigerator1||"0"),V.t8probeRefrigerator1.push(""+e.t8probeRefrigerator1||"0"),V.t3frontRefrigerator2.push(""+e.t3frontRefrigerator2||"0"),V.t4backRefrigerator2.push(""+e.t4backRefrigerator2||"0"),V.t5evapfanRefrigerator2.push(""+e.t5evapfanRefrigerator2||"0"),V.t6comprinRefrigerator2.push(""+e.t6comprinRefrigerator2||"0"),V.t7comproutRefrigerator2.push(""+e.t7comproutRefrigerator2||"0"),V.t8probeRefrigerator2.push(""+e.t8probeRefrigerator2||"0"),V.t3frontRefrigerator3.push(""+e.t3frontRefrigerator3||"0"),V.t4backRefrigerator3.push(""+e.t4backRefrigerator3||"0"),V.t5evapfanRefrigerator3.push(""+e.t5evapfanRefrigerator3||"0"),V.t6comprinRefrigerator3.push(""+e.t6comprinRefrigerator3||"0"),V.t7comproutRefrigerator3.push(""+e.t7comproutRefrigerator3||"0"),V.t8probeRefrigerator3.push(""+e.t8probeRefrigerator3||"0"),V.t3frontRefrigerator4.push(""+e.t3frontRefrigerator4||"0"),V.t4backRefrigerator4.push(""+e.t4backRefrigerator4||"0"),V.t5evapfanRefrigerator4.push(""+e.t5evapfanRefrigerator4||"0"),V.t6comprinRefrigerator4.push(""+e.t6comprinRefrigerator4||"0"),V.t7comproutRefrigerator4.push(""+e.t7comproutRefrigerator4||"0"),V.t8probeRefrigerator4.push(""+e.t8probeRefrigerator4||"0"),L.push(new Date(e.timestamp)))}),v=O.length>0?null===(M=L[L.length-1])||void 0===M?void 0:M.toLocaleString():"No Data",V.register1.push(null),V.t3frontRefrigerator1.push(null),V.t4backRefrigerator1.push(null),V.t5evapfanRefrigerator1.push(null),V.t6comprinRefrigerator1.push(null),V.t7comproutRefrigerator1.push(null),V.t8probeRefrigerator1.push(null),V.t3frontRefrigerator2.push(null),V.t4backRefrigerator2.push(null),V.t5evapfanRefrigerator2.push(null),V.t6comprinRefrigerator2.push(null),V.t7comproutRefrigerator2.push(null),V.t8probeRefrigerator2.push(null),V.t3frontRefrigerator3.push(null),V.t4backRefrigerator3.push(null),V.t5evapfanRefrigerator3.push(null),V.t6comprinRefrigerator3.push(null),V.t7comproutRefrigerator3.push(null),V.t8probeRefrigerator3.push(null),V.t3frontRefrigerator4.push(null),V.t4backRefrigerator4.push(null),V.t5evapfanRefrigerator4.push(null),V.t6comprinRefrigerator4.push(null),V.t7comproutRefrigerator4.push(null),V.t8probeRefrigerator4.push(null),L.push(new Date(n)),L.length>1){if(P=Object(o.c)(5,a,n),N="",P.length>1?(R=((new Date).getTime()-P[0].getTime())/1e3,N=(R/=3600)>24?"%m-%d %H:%M":R<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",y.x.lines=[],P.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((j=JSON.parse(JSON.stringify(g.a))).name="Temperatures",j.graphData.columns=[L],j.graphData.x="x",q=0;q<E.length;q++)k=E[q],K=Object(l.g)(k.sensedValue),j.sensedKeys.push(K),j.graphData.columns.push(V[""+K]);S.find(function(e){return e.name==j.name})&&(j.axis.y.tick.values=S.find(function(e){return e.name==j.name}).value,j.axis.y.min=j.axis.y.tick.values[0],j.axis.y.max=j.axis.y.tick.values[j.axis.y.tick.values.length-1]),x&&x.length&&(F=x.find(function(e){return e.graphName==j.name}))&&F.yAxisSettings&&("Fixed"==F.yAxisSettings?(delete j.axis.y.tick.values,j.axis.y.min=F.yAxisMin,j.axis.y.max=F.yAxisMax):"Floating"==F.yAxisSettings&&(delete j.axis.y.tick.values,delete j.axis.y.max,delete j.axis.y.min),j.yAxisSettings=F.yAxisSettings,j.yAxisFixedValues={max:F.yAxisMax,min:F.yAxisMin}),j.axis.y.label="\xb0F",j.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},j.axis.x.tick.format=N,j.axis.x.tick.values=P,j.graphEquipment=this.fetchEquipmentFromPoints(j.name,j.sensedKeys),A.push(j)}else for(C=function(e){var t=i[e],a=JSON.parse(JSON.stringify(g.a)),n=[];if(a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["register1","t3frontRefrigerator1","t4backRefrigerator1","t5evapfanRefrigerator1","t6comprinRefrigerator1","t7comproutRefrigerator1","t8probeRefrigerator1"],n=[L,V.register1,V.t3frontRefrigerator1,V.t4backRefrigerator1,V.t5evapfanRefrigerator1,V.t6comprinRefrigerator1,V.t7comproutRefrigerator1,V.t8probeRefrigerator1]):"Refrigerator 2"==t?(a.sensedKeys=["register1","t3frontRefrigerator2","t4backRefrigerator2","t5evapfanRefrigerator2","t6comprinRefrigerator2","t7comproutRefrigerator2","t8probeRefrigerator2"],n=[L,V.register1,V.t3frontRefrigerator2,V.t4backRefrigerator2,V.t5evapfanRefrigerator2,V.t6comprinRefrigerator2,V.t7comproutRefrigerator2,V.t8probeRefrigerator2]):"Refrigerator 3"==t?(a.sensedKeys=["register1","t3frontRefrigerator3","t4backRefrigerator3","t5evapfanRefrigerator3","t6comprinRefrigerator3","t7comproutRefrigerator3","t8probeRefrigerator3"],n=[L,V.register1,V.t3frontRefrigerator3,V.t4backRefrigerator3,V.t5evapfanRefrigerator3,V.t6comprinRefrigerator3,V.t7comproutRefrigerator3,V.t8probeRefrigerator3]):"Refrigerator 2"==t&&(a.sensedKeys=["register1","t3frontRefrigerator4","t4backRefrigerator4","t5evapfanRefrigerator4","t6comprinRefrigerator4","t7comproutRefrigerator4","t8probeRefrigerator4"],n=[L,V.register1,V.t3frontRefrigerator4,V.t4backRefrigerator4,V.t5evapfanRefrigerator4,V.t6comprinRefrigerator4,V.t7comproutRefrigerator4,V.t8probeRefrigerator4]),S.find(function(e){return e.name==t})&&(a.axis.y.tick.values=S.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),x&&x.length){var r=x.find(function(e){return e.graphName==t});r&&r.yAxisSettings&&("Fixed"==r.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=r.yAxisMin,a.axis.y.max=r.yAxisMax):"Floating"==r.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=r.yAxisSettings,a.yAxisFixedValues={max:r.yAxisMax,min:r.yAxisMin})}a.axis.y.label="\xb0F",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.x.tick.format=N,a.axis.x.tick.values=P,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=G.fetchEquipmentFromPoints(t,a.sensedKeys),A.push(a)},G=this,q=0;q<i.length;q++)C(q);this.props.loadNextInsight(),Object(h.h)(w,this.callLiveUpdate),this.setState({grid:y,graphData:A,lastUpdatedAt:v,loading:!1},function(){p(!!d||O.length>0),r&&T.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.showAlarmPoints,g=c.insightRelEquipment,f=c.isEquipment,y=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||y?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,y="";return d&&t.alarmStatus&&("active"==t.alarmStatus?y="alarm-graph":"ack"==t.alarmStatus?y="alarm-ack-graph":"clear"==t.alarmStatus&&(y="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+y,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CBW406/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},f?t.name:t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:d&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2974:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(715),o=a(837),l=a(11),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,o,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(s.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,o=this.props,u=o.showAlarmPoints,c=o.device,m=new Date,p=Object(l.g)(c.moncontype),h=g.c.filter(function(e){return p.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(m=new Date(e["@timestamp"]));var d=this.props.liveGraphRange;if(r&&r.length&&m){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=h.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(m.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<m.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),m.setSeconds(0),d>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),y.axis.x.tick.values.push(m),i.x.lines.push({value:m,class:"grid4"}))}}var E=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(u){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(l.g)(r.moncontype),(s=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(l.g)(u.moncondevice),d=Object(l.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(l.g)(r.moncondevice),[4,Object(o.a)(t,i)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T,B,Y,H,W,I,U=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,d=e.showAllGraphs,f=this.state,y=f.grid,v=f.graphData,x=f.lastUpdatedAt,A=f.graphYAxisSettings,E=[],c&&(E=u.filter(function(e){return Object(l.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(D=Object(l.g)(t.moncontype),w=Object(l.g)(t.topic),S=g.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=g.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),O=[],!c||c&&E.length?[4,Object(s.l)(w,a,n,!1)]:[3,2]):[3,3];case 1:O=b.sent(),b.label=2;case 2:if(V={a13comprcurrRefrigerator1:[_.find(function(e){return"a13comprcurrRefrigerator1"==e.sensedKey}).des],a14efmcurrRefrigerator1:[_.find(function(e){return"a14efmcurrRefrigerator1"==e.sensedKey}).des],a15prRefrigerator1:[_.find(function(e){return"a15prRefrigerator1"==e.sensedKey}).des],a16doorRefrigerator1:[_.find(function(e){return"a16doorRefrigerator1"==e.sensedKey}).des],a13comprcurrRefrigerator2:[_.find(function(e){return"a13comprcurrRefrigerator2"==e.sensedKey}).des],a14efmcurrRefrigerator2:[_.find(function(e){return"a14efmcurrRefrigerator2"==e.sensedKey}).des],a15prRefrigerator2:[_.find(function(e){return"a15prRefrigerator2"==e.sensedKey}).des],a16doorRefrigerator2:[_.find(function(e){return"a16doorRefrigerator2"==e.sensedKey}).des],register1:[_.find(function(e){return"register1"==e.sensedKey}).des],serialNumber:[_.find(function(e){return"serialNumber"==e.sensedKey}).des],minRecRefresh:[_.find(function(e){return"minRecRefresh"==e.sensedKey}).des],a13comprcurrRefrigerator3:[_.find(function(e){return"a13comprcurrRefrigerator3"==e.sensedKey}).des],a14efmcurrRefrigerator3:[_.find(function(e){return"a14efmcurrRefrigerator3"==e.sensedKey}).des],a15prRefrigerator3:[_.find(function(e){return"a15prRefrigerator3"==e.sensedKey}).des],a16doorRefrigerator3:[_.find(function(e){return"a16doorRefrigerator3"==e.sensedKey}).des],a13comprcurrRefrigerator4:[_.find(function(e){return"a13comprcurrRefrigerator4"==e.sensedKey}).des],a14efmcurrRefrigerator4:[_.find(function(e){return"a14efmcurrRefrigerator4"==e.sensedKey}).des],a15prRefrigerator4:[_.find(function(e){return"a15prRefrigerator4"==e.sensedKey}).des],a16doorRefrigerator4:[_.find(function(e){return"a16doorRefrigerator4"==e.sensedKey}).des],amalgamatedWattsRefrigerator1:["Amalgamated Watts"],amalgamatedWattsRefrigerator2:["Amalgamated Watts"],amalgamatedWattsRefrigerator3:["Amalgamated Watts"],amalgamatedWattsRefrigerator4:["Amalgamated Watts"]},L=["x"],V.a13comprcurrRefrigerator1.push(null),V.a14efmcurrRefrigerator1.push(null),V.a15prRefrigerator1.push(null),V.a16doorRefrigerator1.push(null),V.a13comprcurrRefrigerator2.push(null),V.a14efmcurrRefrigerator2.push(null),V.a15prRefrigerator2.push(null),V.a16doorRefrigerator2.push(null),V.a13comprcurrRefrigerator3.push(null),V.a14efmcurrRefrigerator3.push(null),V.a15prRefrigerator3.push(null),V.a16doorRefrigerator3.push(null),V.a13comprcurrRefrigerator4.push(null),V.a14efmcurrRefrigerator4.push(null),V.a15prRefrigerator4.push(null),V.a16doorRefrigerator4.push(null),V.register1.push(null),V.serialNumber.push(null),V.minRecRefresh.push(null),V.amalgamatedWattsRefrigerator1.push(null),V.amalgamatedWattsRefrigerator2.push(null),V.amalgamatedWattsRefrigerator3.push(null),V.amalgamatedWattsRefrigerator4.push(null),L.push(new Date(a)),P=!1,N=!1,R=!1,j=!1,O.length>0&&O.forEach(function(e){e&&(V.a13comprcurrRefrigerator1.push(""+e.a13comprcurrRefrigerator1||null),V.a14efmcurrRefrigerator1.push(""+e.a14efmcurrRefrigerator1||null),V.a15prRefrigerator1.push(""+e.a15prRefrigerator1||null),V.a16doorRefrigerator1.push(""+e.a16doorRefrigerator1||null),V.a13comprcurrRefrigerator2.push(""+e.a13comprcurrRefrigerator2||null),V.a14efmcurrRefrigerator2.push(""+e.a14efmcurrRefrigerator2||null),V.a15prRefrigerator2.push(""+e.a15prRefrigerator2||null),V.a16doorRefrigerator2.push(""+e.a16doorRefrigerator2||null),V.a13comprcurrRefrigerator3.push(""+e.a13comprcurrRefrigerator3||null),V.a14efmcurrRefrigerator3.push(""+e.a14efmcurrRefrigerator3||null),V.a15prRefrigerator3.push(""+e.a15prRefrigerator3||null),V.a16doorRefrigerator3.push(""+e.a16doorRefrigerator3||null),V.a13comprcurrRefrigerator4.push(""+e.a13comprcurrRefrigerator4||null),V.a14efmcurrRefrigerator4.push(""+e.a14efmcurrRefrigerator4||null),V.a15prRefrigerator4.push(""+e.a15prRefrigerator4||null),V.a16doorRefrigerator4.push(""+e.a16doorRefrigerator4||null),V.register1.push(""+e.register1||null),V.serialNumber.push(""+e.serialNumber||null),V.minRecRefresh.push(""+e.minRecRefresh||null),V.amalgamatedWattsRefrigerator1.push(""+360*e.a13comprcurrRefrigerator1||"0"),V.amalgamatedWattsRefrigerator2.push(""+360*e.a13comprcurrRefrigerator2||"0"),V.amalgamatedWattsRefrigerator3.push(""+360*e.a13comprcurrRefrigerator3||"0"),V.amalgamatedWattsRefrigerator4.push(""+360*e.a13comprcurrRefrigerator4||"0"),L.push(new Date(e.timestamp)),P=e.a14efmcurrRefrigerator1<-5,N=e.a14efmcurrRefrigerator2<-5,R=e.a14efmcurrRefrigerator3<-5,j=e.a14efmcurrRefrigerator4<-5)}),x=O.length>0?null===(I=L[L.length-1])||void 0===I?void 0:I.toLocaleString():"No Data",V.a13comprcurrRefrigerator1.push(null),V.a14efmcurrRefrigerator1.push(null),V.a15prRefrigerator1.push(null),V.a16doorRefrigerator1.push(null),V.a13comprcurrRefrigerator2.push(null),V.a14efmcurrRefrigerator2.push(null),V.a15prRefrigerator2.push(null),V.a16doorRefrigerator2.push(null),V.a13comprcurrRefrigerator3.push(null),V.a14efmcurrRefrigerator3.push(null),V.a15prRefrigerator3.push(null),V.a16doorRefrigerator3.push(null),V.a13comprcurrRefrigerator4.push(null),V.a14efmcurrRefrigerator4.push(null),V.a15prRefrigerator4.push(null),V.a16doorRefrigerator4.push(null),V.register1.push(null),V.serialNumber.push(null),V.minRecRefresh.push(null),V.amalgamatedWattsRefrigerator1.push(null),V.amalgamatedWattsRefrigerator2.push(null),V.amalgamatedWattsRefrigerator3.push(null),V.amalgamatedWattsRefrigerator4.push(null),L.push(new Date(n)),L.length>1){if(k=Object(o.c)(5,a,n),K="",k.length>1?(F=((new Date).getTime()-k[0].getTime())/1e3,K=(F/=3600)>24?"%m-%d %H:%M":F<.3?"%H:%M:%S":"%H:%M"):K="%H:%M:%S",y.x.lines=[],k.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((C=JSON.parse(JSON.stringify(g.a))).name="Analog Values",C.graphData.columns=[L],C.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},C.axis.x.tick.format=K,C.axis.x.tick.values=k,C.graphData.x="x",G="",W=0;W<E.length;W++)q=E[W],M=Object(l.g)(q.sensedValue),C.sensedKeys.push(M),C.graphData.columns.push(V[""+M]),G=M.substr(M.length-1);C.graphEquipment=this.fetchEquipmentFromPoints(C.name,C.sensedKeys),T="1"==G?P:"2"==G?P:"3"==G?R:"4"==G&&j,S.find(function(e){return e.name==C.name})&&(C.axis.y.tick.values=T?S.find(function(e){return e.name==C.name}).value2:S.find(function(e){return e.name==C.name}).value,C.axis.y.min=C.axis.y.tick.values[0],C.axis.y.max=C.axis.y.tick.values[C.axis.y.tick.values.length-1]),A&&A.length&&(B=A.find(function(e){return e.graphName==C.name}))&&B.yAxisSettings&&("Fixed"==B.yAxisSettings?(delete C.axis.y.tick.values,C.axis.y.min=B.yAxisMin,C.axis.y.max=B.yAxisMax):"Floating"==B.yAxisSettings&&(delete C.axis.y.tick.values,delete C.axis.y.max,delete C.axis.y.min),C.yAxisSettings=B.yAxisSettings,C.yAxisFixedValues={max:B.yAxisMax,min:B.yAxisMin}),C.axis.y.label="Amps,PSI",v.push(C)}else for(Y=function(e){var t=i[e],a=JSON.parse(JSON.stringify(g.a)),n=[];if(a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["a13comprcurrRefrigerator1","a14efmcurrRefrigerator1","a15prRefrigerator1","a16doorRefrigerator1"],n=[L,V.a13comprcurrRefrigerator1,V.a14efmcurrRefrigerator1,V.a15prRefrigerator1,V.a16doorRefrigerator1]):"Refrigerator 2"==t?(a.sensedKeys=["a13comprcurrRefrigerator2","a14efmcurrRefrigerator2","a15prRefrigerator2","a16doorRefrigerator2"],n=[L,V.a13comprcurrRefrigerator2,V.a14efmcurrRefrigerator2,V.a15prRefrigerator2,V.a16doorRefrigerator2]):"Refrigerator 3"==t?(a.sensedKeys=["a13comprcurrRefrigerator3","a14efmcurrRefrigerator3","a15prRefrigerator3","a16doorRefrigerator3"],n=[L,V.a13comprcurrRefrigerator3,V.a14efmcurrRefrigerator3,V.a15prRefrigerator3,V.a16doorRefrigerator3]):"Refrigerator 4"==t&&(a.sensedKeys=["a13comprcurrRefrigerator4","a14efmcurrRefrigerator4","a15prRefrigerator4","a16doorRefrigerator4"],n=[L,V.a13comprcurrRefrigerator4,V.a14efmcurrRefrigerator4,V.a15prRefrigerator4,V.a16doorRefrigerator4]),S.find(function(e){return e.name==t})){var r=!1;"Refrigerator 1"==t?r=P:"Refrigerator 2"==t?r=N:"Refrigerator 3"==t?r=R:"Refrigerator 4"==t&&(r=j),a.axis.y.tick.values=r?S.find(function(e){return e.name==t}).value2:S.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]}if(A&&A.length){var s=A.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.label="Amps,PSI",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.x.tick.format=K,a.axis.x.tick.values=k,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=H.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},H=this,W=0;W<i.length;W++)Y(W);this.props.loadNextInsight(),Object(h.h)(w,this.callLiveUpdate),this.setState({grid:y,graphData:v,lastUpdatedAt:x,loading:!1},function(){p(!!d||O.length>0),r&&U.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.showAlarmPoints,d=c.device,g=c.insightRelEquipment,f=c.isEquipment,y=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||y?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,y="";return h&&t.alarmStatus&&("active"==t.alarmStatus?y="alarm-graph":"ack"==t.alarmStatus?y="alarm-ack-graph":"clear"==t.alarmStatus&&(y="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+y,id:"divGraphs"},n.createElement("br",null),(h||u)&&n.createElement("div",{className:"alarm-limit-select"},h&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(d.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CompressorControl/"+Object(l.g)(d.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},f?t.name:t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(d.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(d.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(d.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(d.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:h&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2975:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(707),o=a(11),l=a(837),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,l,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(m.a)(!0),i&&!e?[3,2]:(l=[],r&&r.length&&r.forEach(function(e){l.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(s.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,l=n.alarmSensedPoints,u=this.props,c=u.showAlarmPoints,m=u.device,p=new Date,h=Object(o.g)(m.moncontype),d=g.c.filter(function(e){return h.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(p=new Date(e["@timestamp"]));var f=this.props.liveGraphRange,y=Object(s.a)(parseInt(null===e||void 0===e?void 0:e.v4relay_state));3==y.length?y="0"+y:2==y.length?y="00"+y:1==y.length&&(y="000"+y);var v=y[3],x=y[2],b=y[1],A=y[0];if(r&&r.length&&p){for(var E=0;E<r.length;E++){var D=r[E],w=D.graphData.columns.map(function(e){return e[0]});if(D.graphData.columns&&D.graphData.columns.length){if(D.graphData.columns[0].push(p),e&&Object.keys(e).length)for(var S=Object.keys(e),_=function(a){var n=S[a];if(D.sensedKeys&&D.sensedKeys.length&&D.sensedKeys.find(function(e){return e==n}))if("v4relay_state"==n){var r=w.findIndex(function(e){return"Relay 1 State"==e}),i=w.findIndex(function(e){return"Relay 2 State"==e}),s=w.findIndex(function(e){return"Relay 3 State"==e}),o=w.findIndex(function(e){return"Relay 4 State"==e});D.graphData.columns[r].splice(1,1),D.graphData.columns[r].push(v||"0"),D.graphData.columns[i].splice(1,1),D.graphData.columns[i].push(x||"0"),D.graphData.columns[s].splice(1,1),D.graphData.columns[s].push(b||"0"),D.graphData.columns[o].splice(1,1),D.graphData.columns[o].push(A||"0")}else{var l=null===(t=d.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(l){var u=w.findIndex(function(e){return e==l});D.graphData.columns[u].splice(1,1),D.graphData.columns[u].push(e[n])}}},O=0;O<S.length;O++)_(O);(p.getTime()-D.graphData.columns[0][2].getTime())/6e4>f&&D.graphData.columns[0].splice(1,1),D.axis.x.tick.values[2]&&D.axis.x.tick.values[1].getTime()&&D.axis.x.tick.values[2].getTime()-D.axis.x.tick.values[1].getTime()<p.getTime()-D.axis.x.tick.values[D.axis.x.tick.values.length-1]&&(D.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),p.setSeconds(0),f>10&&p.setMinutes(p.getMinutes()-p.getMinutes()%5),D.axis.x.tick.values.push(p),i.x.lines.push({value:p,class:"grid4"}))}}var V=null===p||void 0===p?void 0:p.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:V},function(){if(c){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&l.length>0&&l.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),s=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,s,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(o.g)(r.moncontype),(s=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(o.g)(u.moncondevice),d=Object(o.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(o.g)(r.moncondevice),[4,Object(l.a)(t,i)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(o.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(o.g)(i.relatedEquipment)})||r.push({value:Object(o.g)(i.relatedEquipment),label:Object(o.g)(i.relatedEquipmentLabel),space:Object(o.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T,B,Y,H,W,I=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.devicePoints,u=e.isEquipment,c=e.equipment,m=e.isGraphLoaded,p=e.showAllGraphs,d=this.state,f=d.grid,y=d.graphData,v=d.lastUpdatedAt,x=d.graphYAxisSettings,A=[],u&&(A=i.filter(function(e){return Object(o.g)(e.relatedEquipment)==c.ontology})),t&&t.moncondevice?(E=Object(o.g)(t.moncontype),D=Object(o.g)(t.topic),w=g.b.filter(function(e){return E.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=g.c.filter(function(e){return E.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=[],!u||u&&A.length?[4,Object(s.h)(D,a,n,!1)]:[3,2]):[3,3];case 1:_=b.sent(),b.label=2;case 2:if(O={mAmps_relay1:[S.find(function(e){return"mAmps_relay1"==e.sensedKey}).des],mAmps_relay2:[S.find(function(e){return"mAmps_relay2"==e.sensedKey}).des],mAmps_relay3:[S.find(function(e){return"mAmps_relay3"==e.sensedKey}).des],mAmps_relay4:[S.find(function(e){return"mAmps_relay4"==e.sensedKey}).des],nominal_src_volts:[S.find(function(e){return"nominal_src_volts"==e.sensedKey}).des],power_Wt_relay1:[S.find(function(e){return"power_Wt_relay1"==e.sensedKey}).des],power_Wt_relay2:[S.find(function(e){return"power_Wt_relay2"==e.sensedKey}).des],power_Wt_relay3:[S.find(function(e){return"power_Wt_relay3"==e.sensedKey}).des],Relay1_State:[S.find(function(e){return"Relay1_State"==e.sensedKey}).des],Relay2_State:[S.find(function(e){return"Relay2_State"==e.sensedKey}).des],Relay3_State:[S.find(function(e){return"Relay3_State"==e.sensedKey}).des],Relay4_State:[S.find(function(e){return"Relay4_State"==e.sensedKey}).des]},V=["x"],O.mAmps_relay1.push(null),O.mAmps_relay2.push(null),O.mAmps_relay3.push(null),O.mAmps_relay4.push(null),O.nominal_src_volts.push(null),O.power_Wt_relay1.push(null),O.power_Wt_relay2.push(null),O.power_Wt_relay3.push(null),O.Relay1_State.push(null),O.Relay2_State.push(null),O.Relay3_State.push(null),O.Relay4_State.push(null),V.push(new Date(a)),_.length>0)for(H=0;H<_.length;H++)(null===(L=_[H])||void 0===L?void 0:L.mAmps_relay1)&&(O.mAmps_relay1.push(L.mAmps_relay1||"0"),O.mAmps_relay2.push(L.mAmps_relay2||"0"),O.mAmps_relay3.push(L.mAmps_relay3||"0"),O.mAmps_relay4.push(L.mAmps_relay4||"0"),O.nominal_src_volts.push(L.nominal_src_volts||"0"),O.power_Wt_relay1.push(L.power_Wt_relay1||"0"),O.power_Wt_relay2.push(L.power_Wt_relay2||"0"),O.power_Wt_relay3.push(L.power_Wt_relay3||"0"),P=Object(s.a)(parseInt(L.v4relay_state)),V.push(new Date(L.timestamp)),3==P.length?P="0"+P:2==P.length?P="00"+P:1==P.length&&(P="000"+P),N=P[3],R=P[2],j=P[1],k=P[0],O.Relay1_State.push(N||"0"),O.Relay2_State.push(R||"0"),O.Relay3_State.push(j||"0"),O.Relay4_State.push(k||"0"));if(v=_.length>0?null===(W=V[V.length-1])||void 0===W?void 0:W.toLocaleString():"No Data",O.mAmps_relay1.push(null),O.mAmps_relay2.push(null),O.mAmps_relay3.push(null),O.mAmps_relay4.push(null),O.nominal_src_volts.push(null),O.power_Wt_relay1.push(null),O.power_Wt_relay2.push(null),O.power_Wt_relay3.push(null),O.Relay1_State.push(null),O.Relay2_State.push(null),O.Relay3_State.push(null),O.Relay4_State.push(null),V.push(new Date(n)),V.length>1){if(K=Object(l.c)(5,a,n),F="",K.length>1?(C=((new Date).getTime()-K[0].getTime())/1e3,F=(C/=3600)>24?"%m-%d %H:%M":C<.3?"%H:%M:%S":"%H:%M"):F="%H:%M:%S",f.x.lines=[],K.forEach(function(e){f.x.lines.push({value:e,class:"grid4"})}),u){for((G=JSON.parse(JSON.stringify(g.a))).name="Relay V4",G.graphData.columns=[V],G.axis.x.tick.format=F,G.axis.x.tick.values=K,G.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},G.graphData.x="x",H=0;H<A.length;H++)q=A[H],M=Object(o.g)(q.sensedValue),G.sensedKeys.push(M),"v4relay_state"==M?(G.graphData.columns.push(O.Relay1_State),G.graphData.columns.push(O.Relay2_State),G.graphData.columns.push(O.Relay3_State),G.graphData.columns.push(O.Relay4_State)):G.graphData.columns.push(O[""+M]);w.find(function(e){return e.name==G.name})&&(G.axis.y.tick.values=w.find(function(e){return e.name==G.name}).value,G.axis.y.min=G.axis.y.tick.values[0],G.axis.y.max=G.axis.y.tick.values[G.axis.y.tick.values.length-1]),x&&x.length&&(T=x.find(function(e){return e.graphName==G.name}))&&T.yAxisSettings&&("Fixed"==T.yAxisSettings?(delete G.axis.y.tick.values,G.axis.y.min=T.yAxisMin,G.axis.y.max=T.yAxisMax):"Floating"==T.yAxisSettings&&(delete G.axis.y.tick.values,delete G.axis.y.max,delete G.axis.y.min),G.yAxisSettings=T.yAxisSettings,G.yAxisFixedValues={max:T.yAxisMax,min:T.yAxisMin}),G.graphEquipment=this.fetchEquipmentFromPoints(G.name,G.sensedKeys),y.push(G)}else for(B=function(e){var t,a="Relay V4",n=JSON.parse(JSON.stringify(g.a));if(n.name=a,n.axis.y.label="Amp, W, On/Off, Volts",n.sensedKeys=["mAmps_relay1","mAmps_relay2","mAmps_relay3","mAmps_relay4","power_Wt_relay1","power_Wt_relay2","power_Wt_relay3","v4relay_state","nominal_src_volts"],t=[V,O.mAmps_relay1,O.mAmps_relay2,O.mAmps_relay3,O.mAmps_relay4,O.power_Wt_relay1,O.power_Wt_relay2,O.power_Wt_relay3,O.Relay1_State,O.Relay2_State,O.Relay3_State,O.Relay4_State,O.nominal_src_volts],w.find(function(e){return e.name==a})&&(n.axis.y.tick.values=w.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),x&&x.length){var r=x.find(function(e){return e.graphName==a});r&&r.yAxisSettings&&("Fixed"==r.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=r.yAxisMin,n.axis.y.max=r.yAxisMax):"Floating"==r.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=r.yAxisSettings,n.yAxisFixedValues={max:r.yAxisMax,min:r.yAxisMin})}n.axis.y.tick.format=function(e){return parseFloat(e).toFixed(0)},n.axis.x.tick.format=F,n.axis.x.tick.values=K,n.graphData.x="x",n.graphData.columns=t,n.graphEquipment=Y.fetchEquipmentFromPoints(a,n.sensedKeys),y.push(n)},Y=this,H=0;H<1;H++)B(H);this.props.loadNextInsight(),Object(h.h)(D,this.callLiveUpdate),this.setState({grid:f,graphData:y,lastUpdatedAt:v,loading:!1},function(){m(!!p||_.length>0),r&&I.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.insightRelEquipment,g=c.showAlarmPoints,f=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=l||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/RelayControl/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2976:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(772)),i=a.n(r),s=a(715),o=a(837),l=a(11),u=a(838),c=a(797),m=a(122),p=a(736),h=a(124),d=a(760),g=(a.n(d),a(857)),f=a(20),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},x=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return y(t,e),t.prototype.componentDidMount=function(){return x(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return x(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return x(this,void 0,void 0,function(){var t,a,n,r,i,s,o,u,h,d,g,f,y,v=this;return b(this,function(x){switch(x.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,r=a.devicePoints,i=a.showAlarmPoints,s=a.device,Object(m.a)(!0),i&&!e?[3,2]:(o=[],r&&r.length&&r.forEach(function(e){o.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(s.moncondevice)],null)]);case 1:return u=x.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,d=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>d})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var r=t[n],i=r.selectedAlarmPoint.sensedValue.length>1?r.selectedAlarmPoint.sensedValue:r.sensedKeys&&r.sensedKeys.length>0?r.sensedKeys[r.sensedKeys.length-1]:"";a.push(v.selectAlarmPoint(r,i,!1))}v.setState({graphData:a})}}),[3,3];case 2:for(g=[],f=0;f<t.length;f++)y=t[f],g.push(this.selectAlarmPoint(y,"",!1));this.setState({graphData:g}),x.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var r,i,s=n.state,o=s.alarmSensedPoints,l=s.deviceAlarms,c=s.graphData,m=o.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&l.length>0&&l.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,d=0;d<e.sensedKeys.length;d++){var g=e.sensedKeys[d];if(t==g){h=!1;for(var f=["Low-Low"],y=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),y.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,y,e.graphData.columns[d+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(r={"Low-Low":"red",Low:"grey"},r[e.graphData.columns[d+1][0]]="#e3e3e3",r.High="grey",r["High-High"]="red",r)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=v({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(d=0;d<e.sensedKeys.length;d++){g=e.sensedKeys[d];t==g&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[d+1]],colors:(i={},i[e.graphData.columns[d+1][0]]="#e3e3e3",i)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=v({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t,a=this,n=this.state,r=n.graphData,i=n.grid,s=n.alarmSensedPoints,o=this.props,u=o.showAlarmPoints,c=o.device,m=new Date,p=Object(l.g)(c.moncontype),h=g.c.filter(function(e){return p.toLowerCase().indexOf(e.type.toLowerCase())>-1});e["@timestamp"]&&(m=new Date(e["@timestamp"]));var d=this.props.liveGraphRange;if(r&&r.length&&m){for(var f=0;f<r.length;f++){var y=r[f],v=y.graphData.columns.map(function(e){return e[0]});if(y.graphData.columns&&y.graphData.columns.length){if(y.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var x=Object.keys(e),b=function(a){var n=x[a];if(y.sensedKeys&&y.sensedKeys.length&&y.sensedKeys.find(function(e){return e==n})){var r=null===(t=h.find(function(e){return e.sensedKey==n}))||void 0===t?void 0:t.des;if(r){var i=v.findIndex(function(e){return e==r});"EnergySumNR"==n||"EnergyPosSumNR"==n?y.graphData.columns[i].push(parseFloat(e[""+n])/1e3):y.graphData.columns[i].push(e[n]),y.graphData.columns[i].splice(1,1)}}},A=0;A<x.length;A++)b(A);(m.getTime()-y.graphData.columns[0][2].getTime())/6e4>d&&y.graphData.columns[0].splice(1,1),y.axis.x.tick.values[2]&&y.axis.x.tick.values[1].getTime()&&y.axis.x.tick.values[2].getTime()-y.axis.x.tick.values[1].getTime()<m.getTime()-y.axis.x.tick.values[y.axis.x.tick.values.length-1]&&(y.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),m.setSeconds(0),d>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),y.axis.x.tick.values.push(m),i.x.lines.push({value:m,class:"grid4"}))}}var E=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:i,graphData:r,lastUpdatedAt:E},function(){if(u){for(var e=[],t=function(t){var n=r[t],i=n.sensedKeys&&n.sensedKeys.length&&s.length>0&&s.filter(function(e){return n.sensedKeys.includes(e.sensedValue)}),o=n.selectedAlarmPoint.sensedValue.length>1?n.selectedAlarmPoint.sensedValue:(null===i||void 0===i?void 0:i.length)>0?i[i.length-1].sensedValue:"";e.push(a.selectAlarmPoint(n,o,!1))},n=0;n<r.length;n++)t(n);a.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return x(this,void 0,void 0,function(){var a,n,r,i,s,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(r=this.props.device,i=Object(l.g)(r.moncontype),(s=g.b.find(function(t){return i.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var r=this,i=this.state.graphData,s=i.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return x(r,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:i.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:i})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return x(this,void 0,void 0,function(){var r,i,s,u,c,m,p,h,d,g,y,v,x,A=this;return b(this,function(b){switch(b.label){case 0:return r=this.props,i=r.instance,s=r.buildingName,u=r.device,c=r.isEquipment,m=r.equipment,p=this.state.graphYAxisSettings,h="",d="",g="",c?(g="equipment",h=m.ontology,d=m.rdfsLabel):(g="device",h=Object(l.g)(u.moncondevice),d=Object(l.g)(u.rdfsLabel)),y=p.find(function(t){return t.graphName==e}),v=Object(f.F)(12),y&&y.ontology&&(v=y.ontology),x={instance:i,building:s,ontology:v,assetOntology:h,ontologyLabel:d,ontologyAssetType:g,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(x).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return x(this,void 0,void 0,function(){var e,t,a,n,r,i,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,r=e.device,i=a?n.ontology:Object(l.g)(r.moncondevice),[4,Object(o.a)(t,i)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),r=[];if(a&&a.length>0)for(var i=function(e){var n=t[e],i=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!i||!Object(l.g)(i.point)||r&&r.length&&r.find(function(e){return e.value==Object(l.g)(i.relatedEquipment)})||r.push({value:Object(l.g)(i.relatedEquipment),label:Object(l.g)(i.relatedEquipmentLabel),space:Object(l.g)(i.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)i(s);return n.graph=e,n.pointEquip=r,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return x(e,void 0,void 0,function(){var e,t,a,n,r,i,u,c,m,p,d,f,y,v,x,A,E,D,w,S,_,O,V,L,P,N,R,j,k,K,F,C,G,q,M,T,B=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,r=e.showAlarmPoints,i=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=e.isGraphLoaded,d=e.showAllGraphs,f=this.state,y=f.grid,v=f.graphData,x=f.lastUpdatedAt,A=f.graphYAxisSettings,E=[],c&&(E=u.filter(function(e){return Object(l.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(D=Object(l.g)(t.moncontype),w=Object(l.g)(t.topic),S=g.b.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=g.c.filter(function(e){return D.toLowerCase().indexOf(e.type.toLowerCase())>-1}),(O=w?w.split(","):[]).length&&O[0]?(V=[],!c||c&&E.length?[4,Object(s.n)(O[0],a,n)]:[3,2]):[3,3]):[3,3];case 1:V=b.sent(),b.label=2;case 2:if(L={EnergySum:[_.find(function(e){return"EnergySum"==e.sensedKey}).des],EnergyPosSum:[_.find(function(e){return"EnergyPosSum"==e.sensedKey}).des],EnergySumNR:[_.find(function(e){return"EnergySumNR"==e.sensedKey}).des],EnergyPosSumNR:[_.find(function(e){return"EnergyPosSumNR"==e.sensedKey}).des],PowerSum:[_.find(function(e){return"PowerSum"==e.sensedKey}).des],PowerA:[_.find(function(e){return"PowerA"==e.sensedKey}).des],PowerB:[_.find(function(e){return"PowerB"==e.sensedKey}).des],PowerC:[_.find(function(e){return"PowerC"==e.sensedKey}).des],VoltA:[_.find(function(e){return"VoltA"==e.sensedKey}).des],VoltB:[_.find(function(e){return"VoltB"==e.sensedKey}).des],VoltC:[_.find(function(e){return"VoltC"==e.sensedKey}).des],VoltAvgLL:[_.find(function(e){return"VoltAvgLL"==e.sensedKey}).des],VoltAB:[_.find(function(e){return"VoltAB"==e.sensedKey}).des],VoltAC:[_.find(function(e){return"VoltAC"==e.sensedKey}).des],VoltBC:[_.find(function(e){return"VoltBC"==e.sensedKey}).des],Freq:[_.find(function(e){return"Freq"==e.sensedKey}).des]},P=["x"],L.EnergySum.push(null),L.EnergyPosSum.push(null),L.EnergySumNR.push(null),L.EnergyPosSumNR.push(null),L.PowerSum.push(null),L.PowerA.push(null),L.PowerB.push(null),L.PowerC.push(null),L.VoltA.push(null),L.VoltB.push(null),L.VoltC.push(null),L.VoltAvgLL.push(null),L.VoltAB.push(null),L.VoltAC.push(null),L.VoltBC.push(null),L.Freq.push(null),P.push(new Date(a)),V.length>0&&V.forEach(function(e){e&&(L.EnergySum.push(e.EnergySum||"0"),L.EnergyPosSum.push(e.EnergyPosSum||"0"),L.EnergySumNR.push(""+ +e.EnergySumNR/1e3||"0"),L.EnergyPosSumNR.push(""+ +e.EnergyPosSumNR/1e3||"0"),L.PowerSum.push(e.PowerSum||"0"),L.PowerA.push(e.PowerA||"0"),L.PowerB.push(e.PowerB||"0"),L.PowerC.push(e.PowerC||"0"),L.VoltA.push(e.VoltA||"0"),L.VoltB.push(e.VoltB||"0"),L.VoltC.push(e.VoltC||"0"),L.VoltAvgLL.push(e.VoltAvgLL||"0"),L.VoltAB.push(e.VoltAB||"0"),L.VoltAC.push(e.VoltAC||"0"),L.VoltBC.push(e.VoltBC||"0"),L.Freq.push(e.Freq||"0"),P.push(new Date(e.timestamp)))}),x=V.length>0?null===(T=P[P.length-1])||void 0===T?void 0:T.toLocaleString():"No Data",L.EnergySum.push(null),L.EnergyPosSum.push(null),L.EnergySumNR.push(null),L.EnergyPosSumNR.push(null),L.PowerSum.push(null),L.PowerA.push(null),L.PowerB.push(null),L.PowerC.push(null),L.VoltA.push(null),L.VoltB.push(null),L.VoltC.push(null),L.VoltAvgLL.push(null),L.VoltAB.push(null),L.VoltAC.push(null),L.VoltBC.push(null),L.Freq.push(null),P.push(new Date(n)),P.length>1){if(N=Object(o.c)(5,a,n),R="",N.length>1?(j=((new Date).getTime()-N[0].getTime())/1e3,R=(j/=3600)>24?"%m-%d %H:%M":j<.3?"%H:%M:%S":"%H:%M"):R="%H:%M:%S",y.x.lines=[],N.forEach(function(e){y.x.lines.push({value:e,class:"grid4"})}),c){for((k=JSON.parse(JSON.stringify(g.a))).name="Wattnode",k.graphData.columns=[P],k.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},k.axis.x.tick.format=R,k.axis.x.tick.values=N,k.graphData.x="x",M=0;M<E.length;M++)K=E[M],F=Object(l.g)(K.sensedValue),k.sensedKeys.push(F),k.graphData.columns.push(L[""+F]);S.find(function(e){return e.name==k.name})&&(k.axis.y.tick.values=S.find(function(e){return e.name==k.name}).value,k.axis.y.min=k.axis.y.tick.values[0],k.axis.y.max=k.axis.y.tick.values[k.axis.y.tick.values.length-1]),A&&A.length&&(C=A.find(function(e){return e.graphName==k.name}))&&C.yAxisSettings&&("Fixed"==C.yAxisSettings?(delete k.axis.y.tick.values,k.axis.y.min=C.yAxisMin,k.axis.y.max=C.yAxisMax):"Floating"==C.yAxisSettings&&(delete k.axis.y.tick.values,delete k.axis.y.max,delete k.axis.y.min),k.yAxisSettings=C.yAxisSettings,k.yAxisFixedValues={max:C.yAxisMax,min:C.yAxisMin}),k.graphEquipment=this.fetchEquipmentFromPoints(k.name,k.sensedKeys),v.push(k)}else for(G=function(e){var t=i[e],a=JSON.parse(JSON.stringify(g.a)),n=1,r=[];if(a.name=t,"Power"==t?(a.axis.y.label="Watts",a.sensedKeys=["PowerA","PowerB","PowerC","PowerSum"],r=[P,L.PowerA,L.PowerB,L.PowerC,L.PowerSum]):"Phase Voltage"==t?(n=0,a.axis.y.label="Volts",a.sensedKeys=["VoltAB","VoltBC","VoltAC"],r=[P,L.VoltAB,L.VoltBC,L.VoltAC]):"Voltage"==t?(n=0,a.axis.y.label="Volts",a.sensedKeys=["VoltA","VoltB","VoltC"],r=[P,L.VoltA,L.VoltB,L.VoltC]):"Frequency"==t?(a.axis.y.label="Hz",a.sensedKeys=["Freq"],r=[P,L.Freq]):"Energy Sum Resettable"==t?(a.axis.y.label="MWh",a.sensedKeys=["EnergySumNR"],r=[P,L.EnergySumNR]):"Positive Energy Sum Non-resettable"==t&&(a.axis.y.label="MWh",a.sensedKeys=["EnergyPosSumNR"],r=[P,L.EnergyPosSumNR]),S.find(function(e){return e.name==t})&&(a.axis.y.tick.values=S.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),A&&A.length){var s=A.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=R,a.axis.x.tick.values=N,a.graphData.x="x",a.graphData.columns=r,a.graphEquipment=q.fetchEquipmentFromPoints(t,a.sensedKeys),v.push(a)},q=this,M=0;M<i.length;M++)G(M);this.props.loadNextInsight(),Object(h.h)(O,this.callLiveUpdate),this.setState({grid:y,graphData:v,lastUpdatedAt:x,loading:!1},function(){p(!!d||V.length>0),r&&B.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,r=t.graphData,s=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,d=c.showAlarmPoints,g=c.insightRelEquipment,f=c.showAllGraphs;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"!=o||f?n.createElement(n.Fragment,null,r&&r.length&&r.map(function(t){var a,r,c,f="";return d&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(r=t.graphDataAlarmPoint.columns)||void 0===r?void 0:r.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(i.a,{data:d&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)})):n.createElement(n.Fragment,null)},t}(n.Component);t.a=A},2977:function(e,t,a){"use strict";var n=a(2),r=(a.n(n),a(744)),i=a(1014),s=a(772),o=a.n(s),l=a(760),u=(a.n(l),a(715)),c=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),m=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},h=function(e){function t(t){var a=e.call(this,t)||this;return a.state={asisData:[],seasonList:[],graphData1:{x:"Date",columns:[],type:"bar"},grid1:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphData2:{x:"Date",columns:[],type:"bar"},grid2:{x:{lines:[{}]},y:{show:!0}},axis2:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}},y2:{show:!0,label:"$",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,selectedSeason:""},a._fetchData=a._fetchData.bind(a),a}return c(t,e),t.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){return p(this,function(e){return this._fetchData(),[2]})})},t.prototype.fetchVeifyDetail=function(e){return m(this,void 0,void 0,function(){return p(this,function(e){return[2]})})},t.prototype._fetchData=function(){return m(this,void 0,void 0,function(){var e,t,a=this;return p(this,function(n){switch(n.label){case 0:return e=this.props.buildingName,t=this.props.projectName,[4,Object(r.o)(e,"",t).then(function(e){return m(a,void 0,void 0,function(){var t,a,n,s,o,l,u,c,m,h,d,g,f,y,v=this;return p(this,function(p){switch(p.label){case 0:return e&&e[0]&&e[0].ontology?(t=[],0,0,0,0,a=[],n=e[0],[4,Object(r.l)(n.ontology)]):[3,7];case 1:if(!((s=p.sent())&&s.length>0))return[3,7];for((t=s.sort(function(e,t){return e.seasonSequence>t.seasonSequence?1:t.seasonSequence>e.seasonSequence?-1:0})).map(function(e){var t=e.analysisName+": "+(e.seasonType&&"both"==e.seasonType.toLocaleLowerCase().trim()?e.seasonType+": "+("cooling"==e.selectedAnalysis?"Cooling":"Heating"):e.seasonType);a.push({label:t,value:e.ontology})}),o=0;o<t.length;o++)l=t[o],l.totalConsumedEnergyASIS,l.totalConsumedEnergyECM,l.totalConsumedEnergyCostASIS,l.totalConsumedEnergyCostECM;return 0==n.measureAnalysis.length?n.measureAnalysis=[{staticSeasonName:"Summer",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Fall",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Winter",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Spring",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value}]:n.measureAnalysis.length,u=[],c=[],t&&t.length>0?(m=[],h=[],(d=t.sort(function(e,t){return new Date(e.asisStartDate)>new Date(t.asisStartDate)?1:new Date(t.asisStartDate)>new Date(e.asisStartDate)?-1:0}))&&d.length>0?(g=d[0],[4,Object(r.k)(g.importDataASISOntology).then(function(e){u=e?e[0].fileData:[]})]):[3,6]):[3,7];case 2:return p.sent(),[4,Object(r.k)(g.importDataECMOntology).then(function(e){c=e?e[0].fileData:[]})];case 3:return p.sent(),[4,Object(i.c)(u,new Date(g.asisStartDate),new Date(g.asisEndDate),g.noaaStation.value,parseFloat(g.basepointCD),parseFloat(g.basepointHD),g.isMeasureFile)];case 4:return f=p.sent(),[4,Object(i.c)(c,new Date(g.ecmStartDate),new Date(g.ecmEndDate),g.noaaStation.value,parseFloat(g.basepointCD),parseFloat(g.basepointHD),g.isMeasureFile)];case 5:y=p.sent(),m.push.apply(m,f),h.push.apply(h,y),p.label=6;case 6:this.setState({seasonList:t,asisData:u},function(){v.energyConsumptionGraph()}),p.label=7;case 7:return[2]}})})}).catch(function(e){console.log(e)})];case 1:return n.sent(),[2]}})})},t.prototype.energyConsumptionGraph=function(){return m(this,void 0,void 0,function(){var e,t,a,n,r,i,s,o,l,c,m,h,d,g,f,y,v,x,b,A,E,D,w,S;return p(this,function(p){switch(p.label){case 0:e=this.state.asisData,t=this.state,a=t.graphData1,n=t.axis1,r=t.grid1,i=t.graphData2,s=t.axis2,o=t.grid2,l=new Date,c=new Date,l.setMonth(l.getMonth()-1),l.setHours(0,0,0,0),m=["ECM Energy Consumption (Metered)"],h=["Date"],d=["Asis Consumption (Projected)"],g=["Energy Saving"],f=["Energy Savings $ at 10.42 cents per unit"],y=["Tons CO2 emission reduction at 0.000709 tons per unit"],v=new Date(l),p.label=1;case 1:return v<=c?((x=new Date(v)).setHours(23,59,59,0),[4,Object(u.n)("michaels/5_125/wn_basicreg1",v,x,!1)]):[3,4];case 2:b=p.sent(),A=b[0],E=b[b.length-1],A&&E?m.push(""+(E.EnergyPosSum-A.EnergyPosSum)):m.push("0"),h.push(new Date(v)),p.label=3;case 3:return v.setDate(v.getDate()+1),[3,1];case 4:for(D=function(t){var a=new Date(h[t]),n=0;e.filter(function(e){if(+e.Date.split("/")[1]==a.getDate())return e}).forEach(function(e){n+=+e.ValueSum}),d.push(n),r.x.lines.push({value:a,class:"grid4"}),o.x.lines.push({value:a,class:"grid4"})},w=1;w<h.length-1;w++)D(w);for(w=1;w<d.length-1;w++)+d[w]&&+m[w]?(S=+d[w]-+m[w],g.push(S),f.push(.01042*S),y.push(709e-6*S)):(g.push(0),f.push(0));return a={x:"Date",columns:[h,m,d],type:"bar"},i={x:"Date",columns:[h,g,f],groups:[["Energy Saving"]],axes:{"Energy Savings $ at 10.42 cents per unit":"y"},type:"bar",types:{"Energy Savings $ at 10.42 cents per unit":"line"}},n.y.label="KwH",s.y.tick.values=[-2e3,-1e3,0,1e3,2e3],s.y.tick.max=2e3,s.y.tick.min=-2e3,s.y2.tick.values=[-40,-20,0,20,40],s.y2.tick.max=40,s.y2.tick.min=-40,this.setState({loading:!1,graphData1:a,axis1:n,grid1:r,graphData2:i,grid2:o}),[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData1,r=e.grid1,i=e.axis1,s=e.graphData2,l=e.axis2,u=e.grid2;return n.createElement(n.Fragment,null,n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(o.a,{data:a,size:{height:500},axis:i,grid:r,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})),n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(o.a,{data:s,size:{height:500},axis:l,grid:u,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})))},t}(n.Component);t.a=h},837:function(e,t,a){"use strict";a.d(t,"c",function(){return l}),t.b=function(e){return s(this,void 0,void 0,function(){var t=this;return o(this,function(a){switch(a.label){case 0:return[4,Object(n.f)({model:e},n.a.DEVICES.UpdateGraphYAxisSettings,r.b.EQUIP).then(function(e){return s(t,void 0,void 0,function(){return o(this,function(t){return e&&Object(i.b)("Updated Y Axis settings"),[2]})})}).catch(function(e){Object(i.a)("Error occured while updating Y Axis settings.")})];case 1:return[2,a.sent()]}})})},t.a=function(e,t,a,i){return s(this,void 0,void 0,function(){return o(this,function(s){switch(s.label){case 0:return[4,Object(n.f)({building:e,assetOntology:t,ontology:a,graphName:i},n.a.DEVICES.FetchGraphYAxisSettings,r.b.EQUIP)];case 1:return[2,s.sent()]}})})};var n=a(12),r=a(13),i=a(21),s=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(r,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function o(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,n,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},l=function(e,t,a){for(var n=new Date(t.setSeconds(0)),r=new Date(a.setSeconds(0)),i=[],s=r.getTime()-n.getTime(),o=s/1e3/3600,l=0;l<e+1;l++){var u=void 0;if(0===l)o>48?(n.setSeconds(0),n.setMinutes(0),n.setHours(n.getHours()+(24-n.getHours()%24))):o>24?(n.setSeconds(0),n.setMinutes(0),n.setHours(n.getHours()+(10-n.getHours()%10))):o>1?(n.setSeconds(0),n.setMinutes(n.getMinutes()+(10-n.getMinutes()%10))):o>.1?(n.setSeconds(0),n.setMinutes(n.getMinutes()+(10-n.getMinutes()%10))):o>.1&&(n.setSeconds(0),n.setMinutes(n.getMinutes()+(5-n.getMinutes()%5))),u=n;else if(o>72){var c=Math.ceil(o);c+=360-c%360,(u=new Date(i[i.length-1].getTime()+6e5*c)).setSeconds(0)}else if(o>24){c=Math.ceil(o);c+=60-c%60,(u=new Date(i[i.length-1].getTime()+6e5*c)).setSeconds(0)}else o>1?(u=new Date(i[i.length-1].getTime()+Math.ceil(o)%60*6e5)).setSeconds(0):o>.2?(u=new Date(i[i.length-1].getTime()+6e5)).setSeconds(0):u=new Date(i[i.length-1].getTime()+Math.ceil(s/e));u!=i[i.length-1]&&u<=r&&i.push(u)}return i}},838:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n={sensedValue:"",maximumExtremeValue:"",minimumExtremeValue:"",maximumNormalValue:"",minimumNormalValue:"",generateMaximumExtremeValue:!0,generateMaximumNormalValue:!0,generateMinimumExtremeValue:!0,generateMinimumNormalValue:!0}},857:function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"c",function(){return i}),a.d(t,"a",function(){return s});var n=a(838),r=[{name:"Temp & Humidity",type:"CeilingSensor",value:[0,20,40,60,80,100]},{name:"Pressure",type:"CeilingSensor",value:[0,400,800,1200]},{name:"Illuminance",type:"CeilingSensor",value:[0,40,80,120,160,200,240]},{name:"Gas Resistance",type:"CeilingSensor",value:[0,600,1200,1800,2400,3e3]},{name:"Air Particles",type:"CeilingSensor",value:[0,4e3,8e3,12e3,16e3]},{name:"Other Parameters",type:"CeilingSensor",value:[0,10,20,30,40,50]},{name:"Ceiling Sensor",type:"CeilingSensor",value:[0,4e3,8e3,12e3,16e3]},{name:"ATS Frequency",type:"ATS",value:[0,20,40,60,80]},{name:"Refrigerator 1",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 2",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 3",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 4",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Temperatures",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 1",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 2",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 3",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 4",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Analog Values",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Voltages",type:"Generator",value:[0,50,100,150,200,250]},{name:"Currents",type:"Generator",value:[0,10,20,30,40,50]},{name:"Powers",type:"Generator",value:[0,20,40,60,80,100]},{name:"Power Factor",type:"Generator",value:[-1,0,1]},{name:"Other Parameters",type:"Generator",value:[0,40,80,120,160,160]},{name:"Binary Parameters",type:"Generator",value:[-1,0,1]},{name:"Generator",type:"Generator",value:[-1,0,50,100,150,200,250]},{name:"Intesis",type:"Intesis",value:[0,20,40,60,80,100]},{name:"Totalized Energy",type:"RelayI1",value:[0,10,20,30,40,50]},{name:"Frequency and Voltage",type:"RelayI1",value:[0,50,100,150,200]},{name:"Current and Power",type:"RelayI1",value:[0,20,40,60,80,100]},{name:"State and Power Factor",type:"RelayI1",value:[-1,0,1,2]},{name:"Relay i1",type:"RelayI1",value:[-1,0,1,2,50,100,150,200]},{name:"Relay V4",type:"RelayV4",value:[0,50,100,150,200,250,300]},{name:"Thermostat",type:"Thermostat",value:[0,20,40,60,80,100]},{name:"Power",type:"Wattnode",value:[0,1e4,2e4,3e4,4e4]},{name:"Phase Voltage",type:"Wattnode",value:[0,50,100,150,200,250]},{name:"Voltage",type:"Wattnode",value:[0,50,100,150]},{name:"Frequency",type:"Wattnode",value:[0,20,40,60,80]},{name:"Energy Sum Resettable",type:"Wattnode",value:[0,40,80,120,160]},{name:"Positive Energy Sum Non-resettable",type:"Wattnode",value:[0,40,80,120,160]},{name:"Wattnode",type:"Wattnode",value:[0,1e4,2e4,3e4,4e4]}],i=[{sensedKey:"Normal_Frequency",des:"Normal Freq",type:"ATS"},{sensedKey:"Emergency_Frequency",des:"Emergency Freq",type:"ATS"},{sensedKey:"register1",des:"Register",type:"CBW406"},{sensedKey:"t3frontRefrigerator1",des:"Front",type:"CBW406"},{sensedKey:"t4backRefrigerator1",des:"Back",type:"CBW406"},{sensedKey:"t5evapfanRefrigerator1",des:"Evaporator Fan",type:"CBW406"},{sensedKey:"t6comprinRefrigerator1",des:"Evaporator Coil",type:"CBW406"},{sensedKey:"t7comproutRefrigerator1",des:"Compressor Out",type:"CBW406"},{sensedKey:"t8probeRefrigerator1",des:"Solid",type:"CBW406"},{sensedKey:"t3frontRefrigerator2",des:"Front",type:"CBW406"},{sensedKey:"t4backRefrigerator2",des:"Back",type:"CBW406"},{sensedKey:"t5evapfanRefrigerator2",des:"Evaporator Fan",type:"CBW406"},{sensedKey:"t6comprinRefrigerator2",des:"Evaporator Coil",type:"CBW406"},{sensedKey:"t7comproutRefrigerator2",des:"Compressor Out",type:"CBW406"},{sensedKey:"t8probeRefrigerator2",des:"Solid",type:"CBW406"},{sensedKey:"t3frontRefrigerator3",des:"Front",type:"CBW406"},{sensedKey:"t4backRefrigerator3",des:"Back",type:"CBW406"},{sensedKey:"t5evapfanRefrigerator3",des:"Evaporator Fan",type:"CBW406"},{sensedKey:"t6comprinRefrigerator3",des:"Evaporator Coil",type:"CBW406"},{sensedKey:"t7comproutRefrigerator3",des:"Compressor Out",type:"CBW406"},{sensedKey:"t8probeRefrigerator3",des:"Solid",type:"CBW406"},{sensedKey:"t3frontRefrigerator4",des:"Front",type:"CBW406"},{sensedKey:"t4backRefrigerator4",des:"Back",type:"CBW406"},{sensedKey:"t5evapfanRefrigerator4",des:"Evaporator Fan",type:"CBW406"},{sensedKey:"t6comprinRefrigerator4",des:"Evaporator Coil",type:"CBW406"},{sensedKey:"t7comproutRefrigerator4",des:"Compressor Out",type:"CBW406"},{sensedKey:"t8probeRefrigerator4",des:"Solid",type:"CBW406"},{sensedKey:"a13comprcurrRefrigerator1",des:"Compressor Amps",type:"CBW418"},{sensedKey:"a14efmcurrRefrigerator1",des:"EFM Amps",type:"CBW418"},{sensedKey:"a15prRefrigerator1",des:"Compressor Outlet PSI",type:"CBW418"},{sensedKey:"a16doorRefrigerator1",des:"Door Contact",type:"CBW418"},{sensedKey:"a13comprcurrRefrigerator2",des:"Compressor Amps",type:"CBW418"},{sensedKey:"a14efmcurrRefrigerator2",des:"EFM Amps",type:"CBW418"},{sensedKey:"a15prRefrigerator2",des:"Compressor Outlet PSI",type:"CBW418"},{sensedKey:"a16doorRefrigerator2",des:"Door Contact",type:"CBW418"},{sensedKey:"a13comprcurrRefrigerator3",des:"Compressor Amps",type:"CBW418"},{sensedKey:"a14efmcurrRefrigerator3",des:"EFM Amps",type:"CBW418"},{sensedKey:"a15prRefrigerator3",des:"Compressor Outlet PSI",type:"CBW418"},{sensedKey:"a16doorRefrigerator3",des:"Door Contact",type:"CBW418"},{sensedKey:"a13comprcurrRefrigerator4",des:"Compressor Amps",type:"CBW418"},{sensedKey:"a14efmcurrRefrigerator4",des:"EFM Amps",type:"CBW418"},{sensedKey:"a15prRefrigerator4",des:"Compressor Outlet PSI",type:"CBW418"},{sensedKey:"a16doorRefrigerator4",des:"Door Contact",type:"CBW418"},{sensedKey:"register1",des:"Register",type:"CBW418"},{sensedKey:"serialNumber",des:"Serial Number",type:"CBW418"},{sensedKey:"minRecRefresh",des:"Refresh",type:"CBW418"},{sensedKey:"temp_celsius",des:"Temp",type:"CeilingSensor"},{sensedKey:"relhumidity_pct",des:"Humidity",type:"CeilingSensor"},{sensedKey:"altitude_m",des:"Alt.",type:"CeilingSensor"},{sensedKey:"equiCO2_ppm",des:"CO2",type:"CeilingSensor"},{sensedKey:"tvoc_ppm",des:"TVOC",type:"CeilingSensor"},{sensedKey:"gasResistance_kOhm",des:"Gas Res",type:"CeilingSensor"},{sensedKey:"illuminance_lux",des:"Illuminance",type:"CeilingSensor"},{sensedKey:"motion_sensed",des:"Motion",type:"CeilingSensor"},{sensedKey:"num_BTdev",des:"Blth Dev.",type:"CeilingSensor"},{sensedKey:"pressure_hPa",des:"Pressure",type:"CeilingSensor"},{sensedKey:"GenVAB_Volts",des:"VAB",type:"Generator"},{sensedKey:"GenVBC_Volts",des:"VBC",type:"Generator"},{sensedKey:"GenVCA_Volts",des:"VCA",type:"Generator"},{sensedKey:"GenVAN_Volts",des:"VA",type:"Generator"},{sensedKey:"GenVBN_Volts",des:"VB",type:"Generator"},{sensedKey:"GenVCN_Volts",des:"VC",type:"Generator"},{sensedKey:"BusVoltage_Volts",des:"Bus Voltage",type:"Generator"},{sensedKey:"GenIA_Amps",des:"Gen IA",type:"Generator"},{sensedKey:"GenIB_Amps",des:"Gen IB",type:"Generator"},{sensedKey:"GenIC_Amps",des:"Gen IC",type:"Generator"},{sensedKey:"GenKVA_A_KiloVA",des:"Gen kVA A",type:"Generator"},{sensedKey:"GenKVA__B_KiloVA",des:"Gen kVA B",type:"Generator"},{sensedKey:"GenKVA_C_KiloVA",des:"Gen kVA C",type:"Generator"},{sensedKey:"GenKVA_Total_KiloVA",des:"Gen kVA Total",type:"Generator"},{sensedKey:"Gen_A_kW",des:"Gen kW A",type:"Generator"},{sensedKey:"Gen_B_kW",des:"Gen kW B",type:"Generator"},{sensedKey:"Gen_C_kW",des:"Gen kW C",type:"Generator"},{sensedKey:"Gen_Total_kW",des:"Gen kW Total",type:"Generator"},{sensedKey:"GenPFLagging",des:"Gen Power Factor",type:"Generator"},{sensedKey:"ActiveSpeedSource",des:"Act speed",type:"Generator"},{sensedKey:"EngineSpeed_rpm",des:"Engine Speed",type:"Generator"},{sensedKey:"EngineLoad_pct",des:"Engine Load",type:"Generator"},{sensedKey:"CoolantTemp_F",des:"Coolant Temp",type:"Generator"},{sensedKey:"OilPressure_psi",des:"Oil Press",type:"Generator"},{sensedKey:"BatteryVoltage_DeciVolt",des:"Battery Volt",type:"Generator"},{sensedKey:"FuelLevel",des:"Fuel Level",type:"Generator"},{sensedKey:"ECUCoolantLevel",des:"ECU Coolant level",type:"Generator"},{sensedKey:"CoolDownTimeRemaining_mins",des:"Cool Down Time Rem.",type:"Generator"},{sensedKey:"UnexpectedShutdown",des:"Unexp. Shutdown",type:"Generator"},{sensedKey:"GlobalAlarm",des:"Global Alarm",type:"Generator"},{sensedKey:"AutoRestartFailure",des:"Auto Restart Fail",type:"Generator"},{sensedKey:"FuelLeakDetect",des:"Fuel Leak Det.",type:"Generator"},{sensedKey:"BatteryChargerFailure",des:"Battery Chg. Fail",type:"Generator"},{sensedKey:"TransferFail",des:"Transfer Fail",type:"Generator"},{sensedKey:"LowCoolantLevel",des:"Low Coolant level",type:"Generator"},{sensedKey:"ECUShutdown",des:"ECU Shutdown",type:"Generator"},{sensedKey:"EmergencyShutdown",des:"Emerg. Shut",type:"Generator"},{sensedKey:"Overcrank",des:"Overcrank",type:"Generator"},{sensedKey:"LossofECUComms",des:"Loss of ECU Comms",type:"Generator"},{sensedKey:"GlobalSenderFail",des:"Global Sender Fail",type:"Generator"},{sensedKey:"LowFuelLevel",des:"Low Fuel Level",type:"Generator"},{sensedKey:"LowOilPressure",des:"Low Oil Press",type:"Generator"},{sensedKey:"HighCoolantTemp",des:"High Coolant",type:"Generator"},{sensedKey:"i1relay_state",des:"State",type:"RelayI1"},{sensedKey:"active_power_Watts",des:"Watts",type:"RelayI1"},{sensedKey:"current_Amperes",des:"Amps",type:"RelayI1"},{sensedKey:"frequency_Hz",des:"Freq",type:"RelayI1"},{sensedKey:"import_active_energy_Wh",des:"Kilo Watt Hour",type:"RelayI1"},{sensedKey:"power_factor",des:"Power Factor",type:"RelayI1"},{sensedKey:"voltage_volts",des:"Volts",type:"RelayI1"},{sensedKey:"mAmps_relay1",des:"Relay 1 Amp",type:"RelayV4"},{sensedKey:"power_Wt_relay1",des:"Relay 1 Watts",type:"RelayV4"},{sensedKey:"Relay1_State",des:"Relay 1 State",type:"RelayV4"},{sensedKey:"mAmps_relay2",des:"Relay 2 Amp",type:"RelayV4"},{sensedKey:"power_Wt_relay2",des:"Relay 2 Watts",type:"RelayV4"},{sensedKey:"Relay2_State",des:"Relay 2 State",type:"RelayV4"},{sensedKey:"mAmps_relay3",des:"Relay 3 Amp",type:"RelayV4"},{sensedKey:"power_Wt_relay3",des:"Relay 3 Watts",type:"RelayV4"},{sensedKey:"Relay3_State",des:"Relay 3 State",type:"RelayV4"},{sensedKey:"mAmps_relay4",des:"Relay 4 Amp",type:"RelayV4"},{sensedKey:"power_Wt_relay4",des:"Relay 4 Watts",type:"RelayV4"},{sensedKey:"Relay4_State",des:"Relay 4 State",type:"RelayV4"},{sensedKey:"nominal_src_volts",des:"Nom. Source Volts",type:"RelayV4"},{sensedKey:"state",des:"State 1: Heat 2: Cool",type:"Thermostat"},{sensedKey:"cooltemp",des:"Cool setpoint",type:"Thermostat"},{sensedKey:"heattemp",des:"Heat setpoint",type:"Thermostat"},{sensedKey:"spacetemp",des:"Space Temp",type:"Thermostat"},{sensedKey:"fan",des:"Fan 0: Auto 1: On",type:"Thermostat"},{sensedKey:"fanstate",des:"Fan State 1: On",type:"Thermostat"},{sensedKey:"mode",des:"Mode 0: Heat 1: Cool 2: Auto",type:"Thermostat"},{sensedKey:"EnergySum",des:"Enerygy Sum",type:"Wattnode"},{sensedKey:"EnergyPosSum",des:"Energy Pos Sum",type:"Wattnode"},{sensedKey:"EnergySumNR",des:"Energy Sum NR",type:"Wattnode"},{sensedKey:"EnergyPosSumNR",des:"Energy Pos Sum NR",type:"Wattnode"},{sensedKey:"PowerSum",des:"Power Sum",type:"Wattnode"},{sensedKey:"PowerA",des:"Power A",type:"Wattnode"},{sensedKey:"PowerB",des:"Power B",type:"Wattnode"},{sensedKey:"PowerC",des:"Power C",type:"Wattnode"},{sensedKey:"VoltA",des:"Volts A",type:"Wattnode"},{sensedKey:"VoltB",des:"Volts B",type:"Wattnode"},{sensedKey:"VoltC",des:"Volts C",type:"Wattnode"},{sensedKey:"VoltAvgLL",des:"Volts Avg LL",type:"Wattnode"},{sensedKey:"VoltAB",des:"Volts AB",type:"Wattnode"},{sensedKey:"VoltAC",des:"Volts AC",type:"Wattnode"},{sensedKey:"VoltBC",des:"Volts BC",type:"Wattnode"},{sensedKey:"Freq",des:"Frequency",type:"Wattnode"}],s={name:"",graphData:{x:"x",columns:[]},axis:{x:{type:"timeseries",tick:{fit:!1,count:5,multiline:!0,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphDataAlarmPoint:{x:"x",columns:[]},graphEquipment:Object(),alarmStatus:"",selectedAlarmPoint:n.a,sensedKeys:[],yAxisSettings:"Default",yAxisFixedValues:{min:0,max:0},loading:!1}}});