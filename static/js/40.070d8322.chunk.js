webpackJsonp([40],{1027:function(e,t,n){"use strict";t.a=function(e,t){var n="";if(t&&"3.1"==t){var r=0;r=e+3,r/=10,n=Object(a.a)(r).toFixed(1)}else n=Object(a.a)(e).toFixed(1);return n};var a=n(23)},1181:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r,o=n(2),i=(n.n(o),n(659)),s=n(651),c=n(23),l=n(24),u=n(117),d=n(1027),m=n(650),h=n(11),p=n(725),g=n(662),f=n(663),b=n(10),v=n(671),E=n(721),C=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),y=this&&this.__assign||function(){return(y=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},O=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(r,o){function i(e){try{c(a.next(e))}catch(e){o(e)}}function s(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(i,s)}c((a=a.apply(e,t||[])).next())})},N=this&&this.__generator||function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},S=0,_=function(e){function t(t){var n=e.call(this,t)||this;return n.state={computingDevice:Object(),CeilingSensorBoardInfo:Object(),Old_CeilingSensorBoardInfo:Object(),modelChanged:!1,Moncon:{monitoringControl:"",monitoringControlDeviceType:"",deviceName:"",floor:"",rdfsLabel:"",manufacturer:"",model:"",location:"",computingDevice:"",connectionType:"",notes:"",wirelessConfig:{ipAddress:"",controllerIPAddress:"",thermostatMacAddress:"",ssid:"",password:""},isSchedule:!1,relatedEquipment:[],deviceNumber:"",enclosure:""},EquipmentList:[],currentChange:"",detailsExpanded:!1,localBTNState:!1,spaces:[],showLogs:!1,showErrorOnce:!1},a=a=n,n._fetchData=n._fetchData.bind(n),n._fetchCeilingSensorBoardInfo=n._fetchCeilingSensorBoardInfo.bind(n),n.cancelSend=n.cancelSend.bind(n),n.resetChanges=n.resetChanges.bind(n),n.applyChanges=n.applyChanges.bind(n),n.handleChange=n.handleChange.bind(n),n.getRelatedEquipmentLabel=n.getRelatedEquipmentLabel.bind(n),n}return C(t,e),t.prototype.componentDidMount=function(){return O(this,void 0,void 0,function(){return N(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this._fetchData()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.setIntervalStart(),[2]}})})},t.prototype.componentWillUnmount=function(){return O(this,void 0,void 0,function(){return N(this,function(e){return clearInterval(r),[2]})})},t.prototype.setIntervalStart=function(){var e=this;r&&clearInterval(r),r=setInterval(function(){var t=e.state.modelChanged;S++,!t&&S>=3&&(e.resetChanges(!1),Object(u.a)(!1),S=0)},1e3)},t.prototype._fetchData=function(){return O(this,void 0,void 0,function(){var e,t,n,a,r,o,i,c,l,d,p=this;return N(this,function(g){switch(g.label){case 0:return this.state,e=this.props,t=e.CeilingSensorBoardName,n=e.buildingName,t?(Object(u.a)(!0),[4,Object(m.h)(this.props.buildingName)]):[3,6];case 1:return a=g.sent(),r=a&&a.length>0&&a.map(function(e){return{value:Object(h.g)(e.ontology),label:Object(h.g)(e.rdfsLabel)}}),o=Object(),i=Object(),[4,Object(s.v)(t,n)];case 2:return o=g.sent(),localStorage.getItem(o.deviceID)&&localStorage.getItem(o.deviceID).length>0&&(c=JSON.parse(localStorage.getItem(o.deviceID)),this.setState({CeilingSensorBoardInfo:c,Old_CeilingSensorBoardInfo:y({},c),modelChanged:!1,currentChange:""})),o&&o.computingDevice?[4,Object(v.f)(o.computingDevice)]:[3,5];case 3:return l=g.sent(),[4,Object(v.d)(l)];case 4:(d=g.sent())&&d.length>0&&(i=d[0]),g.label=5;case 5:this.setState({Moncon:o,computingDevice:i,EquipmentList:r},function(){return O(p,void 0,void 0,function(){return N(this,function(e){return this._fetchCeilingSensorBoardInfo(!0),[2]})})}),Object(u.a)(!1),g.label=6;case 6:return[2]}})})},t.prototype._fetchCeilingSensorBoardInfo=function(e){return O(this,void 0,void 0,function(){var t,n,a,r,o=this;return N(this,function(s){switch(s.label){case 0:return e&&Object(u.a)(!0),t=this.state,n=t.Moncon,a=t.showErrorOnce,[4,Object(i.n)(n).then(function(e){var t=e[0];return!t||t&&t.error?(a||(Object(l.a)("Error occurred while fetching ceiling sensor board info."),o.setState({showErrorOnce:!0})),Object()):(o.setState({showErrorOnce:!1}),localStorage.setItem(n.deviceID,JSON.stringify(e)),t)}).catch(function(e){return Object()})];case 1:return r=s.sent(),this.setState({CeilingSensorBoardInfo:r,Old_CeilingSensorBoardInfo:y({},r),modelChanged:!1,currentChange:""}),e&&Object(u.a)(!1),[2]}})})},t.prototype.handleChange=function(e,t){var n=this.state.CeilingSensorBoardInfo;n[e]=t,this.setState({CeilingSensorBoardInfo:n,modelChanged:!0,currentChange:e})},t.prototype.cancelSend=function(){this.setState({modelChanged:!1,currentChange:""})},t.prototype.resetChanges=function(e){return O(this,void 0,void 0,function(){var t=this;return N(this,function(n){return this.setState({modelChanged:!1,currentChange:""},function(){return O(t,void 0,void 0,function(){return N(this,function(t){switch(t.label){case 0:return[4,this._fetchCeilingSensorBoardInfo(e)];case 1:return t.sent(),[2]}})})}),[2]})})},t.prototype.applyChanges=function(e,t){return O(this,void 0,void 0,function(){var n=this;return N(this,function(r){return Object(u.a)(!0),this.setState({modelChanged:!1,currentChange:""},function(){return O(n,void 0,void 0,function(){var n=this;return N(this,function(r){return setTimeout(function(){n.resetChanges(!0)},5e3),Object(i.G)(e,t,this.state.Old_CeilingSensorBoardInfo).then(function(e){e.success?Object(l.b)("Changes applied successfully. "):e.error&&Object(l.a)(e.reason)}).catch(function(e){Object(l.a)("Some error orccured. ")}),setTimeout(function(){a._fetchCeilingSensorBoardInfo()},5e3),Object(u.a)(!1),[2]})})}),[2]})})},t.prototype.getRelatedEquipmentLabel=function(e){var t=this.state.EquipmentList,n=Object();return(n=t&&t.find(function(t){return t.value==e}))&&n.label},t.prototype.bootDevice=function(){return O(this,void 0,void 0,function(){var e,t,n,a=this;return N(this,function(r){switch(r.label){case 0:return e=this.props.buildingName,t=this.state.computingDevice,!(n=JSON.parse(b.a.getItem("user")))||!n.role||"1"!=n.role&&"2"!=n.role?[3,2]:(Object(u.a)(!0,"Booting Device"),[4,Object(i.L)(t,e).then(function(e){return O(a,void 0,void 0,function(){return N(this,function(t){return 0==e.responseCode?Object(l.b)(e.responseMessage):Object(l.a)(e.responseMessage),[2]})})}).catch(function(e){Object(l.a)("Some error orccured. ")})]);case 1:r.sent(),Object(u.a)(!1),r.label=2;case 2:return[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.instance,a=t.buildingName,r=t.CeilingSensorBoardName,i=this.state,s=i.CeilingSensorBoardInfo,l=i.Moncon,u=i.modelChanged,m=i.detailsExpanded,h=i.showLogs,v=JSON.parse(b.a.getItem("user")),C="not refreshed";return s&&s.timestamp&&(C=new Date(s.timestamp).toLocaleString()),h?o.createElement(g.a,{instance:n,buildingName:a,fromEntityList:!0,module:f.a.Assets,ontology:l.monitoringControl,entityName:"Device",onLogClose:function(){return e.setState({showLogs:!1})}}):o.createElement("div",{className:"content"},o.createElement("div",{className:"container-fluid"},o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-12"},o.createElement("div",{className:"card",id:"InsightsList"},o.createElement("div",{className:"container-fluid"},o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-12"},v&&"1"==v.role&&o.createElement("button",{className:"btn btn-md btn-primary btn-fill pull-right",style:{margin:10},title:"Logs",onClick:function(){e.setState({showLogs:!0})}}," ",o.createElement("img",{src:"assets/img/Logs.png",style:{width:25,height:18}})),v&&v.role&&("1"==v.role||"2"==v.role)&&o.createElement("button",{className:"btn btn-success active pull-right custom-outline-btn m-3",title:"Boot PI Board","data-toggle":"modal","data-target":"#bootDevice"}," ",o.createElement("i",{className:"fa fa-refresh"})," Boot PI Board"),o.createElement("div",{className:"header"},o.createElement("h3",{className:"title"},o.createElement("strong",null,l.rdfsLabel)," "),o.createElement("h4",{className:"title"},o.createElement("strong",null,this.props.type.toUpperCase(),":",l&&l.relatedEquipment&&l.relatedEquipment.map(function(t,n){return o.createElement("span",{key:n},e.getRelatedEquipmentLabel(t.value),n+1==l.relatedEquipment.length?"":",")}))))))),o.createElement("div",{className:"content"},o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-6 col-xs-12 tempCounter roomTemp"},o.createElement("h4",{className:"padding-5 margin-5"},"Temp: ",o.createElement("b",null,s&&s.temp_celsius?Object(d.a)(s.temp_celsius,l&&l.firmwareVersion?l.firmwareVersion:""):0,"\xb0F")),o.createElement("h4",{className:"padding-5 margin-5"},"CO2: ",o.createElement("b",null,s&&s.equiCO2_ppm?s.equiCO2_ppm+" ppm":"-")),o.createElement("h4",{className:"padding-5 margin-5"},"Altitude: ",o.createElement("b",null,s&&s.altitude_m?s.altitude_m+" m":"-")),o.createElement("h4",{className:"padding-5 margin-5"},"Pressure: ",o.createElement("b",null,s&&s.pressure_hPa?s.pressure_hPa+" hPa":"-")),o.createElement("h4",{className:"padding-5 margin-5"},"illuminance: ",o.createElement("b",null,s&&s.illuminance_lux?s.illuminance_lux:0," Lumens")),o.createElement("h4",{className:"padding-5 margin-5"},"Gas Resistance: ",o.createElement("b",null,s&&s.gasResistance_kOhm?s.gasResistance_kOhm+" kOhm":"-"))),o.createElement("div",{className:"col-md-6 col-xs-12 InsightRow"},o.createElement("h4",{className:"padding-5 margin-5"},"Humidity: ",o.createElement("b",null,s&&s.relhumidity_pct?s.relhumidity_pct+" %":"-")),o.createElement("h4",{className:"padding-5 margin-5"},"TVOC: ",o.createElement("b",null,s&&s.tvoc_ppm?s.tvoc_ppm+" ppm":"-")),o.createElement("h4",{className:"padding-5 margin-5"},"No. of BT Devices: ",o.createElement("b",null,s&&s.num_BTdev?s.num_BTdev:"-")),o.createElement("h4",{className:"padding-5 margin-5"},"Motion Sensed: ",o.createElement("b",null,s&&s.motion_sensed&&s.motion_sensed>0?"True":"False")),o.createElement("h4",{className:"padding-5 margin-5"},"WIFI Temp: ",o.createElement("b",null,Object(c.a)(s&&s.wifiTemp1_celsius?s.wifiTemp1_celsius:0).toFixed(2),"\xb0F")))),o.createElement("br",null),l.monitoringControl&&l.monitoringControlDeviceType&&o.createElement(p.a,{instance:n,buildingName:a,monconType:l.monitoringControlDeviceType,moncon:l.monitoringControl,deviceId:l.deviceID,monconRDFsLabel:l.rdfsLabel}),o.createElement("div",{className:"accordion row padding-10",id:"accordionExample"+r,style:{paddingLeft:"30px",border:"1px solid #80808066",margin:"10px",borderRadius:"7px"}},o.createElement("div",{className:"",id:"headingOne"},o.createElement("button",{className:"btn btn-link",type:"button","data-toggle":"collapse","data-target":"#collapseOne"+r,style:{border:0,left:"-25px",position:"relative"},"aria-expanded":"true","aria-controls":"collapseOne"+r,onClick:function(){e.setState({detailsExpanded:!m})}},o.createElement("i",{className:m?"fa fa-minus":"fa fa-plus","aria-hidden":"true"}),"\xa0 Device Info")),o.createElement("div",{id:"collapseOne"+r,className:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionExample"+r},o.createElement("div",{className:"col-md-6 col-xs-12 padding-10"},o.createElement("h5",{className:"title"},o.createElement("strong",null,"IP Address:")," ",l.wirelessConfig&&l.wirelessConfig.ipAddress),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Controller IP Address:")," ",l.wirelessConfig.controllerIPAddress),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Manufacturer:")," ",l.manufacturer),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Model:")," ",l.model),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Board Address:")," ",l.boardAddress),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Device ID:")," ",l.deviceID?l.deviceID:""),o.createElement("h5",{className:"title"},o.createElement("strong",null,"Last Data Synced At:")," ",C)))),o.createElement("div",{className:u?"InsightApplyChanges":"hidden"},o.createElement("h4",null,"Do you want to apply these changes?"),o.createElement("div",null,o.createElement("button",{type:"button",className:"btn btn-fill btn-secondary",onClick:function(){return e.cancelSend()}},"Cancel"),"\xa0",o.createElement("button",{type:"button",className:"btn btn-fill btn-danger",onClick:function(){return e.resetChanges(!0)}},"Reset"),"\xa0",o.createElement("button",{type:"button",className:"btn btn-fill btn-primary",onClick:function(){return e.applyChanges(l,s)}},"Apply Changes"))))),o.createElement(E.a,{id:"bootDevice",heading:"Boot Device",cancelButtonText:"Cancel",showCreateButton:!0,createButtonText:"Boot",showRestoreButton:!0,showCancelButton:!0,onSaveButtonClick:function(){return e.bootDevice()}},o.createElement("h4",null,"Are you sure you want to boot device?"))))))},t}(o.Component);t.default=_}});