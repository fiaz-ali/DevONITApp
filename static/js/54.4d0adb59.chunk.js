webpackJsonp([54],{1801:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=a(3),r=(a.n(s),a(99)),o=a(18),c=a(49),l=a(600),i=a(610),u=a(29),m=a(911),d=a(1802),p=a(604),h=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),f=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function c(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(o,c)}l((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}},v=function(e){function t(t){var a=e.call(this,t)||this;return a.state={_customerList:[],isEdit:!1,tenantAlertObj:Object(),TenantAlertLog:[],refreshChild:!1,spaceCustomerObj:Object(),_spaceCustomers:[],otherCustomerObj:Object(),SelectedSpaceCustomer:Object(),sortOrder:1,isValidate:!1,isView:!1},n=a,a.s3=new c.b,a.saveAlertLog=a.saveAlertLog.bind(a),a.handleTenantAlerts=a.handleTenantAlerts.bind(a),a.getAllAlertLogs=a.getAllAlertLogs.bind(a),a._saveCustomerSpace=a._saveCustomerSpace.bind(a),a.handleCustomerSpace=a.handleCustomerSpace.bind(a),a.deleteSpaceCustomer=a.deleteSpaceCustomer.bind(a),a.fetchSpaceCustomers=a.fetchSpaceCustomers.bind(a),a.sortSpaceCustomerList=a.sortSpaceCustomerList.bind(a),a.handleEdit=a.handleEdit.bind(a),a}return h(t,e),t.prototype.handleEdit=function(e){var t=Object();Object.assign(t,e),this.setState({isEdit:!0,SelectedSpaceCustomer:t,isView:!1}),document.getElementById("btn-assignCustomerSpace").click()},t.prototype.componentDidMount=function(){return f(this,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this.getAllAlertLogs()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[4,this.fetchSpaceCustomers()];case 3:return e.sent(),[2]}})})},t.prototype.getAllAlertLogs=function(){return f(this,void 0,void 0,function(){return b(this,function(e){return Object(r.a)(!0),this.s3.GetObject(c.a.DOCUMENT(),"AlertLog.json",function(e,t){if(e)console.log("Get Object Error Returned",e);else{var a=Object(u.c)(t.Body);if(a){var s=JSON.parse(a);s.length>0&&n.setState({TenantAlertLog:s})}}}),Object(r.a)(!1),[2]})})},t.prototype.handleTenantAlerts=function(e){this.setState({tenantAlertObj:e})},t.prototype.sendAlertsToTenants=function(){return f(this,void 0,void 0,function(){var e,t,a=this;return b(this,function(n){switch(n.label){case 0:e=this.state.tenantAlertObj,t=new m.a,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.SendSMS_Multiple(e.contactNumbers,e.message,this.props.instance,!1,function(){a.saveAlertLog()})];case 2:return n.sent(),[3,4];case 3:return n.sent(),Object(r.a)(!1),[3,4];case 4:return[2]}})})},t.prototype.saveAlertLog=function(){return f(this,void 0,void 0,function(){var e,t,a,n,s,l=this;return b(this,function(i){return e=this.state,t=e.tenantAlertObj,a=e._customerList,n=e.TenantAlertLog,s=n,t.contactNumbers&&t.contactNumbers.length&&(Object(r.a)(!0),t.contactNumbers.map(function(e){a.map(function(a){Object(o.g)(a.mobile)==e&&s.push({alertMessage:t.message,group:Object(o.g)(a.group),date:(new Date).toString(),contact:e,site:l.props.buildingName})})}),this.setState({TenantAlertLog:s},function(){l.s3.PutObject(c.a.DOCUMENT(),"AlertLog.json",JSON.stringify(l.state.TenantAlertLog))}),Object(r.a)(!1)),[2]})})},t.prototype._saveCustomerSpace=function(){return f(this,void 0,void 0,function(){var e,t,a,n,s=this;return b(this,function(o){switch(o.label){case 0:return e=this.state,t=e.spaceCustomerObj,a=e.isEdit,n=this.props.buildingName,Object(r.a)(!0),t?[4,Object(i.h)(n,t,a).then(function(){s.fetchSpaceCustomers()})]:[3,2];case 1:o.sent(),o.label=2;case 2:return Object(r.a)(!1),[2]}})})},t.prototype.handleCustomerSpace=function(e){var t=!!(e&&e.customer&&e.role&&e.selectedSpaces);this.setState({spaceCustomerObj:e,isValidate:t})},t.prototype.fetchSpaceCustomers=function(){return f(this,void 0,void 0,function(){var e,t,a,n;return b(this,function(s){switch(s.label){case 0:return e=[],t=[],Object(r.a)(!0),[4,Object(i.m)(this.props.buildingName)];case 1:e=s.sent(),a=function(a){var n,s,r,c;return b(this,function(l){switch(l.label){case 0:return n=e[a],[4,Object(u.q)(Object(o.g)(n.selectedSpaces).split(","))];case 1:return s=l.sent(),r=[],s&&s.length>0&&s.map(function(e){r.push({value:e.ontology,label:e.rdfsLabel})}),""!=(c={ontology:Object(o.g)(n.ontology),customer:{value:Object(o.g)(n.customer),label:Object(o.g)(n.customerLabel)},notes:Object(o.g)(n.notes),role:Object(o.g)(n.role),selectedSpaces:r}).ontology&&t.push(c),[2]}})},n=0,s.label=2;case 2:return n<e.length?[5,a(n)]:[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return this.setState({_spaceCustomers:t}),Object(r.a)(!1),[2]}})})},t.prototype.deleteSpaceCustomer=function(){return f(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){switch(a.label){case 0:return e=this.state.SelectedSpaceCustomer,Object(r.a)(!0),e&&e.ontology?[4,Object(i.j)(e.ontology).then(function(e){return f(t,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,this.fetchSpaceCustomers()];case 1:return[2,e.sent()]}})})})]:[3,2];case 1:a.sent(),this.setState({SelectedSpaceCustomer:Object()}),a.label=2;case 2:return[2]}})})},t.prototype.sortSpaceCustomerList=function(e,t){var a=this.state._spaceCustomers,n=this.state.sortOrder,s=a.sort(function(t,a){if(t&&a){var s="",r="";switch(e){case"Customer":t.customer&&a.customer&&(s=t.customer.value,r=a.customer.value);break;case"Role":t.role&&a.role&&(s=t.role,r=a.role)}var o=0;return s.toLocaleLowerCase()<r.toLocaleLowerCase()?o=-1:s.toLocaleLowerCase()>r.toLocaleLowerCase()&&(o=1),o*n}});this.setState({_spaceCustomers:s,sortOrder:-1*n})},t.prototype.render=function(){var e,t=this,a=this.state,n=a._spaceCustomers,r=a.isEdit,o=a.SelectedSpaceCustomer,c=a.isValidate,i=a.isView,u=this.props,m=u.buildingName,h=u.instance;return o&&(e=!!(o&&o.customer&&o.role&&o.selectedSpaces.length>0)),s.createElement("div",{className:"content",id:"chats",style:{paddingTop:"0px"}},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12 "},s.createElement("div",{style:{marginTop:5},className:"row"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"dropdown pull-right"},s.createElement("button",{type:"button",className:"btn btn-dark pull-right",onClick:function(){window.location.hash=h+"/"+m+"/Customer/NewCustomer"}},s.createElement("i",{className:"fa fa-plus"}),s.createElement("span",{className:"hidden-xs"},"Add Customer")),s.createElement("button",{type:"button",className:"btn btn-dark pull-right",style:{marginRight:3},"data-toggle":"modal",onClick:function(){var e=t.state.spaceCustomerObj;e.ontology="",e.selectedSpaces=null,e.customer=null,e.notes=null,e.role="",t.setState({spaceCustomerObj:e,isEdit:!1,isView:!1,SelectedSpaceCustomer:Object()}),document.getElementById("btn-assignCustomerSpace").click()}},s.createElement("i",{className:"fa fa-bell"}),s.createElement("span",{className:"hidden-xs"},"Assign Space(s) To Customer")),s.createElement("button",{type:"button",id:"btn-assignCustomerSpace",className:"btn btn-primary btn-fill","data-toggle":"modal","data-target":"#assignCustomerSpace",style:{display:"none"}},"."),s.createElement(l.a,{showSaveButton:!i,showCancelButton:!0,id:"assignCustomerSpace",heading:"Space Customer Information",onSaveButtonClick:function(){t._saveCustomerSpace()},saveButtonText:"Save",disableSaveButton:!c||!e},s.createElement(d.a,{instance:h,SelectedSpaceCustomer:o,isEdit:r,buildingName:m,handleCustomerSpace:this.handleCustomerSpace,isView:i}))))),s.createElement("br",null),s.createElement("div",null,s.createElement("div",{className:"card padding-10",id:"CustomerList",style:{paddingTop:"0px"}},s.createElement("div",{className:"content",style:{paddingTop:"10px"}},s.createElement("div",{className:"dataCard"},s.createElement("div",{className:"row hidden-xs no-padding"},s.createElement("div",{className:"col-md-10 col-sm-12 dataCard"},s.createElement("div",{className:"col-md-3 col-sm-12 small grid-header",onClick:function(){return t.sortSpaceCustomerList("Customer")}},s.createElement("i",{className:"fa fas fa-sort"}),"Customer"),s.createElement("div",{className:"col-md-3 col-sm-12 small grid-header-left"},s.createElement("i",{className:"fa fas fa-sort"}),"Space"),s.createElement("div",{className:"col-md-3 col-sm-12 small grid-header",onClick:function(){return t.sortSpaceCustomerList("Role")}},s.createElement("i",{className:"fa fas fa-sort"}),"Role"))),n.map(function(e,a){return s.createElement("div",{key:a,className:"row clickable"},s.createElement("div",{className:"col-md-10 col-sm-12 "},s.createElement("div",{className:"col-md-3 col-sm-12 padding-10 small trim-data",title:e.customer.label},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Customer"),s.createElement("a",{onClick:function(){t.setState({SelectedSpaceCustomer:e,isView:!0}),document.getElementById("btn-assignCustomerSpace").click()},title:e.customer.label}," ",s.createElement("span",null,e.customer.label))),s.createElement("div",{className:"col-md-3 col-sm-12 padding-10 small trim-data",title:e&&e.selectedSpaces&&e.selectedSpaces.map(function(e){return e.label}).join(", ")},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Space"),e&&e.selectedSpaces&&e.selectedSpaces.map(function(e){return e.label}).join(", ")),s.createElement("div",{className:"col-md-2 col-sm-12 padding-10 small trim-data",title:e.role},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Role"),e.role)),s.createElement("div",{className:"col-md-2 col-sm-12 no-padding col-xs-12",style:{display:"inline-flex"}},s.createElement("a",{className:"btn-sm btn-success active pull-right",title:"Edit Customer Space",style:{margin:"3px",padding:"6.5px",border:"1px solid",borderRadius:"5px",width:"31px",height:"31px"},onClick:function(){return t.handleEdit(e)}},s.createElement("i",{className:"fa fa-pencil"})),s.createElement("a",{className:"btn-sm btn-danger active pull-right","data-target":"#ConfirmDeleteDialog",title:"Delete Customer Space",style:{margin:"3px",padding:"6.5px",border:"1px solid",borderRadius:"5px",width:"31px",height:"31px"},onClick:function(a){t.setState({SelectedSpaceCustomer:e}),document.getElementById("btnDeleteCustomerSpaceDialog").click()}},s.createElement("i",{className:"fa fa-trash"}))))})))),s.createElement("button",{type:"button",id:"btnDeleteCustomerSpaceDialog",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#ConfirmDeleteDialog"}," ."),s.createElement(p.a,{instance:h,id:"ConfirmDeleteDialog",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmationText:"Are you sure to delete this Customer Space Relation?",heading:"Confirm...",onConfirmButtonClick:function(){t.deleteSpaceCustomer()}}))))))},t}(s.Component);t.default=v},1802:function(e,t,a){"use strict";var n=a(3),s=(a.n(n),a(615)),r=a(611),o=a(610),c=a(99),l=a(18),i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),u=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function c(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(o,c)}l((n=n.apply(e,t||[])).next())})},m=this&&this.__generator||function(e,t){var a,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}},d=[{name:"Owner",value:"Owner"},{name:"Renter",value:"Renter"}],p=function(e){function t(t){var a=e.call(this,t)||this;return a.state={_spaceList:[],addContactDropDownList:[],spaceDropDownList:[],tenantDropDownList:[],_tenantList:[],spaceCustomerObj:a.props.isEdit?a.props.SelectedSpaceCustomer:Object(),newLocation:Object()},a._saveSpaceCustomer=a._saveSpaceCustomer.bind(a),a._getSpacesList=a._getSpacesList.bind(a),a._fetchTenantList=a._fetchTenantList.bind(a),a.handleMultiSpacesChange=a.handleMultiSpacesChange.bind(a),a.handleMultiCustomerChange=a.handleMultiCustomerChange.bind(a),a}return i(t,e),t.prototype.componentDidMount=function(){return u(this,void 0,void 0,function(){var e;return m(this,function(t){switch(t.label){case 0:return e=this.state.spaceCustomerObj,e=this.props.isEdit?this.props.SelectedSpaceCustomer:Object(),this.props.buildingName?[4,this._getSpacesList()]:[3,3];case 1:return t.sent(),[4,this._fetchTenantList()];case 2:t.sent(),this.setState({spaceCustomerObj:e}),t.label=3;case 3:return[2]}})})},t.prototype.componentWillReceiveProps=function(e){return u(this,void 0,void 0,function(){return m(this,function(t){return e.SelectedSpaceCustomer&&this.setState({spaceCustomerObj:e.SelectedSpaceCustomer}),[2]})})},t.prototype._getSpacesList=function(){return u(this,void 0,void 0,function(){var e,t=this;return m(this,function(a){switch(a.label){case 0:return e=this.props.buildingName,[4,Object(r.b)(e).then(function(e){var a=e.map(function(e){return{value:e.ontology.value,label:e.rdfsLabel.value}});t.setState({_spaceList:e,spaceDropDownList:a})})];case 1:return a.sent(),[2]}})})},t.prototype._fetchTenantList=function(){return u(this,void 0,void 0,function(){var e=this;return m(this,function(t){switch(t.label){case 0:return[4,Object(o.l)(this.props.buildingName).then(function(t){var a=t.map(function(e){return{value:Object(l.g)(e.userName),label:Object(l.g)(e.name)}});e.setState({_tenantList:t,tenantDropDownList:a,addContactDropDownList:a})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.handleMultiSpacesChange=function(e){var t=this.state.spaceCustomerObj;t.selectedSpaces=e,this.setState({spaceCustomerObj:t}),this.props.handleCustomerSpace(t)},t.prototype.handleMultiCustomerChange=function(e){var t=this.state.spaceCustomerObj;t.customer=e,this.setState({spaceCustomerObj:t}),this.props.handleCustomerSpace(t)},t.prototype.handleNotesChange=function(e){var t=this.state.spaceCustomerObj;t.notes=e,this.setState({spaceCustomerObj:t}),this.props.handleCustomerSpace(t)},t.prototype._saveSpaceCustomer=function(){return u(this,void 0,void 0,function(){var e,t,a,n,s;return m(this,function(r){switch(r.label){case 0:return e=this.state.spaceCustomerObj,t=this.props,a=t.instance,n=t.buildingName,s=t.isEdit,e?(Object(c.a)(!0),[4,Object(o.h)(n,e,s).then(function(e){window.location.hash=a+"/"+n+"/Space/Customers"})]):[3,2];case 1:r.sent(),Object(c.a)(!1),r.label=2;case 2:return[2]}})})},t.prototype.handleRoleChange=function(e){var t=this.state.spaceCustomerObj;t.role=e,this.setState({spaceCustomerObj:t}),this.props.handleCustomerSpace(t)},t.prototype.render=function(){var e=this,t=this.props.isView,a=this.state,r=a.spaceCustomerObj,o=a.spaceDropDownList,c=a.tenantDropDownList;return n.createElement("div",{className:"content"},n.createElement("div",{className:""},n.createElement("div",{className:"container-fluid padding-10"},n.createElement("div",{className:""},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-3 col-sm-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"spaces"},"Spaces"))),n.createElement("div",{className:"col-md-9 col-sm-3"},n.createElement("div",{className:(r.selectedSpaces?"":"addFieldValidate")+" form-group"},n.createElement(s.a,{isDisabled:t,closeMenuOnSelect:!1,isMulti:!0,value:r.selectedSpaces?r.selectedSpaces:"",onChange:this.handleMultiSpacesChange,placeholder:"Select Spaces",options:o}))))),n.createElement("div",{className:""},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-3 col-sm-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"Customer"},"Customer"))),n.createElement("div",{className:"col-md-9 col-sm-3"},n.createElement("div",{className:(r.customer?"":"addFieldValidate")+" form-group"},n.createElement(s.a,{id:"Customer",name:"Customer",isDisabled:t,closeMenuOnSelect:!0,isMulti:!1,value:r.customer?r.customer:"",onChange:this.handleMultiCustomerChange,placeholder:"Select Customer",options:c}))))),n.createElement("div",{className:""},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-3 col-sm-2"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"role"},"Role"))),n.createElement("div",{className:"col-md-9 col-sm-3"},n.createElement("div",{className:"form-group"},n.createElement("select",{id:"role",disabled:t,className:(r.role?"":"addFieldValidate")+" form-control",value:r.role?r.role:"",onChange:function(t){return e.handleRoleChange(t.target.value)}},n.createElement("option",{value:"",key:-1,disabled:!0,selected:!0},"Select Role"),d.map(function(e,t){return n.createElement("option",{value:e.value,key:t},e.name," ")})))))),n.createElement("div",{className:""},n.createElement("div",{className:"col-md-12"},n.createElement("div",{className:"col-md-3"},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"notes"},"Notes"))),n.createElement("div",{className:"col-md-9"},n.createElement("input",{type:"text",disabled:t,id:"notes",className:"form-control",value:r.notes?r.notes:"",onChange:function(t){return e.handleNotesChange(t.target.value)}})))))))},t}(n.Component);t.a=p}});