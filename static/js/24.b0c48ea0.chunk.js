webpackJsonp([24],{1199:function(e,t,n){"use strict";t.g=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.f)(e,i.a.TICKETS.AddNewTicket,s.b.TICKET).then(function(){Object(a.b)("Ticket Added")}).catch(function(e){Object(a.a)("Error occured while saving Ticket.")})];case 1:return[2,t.sent()]}})})},t.h=function(e,t,n){return o(this,void 0,void 0,function(){return r(this,function(o){switch(o.label){case 0:return[4,Object(i.f)({buildingName:e,ticketType:t},i.a.TICKETS.AddNewTicketType,s.b.TICKET).then(function(){Object(a.b)("Ticket Type "+(n?"Updated":"Added"))}).catch(function(e){Object(a.a)("Error occured while saving Ticket Type.")})];case 1:return[2,o.sent()]}})})},t.b=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.f)({ticketTypeOntology:e},i.a.TICKETS.DeleteTicketType,s.b.TICKET).then(function(){Object(a.b)("Ticket Type Deleted")}).catch(function(e){Object(a.a)("Error occured while deleting Ticket Type.")})];case 1:return[2,t.sent()]}})})},t.f=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,Object(i.e)({},i.a.TICKETS.GetAllTickets,s.b.TICKET,!0)];case 1:return[2,e.sent()]}})})},t.d=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({buildingName:e},i.a.TICKETS.GetTicketTypes,s.b.TICKET)];case 1:return[2,t.sent()]}})})},t.c=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({ticketTypeOntology:e},i.a.TICKETS.GetTicketTypeUsingOntology,s.b.TICKET,!0)];case 1:return[2,t.sent()]}})})},t.e=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({ticketOntology:e},i.a.TICKETS.GetTicketUsingOntology,s.b.TICKET,!0)];case 1:return[2,t.sent()]}})})},t.a=function(e){return o(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,Object(i.f)({ticketOntology:e},i.a.TICKETS.DeleteTicket,s.b.TICKET).then(function(){Object(a.b)("Ticket Deleted")}).catch(function(e){Object(a.a)("Error occured while deleting Ticket.")})];case 1:return[2,t.sent()]}})})};var a=n(24),s=n(20),i=n(12),o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}c((a=a.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}}},3443:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=(n.n(a),n(24)),i=n(116),o=n(1097),r=n(20),c=n(10),l=n(713),u=n(673),d=n(660),m=n(848),g=n(656),p=n(23),b=n(772),f=n(659),h=n(11),v=n(118),y=n(704),T=n(1199),k=n(770),O=n(668),E=n(702),w=n(3444),j=n(661),N=n(56),S=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),C=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}c((a=a.apply(e,t||[])).next())})},x=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},D="",A=function(e){function t(t){var n=e.call(this,t)||this;return n.state={building:"Select Building",ticketType:"",_buildings:[],_floors:[],_spaces:[],_assets:[],_components:[],_ticketType:[],ticketObject:{customerName:"",timeStamp:"",customerEmail:"",ticketTypeOntology:"",componentOntology:"",enteredBy:"",acutalFindFix:"",assetOntology:"",buildingOntology:n.props.buildingName,ticketIssue:"",criticalityOntology:"",facilatatorOntology:"",floorOntology:"",imageUrl:"",ontology:(new Date).Ticket_Number(),spaceOntology:"",suggestionFix:""},phaseTemplateDetailList:[],emailsList:[],peopleList:[],actions:[],isTicketSaved:!1,departments:[],StageOntology:"",subTaskOntology:"",wfOntology:""},n.ticketTypeChangeHandler=n.ticketTypeChangeHandler.bind(n),n.buildingChangeHandler=n.buildingChangeHandler.bind(n),n.getFloorBasesOnBuildingHandler=n.getFloorBasesOnBuildingHandler.bind(n),n.floorChangeHandler=n.floorChangeHandler.bind(n),n.getSpacesBasedOnFloorHandler=n.getSpacesBasedOnFloorHandler.bind(n),n.spaceChangeHandler=n.spaceChangeHandler.bind(n),n.getAssetsHandler=n.getAssetsHandler.bind(n),n.assetChangeHandler=n.assetChangeHandler.bind(n),n.getComponentsHandler=n.getComponentsHandler.bind(n),n.checkingValidations=n.checkingValidations.bind(n),n.saveTicketHandler=n.saveTicketHandler.bind(n),n.handleActivateStage=n.handleActivateStage.bind(n),n._fetchDepartmentOrGroup=n._fetchDepartmentOrGroup.bind(n),n.handleAssignTo=n.handleAssignTo.bind(n),n}return S(t,e),t.prototype.componentDidMount=function(){return C(this,void 0,void 0,function(){var e,t,n,a,s,i,o=this;return x(this,function(c){switch(c.label){case 0:return[4,this._fetchBuildings()];case 1:return c.sent(),[4,Object(p.x)(this.props.buildingName)];case 2:return e=c.sent(),[4,Promise.all([this.buildingChangeHandler(this.props.buildingName,e),this._fetchTicketTypes(this.props.buildingName),this._fetchPhaseTemplateDetails(this.props.buildingName),this._fetchContact(this.props.buildingName),this._fetchDepartmentOrGroup()])];case 3:return c.sent(),this.props.ticketOntology?[4,Object(T.e)(this.props.ticketOntology)]:[3,6];case 4:return t=c.sent(),[4,Promise.all([Object(f.d)(t.floorOntology,t.buildingOntology),Object(l.g)(t.buildingOntology,r.b.POINT,t.floorOntology,t.spaceOntology),Object(g.n)(t.buildingOntology,t.assetOntology)])];case 5:return n=c.sent(),a=n[0],s=n[1],i=n[2],this.setState({ticketObject:Object(),_spaces:a,_assets:s,_components:i},function(){o.setState({ticketObject:t})}),[3,7];case 6:this.setState({building:this.props.buildingName}),c.label=7;case 7:return[2]}})})},t.prototype.componentWillUnmount=function(){return C(this,void 0,void 0,function(){return x(this,function(e){return this.setState({ticketObject:Object(),_spaces:[],_assets:[],_components:[]}),[2]})})},t.prototype._fetchBuildings=function(){return C(this,void 0,void 0,function(){var e=this;return x(this,function(t){switch(t.label){case 0:return[4,Object(u.d)().then(function(t){e.setState({_buildings:t}),e.buildingChangeHandler(t[0].building.value,t[0].rdfsLabel.value)}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype._fetchTicketTypes=function(e){return C(this,void 0,void 0,function(){var t=this;return x(this,function(n){switch(n.label){case 0:return[4,Object(T.d)(e).then(function(e){t.setState({_ticketType:e})}).catch(function(e){return e})];case 1:return n.sent(),[2]}})})},t.prototype._fetchPhaseTemplateDetails=function(e){return C(this,void 0,void 0,function(){var t=this;return x(this,function(n){switch(n.label){case 0:return[4,Object(k.j)(e).then(function(e){t.setState({phaseTemplateDetailList:e})}).catch(function(e){return e})];case 1:return n.sent(),[2]}})})},t.prototype._fetchContact=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return[4,Object(d.s)(e)];case 1:return(t=n.sent())&&this.setState({peopleList:t}),[2]}})})},t.prototype._fetchDepartmentOrGroup=function(){return C(this,void 0,void 0,function(){var e=this;return x(this,function(t){switch(t.label){case 0:return[4,Object(d.h)().then(function(t){t&&t.length>0&&e.setState({departments:t})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.ticketTypeChangeHandler=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){return t=this.state.ticketObject,this.setState({ticketType:e}),t.ticketTypeOntology=e,[2]})})},t.prototype.buildingChangeHandler=function(e,t){return C(this,void 0,void 0,function(){var n;return x(this,function(a){switch(a.label){case 0:return(n=this.state.ticketObject).buildingOntology=e,n.buildingLabel=t,this.setState({ticketObject:n,building:e}),Object(i.a)(!0),[4,Promise.all([this.getFloorBasesOnBuildingHandler(e),this._fetchTicketTypes(e),this._fetchPhaseTemplateDetails(e),this._fetchContact(e)])];case 1:return a.sent(),Object(i.a)(!1),[2]}})})},t.prototype.getFloorBasesOnBuildingHandler=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return[4,Object(O.f)(e)];case 1:return t=n.sent(),this.setState({_floors:t,_spaces:[],_assets:[],_components:[]}),[2]}})})},t.prototype.floorChangeHandler=function(e,t){return C(this,void 0,void 0,function(){var n;return x(this,function(a){return(n=this.state.ticketObject).floorOntology=e,n.floorLabel=t,this.setState({ticketObject:n}),this.getSpacesBasedOnFloorHandler(e),[2]})})},t.prototype.getSpacesBasedOnFloorHandler=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return[4,Object(f.d)(e,this.state.building)];case 1:return t=n.sent(),this.setState({_spaces:t,_assets:[],_components:[]}),[2]}})})},t.prototype.spaceChangeHandler=function(e,t){return C(this,void 0,void 0,function(){var n;return x(this,function(a){return(n=this.state.ticketObject).spaceOntology=e,n.spaceLabel=t,this.setState({ticketObject:n}),this.getAssetsHandler(e),[2]})})},t.prototype.getAssetsHandler=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return""==e?(this.setState({_assets:[],_components:[]}),[2]):[4,Object(l.g)(this.state.building,r.b.POINT,this.state.ticketObject.floorOntology,e)];case 1:return t=n.sent(),this.setState({_assets:t,_components:[]}),[2]}})})},t.prototype.assetChangeHandler=function(e,t){return C(this,void 0,void 0,function(){var n;return x(this,function(a){return(n=this.state.ticketObject).assetOntology=e,n.assetLabel=t,this.setState({ticketObject:n}),this.getComponentsHandler(e),[2]})})},t.prototype.getComponentsHandler=function(e){return C(this,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return[4,Object(g.n)(this.state.building,e)];case 1:return t=n.sent(),this.setState({_components:t}),[2]}})})},t.prototype.componentChangeHandler=function(e,t){return C(this,void 0,void 0,function(){var n;return x(this,function(a){return(n=this.state.ticketObject).componentOntology=e,n.componentLabel=t,this.setState({ticketObject:n}),[2]})})},t.prototype.checkingValidations=function(e,t){document.getElementById(e).classList.add("text-success"),document.getElementById(t).classList.add("is-valid")},t.prototype.saveTicketHandler=function(e){return void 0===e&&(e=!1),C(this,void 0,void 0,function(){var t,n,a,s,o,r,l,d,g,f,v,k,O,E,w,j,S,D=this;return x(this,function(A){switch(A.label){case 0:return Object(i.a)(!0),t=this.state,n=t.ticketObject,a=t._ticketType,s=t.wfOntology,o=t.StageOntology,r=t.subTaskOntology,l=n.buildingOntology,document.getElementById("btnSave").setAttribute("disabled","disabled"),this.props.isEdit?[3,6]:(d=JSON.parse(h.a.getItem("user")),n.enteredBy=d.contact,g=n.ticketTypeOntology,f=a.find(function(e){return e.ontology==g}).notifyManager,[4,Object(T.c)(g)]);case 1:v=A.sent(),k=v.split(","),O=function(e){var t,a,i,u,d,g,h,v,T,O,w,j,N,S;return x(this,function(A){switch(A.label){case 0:for(t=E.state.phaseTemplateDetailList.find(function(t){return t.ontology===k[e]}),a="Dynamic"==t.behaviour,i=[],u=0;u<t.stageTemplates.length;u++)(i=t.stageTemplates[u].subTasks.map(function(e){return e.ontology})).push.apply(i,i);return[4,Object(b.c)(l,i)];case 1:d=A.sent(),(g=Object()).ontology=Object(p.w)(7),s=s+g.ontology+",",g.description=t.description,g.module=t.module,g.status="Planned",g.phaseID=Object(p.u)(7).toString(),g.templateID=t.templateID,g.templateType=t.templateType,g.stageTemplateOnology=[],g.ticketOntology=n.ontology,g.stages=[],g.estimatedStartTime=t.estimatedStartTime,g.estimatedEndTime=t.estimatedEndTime,h=[],v=t.facilitatorAssigned,h[0]=Object(),h[0].label=v,h[0].value=v,g.facilitatorAssigned=h[0],g.notifyManager=f,T=[],O=[],w=function(e){var s,i,u,b,f,h,v,y,k,w,j;return x(this,function(N){switch(N.label){case 0:for(s=t.stageTemplates[e],i=Object(),u=Object(p.w)(7),i.task=u,b="",b+=Object(p.v)(),i.color=b,o=o+u+",",i.wfOntology=g.ontology,i.taskNumber=Object(p.u)(7).toString(),i.description=s.description,i.action=s.action,i.enteredBy=s.enteredBy,i.enteredByName=s.enteredByName,i.assignedTo=s.assignedTo,s.assignedDepartment&&""!=s.assignedDepartment&&(f=E.state.peopleList&&E.state.peopleList.find(function(e){return Object(c.g)(e.departmentsAndGroups).includes(s.assignedDepartment)&&Object(c.g)(e.assignedTo).includes(s.building)&&"2"==Object(c.g)(e.role)}),i.assignedTo=void 0!==f?[{label:Object(c.g)(f.name),value:Object(c.g)(f.contact)}]:s.assignedTo),i.hasChat=!0,i.entryTimeStamp=s.entryTimeStamp,i.criticality=s.criticality,i.equipSubject=s.equipSubject,i.equipRdfsLabel=s.equipRdfsLabel,i.spaceSubject=s.spaceSubject,i.spaceRdfsLabel=s.spaceRdfsLabel,i.floor=s.floor,i.building=s.building,i.workOrder=s.workOrder,i.status="Pending",i.acknowledged=!0,i.archived=!1,i.startTime="",i.note="",i.isSequence=!0,i.QRTag=s.QRTag,i.isQRTask=s.isQRTask,i.subTasks=[],i.workflowType=s.workflowType,i.redirectionLink=s.redirectionLink,i.isStage=!0,i.isActivated=!1,i.estimatedStartTime=new Date,i.workflowDescription=t.description,h=0,v=0;v<s.subTasks.length;v++)y=s.subTasks[v],h+=parseInt(y.duration);k=i.subTasks.length>0?new Date(i.subTasks[0].estimatedStartTime):new Date,i.estimatedEndTime=new Date(k.setHours(k.getHours()+h)),i.ticketOntology=n.ontology,i.subTasks=[],w=function(e){var t,o,u,f,h,v,y,k,E,w,j,N;return x(this,function(S){switch(S.label){case 0:return t=s.subTasks[e],(o=Object()).subTask=Object(p.w)(7),o.color=b,r=r+o.subTask+",",[4,Object(m.d)(l,["TaskTemplate"],[t.ontology])];case 1:if((u=S.sent())&&u.length>0&&u[0].entityOntology)for(f=0;f<u.length;f++)h=Object(),v=u[f],h.docOntology=o.subTask+Object(p.A)()+f,h.building=Object(c.g)(v.building),h.documentType=Object(c.g)(v.documentType),h.enteredBy=Object(c.g)(v.enteredBy),h.entityOntology=[{label:o.subTask,value:o.subTask}],h.entityType="Task",h.entryTimeStamp=(new Date).toString(),h.rdfsLabel=Object(c.g)(v.rdfsLabel),h.s3FileName=Object(c.g)(v.s3FileName),O.push(h);for(o.taskNumber=Object(p.u)(7).toString(),o.description=t.description,o.action=t.action,o.enteredBy=t.enteredBy,o.enteredByName=t.enteredByName,o.assignedTo=t.assignedTo,o.assignedDepartment=t.assignedDepartment,o.hasChat=!0,o.entryTimeStamp=t.entryTimeStamp,o.criticality=t.criticality,o.equipSubject=i.equipSubject,o.equipRdfsLabel=i.equipRdfsLabel,o.spaceSubject=i.spaceSubject,o.spaceRdfsLabel=i.spaceRdfsLabel,o.building=i.building,o.workOrder=t.workOrder,o.status="Planned",o.acknowledged=!0,o.archived=!1,o.index=t.index,o.parentTask=i.task,o.note=t.note,o.relatedLink=t.relatedLink,o.duration=t.duration,o.durationUnit=t.durationUnit,o.workerDuration=t.workerDuration,o.workerDurationUnit=t.workerDurationUnit,o.fileName=t.fileName,o.oldFileName=t.oldFileName,o.startTime="",o.workType=t.workType,o.checklistID=t.checklistID,o.isQRTask=t.isQRTask,o.QRTag=t.QRTag,o.notifyViaEmail=t.notifyViaEmail,o.notifyViaSMS=t.notifyViaSMS,o.estimatedStartTime=t.estimatedStartTime,o.estimatedEndTime=t.estimatedEndTime,o.workflowType=t.workflowType,o.redirectionLink=t.redirectionLink,o.isStage=!0,o.isActivated=!1,o.acknowledged=!0,o.archived=!1,o.ticketOntology=n.ontology,o.wfOntology=g.ontology,i.subTasks.push(o),y=d.filter(function(e){return e.taskOntology==t.ontology}),k=0;k<y.length;k++)E=y[k],(w=Object()).ontology=Object(p.w)(10),w.directive=E.directive,w.directiveType=E.directiveType,w.floorOntology=a?n.floorOntology:E.floorOntology,w.spaceOntology=a?n.spaceOntology:E.spaceOntology,w.componentOntology=a?n.componentOntology:E.componentOntology,w.assetOntology=a?n.assetOntology:E.assetOntology,w.pointOntology=a?"":E.pointOntology,w.unit=E.unit,w.taskOntology=o.subTask,w.taskDescription=E.taskDescription,w.isTemplate=!1,w.objectTemplateReferenceID=E.ontology,w.isQrCodeVerified=!1,w.qrCode=E.qrCode,w.visibleObjectFormActions=[],T.push(w);for(j=function(e){var t=T[e],n=d.find(function(e){return e.ontology==t.objectTemplateReferenceID});if(n.visibleObjectFormActions&&n.visibleObjectFormActions.length>0)for(var a=function(e){var a=n.visibleObjectFormActions[e];if(""!=a){var s=d.find(function(e){return e.ontology==a}),i=T.find(function(e){return e.objectTemplateReferenceID==s.ontology});-1==t.visibleObjectFormActions.findIndex(function(e){return e==i.ontology})&&t.visibleObjectFormActions.push(i.ontology)}},s=0;s<n.visibleObjectFormActions.length;s++)a(s)},N=0;N<T.length;N++)j(N);return[2]}})},j=0,N.label=1;case 1:return j<s.subTasks.length?[5,w(j)]:[3,4];case 2:N.sent(),N.label=3;case 3:return j++,[3,1];case 4:return g&&g.stages&&g.stages.push(i),[2]}})},j=0,A.label=2;case 2:return j<t.stageTemplates.length?[5,w(j)]:[3,5];case 3:A.sent(),A.label=4;case 4:return j++,[3,2];case 5:return N=Object(y.e)(new Date,g),O.length>0&&O.map(function(e){return C(D,void 0,void 0,function(){return x(this,function(t){switch(t.label){case 0:return[4,Object(m.f)(e)];case 1:return t.sent(),[2]}})})}),[4,Object(b.e)(l,T)];case 6:return A.sent(),[4,Object(y.f)(l,N,!1,!0).then(function(e){return C(D,void 0,void 0,function(){return x(this,function(e){return[2]})})}).catch(function(e){return e})];case 7:return A.sent(),t.stageTemplateOnology&&t.stageTemplateOnology.length>0?(S=t.uses?t.uses+1:1,[4,Object(y.g)(l,t.ontology,S.toString()).then(function(e){}).catch(function(e){return e})]):[3,9];case 8:A.sent(),A.label=9;case 9:return[2]}})},E=this,w=0,A.label=2;case 2:return w<k.length?[5,O(w)]:[3,5];case 3:A.sent(),A.label=4;case 4:return w++,[3,2];case 5:return[3,8];case 6:return[4,Object(T.a)(n.ontology)];case 7:A.sent(),A.label=8;case 8:return n.status="Created",this.props.isEdit?[3,11]:[4,Object(u.d)(n.buildingOntology)];case 9:return j=A.sent(),s=s.substr(0,s.length-1),o=o.substr(0,o.length-1),r=r.substr(0,r.length-1),n.deployedWFOntology=s,n.stageOntology=o,n.subTasksOntology=r,""===n.customerEmail?[3,11]:((S=Object()).subject="Ticket Creation Notification",S.to=n.customerEmail,S.text="<div style='color: black'>",S.text+="A new ticket having case# <b>"+n.ontology+"</b> has been created, associated with the issue: "+n.ticketIssue+".",n.buildingLabel&&""!=n.buildingLabel&&(S.text+="<br>Building: "+n.buildingLabel),n.floorLabel&&""!=n.floorLabel&&(S.text+="<br>Floor: "+n.floorLabel),n.spaceLabel&&""!=n.spaceLabel&&(S.text+="<br>Space: "+n.spaceLabel),n.assetLabel&&""!=n.assetLabel&&(S.text+="<br>Asset: "+n.assetLabel),S.text+="<br>If you have questions, please contact with Response Center.",S.text+="<br>Thank you for allowing us to serve you.",S.text+="<br>Response Center: <br>"+(j[0].responseCenterName&&""!=j[0].responseCenterName.value?j[0].responseCenterName.value:"Operate My Building")+"<br>"+(j[0].responseCenterPhoneNo&&""!=j[0].responseCenterPhoneNo.value?j[0].responseCenterPhoneNo.value:"+1 (516) 256 3000")+"<br>"+(j[0].responseCenterEmail&&""!=j[0].responseCenterEmail.value?j[0].responseCenterEmail.value:"notify@operatemybuilding.com"),S.text+="</div>",[4,Object(N.a)(S,!0)]);case 10:A.sent(),A.label=11;case 11:return[4,Object(T.g)(n)];case 12:return A.sent(),Object(i.a)(!1),this.setState({isTicketSaved:!0},function(){e&&window.open("http://"+Object(p.s)()+"/#"+D.props.instance+"/"+l+"/Deploy/WorkflowView/"+n.deployedWFOntology.split(",")[0],"_blank")}),[2]}})})},t.prototype.activateWorkflows=function(){return C(this,void 0,void 0,function(){return x(this,function(e){return Object(i.a)(!0),Object(i.a)(!1),[2]})})},t.prototype.handleAssignTo=function(e){var t=this.state.ticketObject;t.notifyPeople=e,this.setState({ticketObject:t})},t.prototype.handleActivateStage=function(e,t,n){return C(this,void 0,void 0,function(){var a,o,r,l,u,d;return x(this,function(m){switch(m.label){case 0:if(a=this.state.ticketObject.buildingOntology,o=this.state.peopleList,r=this.state.emailsList,e.startTime=n&&null!=n?0==n?new Date(Date.now()).toString():"":new Date(Date.now()).toString(),e.startTaskCondition=n&&null!=n?0==n?"daytime":"completionof":"daytime",e.conditionalTasks=n&&null!=n?0==n?[]:[{label:D,value:D}]:[],e.status=n&&null!=n?0==n?"Assigned":"Pending":"Assigned",e.acknowledged=!0,e.isSequence=!0,e.archived=!1,e.isDeleted=!1,e.isActivated=!0,e.workflowType=e.workflowType?e.workflowType:t,e.assignedTo&&e.assignedTo.length>0)for(l=function(t){if(e.assignedTo[t]&&e.assignedTo[t].value){var n=o&&o.find(function(n){return Object(c.g)(n.contact)==e.assignedTo[t].value});if(r||(r=[]),n&&n.email)r.find(function(e){return e==Object(c.g)(n.email)})||r.push(Object(c.g)(n.email))}},d=0;d<e.assignedTo.length;d++)l(d);for(e.hasChat=!0,u=function(a){if(e.subTasks[a].workflowType=e.workflowType?e.workflowType:t,e.subTasks[a].isActivated=!0,e.subTasks[a].assignedTo&&e.subTasks[a].assignedTo.length>0){var s=o&&o.find(function(t){return Object(c.g)(t.contact)==e.subTasks[a].assignedTo});if(r||(r=[]),s&&s.email)r.find(function(e){return e==Object(c.g)(s.email)})||r.push(Object(c.g)(s.email))}e.subTasks[a].startTime=n&&null!=n?0==n&&0==a?new Date(Date.now()).toString():"":0==a?new Date(Date.now()).toString():"",e.subTasks[a].status=n&&null!=n?0==n&&0==a?"Assigned":"Pending":0==a?"Assigned":"Pending",e.subTasks[a].acknowledged=!0,e.subTasks[a].isDeleted=!1,e.subTasks[a].startTaskCondition=n&&null!=n?0==n&&0==a?"daytime":"completionof":0==a?"daytime":"completionof",e.subTasks[a].conditionalTasks=n&&null!=n?0==n&&0==a?[]:n>0&&0==a?[{label:D,value:D}]:[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:a>0?[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:[],D=e.task},d=0;d<e.subTasks.length;d++)u(d);return Object(i.a)(!0),"Contract"!=t?[3,2]:[4,Object(v.B)(r,["read"],e.contractFileName).then(function(t){if(t.link){var n=t.link[0].link.webUrl;e.contractFileUrl=n;for(var o=0;o<e.subTasks.length;o++){e.subTasks[o].contractFileUrl=n}Object(v.y)(a,e,!0),Object(y.h)("","Assigned",!0).then(function(){}),Object(i.a)(!1)}else console.log(t),Object(s.a)("Error occured while requesting permissions for Contract File.")})];case 1:return m.sent(),[3,5];case 2:return[4,Object(v.y)(a,e,!0)];case 3:return m.sent(),[4,Object(y.h)("","Assigned",!0).then(function(){})];case 4:m.sent(),Object(i.a)(!1),m.label=5;case 5:return[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.instance,s=t.buildingName,i=t.isView,l=t.isEdit,u=this.state,d=u._floors,m=u._spaces,g=u._assets,b=u._components,f=u._ticketType,h=u.ticketObject,v=u.departments,y=u.peopleList,T=u._buildings,k=this.state.isTicketSaved?"block":"none",O=y&&y.length>0?y.map(function(e){return{value:Object(c.g)(e.contact),label:e.name?Object(c.g)(e.name)+" ("+r.e[Object(c.g)(e.role)]+")":Object(c.g)(e.contact)+" ("+Object(c.g)(e.qualifications)+")"}}).filter(function(e){return Object(c.g)(e)!=(h.notifyPeople&&h.notifyPeople.find(function(t){return Object(c.g)(t)==Object(c.g)(e)})?Object(c.g)(h.notifyPeople.find(function(t){return Object(c.g)(t)==Object(c.g)(e)})):"")}):[],N=""!==h.ticketTypeOntology&&""!==h.ticketIssue,S=h.deployedWFOntology&&h.deployedWFOntology.split(",");return a.createElement(a.Fragment,null,a.createElement("div",{className:""},a.createElement("div",{className:""},a.createElement("div",{className:""},a.createElement("div",{className:"content"},a.createElement("div",{className:"container-fluid small"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-lg-6 col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2 no-margin"},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"content"},a.createElement("div",{className:"row no-margin p-2"},a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Building: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:(h.ontology?"":"addFieldValidate")+" form-control",name:"building",disabled:i||l,value:h.buildingOntology,id:"building",onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.buildingChangeHandler(t.target.value,a)}},T&&T.length>0&&T.map(function(e,t){return a.createElement("option",{key:t,value:Object(c.g)(e.building)},Object(c.g)(e.rdfsLabel)," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"ONIT Case Type: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{name:"ticketType",id:"ticketType",className:(h.ticketTypeOntology?"":"addFieldValidate")+" form-control",value:h.ticketTypeOntology,disabled:i||l,onChange:function(t){e.ticketTypeChangeHandler(t.target.value)}},a.createElement("option",{value:""},"Select Case Type "),f&&f.length>0&&f.map(function(e,t){return a.createElement("option",{key:t,value:e.ontology},e.ticketType," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{id:"issueLabel",className:"col-md-3 py-2 px-0 headingText"}," Describe the Issue:"),a.createElement("div",{className:"col-md-9 no-padding "},a.createElement("textarea",{id:"issue",rows:6,className:(h.ticketIssue?"":"addFieldValidate")+" form-control",value:h.ticketIssue,disabled:i,style:{width:"422px !important",resize:"none"},onChange:function(t){h.ticketIssue=t.target.value,e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Floor: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"floor",name:"floor",disabled:i,value:h.floorOntology,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.floorChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Floor"),d&&d.length>0&&d.map(function(e,t){return a.createElement("option",{value:Object(c.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Space: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"space",name:"space",value:h.spaceOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.spaceChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Space"),m&&m.length>0&&m.map(function(e,t){return a.createElement("option",{value:Object(c.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Asset: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"asset",name:"asset",value:h.assetOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.assetChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Assets"),g&&g.length>0&&g.map(function(e,t){return a.createElement("option",{value:Object(c.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Component: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"component",name:"component",value:h.componentOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.componentChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Component"),b&&b.length>0&&b.map(function(e,t){return a.createElement("option",{value:Object(c.g)(e.name),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Concern: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{name:"ticketType",id:"ticketType",className:"form-control",value:h.criticalityOntology,disabled:i,onChange:function(t){h.criticalityOntology=t.target.value,e.setState({ticketObject:h})}},a.createElement("option",{value:""},"Select Concern"),o.c&&o.c.length>0&&o.c.map(function(e,t){return a.createElement("option",{key:t,value:e.id}," ",e.id," - ",e.name," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Suggest Fix: "),a.createElement("div",{className:"col-md-9 no-padding "},a.createElement("textarea",{rows:4,className:"form-control",value:h.suggestionFix,disabled:i,onChange:function(t){h.suggestionFix=t.target.value,e.setState({ticketObject:h})}})))))))),a.createElement("div",{className:"col-lg-6 col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2 no-margin"},a.createElement("div",{className:"container-fluid p-1"},a.createElement("div",{className:"content p-1"},a.createElement("div",{className:"row no-margin p-2"},a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Customer Name: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("input",{className:"form-control",name:"customerName",id:"customerName",type:"text",value:h.customerName,disabled:i,onChange:function(t){h.customerName=t.target.value,e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Customer Email: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("input",{className:"form-control",name:"customerEmail",id:"customerEmail",value:h.customerEmail,disabled:i,onChange:function(t){h.customerEmail=t.target.value,e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Notify People: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement(j.a,{id:"assignTo",isMulti:!0,closeMenuOnSelect:!1,isDisabled:i,value:h.notifyPeople?h.notifyPeople:[],onChange:this.handleAssignTo,placeholder:"Select Person(s)",options:O}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Department Assigned: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",name:"department",id:"department",value:h.departmentAssigned,disabled:i,onChange:function(t){h.departmentAssigned=t.target.value,e.setState({ticketObject:h})}},a.createElement("option",{value:""},"Select Department"),v&&v.length>0&&v.map(function(e,t){return a.createElement("option",{key:t,value:e},e)}))))))))),a.createElement("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2"},a.createElement("div",{className:"row py-0 no-margin p-2"},h&&h.buildingOntology&&a.createElement(E.a,{showUploader:!i,buildingName:h.buildingOntology,assetOntology:this.props.ticketOntology?this.props.ticketOntology:h.ontology,entityType:"Tickets",uploaderID:this.props.ticketOntology?this.props.ticketOntology:h.ontology})))),S&&a.createElement("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2"},a.createElement("h3",{className:"text-center"},"WorkFlow Status"),S&&S.map(function(t,n){return a.createElement("div",{key:n,className:"card p-2"},a.createElement("div",{className:"row py-0 no-margin p-2"},t&&h&&h.buildingOntology&&a.createElement(w.a,{instance:e.props.instance,buildingName:h.buildingOntology,ontology:t})))}))),a.createElement("br",null),a.createElement("div",{className:"col-md-12 inline-block"},a.createElement("div",{className:"form-inline inline-block"},!this.props.isView&&a.createElement(a.Fragment,null,a.createElement("button",{disabled:!N,id:"btnSave",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return C(e,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this.saveTicketHandler()];case 1:return e.sent(),[4,setTimeout(function(){window.history.back()},1e3)];case 2:return e.sent(),[2]}})})}},a.createElement("i",{className:"fa fa-save"}),"Save"),a.createElement("button",{disabled:!N,id:"btnSave",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return C(e,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this.saveTicketHandler(!0)];case 1:return e.sent(),[2]}})})}},a.createElement("i",{className:"fa fa-save"}),"Save & Redirect")),h.deployedWFOntology&&S.map(function(t,i){return a.createElement("button",{key:i,style:{display:k},id:"redirectBtn",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return C(e,void 0,void 0,function(){return x(this,function(e){return window.open("http://"+Object(p.s)()+"/#"+n+"/"+s+"/Deploy/WorkflowView/"+t,"_blank"),[2]})})}},a.createElement("i",{className:"fa fa-location-arrow"}),"Navigate to Deployed WF")}))))))))))},t}(a.Component);t.default=A},3444:function(e,t,n){"use strict";var a,s=n(2),i=(n.n(s),n(116)),o=n(704),r=n(10),c=n(24),l=n(118),u=n(660),d=n(23),m=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),g=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}c((a=a.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},b="",f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={phase:Object(),emailsList:[],peopleList:[]},a=n,n.getPhaseDetail=n.getPhaseDetail.bind(n),n.handleActivateStage=n.handleActivateStage.bind(n),n.handleActivatePhase=n.handleActivatePhase.bind(n),n.validatePhaseAssignments=n.validatePhaseAssignments.bind(n),n.validateStageAssignments=n.validateStageAssignments.bind(n),n._fetchContact=n._fetchContact.bind(n),n}return m(t,e),t.prototype.componentDidMount=function(){return g(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return this.props.buildingName?(Object(i.a)(!0),[4,this._fetchContact()]):[3,4];case 1:return e.sent(),this.props.ontology?[4,this.getPhaseDetail()]:[3,3];case 2:e.sent(),e.label=3;case 3:Object(i.a)(!1),e.label=4;case 4:return[2]}})})},t.prototype._fetchContact=function(){return g(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return[4,Object(u.s)(this.props.buildingName)];case 1:return(e=t.sent())&&a.setState({peopleList:e}),[2]}})})},t.prototype.getPhaseDetail=function(){return g(this,void 0,void 0,function(){var e=this;return p(this,function(t){switch(t.label){case 0:return[4,Object(o.c)(this.props.buildingName,this.props.ontology).then(function(t){if(t.length){if("Completed"!==t[0].status)t[0].stages.every(function(e){return"Completed"==e.status})&&Object(o.h)(t[0].ontology,"Completed",!0);e.setState({phase:t[0]})}})];case 1:return t.sent(),[2]}})})},t.prototype.handleActivatePhase=function(e){return g(this,void 0,void 0,function(){var t,n;return p(this,function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<e.stages.length?(n=e.stages[t],[4,this.handleActivateStage(n,e.templateType,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},t.prototype.handleActivateStage=function(e,t,n){return g(this,void 0,void 0,function(){var a,s,c,u,d,m,g=this;return p(this,function(p){switch(p.label){case 0:if(a=this.props.buildingName,s=this.state.peopleList,c=this.state.emailsList,e.startTime=n&&null!=n?0==n?new Date(Date.now()).toString():"":new Date(Date.now()).toString(),e.startTaskCondition=n&&null!=n?0==n?"daytime":"completionof":"daytime",e.conditionalTasks=n&&null!=n?0==n?[]:[{label:b,value:b}]:[],e.status=n&&null!=n?0==n?"Assigned":"Pending":"Assigned",e.acknowledged=!0,e.isSequence=!0,e.archived=!1,e.isDeleted=!1,e.isActivated=!0,e.workflowType=e.workflowType?e.workflowType:t,e.assignedTo&&e.assignedTo.length>0)for(u=function(t){if(e.assignedTo[t]&&e.assignedTo[t].value){var n=s&&s.find(function(n){return Object(r.g)(n.contact)==e.assignedTo[t].value});if(c||(c=[]),n&&n.email)c.find(function(e){return e==Object(r.g)(n.email)})||c.push(Object(r.g)(n.email))}},m=0;m<e.assignedTo.length;m++)u(m);for(e.hasChat=!0,d=function(a){if(e.subTasks[a].workflowType=e.workflowType?e.workflowType:t,e.subTasks[a].isActivated=!0,e.subTasks[a].assignedTo&&e.subTasks[a].assignedTo.length>0){var i=s&&s.find(function(t){return Object(r.g)(t.contact)==e.subTasks[a].assignedTo});if(c||(c=[]),i&&i.email)c.find(function(e){return e==Object(r.g)(i.email)})||c.push(Object(r.g)(i.email))}e.subTasks[a].startTime=n&&null!=n?0==n&&0==a?new Date(Date.now()).toString():"":0==a?new Date(Date.now()).toString():"",e.subTasks[a].status=n&&null!=n?0==n&&0==a?"Assigned":"Pending":0==a?"Assigned":"Pending",e.subTasks[a].acknowledged=!0,e.subTasks[a].isDeleted=!1,e.subTasks[a].startTaskCondition=n&&null!=n?0==n&&0==a?"daytime":"completionof":0==a?"daytime":"completionof",e.subTasks[a].conditionalTasks=n&&null!=n?0==n&&0==a?[]:n>0&&0==a?[{label:b,value:b}]:[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:a>0?[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:[],b=e.task},m=0;m<e.subTasks.length;m++)d(m);return Object(i.a)(!0),[4,Object(l.y)(a,e,!0)];case 1:return p.sent(),[4,Object(o.h)("","Assigned",!0).then(function(){g.getPhaseDetail()})];case 2:return p.sent(),Object(i.a)(!1),[2]}})})},t.prototype.validatePhaseAssignments=function(e){var t=!0;if(e.stages&&e.stages.length>0)for(var n=0;n<e.stages.length;n++){var a=e.stages[n];if(a.assignedTo&&a.assignedTo.length>0){if(-1!=a.subTasks.findIndex(function(e){return""==e.assignedTo})){t=!1;break}t=!0}else t=!1}t?document.getElementById("btnActivatePhase").click():Object(c.a)("Not all Tasks have assignments, please assign all tasks.")},t.prototype.validateStageAssignments=function(e,t){var n=!0;e.assignedTo&&e.assignedTo.length>0?n=-1==e.subTasks.findIndex(function(e){return""==e.assignedTo}):n=!1;n?document.getElementById("btnActivateStage"+t).click():Object(c.a)("Not all Tasks have assignments, please assign all tasks.")},t.prototype.render=function(){var e=this,t=this.props,n=t.showGraphOnly,a=t.instance,i=t.buildingName,o=this.state.phase;return s.createElement("div",{className:n?"col-md-12":"content"},s.createElement("div",{className:n?"row padding-10":"container-fluid"},s.createElement("div",{className:"row"}),s.createElement("br",null),s.createElement("div",null,s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12  img-thumbnail",style:{background:"#b8d8f9"}},s.createElement("div",{style:{display:"flex"}},s.createElement("div",{className:"col-md-11"},s.createElement("div",{style:{display:"grid"}},s.createElement("label",{style:{cursor:"default"}}," ",s.createElement("h5",{style:{color:"black",marginBottom:"9px"}}," ",s.createElement("b",null,o&&o.description," "))," "),s.createElement("span",{style:{color:"#666666"}},"Workflow ID: ",o.phaseID))),s.createElement("a",{style:{textAlign:"center",alignSelf:"center"},onClick:function(){return g(e,void 0,void 0,function(){return p(this,function(e){return window.open("http://"+Object(d.s)()+"/#"+a+"/"+i+"/Deploy/WorkflowView/"+o.ontology,"_blank"),[2]})})}},s.createElement("div",{className:"col-md-1",style:{cursor:"pointer"}},s.createElement("i",{className:"fa fa-arrow-right",style:{fontSize:"25px",color:"#6a87a5"}})))))),o&&o.stages&&o.stages.map(function(e,t){return s.createElement("div",{key:t,className:"row"},s.createElement("div",{className:"col-md-12 row.match-my-cols"},s.createElement("div",{className:"col-md-3 col-sm-3 col-xs-4"},s.createElement("div",{className:"card no-margin left-side-card",id:"discriptionCard"},s.createElement("div",{className:"content no-paddingLR"},s.createElement("div",{className:"container-fluid no-paddingLR"},s.createElement("div",{className:"row no-paddingLR"},s.createElement("div",{className:" "},s.createElement("div",{className:"timeline-item-content left-side-card"},s.createElement("h4",{style:{marginTop:"auto",marginBottom:"auto"}},"Stage ",t+1),s.createElement("label",{className:"headingText"},e.description),e.taskNumber&&s.createElement("label",{className:"small"},"Stage ID: "+e.taskNumber)))))))),e.task&&s.createElement("div",{className:"col-md-9 col-sm-9 col-xs-8"},s.createElement("div",{className:"card no-margin right-side-card",id:"taskCard"},s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"timeline-item"},s.createElement("div",{className:"timeline-item-content no-padding"},s.createElement("span",{className:"no-margin"},s.createElement("ul",null,e&&e.subTasks&&e.subTasks.map(function(e,t){return s.createElement("div",{key:t},e.action&&s.createElement(s.Fragment,null,s.createElement("li",null,s.createElement("label",{title:(e.assignedTo?"Assigned to : "+e.assignedTo:e.assignedTo?"Assigned to : "+e.assignedTo+"  ":"No Assignment")+" "},e.action," \xa0 \xa0 ","Pending"!=e.status&&s.createElement("div",{className:"badge ml-2 stage-task-"+e.status,style:{fontSize:"85%"}},e.status),e.checklistID&&s.createElement("a",{style:{color:"#174b54"},"data-toggle":"collapse","data-target":"#checklist"+t},s.createElement("i",{className:"fa fa-check"}))))))}))),s.createElement("span",{className:"circle stage-"+e.status,title:e&&e.status,style:{top:"50%"}}))))))))),!e.equipSubject&&s.createElement("div",{className:"col-md-9 col-sm-9 col-xs-8"},s.createElement("div",{className:"card no-margin right-side-card",id:"taskCard"},s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("label",{style:{color:"red"}}," STAGE MIGHT HAVE DELETED"))))))))}))))))},t}(s.Component);t.a=f},704:function(e,t,n){"use strict";t.g=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(o){switch(o.label){case 0:return[4,Object(a.f)({buildingName:e,ontology:t,uses:n},a.a.TASKTEMPLATE.UPDATESTAGETEMPLATEUSES,s.b.TASK).then(function(){Object(i.b)('Stage Template Uses "Updated"  Successfully.')}).catch(function(e){Object(i.a)("Error occured while saving Stage Template Uses.")})];case 1:return[2,o.sent()]}})})},t.f=function(e,t,n,o){return c(this,void 0,void 0,function(){return l(this,function(r){switch(r.label){case 0:return[4,Object(a.f)({buildingName:e,model:t,isEdit:n,saveStages:o},a.a.TASKTEMPLATE.SAVEPHASE,s.b.TASK).then(function(){}).catch(function(e){Object(i.a)("Error occured while saving Workflow.")})];case 1:return[2,r.sent()]}})})},t.d=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(i){switch(i.label){case 0:return[4,Object(a.e)({buildingName:e,ontology:t},a.a.TASKTEMPLATE.GETPHASETEMPLATE,s.b.TASK,n)];case 1:return[2,i.sent()]}})})},t.c=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(i){switch(i.label){case 0:return[4,Object(a.e)({buildingName:e,ontology:t},a.a.TASKTEMPLATE.GETPHASEDETAILLIST,s.b.TASK,n)];case 1:return[2,i.sent()]}})})},t.h=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(o){switch(o.label){case 0:return[4,Object(a.f)({taskID:e,status:t},a.a.TASKTEMPLATE.UPDATETASKORSTAGESTATUS,s.b.TASK).then(function(){n||Object(i.b)("Status Updated Successfully.")}).catch(function(e){Object(i.a)("Error occured while update Status.")})];case 1:return[2,o.sent()]}})})},t.b=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(i){switch(i.label){case 0:return[4,Object(a.e)({buildingName:e,pointName:t,assetName:n},a.a.POINTS.GETPOINTS,s.b.POINT,!0)];case 1:return[2,i.sent()]}})})},t.a=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return[4,Object(a.e)({buildingName:e,ontology:t},a.a.DEPENDENCY.GETDEPENDENCY,s.b.TASK,!0)];case 1:return[2,n.sent()]}})})},t.e=function(e,t){var n=[];if(!(t.stages&&t.stages.length&&t.stages.length>0))return void Object(i.a)("Error finding Stages");for(var a=r({},t),s=0;s<a.stages.length;s++){for(var c=[],l=a.stages[s],u=0;u<l.subTasks.length;u++){var d=l.subTasks[u];if(!d.estimatedStartTime||void 0==d.estimatedStartTime)return void Object(i.a)("Not all Template Tasks have Estimate Start Time, To Normalise, provide dates first ");c.push(d.estimatedStartTime)}n.push(c)}for(var s=0;s<n.length;s++)for(var c=n[s],u=0;u<c.length;u++)if(0==s&&0==u)t.stages[s].estimatedStartTime=e,t.stages[s].subTasks[u].estimatedStartTime=e;else if(s>0&&0==u){var m=Object(o.k)(new Date(n[s-1][n[s-1].length-1]),new Date(n[s][u])),g=new Date(t.stages[s-1].subTasks[t.stages[s-1].subTasks.length-1].estimatedStartTime);g.setDate(new Date(t.stages[s-1].subTasks[t.stages[s-1].subTasks.length-1].estimatedStartTime).getDate()+m),t.stages[s].subTasks[u].estimatedStartTime=g,t.stages[s].estimatedStartTime=g}else{var m=Object(o.k)(new Date(n[s][u-1]),new Date(n[s][u])),g=new Date(t.stages[s].subTasks[u-1].estimatedStartTime);g.setDate(new Date(t.stages[s].subTasks[u-1].estimatedStartTime).getDate()+m),t.stages[s].subTasks[u].estimatedStartTime=g}var p=Object(o.k)(new Date(t.estimatedEndTime),new Date(t.estimatedStartTime));t.estimatedStartTime=e;var b=new Date(e);return b.setDate(b.getDate()+p),t.estimatedEndTime=b,t};var a=n(12),s=n(20),i=n(24),o=n(23),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},c=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function r(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}c((a=a.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}}}});