webpackJsonp([20],{1008:function(e,t,n){"use strict";t.g=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.f)(e,i.a.TICKETS.AddNewTicket,s.b.TICKET).then(function(){Object(a.b)("Ticket Added")}).catch(function(e){Object(a.a)("Error occured while saving Ticket.")})];case 1:return[2,t.sent()]}})})},t.h=function(e,t,n){return o(this,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,Object(i.f)({buildingName:e,ticketType:t},i.a.TICKETS.AddNewTicketType,s.b.TICKET).then(function(){Object(a.b)("Ticket Type "+(n?"Updated":"Added"))}).catch(function(e){Object(a.a)("Error occured while saving Ticket Type.")})];case 1:return[2,o.sent()]}})})},t.b=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.f)({ticketTypeOntology:e},i.a.TICKETS.DeleteTicketType,s.b.TICKET).then(function(){Object(a.b)("Ticket Type Deleted")}).catch(function(e){Object(a.a)("Error occured while deleting Ticket Type.")})];case 1:return[2,t.sent()]}})})},t.f=function(){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,Object(i.e)({},i.a.TICKETS.GetAllTickets,s.b.TICKET,!0)];case 1:return[2,e.sent()]}})})},t.d=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({buildingName:e},i.a.TICKETS.GetTicketTypes,s.b.TICKET)];case 1:return[2,t.sent()]}})})},t.c=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({ticketTypeOntology:e},i.a.TICKETS.GetTicketTypeUsingOntology,s.b.TICKET,!0)];case 1:return[2,t.sent()]}})})},t.e=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.e)({ticketOntology:e},i.a.TICKETS.GetTicketUsingOntology,s.b.TICKET,!0)];case 1:return[2,t.sent()]}})})},t.a=function(e){return o(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,Object(i.f)({ticketOntology:e},i.a.TICKETS.DeleteTicket,s.b.TICKET).then(function(){Object(a.b)("Ticket Deleted")}).catch(function(e){Object(a.a)("Error occured while deleting Ticket.")})];case 1:return[2,t.sent()]}})})};var a=n(21),s=n(13),i=n(11),o=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function c(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,c)}l((a=a.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}},3037:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=(n.n(a),n(21)),i=n(118),o=n(890),c=n(13),l=n(12),r=n(725),u=n(691),d=n(119),m=n(760),p=n(684),g=n(20),b=n(757),f=n(687),h=n(8),y=n(121),v=n(791),T=n(1008),k=n(744),O=n(697),E=n(716),w=n(3038),j=n(681),N=n(58),S=n(685),x=n.n(S),C=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),D=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function c(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,c)}l((a=a.apply(e,t||[])).next())})},_=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},A="",L=function(e){function t(t){var n=e.call(this,t)||this;return n.state={building:"Select Building",ticketType:"",_buildings:[],_floors:[],_spaces:[],_assets:[],_components:[],_ticketType:[],ticketObject:{customerName:"",timeStamp:"",customerEmail:"",ticketTypeOntology:"",componentOntology:"",enteredBy:"",acutalFindFix:"",assetOntology:"",buildingOntology:n.props.buildingName,ticketIssue:"",criticalityOntology:"",facilatatorOntology:"",floorOntology:"",imageUrl:"",ontology:(new Date).Ticket_Number(),spaceOntology:"",suggestionFix:""},phaseTemplateDetailList:[],emailsList:[],peopleList:[],actions:[],isTicketSaved:!1,departments:[],StageOntology:"",subTaskOntology:"",wfOntology:""},n.ticketTypeChangeHandler=n.ticketTypeChangeHandler.bind(n),n.buildingChangeHandler=n.buildingChangeHandler.bind(n),n.getFloorBasesOnBuildingHandler=n.getFloorBasesOnBuildingHandler.bind(n),n.floorChangeHandler=n.floorChangeHandler.bind(n),n.getSpacesBasedOnFloorHandler=n.getSpacesBasedOnFloorHandler.bind(n),n.spaceChangeHandler=n.spaceChangeHandler.bind(n),n.getAssetsHandler=n.getAssetsHandler.bind(n),n.assetChangeHandler=n.assetChangeHandler.bind(n),n.getComponentsHandler=n.getComponentsHandler.bind(n),n.checkingValidations=n.checkingValidations.bind(n),n.saveTicketHandler=n.saveTicketHandler.bind(n),n.handleActivateStage=n.handleActivateStage.bind(n),n._fetchDepartmentOrGroup=n._fetchDepartmentOrGroup.bind(n),n.handleAssignTo=n.handleAssignTo.bind(n),n}return C(t,e),t.prototype.componentDidMount=function(){return D(this,void 0,void 0,function(){var e,t,n,a,s,i,o=this;return _(this,function(l){switch(l.label){case 0:return[4,this._fetchBuildings()];case 1:return l.sent(),[4,Object(g.D)(this.props.buildingName)];case 2:return e=l.sent(),[4,Promise.all([this.buildingChangeHandler(this.props.buildingName,e),this._fetchTicketTypes(this.props.buildingName),this._fetchContact(this.props.buildingName),this._fetchDepartmentOrGroup()])];case 3:return l.sent(),this.props.ticketOntology?[4,Object(T.e)(this.props.ticketOntology)]:[3,6];case 4:return t=l.sent(),[4,Promise.all([Object(f.d)(t.floorOntology,t.buildingOntology),Object(r.g)(t.buildingOntology,c.b.POINT,t.floorOntology,t.spaceOntology),Object(p.p)(t.buildingOntology,t.assetOntology)])];case 5:return n=l.sent(),a=n[0],s=n[1],i=n[2],this.setState({ticketObject:Object(),_spaces:a,_assets:s,_components:i},function(){o.setState({ticketObject:t})}),[3,7];case 6:this.setState({building:this.props.buildingName}),l.label=7;case 7:return[2]}})})},t.prototype.componentWillUnmount=function(){return D(this,void 0,void 0,function(){return _(this,function(e){return this.setState({ticketObject:Object(),_spaces:[],_assets:[],_components:[]}),[2]})})},t.prototype._fetchBuildings=function(){return D(this,void 0,void 0,function(){var e=this;return _(this,function(t){switch(t.label){case 0:return[4,Object(u.d)().then(function(t){e.setState({_buildings:t}),e.buildingChangeHandler(t[0].building.value,t[0].rdfsLabel.value)}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype._fetchTicketTypes=function(e){return D(this,void 0,void 0,function(){var t=this;return _(this,function(n){switch(n.label){case 0:return[4,Object(T.d)(e).then(function(e){t.setState({_ticketType:e})}).catch(function(e){return e})];case 1:return n.sent(),[2]}})})},t.prototype._fetchPhaseTemplateDetails=function(e,t){return D(this,void 0,void 0,function(){var n=this;return _(this,function(a){switch(a.label){case 0:return[4,Object(k.j)(e,t).then(function(e){n.setState({phaseTemplateDetailList:e})}).catch(function(e){return e})];case 1:return a.sent(),[2]}})})},t.prototype._fetchContact=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return[4,Object(d.y)(e)];case 1:return(t=n.sent())&&this.setState({peopleList:t}),[2]}})})},t.prototype._fetchDepartmentOrGroup=function(){return D(this,void 0,void 0,function(){var e=this;return _(this,function(t){switch(t.label){case 0:return[4,Object(d.h)().then(function(t){t&&t.length>0&&e.setState({departments:t})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.ticketTypeChangeHandler=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){return t=this.state.ticketObject,this.setState({ticketType:e}),t.ticketTypeOntology=e,[2]})})},t.prototype.buildingChangeHandler=function(e,t){return D(this,void 0,void 0,function(){var n;return _(this,function(a){switch(a.label){case 0:return(n=this.state.ticketObject).buildingOntology=e,n.buildingLabel=t,this.setState({ticketObject:n,building:e}),Object(i.a)(!0),[4,this.getFloorBasesOnBuildingHandler(e)];case 1:return a.sent(),[4,this._fetchTicketTypes(e)];case 2:return a.sent(),[4,this._fetchContact(e)];case 3:return a.sent(),Object(i.a)(!1),[2]}})})},t.prototype.getFloorBasesOnBuildingHandler=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return[4,Object(O.f)(e)];case 1:return t=n.sent(),this.setState({_floors:t,_spaces:[],_assets:[],_components:[]}),[2]}})})},t.prototype.floorChangeHandler=function(e,t){return D(this,void 0,void 0,function(){var n;return _(this,function(a){return(n=this.state.ticketObject).floorOntology=e,n.floorLabel=t,this.setState({ticketObject:n}),this.getSpacesBasedOnFloorHandler(e),[2]})})},t.prototype.getSpacesBasedOnFloorHandler=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return[4,Object(f.d)(e,this.state.building)];case 1:return t=n.sent(),this.setState({_spaces:t,_assets:[],_components:[]}),[2]}})})},t.prototype.spaceChangeHandler=function(e,t){return D(this,void 0,void 0,function(){var n;return _(this,function(a){return(n=this.state.ticketObject).spaceOntology=e,n.spaceLabel=t,this.setState({ticketObject:n}),this.getAssetsHandler(e),[2]})})},t.prototype.getAssetsHandler=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return""==e?(this.setState({_assets:[],_components:[]}),[2]):[4,Object(r.g)(this.state.building,c.b.POINT,this.state.ticketObject.floorOntology,e)];case 1:return t=n.sent(),this.setState({_assets:t,_components:[]}),[2]}})})},t.prototype.assetChangeHandler=function(e,t){return D(this,void 0,void 0,function(){var n;return _(this,function(a){return(n=this.state.ticketObject).assetOntology=e,n.assetLabel=t,this.setState({ticketObject:n}),this.getComponentsHandler(e),[2]})})},t.prototype.getComponentsHandler=function(e){return D(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return[4,Object(p.p)(this.state.building,e)];case 1:return t=n.sent(),this.setState({_components:t}),[2]}})})},t.prototype.componentChangeHandler=function(e,t){return D(this,void 0,void 0,function(){var n;return _(this,function(a){return(n=this.state.ticketObject).componentOntology=e,n.componentLabel=t,this.setState({ticketObject:n}),[2]})})},t.prototype.checkingValidations=function(e,t){document.getElementById(e).classList.add("text-success"),document.getElementById(t).classList.add("is-valid")},t.prototype.saveTicketHandler=function(e){return void 0===e&&(e=!1),D(this,void 0,void 0,function(){var t,n,a,s,o,c,r,d,p,f,y,k,O,E,w,j,S,x=this;return _(this,function(C){switch(C.label){case 0:return Object(i.a)(!0),t=this.state,n=t.ticketObject,a=t._ticketType,s=t.wfOntology,o=t.StageOntology,c=t.subTaskOntology,r=n.buildingOntology,document.getElementById("btnSave").setAttribute("disabled","disabled"),this.props.isEdit?[3,6]:(d=JSON.parse(h.a.getItem("user")),n.enteredBy=d.contact,p=n.ticketTypeOntology,f=a.find(function(e){return e.ontology==p}).notifyManager,[4,Object(T.c)(p)]);case 1:y=C.sent(),k=y.split(","),O=function(e){var t,a,i,u,d,p,h,y,T,O,w,j,N,S;return _(this,function(C){switch(C.label){case 0:return[4,E._fetchPhaseTemplateDetails(E.state.building,k[e])];case 1:for(C.sent(),t=E.state.phaseTemplateDetailList.find(function(t){return t.ontology===k[e]}),a="Dynamic"==t.behaviour,i=[],u=0;u<t.stageTemplates.length;u++)(i=t.stageTemplates[u].subTasks.map(function(e){return e.ontology})).push.apply(i,i);return[4,Object(b.c)(r,i)];case 2:d=C.sent(),(p=Object()).ontology=Object(g.C)(7),s=s+p.ontology+",",p.description=t.description,p.module=t.module,p.status="Planned",p.phaseID=Object(g.A)(7).toString(),p.templateID=t.templateID,p.templateType=t.templateType,p.stageTemplateOnology=[],p.ticketOntology=n.ontology,p.stages=[],p.estimatedStartTime=t.estimatedStartTime,p.estimatedEndTime=t.estimatedEndTime,h=[],y=t.facilitatorAssigned,h[0]=Object(),h[0].label=y,h[0].value=y,p.facilitatorAssigned=h[0],p.notifyManager=f,T=[],O=[],w=function(e){var s,i,u,b,f,h,y,v,k,w,j;return _(this,function(N){switch(N.label){case 0:for(s=t.stageTemplates[e],i=Object(),u=Object(g.C)(7),i.task=u,b="",b+=Object(g.B)(),i.color=b,o=o+u+",",i.wfOntology=p.ontology,i.taskNumber=Object(g.A)(7).toString(),i.description=s.description,i.action=s.action,i.enteredBy=s.enteredBy,i.enteredByName=s.enteredByName,i.assignedTo=s.assignedTo,s.assignedDepartment&&""!=s.assignedDepartment&&(f=E.state.peopleList&&E.state.peopleList.find(function(e){return Object(l.g)(e.departmentsAndGroups).includes(s.assignedDepartment)&&Object(l.g)(e.assignedTo).includes(s.building)&&"2"==Object(l.g)(e.role)}),i.assignedTo=void 0!==f?[{label:Object(l.g)(f.name),value:Object(l.g)(f.contact)}]:s.assignedTo),i.hasChat=!0,i.entryTimeStamp=s.entryTimeStamp,i.criticality=s.criticality,i.equipSubject=s.equipSubject,i.equipRdfsLabel=s.equipRdfsLabel,i.spaceSubject=s.spaceSubject,i.spaceRdfsLabel=s.spaceRdfsLabel,i.floor=s.floor,i.building=s.building,i.workOrder=s.workOrder,i.status="Pending",i.acknowledged=!0,i.archived=!1,i.startTime="",i.note="",i.isSequence=!0,i.QRTag=s.QRTag,i.isQRTask=s.isQRTask,i.subTasks=[],i.workflowType=s.workflowType,i.redirectionLink=s.redirectionLink,i.isStage=!0,i.isActivated=!1,i.estimatedStartTime=new Date,i.workflowDescription=t.description,h=0,y=0;y<s.subTasks.length;y++)v=s.subTasks[y],h+=parseInt(v.duration);k=i.subTasks.length>0?new Date(i.subTasks[0].estimatedStartTime):new Date,i.estimatedEndTime=new Date(k.setHours(k.getHours()+h)),i.ticketOntology=n.ontology,i.subTasks=[],w=function(e){var t,o,u,f,h,y,v,k,E,w,j,N;return _(this,function(S){switch(S.label){case 0:return t=s.subTasks[e],(o=Object()).subTask=Object(g.C)(7),o.color=b,c=c+o.subTask+",",[4,Object(m.d)(r,["TaskTemplate"],[t.ontology])];case 1:if((u=S.sent())&&u.length>0&&u[0].entityOntology)for(f=0;f<u.length;f++)h=Object(),y=u[f],h.docOntology=o.subTask+Object(g.G)()+f,h.building=Object(l.g)(y.building),h.documentType=Object(l.g)(y.documentType),h.enteredBy=Object(l.g)(y.enteredBy),h.entityOntology=[{label:o.subTask,value:o.subTask}],h.entityType="Task",h.entryTimeStamp=(new Date).toString(),h.rdfsLabel=Object(l.g)(y.rdfsLabel),h.s3FileName=Object(l.g)(y.s3FileName),O.push(h);for(o.taskNumber=Object(g.A)(7).toString(),o.description=t.description,o.action=t.action,o.enteredBy=t.enteredBy,o.enteredByName=t.enteredByName,o.assignedTo=t.assignedTo,o.assignedDepartment=t.assignedDepartment,o.hasChat=!0,o.entryTimeStamp=t.entryTimeStamp,o.criticality=t.criticality,o.equipSubject=i.equipSubject,o.equipRdfsLabel=i.equipRdfsLabel,o.spaceSubject=i.spaceSubject,o.spaceRdfsLabel=i.spaceRdfsLabel,o.building=i.building,o.workOrder=t.workOrder,o.status="Planned",o.acknowledged=!0,o.archived=!1,o.index=t.index,o.parentTask=i.task,o.note=t.note,o.relatedLink=t.relatedLink,o.duration=t.duration,o.durationUnit=t.durationUnit,o.workerDuration=t.workerDuration,o.workerDurationUnit=t.workerDurationUnit,o.fileName=t.fileName,o.oldFileName=t.oldFileName,o.startTime="",o.workType=t.workType,o.checklistID=t.checklistID,o.isQRTask=t.isQRTask,o.QRTag=t.QRTag,o.notifyViaEmail=t.notifyViaEmail,o.notifyViaSMS=t.notifyViaSMS,o.estimatedStartTime=t.estimatedStartTime,o.estimatedEndTime=t.estimatedEndTime,o.workflowType=t.workflowType,o.redirectionLink=t.redirectionLink,o.isStage=!0,o.isActivated=!1,o.acknowledged=!0,o.archived=!1,o.ticketOntology=n.ontology,o.wfOntology=p.ontology,i.subTasks.push(o),v=d.filter(function(e){return e.taskOntology==t.ontology}),k=0;k<v.length;k++)E=v[k],(w=Object()).ontology=Object(g.C)(10),w.directive=E.directive,w.directiveType=E.directiveType,w.floorOntology=a?n.floorOntology:E.floorOntology,w.spaceOntology=a?n.spaceOntology:E.spaceOntology,w.componentOntology=a?n.componentOntology:E.componentOntology,w.assetOntology=a?n.assetOntology:E.assetOntology,w.pointOntology=a?"":E.pointOntology,w.unit=E.unit,w.taskOntology=o.subTask,w.taskDescription=E.taskDescription,w.isTemplate=!1,w.objectTemplateReferenceID=E.ontology,w.isQrCodeVerified=!1,w.qrCode=E.qrCode,w.visibleObjectFormActions=[],T.push(w);for(j=function(e){var t=T[e],n=d.find(function(e){return e.ontology==t.objectTemplateReferenceID});if(n.visibleObjectFormActions&&n.visibleObjectFormActions.length>0)for(var a=function(e){var a=n.visibleObjectFormActions[e];if(""!=a){var s=d.find(function(e){return e.ontology==a}),i=T.find(function(e){return e.objectTemplateReferenceID==s.ontology});-1==t.visibleObjectFormActions.findIndex(function(e){return e==i.ontology})&&t.visibleObjectFormActions.push(i.ontology)}},s=0;s<n.visibleObjectFormActions.length;s++)a(s)},N=0;N<T.length;N++)j(N);return[2]}})},j=0,N.label=1;case 1:return j<s.subTasks.length?[5,w(j)]:[3,4];case 2:N.sent(),N.label=3;case 3:return j++,[3,1];case 4:return p&&p.stages&&p.stages.push(i),[2]}})},j=0,C.label=3;case 3:return j<t.stageTemplates.length?[5,w(j)]:[3,6];case 4:C.sent(),C.label=5;case 5:return j++,[3,3];case 6:return N=Object(v.d)(new Date,p),O.length>0&&O.map(function(e){return D(x,void 0,void 0,function(){return _(this,function(t){switch(t.label){case 0:return[4,Object(m.f)(e)];case 1:return t.sent(),[2]}})})}),[4,Object(b.e)(r,T)];case 7:return C.sent(),[4,Object(v.e)(r,N,!1,!0).then(function(e){return D(x,void 0,void 0,function(){return _(this,function(e){return[2]})})}).catch(function(e){return e})];case 8:return C.sent(),t.stageTemplateOnology&&t.stageTemplateOnology.length>0?(S=t.uses?t.uses+1:1,[4,Object(v.f)(r,t.ontology,S.toString()).then(function(e){}).catch(function(e){return e})]):[3,10];case 9:C.sent(),C.label=10;case 10:return[2]}})},E=this,w=0,C.label=2;case 2:return w<k.length?[5,O(w)]:[3,5];case 3:C.sent(),C.label=4;case 4:return w++,[3,2];case 5:return[3,8];case 6:return[4,Object(T.a)(n.ontology)];case 7:C.sent(),C.label=8;case 8:return n.status="Created",this.props.isEdit?[3,11]:[4,Object(u.d)(n.buildingOntology)];case 9:return j=C.sent(),s=s.substr(0,s.length-1),o=o.substr(0,o.length-1),c=c.substr(0,c.length-1),n.deployedWFOntology=s,n.stageOntology=o,n.subTasksOntology=c,""===n.customerEmail?[3,11]:((S=Object()).subject="Ticket Creation Notification",S.to=n.customerEmail,S.text="<div style='color: black'>",S.text+="A new ticket having case# <b>"+n.ontology+"</b> has been created, associated with the issue: "+n.ticketIssue+".",n.buildingLabel&&""!=n.buildingLabel&&(S.text+="<br>Building: "+n.buildingLabel),n.floorLabel&&""!=n.floorLabel&&(S.text+="<br>Floor: "+n.floorLabel),n.spaceLabel&&""!=n.spaceLabel&&(S.text+="<br>Space: "+n.spaceLabel),n.assetLabel&&""!=n.assetLabel&&(S.text+="<br>Asset: "+n.assetLabel),S.text+="<br>If you have questions, please contact with Response Center.",S.text+="<br>Thank you for allowing us to serve you.",S.text+="<br>Response Center: <br>"+(j[0].responseCenterName&&""!=j[0].responseCenterName.value?j[0].responseCenterName.value:"Operate My Building")+"<br>"+(j[0].responseCenterPhoneNo&&""!=j[0].responseCenterPhoneNo.value?j[0].responseCenterPhoneNo.value:"+1 (516) 256 3000")+"<br>"+(j[0].responseCenterEmail&&""!=j[0].responseCenterEmail.value?j[0].responseCenterEmail.value:"notify@operatemybuilding.com"),S.text+="</div>",[4,Object(N.a)(S,!0)]);case 10:C.sent(),C.label=11;case 11:return[4,Object(T.g)(n)];case 12:return C.sent(),Object(i.a)(!1),this.setState({isTicketSaved:!0},function(){e&&window.open("http://"+Object(g.y)()+"/#"+x.props.instance+"/"+r+"/Deploy/WorkflowView/"+n.deployedWFOntology.split(",")[0],"_blank")}),[2]}})})},t.prototype.activateWorkflows=function(){return D(this,void 0,void 0,function(){return _(this,function(e){return Object(i.a)(!0),Object(i.a)(!1),[2]})})},t.prototype.handleAssignTo=function(e){var t=this.state.ticketObject;t.notifyPeople=e,this.setState({ticketObject:t})},t.prototype.handleActivateStage=function(e,t,n){return D(this,void 0,void 0,function(){var a,o,c,r,u,d;return _(this,function(m){switch(m.label){case 0:if(a=this.state.ticketObject.buildingOntology,o=this.state.peopleList,c=this.state.emailsList,e.startTime=n&&null!=n?0==n?new Date(Date.now()).toString():"":new Date(Date.now()).toString(),e.startTaskCondition=n&&null!=n?0==n?"daytime":"completionof":"daytime",e.conditionalTasks=n&&null!=n?0==n?[]:[{label:A,value:A}]:[],e.status=n&&null!=n?0==n?"Assigned":"Pending":"Assigned",e.acknowledged=!0,e.isSequence=!0,e.archived=!1,e.isDeleted=!1,e.isActivated=!0,e.workflowType=e.workflowType?e.workflowType:t,e.assignedTo&&e.assignedTo.length>0)for(r=function(t){if(e.assignedTo[t]&&e.assignedTo[t].value){var n=o&&o.find(function(n){return Object(l.g)(n.contact)==e.assignedTo[t].value});if(c||(c=[]),n&&n.email)c.find(function(e){return e==Object(l.g)(n.email)})||c.push(Object(l.g)(n.email))}},d=0;d<e.assignedTo.length;d++)r(d);for(e.hasChat=!0,u=function(a){if(e.subTasks[a].workflowType=e.workflowType?e.workflowType:t,e.subTasks[a].isActivated=!0,e.subTasks[a].assignedTo&&e.subTasks[a].assignedTo.length>0){var s=o&&o.find(function(t){return Object(l.g)(t.contact)==e.subTasks[a].assignedTo});if(c||(c=[]),s&&s.email)c.find(function(e){return e==Object(l.g)(s.email)})||c.push(Object(l.g)(s.email))}e.subTasks[a].startTime=n&&null!=n?0==n&&0==a?new Date(Date.now()).toString():"":0==a?new Date(Date.now()).toString():"",e.subTasks[a].status=n&&null!=n?0==n&&0==a?"Assigned":"Pending":0==a?"Assigned":"Pending",e.subTasks[a].acknowledged=!0,e.subTasks[a].isDeleted=!1,e.subTasks[a].startTaskCondition=n&&null!=n?0==n&&0==a?"daytime":"completionof":0==a?"daytime":"completionof",e.subTasks[a].conditionalTasks=n&&null!=n?0==n&&0==a?[]:n>0&&0==a?[{label:A,value:A}]:[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:a>0?[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:[],A=e.task},d=0;d<e.subTasks.length;d++)u(d);return Object(i.a)(!0),"Contract"!=t?[3,2]:[4,Object(y.H)(c,["read"],e.contractFileName).then(function(t){if(t.link){var n=t.link[0].link.webUrl;e.contractFileUrl=n;for(var o=0;o<e.subTasks.length;o++){e.subTasks[o].contractFileUrl=n}Object(y.F)(a,e,!0),Object(v.g)("","Assigned",!0).then(function(){}),Object(i.a)(!1)}else console.log(t),Object(s.a)("Error occured while requesting permissions for Contract File.")})];case 1:return m.sent(),[3,5];case 2:return[4,Object(y.F)(a,e,!0)];case 3:return m.sent(),[4,Object(v.g)("","Assigned",!0).then(function(){})];case 4:m.sent(),Object(i.a)(!1),m.label=5;case 5:return[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.instance,s=t.buildingName,i=t.isView,r=t.isEdit,u=this.state,d=u._floors,m=u._spaces,p=u._assets,b=u._components,f=u._ticketType,h=u.ticketObject,y=u.departments,v=u.peopleList,T=u._buildings,k=this.state.isTicketSaved?"block":"none",O=v&&v.length>0?v.map(function(e){return{value:Object(l.g)(e.contact),label:e.name?Object(l.g)(e.name)+" ("+c.e[Object(l.g)(e.role)]+")":Object(l.g)(e.contact)+" ("+Object(l.g)(e.qualifications)+")"}}).filter(function(e){return Object(l.g)(e)!=(h.notifyPeople&&h.notifyPeople.find(function(t){return Object(l.g)(t)==Object(l.g)(e)})?Object(l.g)(h.notifyPeople.find(function(t){return Object(l.g)(t)==Object(l.g)(e)})):"")}):[],N=""!==h.ticketTypeOntology&&""!==h.ticketIssue,S=h.deployedWFOntology&&h.deployedWFOntology.split(",");return a.createElement(a.Fragment,null,a.createElement("div",{className:""},a.createElement("div",{className:""},a.createElement("div",{className:""},a.createElement("div",{className:"content"},a.createElement("div",{className:"container-fluid small"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-lg-6 col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2 no-margin"},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"content"},a.createElement("div",{className:"row no-margin p-2"},a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Building: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:(h.ontology?"":"addFieldValidate")+" form-control",name:"building",disabled:i||r,value:h.buildingOntology,id:"building",onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.buildingChangeHandler(t.target.value,a)}},T&&T.length>0&&T.map(function(e,t){return a.createElement("option",{key:t,value:Object(l.g)(e.building)},Object(l.g)(e.rdfsLabel)," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"ONIT Case Type: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{name:"ticketType",id:"ticketType",className:(h.ticketTypeOntology?"":"addFieldValidate")+" form-control",value:h.ticketTypeOntology,disabled:i||r,onChange:function(t){e.ticketTypeChangeHandler(t.target.value)}},a.createElement("option",{value:""},"Select Case Type "),f&&f.length>0&&f.map(function(e,t){return a.createElement("option",{key:t,value:e.ontology},e.ticketType," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{id:"issueLabel",className:"col-md-3 py-2 px-0 headingText"}," Describe the Issue:"),a.createElement("div",{className:"col-md-9 no-padding "},a.createElement("textarea",{id:"issue",rows:6,className:(h.ticketIssue?"":"addFieldValidate")+" form-control",value:Object(g.J)(h.ticketIssue,!1),disabled:i,style:{width:"422px !important",resize:"none"},onChange:function(t){h.ticketIssue=Object(g.J)(t.target.value,!0),e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Floor: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"floor",name:"floor",disabled:i,value:h.floorOntology,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.floorChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Floor"),d&&d.length>0&&d.map(function(e,t){return a.createElement("option",{value:Object(l.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Space: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"space",name:"space",value:h.spaceOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.spaceChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Space"),m&&m.length>0&&m.map(function(e,t){return a.createElement("option",{value:Object(l.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Asset: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"asset",name:"asset",value:h.assetOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.assetChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Assets"),p&&p.length>0&&p.map(function(e,t){return a.createElement("option",{value:Object(l.g)(e.ontology),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Component: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",id:"component",name:"component",value:h.componentOntology,disabled:i,onChange:function(t){var n=t.target.selectedIndex,a=t.nativeEvent.target[n].text;e.componentChangeHandler(t.target.value,a)}},a.createElement("option",{value:""},"Select Component"),b&&b.length>0&&b.map(function(e,t){return a.createElement("option",{value:Object(l.g)(e.name),key:t},e.rdfsLabel.value," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Concern: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{name:"ticketType",id:"ticketType",className:"form-control",value:h.criticalityOntology,disabled:i,onChange:function(t){h.criticalityOntology=t.target.value,e.setState({ticketObject:h})}},a.createElement("option",{value:""},"Select Concern"),o.e&&o.e.length>0&&o.e.map(function(e,t){return a.createElement("option",{key:t,value:e.id}," ",e.id," - ",e.name," ")})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Suggest Fix: "),a.createElement("div",{className:"col-md-9 no-padding "},a.createElement("textarea",{rows:4,className:"form-control",value:Object(g.J)(h.suggestionFix,!1),disabled:i,onChange:function(t){h.suggestionFix=Object(g.J)(t.target.value,!0),e.setState({ticketObject:h})}})))))))),a.createElement("div",{className:"col-lg-6 col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2 no-margin"},a.createElement("div",{className:"container-fluid p-1"},a.createElement("div",{className:"content p-1"},a.createElement("div",{className:"row no-margin p-2"},a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Customer Name: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("input",{className:"form-control",name:"customerName",id:"customerName",type:"text",value:h.customerName,disabled:i,onChange:function(t){h.customerName=t.target.value,e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Customer Email: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("input",{className:"form-control",name:"customerEmail",id:"customerEmail",value:h.customerEmail,disabled:i,onChange:function(t){h.customerEmail=t.target.value,e.setState({ticketObject:h})}}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Notify People: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement(j.a,{id:"assignTo",isMulti:!0,closeMenuOnSelect:!1,isDisabled:i,value:h.notifyPeople?h.notifyPeople:[],onChange:this.handleAssignTo,placeholder:"Select Person(s)",options:O}))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Department Assigned: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement("select",{className:"form-control",name:"department",id:"department",value:h.departmentAssigned,disabled:i,onChange:function(t){h.departmentAssigned=t.target.value,e.setState({ticketObject:h})}},a.createElement("option",{value:""},"Select Department"),y&&y.length>0&&y.map(function(e,t){return a.createElement("option",{key:t,value:e},e)})))),a.createElement("div",{className:"col-md-12 px-0 py-2"},a.createElement("div",{className:"col-md-3 py-2 px-0  headingText"},"Expected Done By: "),a.createElement("div",{className:"col-md-9 no-padding"},a.createElement(x.a,{id:"startTime",name:"startTime",className:"form-control",selected:h.expectedDoneBy?new Date(h.expectedDoneBy):void 0,onChange:function(t){h.expectedDoneBy=t?t.toString():void 0,e.setState({ticketObject:h})},showTimeSelect:!0,timeFormat:"HH:mm",autoComplete:"off",dateFormat:"MMMM d, yyyy h:mm aa",minDate:new Date,timeIntervals:15,timeCaption:"time",customInput:a.createElement("input",{type:"text",className:"form-control",style:{width:"100%"},placeholder:"Start time","aria-label":"","aria-describedby":"button-addon4",value:h.expectedDoneBy&&h.expectedDoneBy.toString()})})))))))),a.createElement("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2"},a.createElement("div",{className:"row py-0 no-margin p-2"},h&&h.buildingOntology&&a.createElement(E.a,{showUploader:!i,buildingName:h.buildingOntology,assetOntology:this.props.ticketOntology?this.props.ticketOntology:h.ontology,entityType:"Tickets",uploaderID:this.props.ticketOntology?this.props.ticketOntology:h.ontology})))),S&&a.createElement("div",{className:"col-md-12 col-sm-12 col-xs-12 no-padding"},a.createElement("div",{className:"card p-2"},a.createElement("h3",{className:"text-center"},"WorkFlow Status"),S&&S.map(function(t,n){return a.createElement("div",{key:n,className:"card p-2"},a.createElement("div",{className:"row py-0 no-margin p-2"},t&&h&&h.buildingOntology&&a.createElement(w.a,{instance:e.props.instance,buildingName:h.buildingOntology,ticketObject:h,ontology:t})))}))),a.createElement("br",null),a.createElement("div",{className:"col-md-12 inline-block"},a.createElement("div",{className:"form-inline inline-block"},!this.props.isView&&a.createElement(a.Fragment,null,a.createElement("button",{disabled:!N,id:"btnSave",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return D(e,void 0,void 0,function(){return _(this,function(e){switch(e.label){case 0:return[4,this.saveTicketHandler()];case 1:return e.sent(),[4,setTimeout(function(){window.history.back()},1e3)];case 2:return e.sent(),[2]}})})}},a.createElement("i",{className:"fa fa-save"}),"Save"),a.createElement("button",{disabled:!N,id:"btnSave",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return D(e,void 0,void 0,function(){return _(this,function(e){switch(e.label){case 0:return[4,this.saveTicketHandler(!0)];case 1:return e.sent(),[2]}})})}},a.createElement("i",{className:"fa fa-save"}),"Save & Redirect")),h.deployedWFOntology&&S.map(function(t,i){return a.createElement("button",{key:i,style:{display:k},id:"redirectBtn",className:"btn btn-primary btn-fill",type:"button",onClick:function(){return D(e,void 0,void 0,function(){return _(this,function(e){return window.open("http://"+Object(g.y)()+"/#"+n+"/"+s+"/Deploy/WorkflowView/"+t,"_blank"),[2]})})}},a.createElement("i",{className:"fa fa-location-arrow"}),"Navigate to Deployed WF")}))))))))))},t}(a.Component);t.default=L},3038:function(e,t,n){"use strict";var a,s=n(2),i=(n.n(s),n(118)),o=n(791),c=n(12),l=n(21),r=n(121),u=n(119),d=n(20),m=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),p=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function c(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,c)}l((a=a.apply(e,t||[])).next())})},g=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},b="",f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={phase:Object(),emailsList:[],peopleList:[]},a=n,n.getPhaseDetail=n.getPhaseDetail.bind(n),n.handleActivateStage=n.handleActivateStage.bind(n),n.handleActivatePhase=n.handleActivatePhase.bind(n),n.validatePhaseAssignments=n.validatePhaseAssignments.bind(n),n.validateStageAssignments=n.validateStageAssignments.bind(n),n._fetchContact=n._fetchContact.bind(n),n}return m(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return this.props.buildingName?(Object(i.a)(!0),[4,this._fetchContact()]):[3,4];case 1:return e.sent(),this.props.ontology?[4,this.getPhaseDetail()]:[3,3];case 2:e.sent(),e.label=3;case 3:Object(i.a)(!1),e.label=4;case 4:return[2]}})})},t.prototype._fetchContact=function(){return p(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,Object(u.y)(this.props.buildingName)];case 1:return(e=t.sent())&&a.setState({peopleList:e}),[2]}})})},t.prototype.getPhaseDetail=function(){return p(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return[4,Object(o.b)(this.props.buildingName,this.props.ontology).then(function(t){if(t.length){if("Completed"!==t[0].status)t[0].stages.every(function(e){return"Completed"==e.status})&&Object(o.g)(t[0].ontology,"Completed",!0);e.setState({phase:t[0]})}})];case 1:return t.sent(),[2]}})})},t.prototype.handleActivatePhase=function(e){return p(this,void 0,void 0,function(){var t,n;return g(this,function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<e.stages.length?(n=e.stages[t],[4,this.handleActivateStage(n,e.templateType,t)]):[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},t.prototype.handleActivateStage=function(e,t,n){return p(this,void 0,void 0,function(){var a,s,l,u,d,m,p=this;return g(this,function(g){switch(g.label){case 0:if(a=this.props.buildingName,s=this.state.peopleList,l=this.state.emailsList,e.startTime=n&&null!=n?0==n?new Date(Date.now()).toString():"":new Date(Date.now()).toString(),e.startTaskCondition=n&&null!=n?0==n?"daytime":"completionof":"daytime",e.conditionalTasks=n&&null!=n?0==n?[]:[{label:b,value:b}]:[],e.status=n&&null!=n?0==n?"Assigned":"Pending":"Assigned",e.acknowledged=!0,e.isSequence=!0,e.archived=!1,e.isDeleted=!1,e.isActivated=!0,e.workflowType=e.workflowType?e.workflowType:t,e.assignedTo&&e.assignedTo.length>0)for(u=function(t){if(e.assignedTo[t]&&e.assignedTo[t].value){var n=s&&s.find(function(n){return Object(c.g)(n.contact)==e.assignedTo[t].value});if(l||(l=[]),n&&n.email)l.find(function(e){return e==Object(c.g)(n.email)})||l.push(Object(c.g)(n.email))}},m=0;m<e.assignedTo.length;m++)u(m);for(e.hasChat=!0,d=function(a){if(e.subTasks[a].workflowType=e.workflowType?e.workflowType:t,e.subTasks[a].isActivated=!0,e.subTasks[a].assignedTo&&e.subTasks[a].assignedTo.length>0){var i=s&&s.find(function(t){return Object(c.g)(t.contact)==e.subTasks[a].assignedTo});if(l||(l=[]),i&&i.email)l.find(function(e){return e==Object(c.g)(i.email)})||l.push(Object(c.g)(i.email))}e.subTasks[a].startTime=n&&null!=n?0==n&&0==a?new Date(Date.now()).toString():"":0==a?new Date(Date.now()).toString():"",e.subTasks[a].status=n&&null!=n?0==n&&0==a?"Assigned":"Pending":0==a?"Assigned":"Pending",e.subTasks[a].acknowledged=!0,e.subTasks[a].isDeleted=!1,e.subTasks[a].startTaskCondition=n&&null!=n?0==n&&0==a?"daytime":"completionof":0==a?"daytime":"completionof",e.subTasks[a].conditionalTasks=n&&null!=n?0==n&&0==a?[]:n>0&&0==a?[{label:b,value:b}]:[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:a>0?[{label:e.subTasks[a-1].subTask,value:e.subTasks[a-1].subTask}]:[],b=e.task},m=0;m<e.subTasks.length;m++)d(m);return Object(i.a)(!0),[4,Object(r.F)(a,e,!0)];case 1:return g.sent(),[4,Object(o.g)("","Assigned",!0).then(function(){p.getPhaseDetail()})];case 2:return g.sent(),Object(i.a)(!1),[2]}})})},t.prototype.validatePhaseAssignments=function(e){var t=!0;if(e.stages&&e.stages.length>0)for(var n=0;n<e.stages.length;n++){var a=e.stages[n];if(a.assignedTo&&a.assignedTo.length>0){if(-1!=a.subTasks.findIndex(function(e){return""==e.assignedTo})){t=!1;break}t=!0}else t=!1}t?document.getElementById("btnActivatePhase").click():Object(l.a)("Not all Tasks have assignments, please assign all tasks.")},t.prototype.validateStageAssignments=function(e,t){var n=!0;e.assignedTo&&e.assignedTo.length>0?n=-1==e.subTasks.findIndex(function(e){return""==e.assignedTo}):n=!1;n?document.getElementById("btnActivateStage"+t).click():Object(l.a)("Not all Tasks have assignments, please assign all tasks.")},t.prototype.render=function(){var e=this,t=this.props,n=t.showGraphOnly,a=t.instance,i=t.buildingName,o=this.state.phase;return s.createElement("div",{className:n?"col-md-12":"content"},s.createElement("div",{className:n?"row padding-10":"container-fluid"},s.createElement("div",{className:"row"}),s.createElement("br",null),s.createElement("div",null,s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12  img-thumbnail",style:{background:"#b8d8f9"}},s.createElement("div",{style:{display:"flex"}},s.createElement("div",{className:"col-md-11"},s.createElement("div",{style:{display:"grid"}},s.createElement("label",{style:{cursor:"default"}}," ",s.createElement("h5",{style:{color:"black",marginBottom:"9px"}}," ",s.createElement("b",null,o&&o.description," ",this.props.ticketObject&&": "+this.props.ticketObject.ticketIssue," ",this.props.ticketObject&&": "+this.props.ticketObject.suggestionFix))," "),s.createElement("span",{style:{color:"#666666"}},"Workflow ID: ",o.phaseID))),s.createElement("a",{style:{textAlign:"center",alignSelf:"center"},onClick:function(){return p(e,void 0,void 0,function(){return g(this,function(e){return window.open("http://"+Object(d.y)()+"/#"+a+"/"+i+"/Deploy/WorkflowView/"+o.ontology,"_blank"),[2]})})}},s.createElement("div",{className:"col-md-1",style:{cursor:"pointer"}},s.createElement("i",{className:"fa fa-arrow-right",style:{fontSize:"25px",color:"#6a87a5"}})))))),o&&o.stages&&o.stages.map(function(t,n){return s.createElement("div",{key:n,className:"row"},s.createElement("div",{className:"col-md-12 row.match-my-cols"},s.createElement("div",{className:"col-md-3 col-sm-3 col-xs-4"},s.createElement("div",{className:"card no-margin left-side-card",id:"discriptionCard"},s.createElement("div",{className:"content no-paddingLR"},s.createElement("div",{className:"container-fluid no-paddingLR"},s.createElement("div",{className:"row no-paddingLR"},s.createElement("div",{className:" "},s.createElement("div",{className:"timeline-item-content left-side-card"},s.createElement("h4",{style:{marginTop:"auto",marginBottom:"auto"}},"Stage ",n+1),s.createElement("a",{className:"bold pull-left",style:{color:"black",marginLeft:"3px"},title:t.description,href:"http://"+Object(d.y)()+"/#"+a+"/"+i+"/Deploy/StageView/"+t.task},s.createElement("label",{className:"headingText"},t.description)),t.taskNumber&&s.createElement("label",{className:"small"},"Stage ID: "+t.taskNumber)))))))),t.task&&s.createElement("div",{className:"col-md-9 col-sm-9 col-xs-8"},s.createElement("div",{className:"card no-margin right-side-card",id:"taskCard"},s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"timeline-item"},s.createElement("div",{className:"timeline-item-content no-padding"},s.createElement("span",{className:"no-margin"},s.createElement("ul",null,t&&t.subTasks&&t.subTasks.map(function(t,n){return s.createElement("div",{key:n},t.action&&s.createElement(s.Fragment,null,s.createElement("li",null,s.createElement("label",{title:(t.assignedTo?"Assigned to : "+t.assignedTo:t.assignedTo?"Assigned to : "+t.assignedTo+"  ":"No Assignment")+" "},s.createElement("a",{className:"pull-left",style:{color:"black",marginLeft:"3px",fontSize:12},title:t.action,href:"/#"+a+"/"+i+"/SubTask/"+t.subTask},t.action),"\xa0 \xa0 ","Pending"!=t.status&&s.createElement("div",{className:"badge ml-2 stage-task-"+t.status,style:{fontSize:"85%"}},t.status),t.checklistID&&s.createElement("a",{style:{color:"#174b54"},"data-toggle":"collapse","data-target":"#checklist"+n},s.createElement("i",{className:"fa fa-check"}))),t.workerNote&&""!=t.workerNote&&s.createElement(s.Fragment,null,s.createElement("br",null),s.createElement("b",null,"Entry Notes: "),s.createElement("label",null,t.workerNote)),e.props.ticketObject&&e.props.ticketObject.ticketIssue&&s.createElement(s.Fragment,null,s.createElement("br",null),s.createElement("b",null,"Issue: "),s.createElement("label",null,e.props.ticketObject.ticketIssue)),e.props.ticketObject&&e.props.ticketObject.suggestionFix&&s.createElement(s.Fragment,null,s.createElement("br",null),s.createElement("b",null,"Suggested Fix: "),s.createElement("label",null,e.props.ticketObject.suggestionFix)))))}))),s.createElement("span",{className:"circle stage-"+t.status,title:t&&t.status,style:{top:"50%"}}))))))))),!t.equipSubject&&s.createElement("div",{className:"col-md-9 col-sm-9 col-xs-8"},s.createElement("div",{className:"card no-margin right-side-card",id:"taskCard"},s.createElement("div",{className:"content"},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("label",{style:{color:"red"}}," STAGE MIGHT HAVE DELETED"))))))))}))))))},t}(s.Component);t.a=f}});