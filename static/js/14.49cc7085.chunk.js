webpackJsonp([14],{1177:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a={task:{Action:"Detail about work that is needed to be done",AssignedTo:"In Simple or Detail Task mode, It is the person(s) who is responsible to perform this task, In Sequence task, this person is the facilitator who is looking after the tasks/subtasks. Facilitator is authorised to modify the task. He is also responsible for resolving issues occuring to workers in this task. ",Criticality:"Criticality of the task to define its priority.",Building:"Defines in which building this task is needed to be performed , On Selection, It Filters out all the related Floors and and people of selected building.",Floor:"Defines in which Floor this task is needed to be performed, On selection, associated locations(spaces) are filtered out",Location:"Defines in which Space this task is needed to be performed, On selection, associated Assets are filtered out",Asset:"Defines on which Asset this task is needed to be performed, Assets includes related devices, points and equipments residing in selected space. "}}},1178:function(e,t,n){"use strict";var a=n(2),s=(n.n(a),n(1179)),i=n(649),o=n(716),r=n(10),l=n(672),c=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),u=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}l((a=a.apply(e,t||[])).next())})},d=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},p=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isStarted:!1,isTourSelected:!1,selectedSteps:n.props.sweeps,modelDetails:Object(),mapModelDetails:Object(),spaceDetails:[],currentSweep:Object(),matterTags:[],floorDetails:Object(),logMessage:"",sdkReady:!1,hasStartSweep:!1,startSweep:Object(),isViewForm:n.props.isViewForm,prevSweepIndex:0,prevSweepModel:Object(),onPropsReceivedStateChanged:!1,linkBimism:n.props.bimURL,routes:n.props.routes,locationDropdownList:[],destinationSpace:n.props.selectedSpace,destinationSweeps:n.props.sweeps,isTaskView:n.props.isTaskView,currentView:"TaskRoute",floor:Object(),hideMap:!0,hideInBuildingRoutes:!0,allSweeps:[],inBuildingRoutes:[],space:n.props.space,currentFloor:"",floorsBimList:[]},n.loadSDK=n.loadSDK.bind(n),n.loadFrame=n.loadFrame.bind(n),n.toggleTourStartStop=n.toggleTourStartStop.bind(n),n.toggleTourSweepsStartStop=n.toggleTourSweepsStartStop.bind(n),n.addCurrentSweep=n.addCurrentSweep.bind(n),n.toggleAddingSweep=n.toggleAddingSweep.bind(n),n.removeSweep=n.removeSweep.bind(n),n.setDialogState=n.setDialogState.bind(n),n.onSaveHandle=n.onSaveHandle.bind(n),n.handleRouteChange=n.handleRouteChange.bind(n),n.getRoutes=n.getRoutes.bind(n),n.checkPreviousRoutesWithCurrentRoutes=n.checkPreviousRoutesWithCurrentRoutes.bind(n),n.fetchFloorListImages=n.fetchFloorListImages.bind(n),n.getFloorsList=n.getFloorsList.bind(n),n}return c(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this;if((0==this.state.selectedSteps.length&&e.sweeps.length>0||e.isSweepChangeable)&&(this.setState({selectedSteps:JSON.parse(JSON.stringify(e.sweeps)),hasStartSweep:!0,startSweep:e.sweeps.find(function(e){return 0==e.stepNo}),onPropsReceivedStateChanged:!0},function(){t.state.sdk&&t.loadFrame(t.state.sdk,t.setDialogState,t.state)}),e.isSweepChangeable&&this.props.onSweepChangeable(e.isSweepChangeable)),e.bimURL&&this.state.linkBimism!=e.bimURL&&this.setState({linkBimism:e.bimURL}),e.locationDropdownList&&this.setState({locationDropdownList:e.locationDropdownList}),e.sweeps&&e.sweeps.length>0&&this.state.destinationSweeps!=e.sweeps){var n=e.sweeps.sort(function(e){return e.stepNo});this.setState({destinationSweeps:e.sweeps,hasStartSweep:!0,startSweep:n[0]})}if(e.selectedSpace&&this.state.destinationSpace.value!=e.selectedSpace.value&&this.setState({destinationSpace:e.selectedSpace}),e.routes&&e.routes.length>0){var a=this.state.selectedSteps;e.routes.forEach(function(e){e.sweeps.forEach(function(e){null==e&&""+e=="undefined"||a.push(e)})}),this.setState({routes:e.routes,onPropsReceivedStateChanged:!0,selectedSteps:a}),this.state.sdk&&this.loadFrame(this.state.sdk,this.setDialogState,this.state)}e.floor&&e.floor.bimSid&&this.setState({floor:e.floor,floorsBimList:[]},function(){t.getFloorsList(e.floor)}),e.space&&e.space!=this.state.space&&(this.setState({space:e.space}),this.state.sdk&&this.loadFrame(this.state.sdk,this.setDialogState,this.state))},t.prototype.componentDidUpdate=function(){this.state.onPropsReceivedStateChanged&&this.setState({onPropsReceivedStateChanged:!1})},t.prototype.getRoutes=function(e){return u(this,void 0,void 0,function(){var t,n,a,s,i,l,c,p=this;return d(this,function(h){switch(h.label){case 0:return t=this.props.buildingName,n=this.state,a=n.space,s=n.selectedSteps,i=[],l=[],c=[],a?[4,Object(o.a)(t,a).then(function(t){return u(p,void 0,void 0,function(){var n,o,u,p,h,f,m,g;return d(this,function(d){for(n=0;n<t.length;n++){for(o=t[n],(u=Object()).description=Object(r.g)(o.description),u.ontology=Object(r.g)(o.ontology),u.space=Object(r.g)(o.space),u.routeName=Object(r.g)(o.routeName),l=Object(r.g)(o.sweeps).split(","),c=Object(r.g)(o.stepNo).split(","),p=Object(),h=[],f=function(t){var n=l[t],i=Object();(p=e.find(function(e){return e.uuid==n}))&&(i.uuid=p.uuid,i.assignedSpace=a,i.stepNo=c[t],h.push(i),s.push(i))},m=0;m<l.length;m++)f(m);u.sweeps=h,i.push(u)}return g=this.state.inBuildingRoutes,this.setState({inBuildingRoutes:i,selectedSteps:s}),i.length>0&&(this.checkPreviousRoutesWithCurrentRoutes(i,g)||this.loadFrame(this.state.sdk,this.setDialogState,this.state)),[2]})})}).catch(function(e){return e})]:[2];case 1:return h.sent(),[2]}})})},t.prototype.checkPreviousRoutesWithCurrentRoutes=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++){if(e[n].description!=t[n].description||e[n].floorBimUrl!=t[n].floorBimUrl||e[n].hideRoutesView!=t[n].hideRoutesView||e[n].ontology!=t[n].ontology||e[n].routeName!=t[n].routeName||e[n].space!=t[n].space)return!1;if(e[n].sweeps.length!=t[n].sweeps.length)return!1;for(var a=0;a<e[n].sweeps.length;a++)if(e[n].sweeps[a].assignedSpace!=t[n].sweeps[a].assignedSpace||e[n].sweeps[a].buildingName!=t[n].sweeps[a].buildingName||e[n].sweeps[a].ontology!=t[n].sweeps[a].ontology||e[n].sweeps[a].stepNo!=t[n].sweeps[a].stepNo||e[n].sweeps[a].uuid!=t[n].sweeps[a].uuid||e[n].sweeps[a].uuidIndex!=t[n].sweeps[a].uuidIndex)return!1}},t.prototype.getFloorsList=function(e){return u(this,void 0,void 0,function(){var t,n,a=this;return d(this,function(s){switch(s.label){case 0:return t=this.props.buildingName,n=this.state.floorsBimList,(n=[]).push({floor:e.floor,linkBimism:e.linkBimism,rdfsLabel:e.rdfsLabel+" (Default)",bimFloor:e.bimFloor,bimSid:e.bimSid,xScaleMap:e.xScaleMap,yOffsetMap:e.yOffsetMap,xOffsetMap:e.xOffsetMap,yScaleMap:e.yScaleMap}),this.setState({floorsBimList:n},function(){return u(a,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.fetchFloorListImages()];case 1:return e.sent(),[2]}})})}),e.bimSid?[4,Object(l.a)(t,"",e.bimSid).then(function(t){return u(a,void 0,void 0,function(){var n,a,s,i=this;return d(this,function(o){for(n=this.state.floorsBimList,a=function(a){var s=t[a];if(Object(r.g)(s.bimFloor)==e.bimFloor)return"continue";if(n.find(function(e){return e.bimFloor==Object(r.g)(s.bimFloor)}))return"continue";var i=Object();i.floor=Object(r.g)(s.zone),i.linkBimism=Object(r.g)(s.linkBimism),i.rdfsLabel=Object(r.g)(s.rdfsLabel),i.bimFloor=Object(r.g)(s.bimFloor),i.bimSid=Object(r.g)(s.bimSid),i.xScaleMap=Object(r.g)(s.xScaleMap),i.yOffsetMap=Object(r.g)(s.yOffsetMap),i.xOffsetMap=Object(r.g)(s.xOffsetMap),i.yScaleMap=Object(r.g)(s.yScaleMap),i.imgFloorMap="",n.push(i)},s=0;s<t.length;s++)a(s);return this.setState({floorsBimList:n},function(){return u(i,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.fetchFloorListImages()];case 1:return e.sent(),[2]}})})}),[2]})})})]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.fetchFloorListImages=function(){return u(this,void 0,void 0,function(){var e,t,a,s,i,r;return d(this,function(l){switch(l.label){case 0:e=this.state.floorsBimList,t=this.props.buildingName,a=0,l.label=1;case 1:return a<e.length?(s=e[a],[4,Object(o.b)(t,s.floor)]):[3,4];case 2:i=l.sent(),r=i&&i[0]?""+i[0].bimImageBase:n(753),s.imgFloorMap=r,e[a]=s,l.label=3;case 3:return a++,[3,1];case 4:return this.setState({floorsBimList:e},function(){console.log("floor bim list with images loaded")}),[2]}})})},t.prototype.onFloorChange=function(e){return u(this,void 0,void 0,function(){var t,n,a,s,i,o,r;return d(this,function(l){return t=this.state,n=t.currentFloor,a=t.floor,s=t.floorsBimList,i=t.currentSweep,o=s.find(function(t){return t.bimFloor==e}),a=o,r=parseInt(e.split(" ")[1]),r-=1,window.moveToFloor(r),n="Floor "+(r+1),this.setState({currentFloor:n,floor:a},function(){window.sweepsMappingFloor(a,i.uuid)}),[2]})})},t.prototype.onSaveHandle=function(){if(this.props.isTaskForm){var e=this.state.routes;this.props.onSaveRouteClickButton(e)}else{var t=this.state.selectedSteps;this.props.onSaveClickButton(t)}},t.prototype.toggleAddingSweep=function(){window.toggleStartStopAddingSweep()},t.prototype.toggleTourStartStop=function(){window.toggleTourSelectedSweep()},t.prototype.toggleTourSweepsStartStop=function(e,t){window.toggleTourSweepsSelectedSweepNew(e,t)},t.prototype.addCurrentSweep=function(){window.addCurrentSweep()},t.prototype.removeSweep=function(e){window.removeSweep(e)},t.prototype.setDialogState=function(e,t,n,a,s,i,o,r,l,c,p,h){var f=this;null!=e&&this.setState({isStarted:e}),null!=t&&this.setState({isTourSelected:t}),null!=n&&this.setState({selectedSteps:n}),null!=a&&(this.setState({modelDetails:a}),this.getRoutes(a.sweeps)),null!=p&&this.setState({mapModelDetails:p}),null!=s&&this.setState({currentSweep:s}),null!=i&&this.setState({logMessage:i}),null!=r&&this.setState({prevSweepIndex:r}),null!=l&&this.setState({prevSweepModel:l}),null!=h&&this.state.currentFloor!=h&&this.setState({currentFloor:h},function(){return u(f,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.onFloorChange(h)];case 1:return e.sent(),[2]}})})}),null!=o&&this.setState({sdkReady:o}),null!=c&&(this.setState({sdk:c}),this.loadFrame(this.state.sdk,this.setDialogState,this.state))},t.prototype.loadSDK=function(e){var t=n(822),a=t.APIKey,s=t.Version,i=document.getElementById("showcase");window.MP_SDK.connect(i,a,s).then(function(t){console.log("SDK Connected!"),e(null,null,null,null,null,null,null,null,null,t)}).catch(function(e){console.log("Error while connecting with Matterport SDK")})},t.prototype.loadFrame=function(e,t,n){var a,s,i,o=document.getElementById("map"),r=0,l={sweep:"",mode:"INSIDE",transition:"FLY"},c=this.state,p=c.modelDetails,h=c.currentSweep,f=c.isStarted,m=c.isTourSelected,g=c.selectedSteps,b=c.sdkReady,v=c.startSweep,S=c.hasStartSweep,w=c.prevSweepIndex,k=c.prevSweepModel,y=c.isTaskView,T=c.mapModelDetails,O=c.currentFloor;function j(){return u(this,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,e.Model.getData().then(function(n){e.Camera.getPose().then(function(a){e.Renderer.getWorldPositionData(a.position).then(function(e){console.log("Model data loaded for sid:",n.sid),console.log("Current floor:",e.floor),O="Floor "+(parseInt(e.floor)+1),p=n,T.sweeps=n.sweeps.filter(function(t){return t.floor==parseInt(e.floor)}),h.uuid=a.sweep,t(null,null,null,p,h,null,null,null,null,null,null,O)})})})];case 1:return n.sent(),[2]}})})}function E(n,a){f?console.log("Tour Stopped"):(a.length>0&&a.length>n?(m=!0,e.Sweep.moveTo(a[n].uuid,{transition:e.Sweep.Transition.FLY}).then(function(e){var t="Arrived at sweep "+e+"at index "+a[n].uuidIndex;console.log(t),E(n+=1,a)}).catch(function(e){console.log("Error: "+JSON.stringify(e))})):(m=!1,console.log("Tour Ended")),t(null,m))}function N(e,t){var n=document.getElementById("p"+t),a=document.getElementById("p"+e)||n;l.sweep=n&&n.value||"",function(e,t){t&&t.classList.remove("active");e&&(e.classList+=" active")}(n,a)}function D(e,t,n,a,s){return(e-t)/(n-t)*a+s}b||e.App.state.subscribe(function(n){return u(this,void 0,void 0,function(){return d(this,function(a){switch(a.label){case 0:return n.phase===e.App.Phase.LOADING&&console.log("The app has started loading!"),n.phase===e.App.Phase.STARTING&&console.log("The transition into the start location begins!"),n.phase!==e.App.Phase.PLAYING?[3,2]:(console.log("The app is ready to take user input now!"),b=!0,t(null,null,null,null,null,null,!0),[4,function e(t){return u(this,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),p.sweeps&&p.sweeps.length>0&&O?[2]:[3,2];case 2:return[4,e(j)];case 3:n.sent(),n.label=4;case 4:return[2]}})})}(j)]);case 1:a.sent(),S&&window.goToSweep(v.uuid),a.label=2;case 2:return[2]}})})}),window.sweepsMappingFloor=function(e,t){if(T.sweeps&&T.sweeps.length>0){a=0,i=0,s=0,r=0;var n=T.sweeps.map(function(e){if(e.position){var t={pid:e.uuid,x:e.position.x||0,y:e.position.z||0};return function(e,t){a=Math.min(a,e),i=Math.max(i,e),s=Math.min(s,t),r=Math.max(i,t)}(t.x,t.y),0==t.x&&0==t.y&&(l.sweep=e.uuid),t}});o.innerHTML="",n.map(function(t){return function(e,t){if(e){var n=document.createElement("BUTTON"),l=0,c=0,u=0,d=0,p=0,h=0;if(!t)return;u=t.xScaleMap&&parseInt(t.xScaleMap)?parseInt(t.xScaleMap):70,d=t.xOffsetMap&&parseInt(t.xOffsetMap)?parseInt(t.xOffsetMap):13,p=t.yScaleMap&&parseInt(t.yScaleMap)?parseInt(t.yScaleMap):70,h=t.yOffsetMap&&parseInt(t.yOffsetMap)?parseInt(t.yOffsetMap):45,l=D(e.x,a,i,u,d),c=D(e.y,s,r,p,h),n.setAttribute("id","p"+e.pid),n.setAttribute("value",e.pid),n.style.left=l+"%",n.style.top=c+"%",n.setAttribute("class","sweep z-depth-3"),n.addEventListener("click",function(e){window.goToSweep(e.target.value),e.stopPropagation()}),o.appendChild(n)}}(t,e)})}},window.toggleStartStopAddingSweep=function(){t(f=!f),f&&window.addCurrentSweep()},window.toggleTourSelectedSweep=function(){(t(null,m=!0),m)?(console.log("Tour Started"),t(null,null,null,null,null,"Tour Started"),E(0,g.sort(function(e,t){return e.stepNo-t.stepNo}))):(console.log("Tour Stopped"),t(null,m))},window.toggleTourSweepsSelectedSweep=function(e){(t(null,m=!0),m)?(console.log("Tour Started"),t(null,null,null,null,null,"Tour Started"),E(0,e.sort(function(e,t){return e.stepNo-t.stepNo}))):(console.log("Tour Stopped"),t(null,m))},window.toggleTourSweepsSelectedSweepNew=function(n,a){for(var s=1;s<=n.length;s++){var i=document.getElementById(a+"_chkstep_"+s);i&&(i.checked=!1)}(0==a&&++a,t(null,m=!0),m)?(t(null,null,null,null,null,"Tour Started"),function n(a,s,i){f?console.log("Tour Stopped"):(s.length>0&&s.length>a?(m=!0,e.Sweep.moveTo(s[a].uuid,{transition:e.Sweep.Transition.FLY}).then(function(e){var t="Arrived at sweep "+e+"at index "+s[a].uuidIndex;console.log(t),a+=1;var o=document.getElementById(i+"_chkstep_"+a);o&&(o.checked=!0),n(a,s,i)}).catch(function(e){console.log("Error: "+JSON.stringify(e))})):(m=!1,console.log("Tour Ended")),t(null,m))}(0,n.sort(function(e,t){return e.stepNo-t.stepNo}),a)):t(null,m)},window.addCurrentSweep=function(){e.Camera.getPose().then(function(e){var n=p.sweeps.find(function(t){return t.uuid==e.sweep});t(null,null,null,null,h=n);var a=p.sweeps.indexOf(n);if(!function(e){if(g.length>0){var t=g.find(function(t){return t.uuid==e});if(null!=t||""+t!="undefined"){var n="Sweep "+t.uuid+" of index "+t.uuidIndex+" is already added in the current list";return console.log(n),!0}}return!1}(h.uuid)){g.push({uuid:h.uuid,uuidIndex:a,stepNo:g.length}),t(null,null,g);var s="Sweep "+h.uuid+" of index "+a+" is added in the current list";console.log(s)}})},window.removeSweep=function(e){var n=g.find(function(t){return t.uuid==e}),a=g.indexOf(n);if(a>-1){g.splice(a,1),t(null,null,g);var s="Sweep "+n.uuid+" of index "+n.uuidIndex+" is removed from the current list";console.log(s)}},window.goToSweep=function(t){e.Sweep.moveTo(t,{transition:e.Sweep.Transition.FLY}).then(function(e){var n="Moved to sweep "+t;console.log(n)}).catch(function(e){console.log("Error: "+JSON.stringify(e))})},window.moveToFloor=function(t){e.Floor.moveTo(t).then(function(e){console.log("Current floor: "+e),O="Floor "+(-1==e?1:e+1)}).catch(function(e){})},e.on(e.Sweep.Event.ENTER,function(){if(m)return!1;e.Camera.getPose().then(function(n){if("mode.inside"==n.mode||"mode.outside"==n.mode){if(g.length>0){var a=g.find(function(e){return e.uuid==n.sweep});if(null!=a&&""+a!="undefined"){var s="Moved to sweep "+a.uuid;console.log(s),y?(N(k.uuid,n.sweep),k=a):(N(g[w].uuid,n.sweep),w=g.indexOf(a)),t(null,null,null,null,null,null,null,w)}else{s="Not allowed in the current step ";console.log(s),y&&k.uuid?window.goToSweep(k.uuid):window.goToSweep(g[w].uuid)}}e.Renderer.getWorldPositionData(n.position).then(function(e){return u(this,void 0,void 0,function(){var a;return d(this,function(s){return a="Floor "+(parseInt(e.floor)+1),O&&O!=a&&(O=a,h.uuid=n.sweep,p.sweeps&&(T.sweeps=p.sweeps.filter(function(t){return t.floor==parseInt(e.floor)}),t(null,null,null,null,h,null,null,null,null,null,T,O))),[2]})})})}})})},t.prototype.handleRouteChange=function(e){for(var t=[],n=0;n<e.length;n++)for(var a=e[n].sweeps,s=0;s<a.length;s++){var i=a[s];t.push(i)}this.setState({routes:e,selectedSteps:t});var o=this.state,r=o.floor,l=o.currentSweep;window.sweepsMappingFloor(r,l.uuid)},t.prototype.render=function(){var e=this;this.props.isRefreshDialog&&(this.setState({isStarted:!1,isTourSelected:!1,selectedSteps:[],modelDetails:Object(),spaceDetails:[],currentSweep:Object(),matterTags:[],floorDetails:Object(),logMessage:"",sdkReady:!1,hasStartSweep:!1,startSweep:Object(),isViewForm:this.props.isViewForm,prevSweepIndex:0,onPropsReceivedStateChanged:!1,linkBimism:this.props.bimURL,destinationSpace:{label:"",value:""},destinationSweeps:[],routes:[],locationDropdownList:[],hideInBuildingRoutes:!0,hideMap:!0}),this.props.onRefreshMatterport(!1),document.getElementById("map").innerHTML="");var t=this.props,o=t.id,r=t.heading,l=t.isViewForm,c=t.isTaskForm,u=t.isTaskView,d=t.sweeps,p=t.selectedSpace,h=t.showSaveButton,f=this.state,m=f.isStarted,g=f.selectedSteps,b=f.isTourSelected,v=f.logMessage,S=f.sdkReady,w=f.linkBimism,k=f.routes,y=f.locationDropdownList,T=f.currentView,O=f.floor,j=f.hideMap,E=f.inBuildingRoutes,N=f.hideInBuildingRoutes,D=0,C=0,R=!1,x=!1;S?(R=b,x=m):(R=!0,x=!0);var F=O&&O.imgFloorMap?O.imgFloorMap:n(753);return a.createElement(i.a,{id:o,saveButtonText:"Save",heading:r,showSaveButton:h,showCancelButton:l,onSaveButtonClick:function(){e.onSaveHandle()},isFullWidth:!0},"TaskRoute"==T&&a.createElement("div",{className:"card dataCard no-margin"},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:""},c&&a.createElement("div",{className:"col-md-7 col-xs-12 matterport-dialog-task-margin-bottom"},!c&&!u&&a.createElement(a.Fragment,null,!l&&a.createElement("button",{type:"button",id:"btnStartStop",disabled:R,title:1==m?"Stop":"Start",className:"btn btn-primary btn-fill",onClick:this.toggleAddingSweep},a.createElement("i",{className:1==m?"fa fa-stop":"fa fa-plus"})),!l&&a.createElement("button",{type:"button",id:"btnAddCurrentStep",disabled:R&&x,title:"Add current step",className:"btn btn-primary btn-fill matterport-dialog-btn-tour-margin",onClick:this.addCurrentSweep},a.createElement("i",{className:"fa fa-thumb-tack"})),a.createElement("button",{type:"button",id:"btnTourSelectedSteps",disabled:x,title:1==m?"Tour selected steps stopped":"Tour selected steps started",className:"btn btn-primary btn-fill ",onClick:this.toggleTourStartStop},a.createElement("i",{className:1==b?"fa fa-stop":"fa fa-play"})),a.createElement("br",null),a.createElement("br",null)),!c&&!u&&a.createElement("span",{className:"small-font-list"},v),c&&a.createElement(s.a,{building:this.props.buildingName,items:k,onItemChange:this.handleRouteChange,isView:!1,spaces:y,destinationSpace:p,destinationSweeps:d})),!u&&a.createElement("div",{className:"col-md-5 col-xs-12"},a.createElement("table",null,a.createElement("tr",null,a.createElement("th",null,"Steps"),a.createElement("th",null)),g&&g.map(function(t){return D+=1,a.createElement("tr",null,a.createElement("td",{className:"link",onClick:function(){S&&window.goToSweep(t.uuid)}},"Step ",D,": ",t.uuid),a.createElement("td",null,!l&&S&&a.createElement("button",{type:"button",title:"Remove step",onClick:function(){e.removeSweep(t.uuid)},className:"btn btn-light matterport-dialog-btn-no-border"},a.createElement("i",{className:"fa fa-times"}))))}))),u&&a.createElement("div",{className:"col-md-5 col-xs-12"},k&&k.map(function(t,n){return D=0,C+=1,a.createElement(a.Fragment,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-6"},a.createElement("b",null,"Route ",C)),a.createElement("div",{className:"col-md-6"},a.createElement("button",{type:"button",id:"btnTourSelectedSteps",disabled:x,title:1==m?"Tour selected steps stopped":"Tour selected steps started",className:"btn btn-primary btn-fill btn-sm float-right matterport-dialog-btn-play-sm",onClick:function(){e.toggleTourSweepsStartStop(t.sweeps,n+1)}},a.createElement("i",{className:1==b?"fa fa-stop":"fa fa-play"})))),a.createElement("span",{className:"small-font-list"},t.description),c&&a.createElement("table",null,a.createElement("tr",null,a.createElement("th",null,"Steps")),t.sweeps.map(function(e){return D+=1,a.createElement("tr",null,a.createElement("td",{className:"link",onClick:function(){S&&window.goToSweep(e.uuid)}}," Step ",D,": ",a.createElement("input",{type:"checkbox",disabled:!0,style:{cursor:"pointer"},id:C+"_chkstep_"+D.toString()})))})),a.createElement("br",null),a.createElement("br",null))}))),a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-2"},a.createElement("button",{type:"button",className:"btn btn-primary btn-fill matterport-dialog-btn-tour-margin",onClick:function(){e.setState({hideMap:!j})}},j?"Show Map":"Hide Map")),E&&E.length>0&&a.createElement("div",{className:"col-md-3"},a.createElement("button",{type:"button",className:"btn btn-primary btn-fill matterport-dialog-btn-tour-margin pull-left",onClick:function(){e.setState({hideInBuildingRoutes:!N})}},N?"Show In Building Routes":"Hide In Building Routes"))),a.createElement("br",null),!N&&E.map(function(t,n){return a.createElement(a.Fragment,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-3"},a.createElement("b",null,t.routeName)),a.createElement("div",{className:"col-md-1"},a.createElement("button",{type:"button",id:"btnTourSelectedSteps",disabled:x,title:1==m?"Tour selected steps stopped":"Tour selected steps started",className:"btn btn-primary btn-fill btn-sm float-right matterport-dialog-btn-play-sm",onClick:function(){e.toggleTourSweepsStartStop(t.sweeps,n)}},a.createElement("i",{className:1==b?"fa fa-stop":"fa fa-play"})))),a.createElement("br",null))})),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12 col-xs-12"},a.createElement("iframe",{id:"showcase",src:w,onLoad:function(){e.loadSDK(e.setDialogState)},width:"100%",height:"500",frameBorder:"0",allowFullScreen:!0})),a.createElement("div",{className:j?"col-md-12 display-none":"col-md-12"},a.createElement("div",{className:"map-container"},a.createElement("img",{className:"responsive-img",src:F,alt:""}),a.createElement("div",{id:"map",className:"map"})))))))},t}(a.Component);t.a=p},1179:function(e,t,n){"use strict";var a=n(2),s=(n.n(a),n(716)),i=n(10),o=n(662),r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),l=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}l((a=a.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},u=function(e){function t(t){var n=e.call(this,t)||this;return n.state={items:[],spaces:[],selectedRowIndex:0,spacesDropDownList:[],isAddDisable:!1},n.addItem=n.addItem.bind(n),n.handleDescriptionChange=n.handleDescriptionChange.bind(n),n.handleSpaceChange=n.handleSpaceChange.bind(n),n.getSweeps=n.getSweeps.bind(n),n.handleSpaceDropdownListChange=n.handleSpaceDropdownListChange.bind(n),n}return r(t,e),t.prototype.componentWillReceiveProps=function(e){e.items&&this.setState({items:e.items}),e.spaces&&this.setState({spaces:e.spaces}),e.destinationSpace&&this.setState({destinationSpace:e.destinationSpace}),e.destinationSweeps&&this.setState({destinationSweeps:e.destinationSweeps},function(){console.log("Destination sweeps updated")})},t.prototype.addItem=function(){var e=this.state.items;e.push({space:[this.state.destinationSpace],description:"",sweeps:this.state.destinationSweeps}),this.setState({items:e,isAddDisable:!0}),this.props.onItemChange(e)},t.prototype.handleSpaceChange=function(e){return l(this,void 0,void 0,function(){var t,n,a,s,i;return c(this,function(o){switch(o.label){case 0:if(this.props.isView)return[3,5];for((t=this.state.items)[this.state.selectedRowIndex].space=e,n=[],a=e.reverse(),s=0;s<a.length;s++)i=a[s],n.push(i);s=0,o.label=1;case 1:return s<n.length?(i=n[s],[4,this.getSweeps(this.props.building,i.value,t,s)]):[3,4];case 2:o.sent(),o.label=3;case 3:return s++,[3,1];case 4:this.state.selectedRowIndex==t.length-1&&this.setState({isAddDisable:!1}),o.label=5;case 5:return[2]}})})},t.prototype.handleSpaceDropdownListChange=function(){this.setState({spacesDropDownList:this.state.spaces.map(function(e){return{value:e.ontology.value,label:e.rdfsLabel.value}})})},t.prototype.handleDescriptionChange=function(e,t){if(!this.props.isView){var n=this.state.items;n[t].description=e,this.setState({items:n}),this.props.onItemChange(n)}},t.prototype.getSweeps=function(e,t,n,a){return l(this,void 0,void 0,function(){var o=this;return c(this,function(r){switch(r.label){case 0:return[4,Object(s.c)(e,t).then(function(e){return l(o,void 0,void 0,function(){var t,s,o,r,l;return c(this,function(c){for(t=[],s=0==a?0:n[this.state.selectedRowIndex].sweeps.length,o=0;o<e.length;o++)r=e[o],(l=Object()).assignedSpace=Object(i.g)(r.assignedSpace),l.buildingName=Object(i.g)(r.buildingName),l.ontology=Object(i.g)(r.ontology),l.uuid=Object(i.g)(r.uuid),l.uuidIndex=parseInt(Object(i.g)(r.uuidIndex)),l.stepNo=parseInt(r.stepNo.value)+s,t.push(l);return 0!=a&&n[this.state.selectedRowIndex].sweeps.forEach(function(e){t.push(e)}),n[this.state.selectedRowIndex].sweeps=t,this.setState({items:n}),this.props.onItemChange(n),[2]})})}).catch(function(e){return e})];case 1:return r.sent(),[2]}})})},t.prototype.render=function(){var e=this,t=this.state,n=t.items,s=t.spaces,i=t.spacesDropDownList,r=t.isAddDisable,l=this.props.isView;return i=s.map(function(e){return{value:e.ontology.value,label:e.rdfsLabel.value}}),a.createElement(a.Fragment,null,a.createElement("div",{className:"dataCard"},a.createElement("div",{className:"row hidden-xs"},a.createElement("div",{className:"col-sm-6 headingText"},"Routes"),a.createElement("div",{className:"col-sm-6 headingText"},"Description")),n.map(function(t,n){return a.createElement("div",{key:n,className:"row"},a.createElement("div",{className:"col-sm-6 col-xs-12"},a.createElement("span",{className:"hidden visible-xs-inline headingText col-xs-6"},a.createElement("label",{htmlFor:"space"},"Routes")),a.createElement("span",{className:"fullWidth"},a.createElement(o.a,{isMulti:!0,closeMenuOnSelect:!1,value:t.space,onChange:e.handleSpaceChange,onFocus:function(){e.setState({selectedRowIndex:n})},placeholder:"Directions",options:i}))),a.createElement("div",{className:"col-sm-6 col-xs-12"},a.createElement("span",{className:"hidden visible-xs-inline headingText col-xs-3"},a.createElement("label",{htmlFor:"description"},"Description")),a.createElement("span",{className:"fullWidth"},a.createElement("input",{type:"text",className:"form-control",id:"description",value:t.description,placeholder:"Description",name:"description",onChange:function(t){return e.handleDescriptionChange(t.target.value,n)}}))))})),a.createElement("br",null),!l&&a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-11"},a.createElement("button",{disabled:r,type:"button",className:"btn btn-dark btn-fill btn-sm",onClick:this.addItem},a.createElement("i",{className:"fa fa-plus"}),n.length>0?"More":"Add"))))},t}(a.Component);t.a=u},1885:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(2),i=(n.n(s),n(1886)),o=n(1887),r=n(1281),l=n(31),c=n(649),u=n(670),d=n.n(u),p=n(118),h=n(10),f=n(121),m=n(657),g=n(116),b=n(57),v=n(662),S=n(11),w=n(716),k=n(658),y=n(1177),T=n(671),O=n(55),j=n(754),E=n(32),N=n(119),D=n(747),C=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),R=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}l((a=a.apply(e,t||[])).next())})},x=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},F=new f.a,M=function(e){function t(t){var n=e.call(this,t)||this;return n.state={task:Object(),showDetailForm:!1,showSequenceForm:!1,isEdit:!1,people:[],isDateOnly:!1,startedTasks:[],tasksDropdownList:[],isNotifyDate:!0,taskType:"",routeSpaces:[],allSpaces:[],allSweeps:[],showQRTaskToggle:!1,_buildings:[],filteredPeople:[],actions:[],isChange:!1,preAction:"",preAssignedTo:[],preBuilding:"",preFloor:"",preSpace:"",preAsset:[],preShowDetail:!1},n.updateView=n.updateView.bind(n),n.handleTaskChange=n.handleTaskChange.bind(n),n.handleDoAtChange=n.handleDoAtChange.bind(n),n.handleDoIfStartRadio=n.handleDoIfStartRadio.bind(n),n._saveTask=n._saveTask.bind(n),n._saveRoutes=n._saveRoutes.bind(n),n.sendSms=n.sendSms.bind(n),n.sendMail=n.sendMail.bind(n),n._fetchPeople=n._fetchPeople.bind(n),n.fetchTask=n.fetchTask.bind(n),n._fetchTasks=n._fetchTasks.bind(n),n.getTaskRoutes=n.getTaskRoutes.bind(n),n.getAllSpaces=n.getAllSpaces.bind(n),n.getAllSweeps=n.getAllSweeps.bind(n),n.interruptTasks=n.interruptTasks.bind(n),n.handleNotifyDateChange=n.handleNotifyDateChange.bind(n),n.handleNotifyRadio=n.handleNotifyRadio.bind(n),n.handleManagerReviewCheck=n.handleManagerReviewCheck.bind(n),n.handleRecurringCheck=n.handleRecurringCheck.bind(n),n.handleRecurringScheduleRadio=n.handleRecurringScheduleRadio.bind(n),n.handleRecurringEndDays=n.handleRecurringEndDays.bind(n),n.handleRecurringDays=n.handleRecurringDays.bind(n),n.handleMultiTaskChange=n.handleMultiTaskChange.bind(n),n.handleRoutesMatterport=n.handleRoutesMatterport.bind(n),n.handleShowQrToggle=n.handleShowQrToggle.bind(n),n.handleBuildingChange=n.handleBuildingChange.bind(n),n.onDoneClicked=n.onDoneClicked.bind(n),n._saveObjectFormAction=n._saveObjectFormAction.bind(n),a=n,n}return C(t,e),t.prototype.componentWillMount=function(){return R(this,void 0,void 0,function(){return x(this,function(e){return[2]})})},t.prototype.componentDidMount=function(){return R(this,void 0,void 0,function(){var e;return x(this,function(t){switch(t.label){case 0:return(e=this.state.actions)[0]=[],this.setState({actions:e}),this.props.buildingName?(this._fetchBuildings(),[4,this._fetchTasks()]):[3,3];case 1:return t.sent(),[4,this.fetchTask()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype._fetchBuildings=function(){return R(this,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,Object(T.d)().then(function(e){a.setState({_buildings:e})}).catch(function(e){return e})];case 1:return e.sent(),[2]}})})},t.prototype._fetchTasks=function(){return R(this,void 0,void 0,function(){var e,t,n;return x(this,function(s){switch(s.label){case 0:return e=this.state,t=e.startedTasks,n=e.tasksDropdownList,t.length<1||n.length<1?[4,Object(p.m)(this.state.task.building,"",!1).then(function(e){var t=e&&e.filter(function(e){return""!=Object(h.g)(e.action)&&"true"!=Object(h.g)(e.isSequence)&&"Completed"!=Object(h.g)(e.status)}),n=t&&t.map(function(e){return{value:Object(h.g)(e.task),label:Object(h.g)(e.taskNumber)+"- "+Object(h.g)(e.action)}});a.setState({startedTasks:e&&e.filter(function(e){return e.hasOwnProperty("startTime")&&"Started"==Object(h.g)(e.status)}),tasksDropdownList:n})}).catch(function(e){return e})]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.interruptTasks=function(){return R(this,void 0,void 0,function(){var e,t,n=this;return x(this,function(a){return e=this.state.startedTasks,t=this.state.task,e.length>0&&e.map(function(e){t.subTasks&&t.subTasks.length>0?Object(h.g)(e.assignedTo)==t.subTasks[0].assignedTo&&(Object(p.f)(Object(h.g)(e.task),"Interrupted"),n.updateTaskStatus(Object(h.g)(e.task),"Paused")):t.assignedTo.map(function(t){Object(h.g)(e.assignedTo)==t.value&&(Object(p.f)(Object(h.g)(e.task),"Interrupted"),n.updateTaskStatus(Object(h.g)(e.task),"Paused"))})}),[2]})})},t.prototype.updateTaskStatus=function(e,t){return R(this,void 0,void 0,function(){return x(this,function(n){switch(n.label){case 0:return[4,Object(p.C)(e,t,!0)];case 1:return n.sent(),[2]}})})},t.prototype.getTaskRoutes=function(e,t){return R(this,void 0,void 0,function(){var n,a,s,i,o=this;return x(this,function(r){switch(r.label){case 0:return n=[],a=[],s=[],i=[],[4,Object(w.d)(e,t).then(function(e){return R(o,void 0,void 0,function(){var t,o,r,l=this;return x(this,function(c){return t=this.state,o=t.allSpaces,r=t.allSweeps,e.forEach(function(e){return R(l,void 0,void 0,function(){var t,l,c,u,d,p,f,m,g;return x(this,function(b){for((t=Object()).description=Object(h.g)(e.description),t.ontology=Object(h.g)(e.ontology),t.task=Object(h.g)(e.task),a=e.space.value.split(","),s=e.sweeps.value.split(","),i=e.stepNo.value.split(","),l=Object(),c=[],d=function(e){var t=a[e];null==(u=o.find(function(e){return e.space.value==t}))&&""+u=="undefined"||(l={label:u.rdfsLabel.value,value:t},c.push(l))},g=0;g<a.length;g++)d(g);for(p=Object(),f=[],m=function(e){var t=s[e];null==(p=r.find(function(e){return e.uuid==t}))&&""+p=="undefined"||(p.stepNo=i[e],f.push(p))},g=0;g<s.length;g++)m(g);return t.space=c,t.sweeps=f,n.push(t),[2]})})}),this.setState({routeSpaces:n}),[2]})})}).catch(function(e){return e})];case 1:return r.sent(),[2]}})})},t.prototype.getAllSpaces=function(e){return R(this,void 0,void 0,function(){var t=this;return x(this,function(n){switch(n.label){case 0:return[4,Object(k.k)(e).then(function(n){return R(t,void 0,void 0,function(){return x(this,function(t){return this.setState({allSpaces:n}),""+this.state.task.task!="undefined"&&this.getTaskRoutes(e,this.state.task.task),[2]})})}).catch(function(e){return e})];case 1:return n.sent(),[2]}})})},t.prototype.getAllSweeps=function(e){return R(this,void 0,void 0,function(){var t,n=this;return x(this,function(a){switch(a.label){case 0:return t=[],[4,Object(w.c)(e).then(function(a){return R(n,void 0,void 0,function(){return x(this,function(n){return a.forEach(function(e){var n=Object();n.assignedSpace=Object(h.g)(e.assignedSpace),n.buildingName=Object(h.g)(e.buildingName),n.ontology=Object(h.g)(e.ontology),n.uuid=Object(h.g)(e.uuid),n.uuidIndex=parseInt(Object(h.g)(e.uuidIndex)),n.stepNo=parseInt(Object(h.g)(e.stepNo)),t.push(n)}),this.setState({allSweeps:t}),""+this.state.task.task!="undefined"&&this.getTaskRoutes(e,this.state.task.task),[2]})})}).catch(function(e){return e})];case 1:return a.sent(),[2]}})})},t.prototype.fetchTask=function(){return R(this,void 0,void 0,function(){var e,t,n,a,s,i,o,r,c,u,d,f,m,g,b,v,w,k,y,T,O,E,N=this;return x(this,function(D){switch(D.label){case 0:return e=this.props.taskID,t=this.state,n=t.task,a=t.showDetailForm,s=t.showSequenceForm,i=t.taskType,o=t.actions,r=t.tasksDropdownList,a=!1,s=!1,c="",e?[4,Object(p.m)("",e).then(function(e){return R(N,void 0,void 0,function(){var t,i,o,l,u,d;return x(this,function(p){return t=e[0],i=t.assignedTo.value.indexOf(",")>0?t.assignedTo.value.split(", "):[t.assignedTo.value],o=t.assignedToName.value.indexOf(",")>0?t.assignedToName.value.split(", "):[t.assignedToName.value],n.task=Object(h.g)(t.task),n.taskNumber=Object(h.g)(t.taskNumber),n.description=Object(h.g)(t.description),n.action=Object(h.g)(t.action),n.enteredBy=Object(h.g)(t.enteredBy),n.enteredByName=Object(h.g)(t.enteredByName),n.assignedTo=t.assignedTo&&i.map(function(e,t){return{label:o[t],value:e}}),n.hasChat=Object(h.g)(t.chatName).trim().length>2,n.entryTimeStamp=Object(h.g)(t.entryTimeStamp),n.criticality=Object(h.g)(t.criticality),l=""!=Object(h.g)(t.equipSubject)?t.equipSubject.value.indexOf(",")>0?t.equipSubject.value.split(","):[t.equipSubject.value]:[],u=t.equipRdfsLabel&&t.equipRdfsLabel.value.indexOf(",")>0?t.equipRdfsLabel.value.split(","):[t.equipRdfsLabel.value],n.equipSubject=t.equipSubject&&l.map(function(e,t){return{label:u[t].trim(),value:e.trim()}}),n.equipRdfsLabel=Object(h.g)(t.equipRdfsLabel),n.spaceSubject=Object(h.g)(t.spaceSubject),n.spaceRdfsLabel=Object(h.g)(t.spaceRdfsLabel),n.floor=Object(h.g)(t.floor),n.building=Object(h.g)(t.building),a=Object(h.g)(t.floor).length>0||""!=Object(h.g)(t.floor)||"true"==Object(h.g)(t.isSequence),n.floorRdfsLabel=Object(h.g)(t.floorRdfsLabel),n.status=Object(h.g)(t.status),n.subTasks=[],c=Object(h.g)(t.subTasks),n.acknowledged="true"==Object(h.g)(t.acknowledged),n.archived="true"==Object(h.g)(t.archived),n.note=Object(h.g)(t.note),n.isForcePush="true"==Object(h.g)(t.isForcePush),n.isRecurring="true"==Object(h.g)(t.isRecurring),n.recurringSchedule=Object(h.g)(t.recurringSchedule),n.startTime=Object(h.g)(t.startTime),n.notifyAt=""!=Object(h.g)(t.notifyAt)?Object(h.g)(t.notifyAt):void 0,n.isQRTask="true"==Object(h.g)(t.isQRTask),n.QRTag=Object(h.g)(t.QRTag),n.isSequence="true"==Object(h.g)(t.isSequence),s="true"==Object(h.g)(t.isSequence),n.startTaskCondition=Object(h.g)(t.startTaskCondition),n.endingDaysCount=""==Object(h.g)(t.endingDaysCount)?null:parseInt(Object(h.g)(t.endingDaysCount)),n.recurDays=""==Object(h.g)(t.recurDays)?null:parseInt(Object(h.g)(t.recurDays)),d=""!=Object(h.g)(t.conditionalTasks)?t.conditionalTasks.value.indexOf(",")>0?t.conditionalTasks.value.split(", "):[t.conditionalTasks.value]:[],r&&r.length>0&&(n.conditionalTasks=d&&d.map(function(e,t){var n=r.find(function(t){return t.value==e});if(n)return{label:n.label,value:n.value}})),n.workflowType=Object(h.g)(t.workflowType),n.redirectionLink=Object(h.g)(t.redirectionLink),n.isStage="true"==Object(h.g)(t.isStage),n.isActivated="true"==Object(h.g)(t.isActivated),n.estimatedStartTime=""!=Object(h.g)(t.estimatedStartTime)?new Date(Object(h.g)(t.estimatedStartTime)):void 0,n.estimatedEndTime=""!=Object(h.g)(t.estimatedEndTime)?new Date(Object(h.g)(t.estimatedEndTime)):void 0,[2]})})})]:[3,9];case 1:return D.sent(),[4,Object(p.n)("",e,c)];case 2:(u=D.sent())[0].subTask||(u=[]),d=function(e){var t,a,s,i,r;return x(this,function(l){switch(l.label){case 0:return t=u[e],(a=Object()).subTask=Object(h.g)(t.subTask),a.taskNumber=Object(h.g)(a.taskNumber),a.description=Object(h.g)(t.description),a.action=Object(h.g)(t.action),a.assignedTo=Object(h.g)(t.assignedTo),a.assignedDepartment=Object(h.g)(t.assignedDepartment),a.index=parseInt(Object(h.g)(t.index)),a.parentTask=Object(h.g)(t.parentTask),a.entryTimeStamp=Object(h.g)(t.entryTimeStamp),a.workOrder=Object(h.g)(t.workOrder),a.note=Object(h.g)(t.note),a.relatedLink=t.relatedLink?t.relatedLink.value.indexOf(",")>0?t.relatedLink.value.split(","):[t.relatedLink.value]:[""],a.duration=t.duration&&-1!=t.duration.value.indexOf("-")?t.duration.value.split("-")[0]:"1",a.durationUnit=t.duration&&-1!=t.duration.value.indexOf("-")?t.duration.value.split("-")[1]:"Hours",a.workerDuration=t.workerDuration&&-1!=t.workerDuration.value.indexOf("-")?t.workerDuration.value.split("-")[0]:"1",a.workerDurationUnit=t.workerDurationUnit&&-1!=t.workerDurationUnit.value.indexOf("-")?t.workerDurationUnit.value.split("-")[1]:"Hours",a.fileName=Object(h.g)(t.fileName).split(","),a.oldFileName=Object(h.g)(t.fileName).split(","),a.enteredBy=Object(h.g)(t.enteredBy),a.enteredByName=Object(h.g)(t.enteredByName),a.startTime=Object(h.g)(t.startTime),a.workType=Object(h.g)(t.workType),a.status=Object(h.g)(t.status),a.checklistID=Object(h.g)(t.checklistID),a.isQRTask="true"==Object(h.g)(t.isQRTask),a.QRTag=Object(h.g)(t.QRTag),a.notifyViaEmail="true"==Object(h.g)(t.notifyViaEmail),a.notifyViaSMS="true"==Object(h.g)(t.notifyViaSMS),a.estimatedStartTime=""!=Object(h.g)(t.estimatedStartTime)?new Date(Object(h.g)(t.estimatedStartTime)):void 0,a.estimatedEndTime=""!=Object(h.g)(t.estimatedEndTime)?new Date(Object(h.g)(t.estimatedEndTime)):void 0,s=""!=Object(h.g)(t.equipSubject)?t.equipSubject.value.indexOf(",")>0?t.equipSubject.value.split(","):[t.equipSubject.value]:[],i=t.equipRdfsLabel&&t.equipRdfsLabel.value.indexOf(",")>0?t.equipRdfsLabel.value.split(","):[t.equipRdfsLabel.value],a.equipSubject=t.equipSubject&&s.map(function(e,t){return{label:i[t].trim(),value:e.trim()}}),a.equipRdfsLabel=Object(h.g)(t.equipRdfsLabel),a.spaceSubject=Object(h.g)(t.spaceSubject),a.spaceRdfsLabel=Object(h.g)(t.spaceRdfsLabel),a.building=Object(h.g)(t.building),a.workflowType=Object(h.g)(t.workflowType),a.redirectionLink=Object(h.g)(t.redirectionLink),a.isStage="true"==Object(h.g)(t.isStage),a.isActivated="true"==Object(h.g)(t.isActivated),a.acknowledged="true"==Object(h.g)(t.acknowledged),a.archived="true"==Object(h.g)(t.archived),n.subTasks.push(a),[4,Object(j.c)(f.props.buildingName,[Object(h.g)(t.subTask)])];case 1:return r=l.sent(),o[e]=[],o[e]=r,[2]}})},f=this,m=0,D.label=3;case 3:return m<u.length?[5,d(m)]:[3,6];case 4:D.sent(),D.label=5;case 5:return m++,[3,3];case 6:return""!=n.startTime&&"Pending"!=n.status&&"Completed"!=n.status&&n.acknowledged?i="Do Now":(""!=n.startTime||n.conditionalTasks.length>0)&&"Pending"==n.status?i="Do If":""==n.startTime&&n.acknowledged&&0==n.conditionalTasks.length&&(i="Do Next"),this.setState({task:n,actions:o,taskType:i,isEdit:!0,showDetailForm:a,showSequenceForm:s,showQRTaskToggle:""!=n.QRTag},function(){return R(N,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this._fetchPeople()];case 1:return e.sent(),[2]}})})}),[4,this.getAllSpaces(n.building)];case 7:return D.sent(),[4,this.getAllSweeps(n.building)];case 8:return D.sent(),[3,10];case 9:g=JSON.parse(S.a.getItem("user")),n={acknowledged:!1,archived:!1,status:"Pending",startTime:"",spaceSubject:"",hasChat:!1,criticality:"3",assignedTo:[],description:"",spaceRdfsLabel:"",floorRdfsLabel:"",enteredBy:g.contact,enteredByName:"",floor:"",equipSubject:[],equipRdfsLabel:"",entryTimeStamp:"",task:Object(l.p)(7),notifyViaEmail:!0,subTasks:[],note:"",isDeleted:!1,isForcePush:!1,recurringSchedule:"week",isSequence:!1,startTaskCondition:"daytime",taskNumber:Object(l.n)(8).toString(),workOrder:"",isQRTask:!1,building:n.building?n.building:this.props.buildingName,isActivated:!0,isStage:!1},this.setState({task:n,isEdit:!1},function(){return R(N,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this._fetchPeople()];case 1:return e.sent(),[2]}})})}),D.label=10;case 10:return b=this.state,v=b.preAction,w=b.preBuilding,k=b.preAssignedTo,y=b.preFloor,T=b.preSpace,O=b.preAsset,E=b.preShowDetail,v=n&&n.action?n.action:"",w=n&&n.building?n.building:"",n&&n.assignedTo&&n.assignedTo.forEach(function(e){k.push(e)}),y=n.floor,T=n.spaceSubject,n&&n.equipSubject&&n.equipSubject.forEach(function(e){O.push(e)}),E=this.state.showDetailForm,this.setState({preAction:v,preAssignedTo:k,preBuilding:w,preFloor:y,preSpace:T,preAsset:O,preShowDetail:E}),[2]}})})},t.prototype._fetchPeople=function(){return R(this,void 0,void 0,function(){var e,t,n;return x(this,function(a){switch(a.label){case 0:return e=this.state.task,[4,Object(m.p)()];case 1:return t=a.sent(),n=t.filter(function(t){return Object(h.g)(t.assignedTo).includes(e.building)}),this.setState({people:t,filteredPeople:n}),[2]}})})},t.prototype.filterPeople=function(e){return this.state.people.filter(function(t){return Object(h.g)(t.assignedTo).includes(e)})},t.prototype.handleTaskChange=function(e){var t=this.state.isChange;if(t=!0,e.action==this.state.preAction&&this.state.preBuilding==this.state.task.building){var n=0;if(e.assignedTo.length==this.state.preAssignedTo.length){for(var a=0;a<this.state.task.assignedTo.length;a++)e.assignedTo[a].value==this.state.preAssignedTo[a].value&&n++;if(n==this.state.task.assignedTo.length&&(t=!1),this.state.preShowDetail){if(this.state.showDetailForm){t=e.floor!=this.state.preFloor||this.state.preSpace!=e.spaceSubject;var s=0;if(e.equipSubject.length==this.state.preAsset.length){for(a=0;a<e.equipSubject.length;a++)e.equipSubject[a].value==this.state.preAsset[a].value&&s++;t=s!=e.equipSubject.length}else t=!0}}else t=!0;this.state.showSequenceForm&&(t=!0)}}this.setState({task:e,isChange:t})},t.prototype.handleShowQrToggle=function(e){this.setState({showQRTaskToggle:e})},t.prototype.handleDoAtChange=function(e){var t=this.state.task;t.startTime=e?e.toString():"",this.setState({task:t})},t.prototype.handleManagerReviewCheck=function(e){var t=this.state.task;t.isForcePush=e,t.acknowledged=e,this.setState({task:t})},t.prototype.handleRecurringCheck=function(e){var t=this.state.task;t.isRecurring=e,this.setState({task:t})},t.prototype.handleDoIfStartRadio=function(e){var t=this.state.task;t.startTaskCondition=e,"completionof"!=e&&"startof"!=e||(t.startTime="",t.notifyAt=""),"daytime"==e&&(t.conditionalTasks=[]),this.setState({task:t})},t.prototype.handleNotifyDateChange=function(e){var t=this.state.task;t.notifyAt=e?e.toString():"",this.setState({task:t})},t.prototype.handleNotifyRadio=function(e){var t=this.state.isNotifyDate;t=e,this.setState({isNotifyDate:t})},t.prototype.handleRecurringScheduleRadio=function(e){var t=this.state.task;t.recurringSchedule=e,this.setState({task:t})},t.prototype.handleMultiTaskChange=function(e){var t=this.state.task;t.conditionalTasks=e||[],this.setState({task:t})},t.prototype.handleRoutesMatterport=function(e){this.setState({routeSpaces:e})},t.prototype.updateView=function(e,t){return R(this,void 0,void 0,function(){return x(this,function(n){return this.setState({showDetailForm:e,showSequenceForm:t}),[2]})})},t.prototype._saveRoutes=function(e){return R(this,void 0,void 0,function(){var t,n,a,s,i;return x(this,function(o){switch(o.label){case 0:return t=this.props.buildingName,n=this.state,a=n.task,s=n.isEdit,(i=n.routeSpaces).map(function(e){return e.task=a.task}),e||Object(g.a)(!0),[4,Object(w.h)(t,i,s).then(function(){e||Object(g.a)(!1)})];case 1:return o.sent(),[2]}})})},t.prototype._saveTask=function(e){return R(this,void 0,void 0,function(){var t,n,a,s,i,o,r,c,u,d,h,f,m,b=this;return x(this,function(v){switch(v.label){case 0:if(t=this.props,n=t.buildingName,a=t.instance,s=this.state,i=s.task,o=s.isEdit,r=s.actions,c="",c+=Object(l.o)(),i.color=c,u=i.subTasks,i.subTasks.length>0){for(d=function(e){var t="";r&&r.map(function(n,a){return R(b,void 0,void 0,function(){return x(this,function(s){return e==a&&(t="",n&&n.map(function(e,n){t=t+e.ontology+","}),t=t.substring(0,t.length-1)),[2]})})}),u[e].checklistID=t,u[e].color=c},h=0;h<u.length;h++)d(h);i.estimatedStartTime=i.subTasks.length>0?new Date(i.subTasks[0].estimatedStartTime):new Date,f=parseInt(i.subTasks[i.subTasks.length-1].duration),m=i.subTasks.length>0?new Date(i.subTasks[i.subTasks.length-1].estimatedStartTime):null,i.estimatedEndTime=new Date(m.setHours(m.getHours()+f))}return e||Object(g.a)(!0),i.hasChat=!0,i.isActivated=!0,i.workflowType?i.isStage=!0:i.isStage=!1,[4,Object(p.x)(i.building,i,o).then(function(){e||(Object(O.n)(),window.location.hash=a+"/"+n+"/Tasks"),e||Object(g.a)(!1)})];case 1:return v.sent(),[2]}})})},t.prototype.sendMail=function(e){return R(this,void 0,void 0,function(){var t,n,a,s;return x(this,function(i){return t=this.state.people,n=this.props.instance,e.subTasks&&e.subTasks.length>0&&e.subTasks[0].assignedTo?(a=t.find(function(t){return Object(h.g)(t.contact)==e.subTasks[0].assignedTo}))&&Object(h.g)(a.email).length>0&&((s=Object()).subject="ONIT Task",s.to=Object(h.g)(a.email),s.text="You have been assigned a new Task. Please visit "+window.location.origin+"/#"+n+"/"+e.building+"/tasks",Object(b.a)(s)):e.assignedTo.map(function(a){var s=t.find(function(e){return Object(h.g)(e.contact)==Object(h.g)(a)});if(s&&Object(h.g)(s.email).length>0){var i=Object();i.subject="ONIT Task",i.to=Object(h.g)(s.email),i.text="You have been assigned a new Task. Please visit "+window.location.origin+"/#"+n+"/"+e.building+"/tasks",Object(b.a)(i)}}),[2]})})},t.prototype.sendSms=function(e){return R(this,void 0,void 0,function(){var t,n,a;return x(this,function(s){return t=this.state.people,n=this.props.instance,e.subTasks&&e.subTasks.length>0&&e.subTasks[0].assignedTo?(a=t.find(function(t){return Object(h.g)(t.contact)==e.subTasks[0].assignedTo}))&&Object(h.g)(a.phone).length>0&&F.SendSMS(Object(h.g)(a.phone),"You have been assigned a new Task. Please visit "+window.location.origin+"/#"+n+"/"+e.building+"/tasks",n,function(e){}):e.assignedTo.map(function(a){var s=t.find(function(e){return Object(h.g)(e.contact)==Object(h.g)(a)});s&&Object(l.v)(Object(h.g)(s.smsSchedule))&&s&&Object(h.g)(s.phone).length>0&&F.SendSMS(Object(h.g)(s.phone),"You have been assigned a new Task. Please visit "+window.location.origin+"/#"+n+"/"+e.building+"/tasks",n,function(e){})}),[2]})})},t.prototype.handleRecurringDays=function(e){var t=this.state.task;t.recurDays=e,this.setState({task:t})},t.prototype.handleRecurringEndDays=function(e){var t=this.state.task;t.endingDaysCount=e,this.setState({task:t})},t.prototype.handleBuildingChange=function(e){var t=this.state.task;t.building=e,t.floor="",t.spaceSubject="",t.equipSubject=[],t.assignedTo=[],t.isQRTask=!1;var n=this.filterPeople(e);this.setState({task:t,showQRTaskToggle:!1,filteredPeople:n})},t.prototype.onDoneClicked=function(e,t){return R(this,void 0,void 0,function(){var n;return x(this,function(a){return(n=this.state.actions)[e-1]=t,this.setState({actions:n}),[2]})})},t.prototype._saveObjectFormAction=function(e){return R(this,void 0,void 0,function(){var t,n,a;return x(this,function(s){switch(s.label){case 0:if(e||Object(g.a)(!0),t=this.props.buildingName,!((n=this.state.actions)&&n.length>0))return[3,4];a=0,s.label=1;case 1:return a<n.length?[4,Object(j.d)(t,this.state.actions[a])]:[3,4];case 2:s.sent(),s.label=3;case 3:return a++,[3,1];case 4:return e||Object(g.a)(!1),[2]}})})},t.prototype.hasOtherStartedTask=function(){return R(this,void 0,void 0,function(){var e,t,n,a,s=this;return x(this,function(i){switch(i.label){case 0:return e=JSON.parse(S.a.getItem("user")),t=!1,[4,Object(p.l)(e.contact)];case 1:return n=i.sent(),(a=n&&n.length>0&&n.filter(function(t){return t.hasOwnProperty("startTime")&&"Started"==Object(h.g)(t.status)&&"true"!=Object(h.g)(t.isSequence)&&Object(h.g)(t.assignedTo)==e.contact})).length>0&&(confirm("If you start this task you will pause the one you are working on, is this ok?")?a.map(function(e){Object(p.f)(Object(h.g)(e.task),"Interrupted"),s.updateTaskStatus(Object(h.g)(e.task),"Paused")}):t=!0),[2,t]}})})},t.prototype.updateRecentPerformance=function(){return R(this,void 0,void 0,function(){var e,t,n=this;return x(this,function(a){switch(a.label){case 0:return e=this.props.buildingName,t=JSON.parse(S.a.getItem("user")),[4,Object(D.b)(e,t.contact).then(function(e){return R(n,void 0,void 0,function(){var t;return x(this,function(n){switch(n.label){case 0:return null==e||""==e._id?[3,2]:(t={_id:e._id,contact:e.contact,contactName:e.contactName,status:e.status,taskOntology:e.taskOntology,taskDescription:e.taskDescription,startDate:e.startDate,endDate:new Date,building:e.building,entryTimestamp:e.entryTimestamp,floorOntology:e.floorOntology,floorDescription:e.floorDescription,assetOntology:e.assetOntology,assetDescription:e.assetDescription,spaceOntology:e.spaceOntology,spaceDescription:e.spaceDescriptionres,workOrder:e.workOrder,stageOntologyReference:e.stageOntologyReference},[4,this.updateCrewPerformance(t)]);case 1:n.sent(),n.label=2;case 2:return[2]}})})})];case 1:return a.sent(),[2]}})})},t.prototype.updateCrewPerformance=function(e){return R(this,void 0,void 0,function(){return x(this,function(t){switch(t.label){case 0:return[4,Object(D.c)(e).then(function(e){}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.startImmediateTask=function(e){return R(this,void 0,void 0,function(){var t,n,a;return x(this,function(s){switch(s.label){case 0:return t=this.state.task,e||document.getElementById("clockInOutButton").click(),[4,this.hasOtherStartedTask()];case 1:return s.sent()?[4,this.handleDoNext(t,this.props.instance,!0)]:[3,3];case 2:return s.sent(),[3,9];case 3:return[4,this.handleDoNow(!0)];case 4:return s.sent(),[4,Object(p.C)(t.task,"Started",!1,(new Date).toString())];case 5:return s.sent(),[4,this.updateRecentPerformance()];case 6:return s.sent(),n=JSON.parse(S.a.getItem("user")),a={contact:n.contact,contactName:n.name,status:"Started",taskOntology:t.task,taskDescription:t.action,startDate:new Date,endDate:new Date,building:t.buildingName,entryTimestamp:new Date,floorOntology:t.floor,floorDescription:t.floorRdfsLabel,assetOntology:t.equipSubject.map(function(e){return e.value}).join(","),assetDescription:t.equipSubject.map(function(e){return e.label}).join(","),spaceOntology:t.spaceSubject,spaceDescription:t.spaceRdfsLabel,workOrder:""!=t.workOrder?t.workOrder:"wo-55555",stageOntologyReference:t.task?t.task:""},[4,this.updateCrewPerformance(a)];case 7:return s.sent(),[4,Object(p.y)(this.props.buildingName)];case 8:s.sent(),s.label=9;case 9:return[2]}})})},t.prototype.handleDoNow=function(e){var t=this;e||Object(g.a)(!0);var n=this.state.task,a=this.props.instance;if(n.startTime=(new Date).toString(),n.status="Assigned",n.acknowledged=!0,n.notifyViaEmail=!0,n.subTasks.length>0)for(var s=function(e){if(n.subTasks[e].equipSubject=n.equipSubject,n.subTasks[e].spaceSubject=n.spaceSubject,n.subTasks[e].building=n.building,n.subTasks[e].criticality=n.criticality,n.subTasks[0].startTime=(new Date).toString(),n.subTasks[0].status="Assigned",e>0&&(n.subTasks[e].acknowledged=!0,new Date(n.subTasks[e].estimatedStartTime)<new Date(n.subTasks[e-1].estimatedStartTime)))return Object(E.a)("Dates are out of sequential order"),Object(g.a)(!1),{value:void 0};if(""==n.subTasks[e].assignedTo&&""!=n.subTasks[e].assignedDepartment){var t=i.state.people.filter(function(t){return Object(h.g)(t.departmentsAndGroups).toLowerCase().includes(n.subTasks[e].assignedDepartment.toLowerCase())&&"2"==Object(h.g)(t.role)}),s="Task has been assigned to Your Department Click: "+window.location.origin+"/#"+a+"/"+n.building+"/tasks";t.length>0&&t.map(function(e){if(e&&Object(h.g)(e.email).length>0){var t=Object();t.subject="Task Assigned to your Department",t.to=Object(h.g)(e.email),t.text=s,Object(b.a)(t)}})}},i=this,o=0;o<n.subTasks.length;o++){var r=s(o);if("object"===typeof r)return r.value}e||Object(g.a)(!1),this.setState({task:n},function(){return R(t,void 0,void 0,function(){return x(this,function(t){switch(t.label){case 0:return this.state.showSequenceForm&&n&&n.subTasks&&n.subTasks.length>1?(n.notifyViaEmail&&this.sendMail(n),n.notifyViaSMS&&this.sendSms(n)):this.sendMail(n),[4,this._saveRoutes(e)];case 1:return t.sent(),[4,this._saveObjectFormAction(e)];case 2:return t.sent(),[4,this._saveTask(e)];case 3:return t.sent(),[2]}})})})},t.prototype.handleDoNext=function(e,t,n){return R(this,void 0,void 0,function(){var a,s,i,o,r,l,c,u,d=this;return x(this,function(f){switch(f.label){case 0:return Object(g.a)(!0),a=[],e.subTasks.length>0?[4,Object(p.l)(e.subTasks[0].assignedTo)]:[3,2];case 1:return a=f.sent(),[3,4];case 2:return[4,Object(p.l)(e.assignedTo[0].value)];case 3:a=f.sent(),f.label=4;case 4:if((a&&a.length>0&&a.filter(function(e){return e.hasOwnProperty("startTime")&&"Pending"!=Object(h.g)(e.status)&&"Completed"!=Object(h.g)(e.status)&&"true"!=Object(h.g)(e.isSequence)})).length>0){if(e.startTime="",e.acknowledged=!0,e.isDoNext=!0,e.status="Pending",e.notifyViaEmail=!0,e.subTasks.length>0)for(s=function(n){if(e.subTasks[n].equipSubject=e.equipSubject,e.subTasks[n].spaceSubject=e.spaceSubject,e.subTasks[n].building=e.building,e.subTasks[n].criticality=e.criticality,e.subTasks[0].isDoNext=!0,e.subTasks[n].status="Pending",e.subTasks[n].startTime="",e.subTasks[n].acknowledged=!0,n>0&&new Date(e.subTasks[n].estimatedStartTime)<new Date(e.subTasks[n-1].estimatedStartTime))return Object(E.a)("Dates are out of sequential order"),Object(g.a)(!1),{value:void 0};if(""==e.subTasks[n].assignedTo&&""!=e.subTasks[n].assignedDepartment){var a=i.state.people.filter(function(t){return Object(h.g)(t.departmentsAndGroups).toLowerCase().includes(e.subTasks[n].assignedDepartment.toLowerCase())&&"2"==Object(h.g)(t.role)}),s="Task has been assigned to Your Department Click: "+window.location.origin+"/#"+t+"/"+e.building+"/tasks";a.length>0&&a.map(function(e){if(e&&Object(h.g)(e.email).length>0){var t=Object();t.subject="Task Assigned to your Department",t.to=Object(h.g)(e.email),t.text=s,Object(b.a)(t)}})}},i=this,c=0;c<e.subTasks.length;c++)if("object"===typeof(o=s(c)))return[2,o.value];this.setState({task:e},function(){return R(d,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this._saveRoutes()];case 1:return e.sent(),[4,this._saveTask(n)];case 2:return e.sent(),[4,this._saveObjectFormAction()];case 3:return e.sent(),[2]}})})})}else{if(Object(g.a)(!0),e.startTime=(new Date).toString(),e.status="Assigned",e.acknowledged=!0,e.notifyViaEmail=!0,e.subTasks.length>0)for(r=function(n){if(e.subTasks[n].equipSubject=e.equipSubject,e.subTasks[n].spaceSubject=e.spaceSubject,e.subTasks[n].building=e.building,e.subTasks[n].criticality=e.criticality,e.subTasks[0].startTime=(new Date).toString(),e.subTasks[0].status="Assigned",n>0&&(e.subTasks[n].acknowledged=!0,new Date(e.subTasks[n].estimatedStartTime)<new Date(e.subTasks[n-1].estimatedStartTime)))return Object(E.a)("Dates are out of sequential order"),Object(g.a)(!1),{value:void 0};if(""==e.subTasks[n].assignedTo&&""!=e.subTasks[n].assignedDepartment){var a=l.state.people.filter(function(t){return Object(h.g)(t.departmentsAndGroups).toLowerCase().includes(e.subTasks[n].assignedDepartment.toLowerCase())&&"2"==Object(h.g)(t.role)}),s="Task has been assigned to Your Department Click: "+window.location.origin+"/#"+t+"/"+e.building+"/tasks";a.length>0&&a.map(function(e){if(e&&Object(h.g)(e.email).length>0){var t=Object();t.subject="Task Assigned to your Department",t.to=Object(h.g)(e.email),t.text=s,Object(b.a)(t)}})}},l=this,c=0;c<e.subTasks.length;c++)if("object"===typeof(u=r(c)))return[2,u.value];Object(g.a)(!1),this.setState({task:e},function(){return R(d,void 0,void 0,function(){return x(this,function(t){switch(t.label){case 0:return this.sendSms(e),[4,this._saveRoutes()];case 1:return t.sent(),[4,this._saveTask(n)];case 2:return t.sent(),[4,this._saveObjectFormAction()];case 3:return t.sent(),[2]}})})})}return[2]}})})},t.prototype.handleImmediateTask=function(e){return R(this,void 0,void 0,function(){var t,n,a;return x(this,function(s){switch(s.label){case 0:return t=this.props,n=t.instance,a=t.buildingName,Object(g.a)(!0),[4,this.startImmediateTask(e)];case 1:return s.sent(),setTimeout(function(){Object(O.n)(),Object(g.a)(!1),window.location.hash=n+"/"+a+"/Tasks"},2e3),[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.buildingName,a=t.instance,u=this.state,p=u.task,f=u.showDetailForm,m=u.showSequenceForm,g=u.isEdit,b=u.isNotifyDate,w=u.isDateOnly,k=u.tasksDropdownList,T=u.taskType,O=u.routeSpaces,j=u._buildings,E=u.filteredPeople,D=JSON.parse(S.a.getItem("user")),C="1"==D.role||"2"==D.role,F=!!(p.subTasks&&p.subTasks.length>0)&&!1===p.subTasks.map(function(e){return""!==e.description&&""!==e.action&&void 0!==e.estimatedStartTime&&null!==e.estimatedStartTime&&""!==e.duration&&""!==e.workerDuration&&(""!==e.assignedDepartment||""!==e.assignedTo)}).find(function(e){return!1===e}),M=p.action&&p.building&&p.assignedTo&&p.assignedTo.length>0&&!F&&!0,_="daytime"==p.startTaskCondition?p.startTime&&(!b||p.notifyAt):"completionof"==p.startTaskCondition||"startof"==p.startTaskCondition?p.conditionalTasks&&p.conditionalTasks.length>0:p.action&&(!p.isRecurring||"days"!=p.recurringSchedule||p.recurDays&&null!=p.recurDays)&&!0;return s.createElement(N.a.Consumer,null,function(t){return s.createElement("div",{className:"content",id:"",style:{marginLeft:"10px",marginRight:"10px"}},s.createElement("div",{className:"card",style:{marginTop:"50px"}},s.createElement("div",{className:"container-fluid padding-10"},s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-8 no-padding"},s.createElement(i.a,{instance:a,buildingName:p.building?p.building:n,task:p,onTaskChange:e.handleTaskChange,isEdit:g,isManagerorAdmin:C,people:E,isFacilitatorText:m})),s.createElement("div",{className:"col-md-4 no-padding"},s.createElement("div",{className:"col-md-3"},s.createElement("label",{htmlFor:"building",title:y.a.task.Building}," Location: ")),s.createElement("div",{className:"col-md-9"},s.createElement("select",{className:"form-control",name:"building",disabled:!C,value:p.building,id:"building",onChange:function(t){e.handleBuildingChange(t.target.value)}},j&&j.map(function(e,t){return s.createElement("option",{key:t,value:Object(h.g)(e.building)},Object(h.g)(e.rdfsLabel)," ")})))),!f&&s.createElement("div",{className:"col-md-12 padding-10"},s.createElement("button",{className:"btn btn-primary btn-fill pull-right",onClick:function(){e.updateView(!0,!1)}}," ",s.createElement("i",{className:"fa fa-plus"})," More"))),f&&s.createElement("div",{className:""},s.createElement(o.a,{instance:a,buildingName:p.building?p.building:n,task:p,onTaskChange:e.handleTaskChange,isManagerorAdmin:C,onRouteChange:e.handleRoutesMatterport,routes:O,handleShowQrToggle:e.handleShowQrToggle,isEdit:g,showQRTaskToggle:e.state.showQRTaskToggle}),!m&&s.createElement("div",{className:"row col-md-12"},s.createElement("button",{className:"btn btn-primary btn-fill pull-right",onClick:function(){e.updateView(!0,!0).then(function(){var t=e.state.task;t.isQRTask=!1,(!g||g&&t.subTasks.length<1)&&(t.subTasks=[{duration:"",description:"",workerDuration:"",workerDurationUnit:"Hours",parentTask:t.task,assignedTo:"",entryTimeStamp:"",fileName:[],hasChat:!1,index:1,note:"",startTime:(new Date).toString(),relatedLink:[],status:"Pending",subTask:Object(l.p)(7),workOrder:"",workType:"",durationUnit:"Hours",acknowledged:!1,enteredBy:D.contact,enteredByName:"",oldFileName:[],archived:!1,criticality:t.criticality,isDeleted:!1,assignedDepartment:"",QRTag:t.QRTag?t.QRTag:"",isQRTask:!1,equipRdfsLabel:"",isStage:!1,isActivated:!0,estimatedStartTime:void 0,spaceRdfsLabel:"",equipSubject:[],spaceSubject:"",taskNumber:Object(l.n)(8).toString(),building:t.building?t.building:n}],e.setState({task:t}))})}},s.createElement("i",{className:"fa fa-plus"})," More"))),m&&s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-12"},s.createElement(r.a,{onDoneClicked:e.onDoneClicked,actions:e.state.actions,instance:a,buildingName:p.building?p.building:n,task:p,onTaskChange:e.handleTaskChange,isEdit:g,isManagerorAdmin:C,showQRToggle:e.state.showQRTaskToggle,people:E}))),s.createElement("div",{className:"row form-group col-md-12"},s.createElement("div",{className:"col-md-12"},C&&s.createElement(s.Fragment,null,s.createElement("button",{disabled:!M||!e.state.isChange,className:"btn "+("Do Now"==T?"btn-success":"btn-primary")+" btn-fill margin-5",onClick:function(){m?e.handleDoNow(!1):p.assignedTo&&1==p.assignedTo.length&&p.assignedTo[0]&&p.assignedTo[0].value==D.contact?e.handleImmediateTask(t.isClockedIn):e.handleDoNow(!1)}},s.createElement("i",{className:"fa fa-save"})," Do Now"),s.createElement("button",{disabled:!M||!e.state.isChange,className:"btn "+("Do Next"==T?"btn-success":"btn-primary")+" btn-fill margin-5",onClick:function(){return R(e,void 0,void 0,function(){return x(this,function(e){return this.handleDoNext(p,a),[2]})})}},s.createElement("i",{className:"fa fa-save"})," Do Next"),s.createElement("button",{disabled:!M||!e.state.isChange,className:"btn "+("Do If"==T?"btn-success":"btn-primary")+" btn-fill margin-5","data-toggle":"modal","data-target":"#DoIfDialog"},s.createElement("i",{className:"fa fa-save"})," Do If")),C&&g&&s.createElement("button",{className:"btn btn-primary btn-fill",onClick:function(){return R(e,void 0,void 0,function(){return x(this,function(e){switch(e.label){case 0:return[4,this._saveTask(!1)];case 1:return e.sent(),[4,this._saveObjectFormAction()];case 2:return e.sent(),[2]}})})}},s.createElement("i",{className:"fa fa-save"})," Save")),"Started"==p.status&&g&&s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-12"},s.createElement("label",null,"Task ID - ",p.taskNumber," ")))),s.createElement(c.a,{id:"DoIfDialog",heading:"Do If",disableSaveButton:!_,showSaveButton:!0,onSaveButtonClick:function(){if(p.subTasks.length>0)for(var t=0;t<p.subTasks.length;t++)p.subTasks[t].equipSubject=p.equipSubject,p.subTasks[t].spaceSubject=p.spaceSubject,p.subTasks[t].building=p.building,p.subTasks[t].criticality=p.criticality,p.subTasks[t].status="Pending",p.subTasks[0].startTaskCondition=p.startTaskCondition,p.subTasks[0].startTime=p.startTime,p.subTasks[0].conditionalTasks=p.conditionalTasks,p.subTasks[0].acknowledged=!1;if(p.acknowledged=!1,p.status="Pending",""==p.startTime){var n=(new Date).toString();e.handleDoAtChange(new Date(n))}if(!b){var a=new Date(p.startTime).getTime()-3e5;p.notifyAt=new Date(a).toString()}p.isForcePush&&(p.acknowledged=!0),e.setState({task:p},function(){return R(e,void 0,void 0,function(){var e=this;return x(this,function(t){switch(t.label){case 0:return[4,this._saveRoutes()];case 1:return t.sent(),setTimeout(function(){e._saveTask(!1)},1e3),[2]}})})})},isEditForm:!0,showCancelButton:!0,cancelButtonText:"Cancel",cancelButtonId:"btnCloseDoIfDialog"},s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-2"},s.createElement("div",{className:"form-group"},s.createElement("label",{htmlFor:"daytime"},"Start time: "))),s.createElement("div",{className:"col-md-4"},s.createElement("div",{className:"form-group"},s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"daytime",checked:"daytime"==p.startTaskCondition,onChange:function(t){e.handleDoIfStartRadio("daytime")}}),s.createElement("label",{htmlFor:"daytime"},"Day Time")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"compof",checked:"completionof"==p.startTaskCondition,onChange:function(){e.handleDoIfStartRadio("completionof")}}),s.createElement("label",{htmlFor:"compof"},"Upon Completion of")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"startof",checked:"startof"==p.startTaskCondition,onChange:function(){e.handleDoIfStartRadio("startof")}}),s.createElement("label",{htmlFor:"startof"},"Upon Start of")))),s.createElement("div",{className:"col-md-6"},"daytime"==p.startTaskCondition&&s.createElement("div",{className:"form-group"},s.createElement(d.a,{id:"startTime",className:"form-control",selected:p.startTime?new Date(p.startTime):void 0,onChange:function(t){return e.handleDoAtChange(t)},showTimeSelect:!w,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"MMMM d, yyyy h:mm aa",timeCaption:"time",customInput:s.createElement("input",{type:"text",className:(p.startTime?"":"addFieldValidate")+" form-control",placeholder:"Start Time","aria-label":"","aria-describedby":"button-addon4",value:p.startTime})})),("completionof"==p.startTaskCondition||"startof"==p.startTaskCondition)&&s.createElement(v.a,{className:p.conditionalTasks&&p.conditionalTasks.length>0?"":"addFieldValidate",isDisabled:!1,closeMenuOnSelect:!1,isMulti:!0,value:p.conditionalTasks,onChange:e.handleMultiTaskChange,placeholder:"Select Task(s)",options:k}))),"daytime"==p.startTaskCondition&&""!=p.startTime&&s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-2"},s.createElement("div",{className:"form-group"},s.createElement("label",{htmlFor:"5min"},"Notify At"))),s.createElement("div",{className:"col-md-4"},s.createElement("div",{className:"form-group"},s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"5min",checked:!b,onChange:function(){e.handleNotifyRadio(!1)}}),s.createElement("label",{htmlFor:"5min"},"5 min before")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"time",checked:b,onChange:function(){e.handleNotifyRadio(!0)}}),s.createElement("label",{htmlFor:"time"},"Set Date Time")))),s.createElement("div",{className:"col-md-6"},s.createElement("div",{className:"form-group"},b&&s.createElement(d.a,{id:"notifyTime",className:"form-control",selected:p.notifyAt?new Date(p.notifyAt):void 0,onChange:function(t){return e.handleNotifyDateChange(t)},showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"MMMM d, yyyy h:mm aa",maxDate:new Date(p.startTime),timeCaption:"time",customInput:s.createElement("input",{type:"text",className:(p.notifyAt?"":"addFieldValidate")+" form-control",placeholder:"Start Time","aria-label":"","aria-describedby":"button-addon4",value:p.notifyAt})})))),s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"form-group",style:{height:"40px",display:"flex"}},s.createElement("span",{className:"headingText",style:{padding:"0px 15px 0px 0px"}},"Place without Manager Review"),s.createElement("input",{style:{margin:"0"},type:"checkbox",checked:p.isForcePush,onChange:function(t){e.handleManagerReviewCheck(t.target.checked)}})))),"daytime"==p.startTaskCondition&&s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-2"},s.createElement("div",{className:"form-group",style:{height:"40px",display:"flex"}},s.createElement("span",{className:"headingText",style:{padding:"0px 15px 0px 0px"}},"Recurring Task"),s.createElement("input",{style:{margin:"0"},type:"checkbox",checked:p.isRecurring,onChange:function(t){e.handleRecurringCheck(t.target.checked)}}))),p.isRecurring&&s.createElement("div",{className:"col-md-8"},s.createElement("div",{className:"form-group"},s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"week",checked:"week"==p.recurringSchedule,onChange:function(){e.handleRecurringScheduleRadio("week")}}),s.createElement("label",{htmlFor:"week"},"Weekly")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"month",checked:"month"==p.recurringSchedule,onChange:function(){e.handleRecurringScheduleRadio("month")}}),s.createElement("label",{htmlFor:"month"},"Monthly")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"quarter",checked:"quarter"==p.recurringSchedule,onChange:function(){e.handleRecurringScheduleRadio("quarter")}}),s.createElement("label",{htmlFor:"quarter"},"Quarterly")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("input",{style:{margin:"5px 5px 5px 0"},type:"radio",id:"year",checked:"year"==p.recurringSchedule,onChange:function(){e.handleRecurringScheduleRadio("year")}}),s.createElement("label",{htmlFor:"year"},"Yearly")),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("div",{className:"col-md-2",style:{paddingLeft:"0"}},s.createElement("label",{htmlFor:"Every"},"Every")),s.createElement("div",{className:"col-md-4"},s.createElement("span",null,s.createElement("input",{type:"number",name:"recurring",value:p.recurDays,onChange:function(t){e.handleRecurringDays(t.target.value)}}))," "),s.createElement("div",{className:"col-md-1"},s.createElement("label",{htmlFor:"Days"},"Days"))),s.createElement("br",null),s.createElement("div",{style:{display:"flex"}},s.createElement("div",{className:"col-md-2",style:{paddingLeft:"0"}},s.createElement("label",{htmlFor:"endingdays"},"Ending in")),s.createElement("div",{className:"col-md-4"},s.createElement("span",null,s.createElement("input",{type:"number",name:"endingDaysCount",value:p.endingDaysCount,onChange:function(t){e.handleRecurringEndDays(t.target.value)}})," ")),s.createElement("div",{className:"col-md-1"},s.createElement("label",{htmlFor:"Days"}," Days "))))))))))})},t}(s.Component);t.default=M},1886:function(e,t,n){"use strict";var a=n(2),s=(n.n(a),n(662)),i=n(20),o=n(1177),r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),l=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}l((a=a.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},u=function(e){function t(t){var n=e.call(this,t)||this;return n.state={task:n.props.task},n.handleAssignTo=n.handleAssignTo.bind(n),n.handleTaskFormChange=n.handleTaskFormChange.bind(n),n}return r(t,e),t.prototype.componentDidMount=function(){return l(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},t.prototype.componentWillReceiveProps=function(e){this.setState({task:e.task})},t.prototype.handleAssignTo=function(e){var t=this.state.task;t.assignedTo=e,this.setState({task:t}),this.props.onTaskChange(t)},t.prototype.handleTaskFormChange=function(e){var t=this.state.task;t[""+e.target.name]=e.target.value,this.setState({task:t}),this.props.onTaskChange(t)},t.prototype.render=function(){var e=this,t=this.props,n=t.isManagerorAdmin,r=t.isFacilitatorText,l=t.people,c=this.state.task,u=l&&l.length>0?l.map(function(e){return{value:e.contact.value,label:e.name?e.name.value+" ("+i.e[e.role.value]+")":e.contact.value+" ("+e.qualifications.value+")"}}).filter(function(e){return e.value!=(c.assignedTo&&c.assignedTo.find(function(t){return t.value==e.value})?c.assignedTo.find(function(t){return t.value==e.value}).value:"")}):[];return a.createElement("div",{className:""},a.createElement("div",{className:"col-md-2"},a.createElement("label",{htmlFor:"action",title:o.a.task.Action}," Action: ")),a.createElement("div",{className:"col-md-4"},a.createElement("b",null," ",a.createElement("input",{type:"text",className:(c.action?"":"addFieldValidate")+" form-control",disabled:!n,id:"action",name:"action",value:c.action,onChange:function(t){e.handleTaskFormChange(t)}})," ")),a.createElement("div",{className:"col-md-2"},a.createElement("label",{htmlFor:"assignedTo",title:o.a.task.AssignedTo},r?"Facilitator":"Assigned "+(n?"To:":"By:"),"  ")),n&&a.createElement("div",{className:"col-md-4"},a.createElement("b",null," ",c.assignedTo&&c.assignedTo.length>0&&"NoOne"!=c.assignedTo[0].value?a.createElement(s.a,{id:"assignTo",isMulti:!0,closeMenuOnSelect:!1,value:c.assignedTo,onChange:this.handleAssignTo,placeholder:"Select Person(s)",options:u}):a.createElement(s.a,{id:"assignTo",isMulti:!0,closeMenuOnSelect:!1,value:[],onChange:this.handleAssignTo,placeholder:"Select Person(s)",className:"addFieldValidate",options:u}))),!n&&a.createElement("div",{className:"col-md-4"},a.createElement("b",null," ",a.createElement("input",{type:"text",className:"form-control",disabled:!0,id:"description",name:"description",value:c.enteredBy}))))},t}(a.Component);t.a=u},1887:function(e,t,n){"use strict";var a,s=n(2),i=(n.n(s),n(20)),o=n(672),r=n(696),l=n(658),c=n(983),u=n(10),d=n(662),p=n(988),h=n(716),f=n(1178),m=n(683),g=n(1177),b=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),v=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(s,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(o,r)}l((a=a.apply(e,t||[])).next())})},S=this&&this.__generator||function(e,t){var n,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}};a=a;var w=function(e){function t(t){var n=e.call(this,t)||this;return n.state={task:n.props.task,assets:[],floors:[],locations:[],bimSweeps:[],onSweepChangeableStatus:!1,floorDetails:Object(),refreshMatterportDialog:!1,routeSpaces:[],points:[]},a=n,n.fetchFloors=n.fetchFloors.bind(n),n._getFloorDetails=n._getFloorDetails.bind(n),n._getSweeps=n._getSweeps.bind(n),n._getAssets=n._getAssets.bind(n),n._getLocations=n._getLocations.bind(n),n._fetchPoints=n._fetchPoints.bind(n),n.handleRefreshMatterport=n.handleRefreshMatterport.bind(n),n.handleFloorChange=n.handleFloorChange.bind(n),n.handleTaskFormChange=n.handleTaskFormChange.bind(n),n.handleLocationChange=n.handleLocationChange.bind(n),n.handleMultiAssetChange=n.handleMultiAssetChange.bind(n),n.handleRoutesMatterport=n.handleRoutesMatterport.bind(n),n.updateSpace=n.updateSpace.bind(n),n.onSweepChangeable=n.onSweepChangeable.bind(n),n.handleQRtoggle=n.handleQRtoggle.bind(n),n}return b(t,e),t.prototype.componentDidMount=function(){return v(this,void 0,void 0,function(){var e,t,n;return S(this,function(a){return e=this.state.task,t=this.props,n=t.buildingName,t.instance&&n&&(this.fetchFloors(n),this._fetchPoints(),e.floor&&e.floor.length>0&&(this._getFloorDetails(),this._getLocations()),""!=e.spaceSubject&&(this._getAssets(),this._getSweeps(e.buildingName,e.spaceSubject))),[2]})})},t.prototype.componentWillReceiveProps=function(e){e.buildingName&&this.props.buildingName&&e.buildingName!=this.props.buildingName&&this.fetchFloors(e.buildingName),this.setState({task:e.task}),e.routes&&e.routes.length>0&&this.setState({routeSpaces:e.routes})},t.prototype.fetchFloors=function(e){return v(this,void 0,void 0,function(){var t;return S(this,function(n){switch(n.label){case 0:return[4,Object(o.f)(e)];case 1:return t=n.sent(),this.setState({floors:t,locations:[],assets:[]}),[2]}})})},t.prototype.onSweepChangeable=function(e){this.setState({onSweepChangeableStatus:!e})},t.prototype._fetchPoints=function(){return v(this,void 0,void 0,function(){var e=this;return S(this,function(t){switch(t.label){case 0:return[4,Object(m.i)("",null,null).then(function(t){t&&t.length>0&&e.setState({points:t})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype._getAssets=function(){return v(this,void 0,void 0,function(){var e,t,n;return S(this,function(a){switch(a.label){case 0:return e=this.state.task,[4,Object(r.f)(e.building,i.b.TASK,e.floor,[e.spaceSubject])];case 1:return t=a.sent(),n=t.map(function(e){return{value:Object(u.g)(e.ontology),label:Object(u.g)(e.rdfsLabel)}}),this.setState({assets:n}),[2]}})})},t.prototype._getLocations=function(){return v(this,void 0,void 0,function(){var e,t;return S(this,function(n){switch(n.label){case 0:return e=this.state.task,[4,Object(l.g)(e.floor,e.building,!0)];case 1:return t=n.sent(),this.setState({locations:t}),[2]}})})},t.prototype._getFloorDetails=function(){return v(this,void 0,void 0,function(){var e,t,a=this;return S(this,function(s){switch(s.label){case 0:return e=this.state.task,t=this.state.floorDetails,[4,Object(o.a)(e.building,e.floor).then(function(s){return v(a,void 0,void 0,function(){var a=this;return S(this,function(i){switch(i.label){case 0:return[4,Object(h.b)(e.building,e.floor).then(function(e){if(s&&s.length>0){var i=e&&e[0]?""+e[0].bimImageBase:n(753);t.linkBimism=Object(u.g)(s[0].linkBimism),t.xOffsetMap=Object(u.g)(s[0].xOffsetMap),t.yOffsetMap=Object(u.g)(s[0].yOffsetMap),t.xScaleMap=Object(u.g)(s[0].xScaleMap),t.yScaleMap=Object(u.g)(s[0].yScaleMap),t.bimFloor=Object(u.g)(s[0].bimFloor),t.bimSid=Object(u.g)(s[0].bimSid),t.floor=Object(u.g)(s[0].zone),t.rdfsLabel=Object(u.g)(s[0].rdfsLabel),t.imgFloorMap=i,a.setState({floorDetails:t,refreshMatterportDialog:!0})}})];case 1:return i.sent(),[2]}})})}).catch(function(e){return e})];case 1:return s.sent(),[2]}})})},t.prototype._getSweeps=function(e,t){return v(this,void 0,void 0,function(){var n,a=this;return S(this,function(s){switch(s.label){case 0:return n=[],[4,Object(h.c)(e,t).then(function(e){return v(a,void 0,void 0,function(){var t,a,s,i,o,r,l;return S(this,function(c){for(t=0;t<e.length;t++)a=e[t],(s=Object()).assignedSpace=Object(u.g)(a.assignedSpace),s.buildingName=Object(u.g)(a.buildingName),s.ontology=Object(u.g)(a.ontology),s.uuid=Object(u.g)(a.uuid),s.uuidIndex=parseInt(Object(u.g)(a.uuidIndex)),s.stepNo=parseInt(Object(u.g)(a.stepNo)),n.push(s);if((i=this.state.bimSweeps).length==n.length){for(o=0,r=0;r<i.length;r++)(l=i[r]).assignedSpace==n[r].assignedSpace&&l.buildingName==n[r].buildingName&&l.ontology==n[r].ontology&&l.stepNo==n[r].stepNo&&l.uuid==n[r].uuid&&l.uuidIndex==n[r].uuidIndex&&(o+=1);o!=i.length&&this.setState({bimSweeps:n,onSweepChangeableStatus:!0,refreshMatterportDialog:!0})}else this.setState({bimSweeps:n,onSweepChangeableStatus:!0,refreshMatterportDialog:!0});return[2]})})}).catch(function(e){return e})];case 1:return s.sent(),[2]}})})},t.prototype.handleRefreshMatterport=function(e){this.setState({refreshMatterportDialog:e})},t.prototype.handleRoutesMatterport=function(e){this.setState({routeSpaces:e}),this.props.onRouteChange(e)},t.prototype.handleFloorChange=function(e){return v(this,void 0,void 0,function(){var t,n=this;return S(this,function(a){return t=this.state.task,""!=e&&(t.floor=e,t.equipSubject=[],t.spaceSubject="",this.setState({task:t},function(){n._getFloorDetails(),n._getLocations()}),this.props.onTaskChange(t)),[2]})})},t.prototype.handleLocationChange=function(e){return v(this,void 0,void 0,function(){var t,n,a,s,i,o,r=this;return S(this,function(l){return t=this.state,n=t.task,a=t.points,s=!1,""!=e&&("newSpace"==e?document.getElementById("btnShowSpaceFormDialog").click():(n.spaceSubject=e,n.equipSubject=[],i=a.filter(function(e){return Object(u.g)(e.space)==n.spaceSubject}),o=i.map(function(e){return Object(u.g)(e.tag)}).join(","),i.length>0&&(s=!0,n.QRTag=o,n.subTasks.forEach(function(e){e.QRTag=o})),this._getSweeps(n.building,n.spaceSubject)),this.setState({refreshMatterportDialog:!0,task:n},function(){r._getAssets()}),this.props.onTaskChange(n),this.props.handleShowQrToggle(s)),[2]})})},t.prototype.handleTaskFormChange=function(e){var t=this.state.task;t[""+e.target.name]=e.target.value,this.setState({task:t}),this.props.onTaskChange(t)},t.prototype.handleMultiAssetChange=function(e){var t=this.state.task;t.equipSubject=e,this.setState({task:t}),this.props.onTaskChange(t)},t.prototype.updateSpace=function(e){return v(this,void 0,void 0,function(){return S(this,function(t){switch(t.label){case 0:return[4,this._getLocations()];case 1:return t.sent(),setTimeout(function(){var t=a.state.task;t.spaceSubject=e.name,t.floor=e.floor,t.equipSubject=[],a.setState({task:t},function(){a.handleFloorChange(e.floor)})},500),[2]}})})},t.prototype.handleQRtoggle=function(e){var t=this.state.task;t.isQRTask=e,this.setState({task:t}),this.props.onTaskChange(t)},t.prototype.render=function(){var e=this,t=this.props,n=t.isManagerorAdmin,a=t.instance,i=t.showQRTaskToggle,o=this.state,r=o.floors,l=o.assets,h=o.locations,m=o.task,b=o.bimSweeps,v=o.onSweepChangeableStatus,S=o.floorDetails,w=o.refreshMatterportDialog,k=o.routeSpaces,y=!!(b&&b.length>0),T=S.linkBimism?S.linkBimism:localStorage.getItem("BIMURL"),O={value:"",label:""},j=!0;if(m.spaceSubject){var E=m.spaceRdfsLabel?m.spaceRdfsLabel:h&&h.length>0&&h.find(function(e){return e.ontology.value==m.spaceSubject})?h.find(function(e){return e.ontology.value==m.spaceSubject}).rdfsLabel.value:"";O={value:m.spaceSubject,label:E},j=!!n}return s.createElement(s.Fragment,null,s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-2"},s.createElement("label",{htmlFor:"criticality",title:g.a.task.Criticality}," Concern: ")),s.createElement("div",{className:"col-md-5"},s.createElement("select",{className:"form-control",name:"criticality",disabled:!n,value:m.criticality,id:"criticality",onChange:function(t){e.handleTaskFormChange(t)}},c.c.map(function(e,t){return s.createElement("option",{key:t,value:e.id}," ",e.id," - ",e.name," ")})))),s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-4"},s.createElement("label",{htmlFor:"floor",title:g.a.task.Floor}," Floor "),s.createElement("select",{className:"form-control",id:"floor",name:"floor",disabled:!n,value:m.floor,onChange:function(t){e.handleFloorChange(t.target.value)}},s.createElement("option",{value:""},"Select Floor"),r.map(function(e,t){return s.createElement("option",{value:Object(u.g)(e.ontology),key:t},e.rdfsLabel.value," ")}))),s.createElement("div",{className:"col-md-4"},s.createElement("label",{htmlFor:"spaceSubject",title:g.a.task.Location}," Space "),s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-10 col-sm-10"},s.createElement("select",{className:"form-control",name:"spaceSubject",value:m.spaceSubject,disabled:!n,onChange:function(t){e.handleLocationChange(t.target.value)}},s.createElement("option",{value:""},"Select Space"),s.createElement("option",{value:"newSpace",className:"headingText"},"New Space "),s.createElement("hr",null),h.map(function(e,t){return s.createElement("option",{value:Object(u.g)(e.ontology),key:t},e.rdfsLabel.value," ")}))),y&&s.createElement("div",{className:"col-md-2 col-sm-2"},s.createElement("button",{type:"button",className:"btn btn-dark btn-fill btn-sm pull-right",onClick:function(){document.getElementById("btnVirtualBIM").click()},style:{border:"1px solid transparent",backgroundColor:"#A69888"}},s.createElement("img",{className:"icon-img",src:"assets/img/virtual-bim.png"})))),s.createElement(p.a,{updateSpace:this.updateSpace,closeDailogBtnID:"btnShowSpaceFormDialog",floor:m.floor,buildingName:m.building,instance:a})),s.createElement("div",{className:"col-md-4"},s.createElement("label",{htmlFor:"equipSubject",title:g.a.task.Asset}," Asset "),s.createElement(d.a,{isDisabled:!n,closeMenuOnSelect:!1,isMulti:!0,value:m.equipSubject,onChange:this.handleMultiAssetChange,placeholder:"Select Asset(s)",options:l}))),i&&m.subTasks.length<1&&s.createElement("div",{className:"row padding-10"},s.createElement("div",{className:"col-md-3"},s.createElement("label",{htmlFor:"allowAutoSMS"},"QR Task:")),s.createElement("div",{className:"col-md-1"},s.createElement("div",{className:"switch-container"},s.createElement("label",null,s.createElement("input",{id:"qrTask",name:"qrTask",checked:m.isQRTask,onChange:function(t){e.handleQRtoggle(t.target.checked)},className:"switch",type:"checkbox"}),s.createElement("div",null,s.createElement("div",null)))))),s.createElement("button",{type:"button",id:"btnVirtualBIM",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#virtualBIMDialog"}," ."),s.createElement(f.a,{id:"virtualBIMDialog",heading:"Virtual BIM Routes",bimURL:T,isViewForm:!0,isSweepChangeable:v,sweeps:b,isTaskForm:j,isTaskView:!0,onSweepChangeable:this.onSweepChangeable,isRefreshDialog:w,buildingName:this.props.buildingName,onRefreshMatterport:this.handleRefreshMatterport,locationDropdownList:h,routes:k,showSaveButton:j,selectedSpace:O,onSaveRouteClickButton:this.handleRoutesMatterport,floor:S,space:m.spaceSubject}))},t}(s.Component);t.a=w}});