webpackJsonp([11],{2965:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=(a.n(n),a(127)),r=a(1291),s=a(11),l=a(707),o=a(2966),u=a(20),c=a(2967),m=a(2968),p=a(2969),h=a(2970),g=a(2971),d=a(2972),f=a(2973),v=a(2974),x=a(2975),y=a(2976),b=a(1680),A=(a.n(b),a(744)),E=a(2977),D=a(725),S=a(13),w=a(124),O=a(8),_=a(749),N=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),P=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},V=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},j=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<a;t++)for(var r=arguments[t],s=0,l=r.length;s<l;s++,i++)n[i]=r[s];return n},L=function(e){function t(t){var a=e.call(this,t)||this,n=new Date(new Date(Date.now()).setMinutes(new Date(Date.now()).getMinutes()-30)),i=new Date(Date.now());return a.state={from:n,to:i,dashboardURL:"",insights:[],templatesList:[],selectedTemplate:"",loadingDevices:!0,liveGraphRange:30,filteredInsights:[],showInsights:[],selectedTemplateGraphs:{},showAlarmPoints:!1,enableYAxis:!1,insightsLoaded:0,verifyList:[],insightPoints:[],assets:[],isEquipment:!1,filteredAssets:[],showAssets:[],graphsLoaded:[]},a.isGraphLoaded=a.isGraphLoaded.bind(a),a}return N(t,e),t.prototype.componentDidMount=function(){return P(this,void 0,void 0,function(){var e;return V(this,function(t){switch(t.label){case 0:return e=JSON.parse(O.a.getItem("user")),[4,Promise.all([Object(w.b)(e.contact),this._fetchInsights(),this._fetchEquipment()])];case 1:return t.sent(),[2]}})})},t.prototype.moreInsights=function(){var e=this.state,t=e.showInsights,a=e.filteredInsights,n=e.isEquipment,i=e.filteredAssets,r=e.showAssets;if(n){var s=i.slice(r.length-1,r.length+4),l=j(r,s);this.setState({showAssets:l},function(){window.dispatchEvent(new Event("reLoadGraph"))})}else{s=a.slice(t.length-1,t.length+4),l=j(t,s);this.setState({showInsights:l},function(){window.dispatchEvent(new Event("reLoadGraph"))})}},t.prototype.loadNextInsight=function(){var e=this.state,t=e.showInsights,a=e.insightsLoaded,n=e.isEquipment,i=e.showAssets;n?a<i.length&&this.setState({insightsLoaded:a+1}):a<t.length&&this.setState({insightsLoaded:a+1})},t.prototype._fetchInsights=function(){return P(this,void 0,void 0,function(){var e,t,a,n,i,o,u=this;return V(this,function(c){switch(c.label){case 0:return e=this.props.buildingName,t=[],a=[],[4,Object(A.o)(e)];case 1:return n=(n=c.sent()).filter(function(e){return"Measure"==e.verifyType}),e?[4,Object(l.w)(e)]:[3,6];case 2:return(i=(i=c.sent()).filter(function(e){var t,a,n,i,r,l,o;return-1!=(null===(t=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===t?void 0:t.toLowerCase().indexOf("thermostat"))||-1!=(null===(a=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===a?void 0:a.toLowerCase().indexOf("ceiling"))||-1!=(null===(n=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===n?void 0:n.toLowerCase().indexOf("intesis"))||-1!=(null===(i=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("ats"))||-1!=(null===(r=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("generator"))||"CBW406"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)||"CBW418"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)||-1!=(null===(l=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===l?void 0:l.toLowerCase().indexOf("relayv4"))||-1!=(null===(o=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===o?void 0:o.toLowerCase().indexOf("relayi1"))||"WattNode"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype)}))&&i.length?(o=i.map(function(e){return Object(s.g)(e.moncondevice)}),[4,Object(D.k)(e,"Sensed",o)]):[3,4];case 3:a=c.sent(),c.label=4;case 4:return[4,Object(r.b)(e).then(function(e){if(e&&e.length>0)e.map(function(e){t.push({ontology:Object(s.g)(e.ontology),label:Object(s.g)(e.label),deviceGraphs:Object(s.g)(e.deviceGraphs)})}),u.setState({insightPoints:a,templatesList:t,insights:i,selectedTemplate:(t.length-1).toString(),filteredInsights:[],showInsights:[]},function(){var e=JSON.parse(t[t.length-1].deviceGraphs),a=Object.keys(e),r=null===i||void 0===i?void 0:i.filter(function(e){return a.indexOf(Object(s.g)(e.moncondevice))>-1}),l=r.slice(0,10);u.setState({filteredInsights:r,showInsights:l,selectedTemplateGraphs:e,verifyList:n,loadingDevices:!1})});else{var r=null===i||void 0===i?void 0:i.filter(function(e){return e.moncondevice}),l=r.slice(0,10);u.setState({insightPoints:a,insights:i,filteredInsights:r,showInsights:l,verifyList:n,loadingDevices:!1})}})];case 5:c.sent(),c.label=6;case 6:return[2]}})})},t.prototype._fetchEquipment=function(){return P(this,void 0,void 0,function(){var e;return V(this,function(t){switch(t.label){case 0:return[4,Object(_.g)(this.props.buildingName,S.b.POINT)];case 1:return e=t.sent(),this.setState({assets:e}),[2]}})})},t.prototype.changeAlarmStatus=function(){this.setState({showAlarmPoints:!this.state.showAlarmPoints}),window.dispatchEvent(new Event("ShowAlarms"))},t.prototype.changeYAxisStatus=function(){this.setState({enableYAxis:!this.state.enableYAxis})},t.prototype.liveGraphRangeChange=function(e){var t=this,a=new Date,n=new Date;n.setMinutes(n.getMinutes()-+e),this.setState({from:n,to:a,liveGraphRange:+e,loadingDevices:!0,insightsLoaded:0},function(){t.setState({loadingDevices:!1})})},t.prototype.selectTemplate=function(e){var t=this,a=this.state,n=a.templatesList,i=a.insights,r=a.verifyList,l=a.assets;if(isNaN(+e))if("default"==e){var o=i,u=o.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1},function(){t.setState({selectedTemplate:e,filteredInsights:o,showInsights:u,loadingDevices:!1})})}else if("equipmentGraphs"==e){var c=l,m=c.slice(0,10);this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!0},function(){t.setState({selectedTemplate:e,filteredAssets:c,showAssets:m,loadingDevices:!1})})}else{if(!r.find(function(t){return t._id==e}))return;this.setState({loadingDevices:!0,showAlarmPoints:!1,insightsLoaded:0,isEquipment:!1},function(){t.setState({loadingDevices:!1,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],liveGraphRange:1})})}else this.setState({loadingDevices:!0,showAlarmPoints:!1,selectedTemplate:e,filteredInsights:[],showInsights:[],insightsLoaded:0,isEquipment:!1},function(){var a=JSON.parse(n[+e].deviceGraphs),r=Object.keys(a),l=i.filter(function(e){return r.indexOf(Object(s.g)(e.moncondevice))>-1}),o=l.slice(0,10);t.setState({showInsights:o,filteredInsights:l,loadingDevices:!1,selectedTemplateGraphs:a})})},t.prototype.isGraphLoaded=function(e){},t.prototype.render=function(){var e,t=this,a=this.state,r=a.verifyList,l=a.from,b=a.to,A=a.showInsights,D=a.filteredInsights,S=a.templatesList,w=a.selectedTemplate,O=a.loadingDevices,_=a.liveGraphRange,N=a.selectedTemplateGraphs,P=a.showAlarmPoints,V=a.insightsLoaded,j=a.insightPoints,L=a.isEquipment,k=a.filteredAssets,R=a.showAssets,F=a.insights,M=a.enableYAxis,q=this.props,C=q.buildingName,G=q.instance;return n.createElement("div",{className:"dashboard"},n.createElement("div",{className:"dashboard-header sticky"},!O&&n.createElement("div",{className:"col-md-4 float-left"},n.createElement("div",{className:"col-md-8 no-padding"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.selectTemplate(e.target.value)},value:w,placeholder:"Select Template"},0==S.length&&n.createElement("option",{value:""},"Select Template"),n.createElement("option",{value:"default"},"All Graphs"),n.createElement("option",{value:"equipmentGraphs"},"Equipment Graphs"),(null===S||void 0===S?void 0:S.length)>0&&S.map(function(e,t){return n.createElement("option",{value:t,key:t},e.label)}),(null===r||void 0===r?void 0:r.length)>0&&r.map(function(e,t){return n.createElement("option",{value:e._id,key:t},e.projectName)}))),n.createElement(i.b,{target:"_blank",to:"/"+G+"/"+C+"/Dashboard/Templates",className:"btn btn-fill btn-secondary btn-secondary-dark margin-left-20 btn-fix-height"},"Create Template")),n.createElement("h3",{className:"dashboard-title"},Object(u.A)(C)),!O&&n.createElement("div",{className:"col-md-4 float-right margin-top-10"},n.createElement("div",{className:"col-md-3 padding-5 mr-5"},(L&&V==R.length||!L&&V===A.length)&&!r.find(function(e){return e._id==w})&&n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-7"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Show Alarm:")),n.createElement("div",{className:"col-md-5 no-padding"},n.createElement("label",null,n.createElement("input",{name:"showError",onChange:function(e){t.changeAlarmStatus()},className:"switchDashboard",type:"checkbox",checked:P}),n.createElement("div",null,n.createElement("div",null)))))),n.createElement("div",{className:"col-md-4 padding-5 mr-5"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-7 text-align-end"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"Y axis:")),n.createElement("div",{className:"col-md-5 no-padding"},n.createElement("label",null,n.createElement("input",{onChange:function(e){t.changeYAxisStatus()},className:"switchDashboard",type:"checkbox",checked:M}),n.createElement("div",null,n.createElement("div",null)))))),n.createElement("div",{className:"col-md-5 padding-5"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-4 no-padding text-align-end"},n.createElement("label",{style:{color:"#fff",cursor:"default"}},"X axis:")),n.createElement("div",{className:"col-md-8"},n.createElement("select",{className:"form-control",id:"pointState",name:"pointState",onChange:function(e){t.liveGraphRangeChange(e.target.value)},value:_},r.find(function(e){return e._id==w})?n.createElement(n.Fragment,null,n.createElement("option",{value:1},"1 Month"),n.createElement("option",{value:2},"2 Months"),n.createElement("option",{value:3},"3 Months"),n.createElement("option",{value:4},"4 Months"),n.createElement("option",{value:5},"5 Months"),n.createElement("option",{value:6},"6 Months")):n.createElement(n.Fragment,null,n.createElement("option",{value:5},"5 Mins"),n.createElement("option",{value:15},"15 Mins"),n.createElement("option",{value:30},"30 Mins"),n.createElement("option",{value:60},"1 Hour"),n.createElement("option",{value:180},"3 Hours"),n.createElement("option",{value:360},"6 Hours"),n.createElement("option",{value:720},"12 Hours"),n.createElement("option",{value:1440},"24 Hours")))))))),O||""!=w||0!=S.length?O?n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"})):r.find(function(e){return e._id==w})?n.createElement("div",{className:""},n.createElement(E.a,{instance:G,buildingName:C,from:l,to:b,projectName:w,measureAnalysis:r.find(function(e){return e._id==w}).measureAnalysis})):L?n.createElement(c.a,{dataLength:R.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:R.length<k.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},R.map(function(e){var a=F.filter(function(t){return Object(s.g)(t.equipmentsRdfsLabel)&&Object(s.g)(t.equipmentsRdfsLabel).indexOf(Object(s.g)(e.ontology))>-1});return a&&a.length?a&&a.length&&a.map(function(a){for(var i,r,u,c,A,E,D,S=-1!=(null===(i=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("thermostat")),w=-1!=(null===(r=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("ceiling")),O=-1!=(null===(u=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),V=-1!=(null===(c=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),L=-1!=(null===(A=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===A?void 0:A.toLowerCase().indexOf("generator")),k="CBW406"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),R="CBW418"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),F=-1!=(null===(E=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("relayv4")),q=-1!=(null===(D=Object(s.g)(null===a||void 0===a?void 0:a.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayi1")),K="WattNode"==Object(s.g)(null===a||void 0===a?void 0:a.moncontype),H={ontology:Object(s.g)(e.ontology),rdfsLabel:Object(s.g)(e.rdfsLabel)},T=Object(s.g)(a.equipmentsRdfsLabel).split(","),Y=Object(s.g)(a.relatedEquipmentsLabel).split(","),B=[],U=0;U<T.length;U++){var W=T[U],I=Y&&Y[U]?Y[U]:"";B.push({ontology:W,rdfsLabel:I})}var z=null===j||void 0===j?void 0:j.filter(function(e){return Object(s.g)(e.monconDevice)==Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)||Object(s.g)(e.sinkSourceAsset)==Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)});return n.createElement(n.Fragment,null,S&&n.createElement(o.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),w&&n.createElement(p.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),O&&n.createElement(h.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,space:Object(s.g)(a.spaceRdfsLabel),zone:Object(s.g)(a.zoneRdfsLabel),floor:Object(s.g)(a.floorRdfsLabel),equipment:B,loadNextInsight:function(){return t.loadNextInsight()},device:a}),V&&n.createElement(g.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),L&&n.createElement(d.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),k&&n.createElement(f.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),R&&n.createElement(v.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),F&&n.createElement(x.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),q&&n.createElement(m.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}),K&&n.createElement(y.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]?N[Object(s.g)(null===a||void 0===a?void 0:a.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:B,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:z,device:a,isEquipment:!0,equipment:H,enableYAxis:M}))}):n.createElement(n.Fragment,null)}),0==(null===R||void 0===R?void 0:R.length)&&n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Graphs "))):n.createElement(c.a,{dataLength:A.length,className:"graph-boxes",next:function(){return t.moreInsights()},hasMore:A.length<D.length,loader:n.createElement("div",{className:"graph-box-loader full-screen"},n.createElement("div",{className:"center-object loader"}))},null===(e=null===A||void 0===A?void 0:A.slice(0,V+1))||void 0===e?void 0:e.map(function(e,a){for(var i,r,u,c,A,E,D,S=-1!=(null===(i=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===i?void 0:i.toLowerCase().indexOf("thermostat")),w=-1!=(null===(r=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===r?void 0:r.toLowerCase().indexOf("ceiling")),O=-1!=(null===(u=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===u?void 0:u.toLowerCase().indexOf("intesis")),V=-1!=(null===(c=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===c?void 0:c.toLowerCase().indexOf("ats")),L=-1!=(null===(A=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===A?void 0:A.toLowerCase().indexOf("generator")),k="CBW406"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),R="CBW418"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),F=-1!=(null===(E=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===E?void 0:E.toLowerCase().indexOf("relayv4")),q=-1!=(null===(D=Object(s.g)(null===e||void 0===e?void 0:e.moncontype))||void 0===D?void 0:D.toLowerCase().indexOf("relayi1")),K="WattNode"==Object(s.g)(null===e||void 0===e?void 0:e.moncontype),H=Object(s.g)(e.equipmentsRdfsLabel).split(","),T=Object(s.g)(e.relatedEquipmentsLabel).split(","),Y=[],B=0;B<H.length;B++){var U=H[B],W=T&&T[B]?T[B]:"";Y.push({ontology:U,rdfsLabel:W})}var I=null===j||void 0===j?void 0:j.filter(function(t){return Object(s.g)(t.monconDevice)==Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)||Object(s.g)(t.sinkSourceAsset)==Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)}),z=["Refrigerator 1","Refrigerator 2"];return R&&Object(s.g)(e.applicationLabel)&&Object(s.g)(e.applicationLabel).indexOf("3")>-1&&(z=["Refrigerator 3","Refrigerator 4"]),n.createElement(n.Fragment,null,S&&n.createElement(o.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),w&&n.createElement(p.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Temp & Humidity","Pressure","Illuminance","Air Particles","Gas Resistance","Other Parameters"],insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,isEquipment:!1,equipment:Object(),enableYAxis:M}),O&&n.createElement(h.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,space:Object(s.g)(e.spaceRdfsLabel),zone:Object(s.g)(e.zoneRdfsLabel),floor:Object(s.g)(e.floorRdfsLabel),equipment:Y,loadNextInsight:function(){return t.loadNextInsight()},device:e}),V&&n.createElement(g.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),L&&n.createElement(d.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Voltages","Currents","Powers","Power Factor","Other Parameters","Binary Parameters"],insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),k&&n.createElement(f.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Refrigerator 1","Refrigerator 2","Refrigerator 3","Refrigerator 4"],insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),R&&n.createElement(v.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:z,insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),F&&n.createElement(x.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),q&&n.createElement(m.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Totalized Energy","Frequency and Voltage","Current and Power","State and Power Factor"],insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}),K&&n.createElement(y.a,{buildingName:C,instance:G,from:l,to:b,liveGraphRange:_,graphsList:N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]?N[Object(s.g)(null===e||void 0===e?void 0:e.moncondevice)]:["Power","Phase Voltage","Voltage","Frequency","Energy Sum Resettable","Positive Energy Sum Non-resettable"],insightRelEquipment:Y,showAlarmPoints:P,loadNextInsight:function(){return t.loadNextInsight()},devicePoints:I,device:e,enableYAxis:M}))}),0==(null===A||void 0===A?void 0:A.length)&&n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Graphs "))):n.createElement("div",{className:"full-screen"},n.createElement("h1",{className:"no-graph-heading"}," No Template Created ")))},t}(n.Component);t.default=L},2966:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(11),l=a(707),o=a(803),u=a(20),c=a(837),m=a(796),p=a(122),h=a(736),g=a(124),d=a(760),f=(a.n(d),a(857)),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(s.g)(e)&&Object(g.g)(Object(s.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,l,o,u,c,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,l=a.device,Object(p.a)(!0),r&&!e?[3,2]:(o=[],i&&i.length&&i.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(h.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(c=t[0].graphData.columns,g=new Date(c[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(p.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,u=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=c.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this.state,a=t.graphData,n=t.grid,i=new Date;e["@timestamp"]&&(i=new Date(e["@timestamp"]),i=new Date(i.setHours(i.getHours()+10)));var r=this.props.liveGraphRange;if(a&&a.length&&i){for(var s=0;s<a.length;s++){var l=a[s];if(l.graphData.columns&&l.graphData.columns.length){if(l.graphData.columns[0].push(i),e&&Object.keys(e).length)for(var o=Object.keys(e),c=function(t){var a=o[t],n=1;l.sensedKeys&&l.sensedKeys.length&&l.sensedKeys.find(function(e){return e==a})&&(1!=(null===e||void 0===e?void 0:e.tempunits)||"cooltemp"!=a&&"heattemp"!=a&&"spacetemp"!=a?l.graphData.columns[n].push(e[a]):l.graphData.columns[n].push(Object(u.a)(e[a]).toFixed(1)),n++,l.graphData.columns[n].splice(1,1))},m=0;m<o.length;m++)c(m);(i.getTime()-l.graphData.columns[0][2].getTime())/6e4>r&&l.graphData.columns[0].splice(1,1),l.axis.x.tick.values[2]&&l.axis.x.tick.values[1].getTime()&&l.axis.x.tick.values[2].getTime()-l.axis.x.tick.values[1].getTime()<i.getTime()-l.axis.x.tick.values[l.axis.x.tick.values.length-1]&&(l.axis.x.tick.values.splice(0,1),n.x.lines.splice(0,1),i.setSeconds(0),r>10&&i.setMinutes(i.getMinutes()-i.getMinutes()%5),l.axis.x.tick.values.push(i),n.x.lines.push({value:i,class:"grid4"}))}}var p=null===i||void 0===i?void 0:i.toLocaleString();this.setState({grid:n,graphData:a,lastUpdatedAt:p})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,l,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(s.g)(i.moncontype),(l=f.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&l.value&&(n.axis.y.tick.values=l.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,l,c,m,p,h,g,d,f,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,l=i.buildingName,c=i.device,m=i.isEquipment,p=i.equipment,h=this.state.graphYAxisSettings,g="",d="",f="",m?(f="equipment",g=p.ontology,d=p.rdfsLabel):(f="device",g=Object(s.g)(c.moncondevice),d=Object(s.g)(c.rdfsLabel)),v=h.find(function(t){return t.graphName==e}),x=Object(u.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:l,ontology:x,assetOntology:g,ontologyLabel:d,ontologyAssetType:f,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,l;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(s.g)(i.moncondevice),[4,Object(o.a)(t,r)];case 1:return l=u.sent(),this.setState({graphYAxisSettings:l}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(s.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(s.g)(r.relatedEquipment)})||i.push({value:Object(s.g)(r.relatedEquipment),label:Object(s.g)(r.relatedEquipmentLabel),space:Object(s.g)(r.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)r(l);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,c,m,p,h,d,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.from,a=e.to,n=e.device,i=e.showAlarmPoints,r=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,h=p.grid,d=p.graphData,v=p.lastUpdatedAt,x=p.graphYAxisSettings,y=[],c&&(y=r.filter(function(e){return Object(s.g)(e.relatedEquipment)==m.ontology})),n&&n.moncondevice?(A=Object(s.g)(n.moncontype),E=Object(s.g)(n.topic),D=f.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!c||c&&y.length?[4,Object(l.I)(E,t,a,!1)]:[3,2]):[3,3];case 1:S=b.sent(),b.label=2;case 2:if(O=["x"],(w={cooltemp:["Cool setpoint"],heattemp:["Heat setpoint"],spacetemp:["Space Temp"],fan:["Fan 0: Auto 1: On"],fanstate:["Fan State 1: On"],mode:["Mode 0: Heat 1: Cool 2: Auto"],state:["State 1: Heat 2: Cool"]}).cooltemp.push(null),w.heattemp.push(null),w.spacetemp.push(null),w.fan.push(null),w.fanstate.push(null),w.mode.push(null),w.state.push(null),O.push(new Date(t)),S.length>0&&(null===S||void 0===S||S.forEach(function(e){(null===e||void 0===e?void 0:e.cooltemp)&&(1==e.tempunits?(w.cooltemp.push(Object(u.a)(e.cooltemp).toFixed(1)),w.heattemp.push(Object(u.a)(e.heattemp).toFixed(1)),w.spacetemp.push(Object(u.a)(e.spacetemp).toFixed(1))):(w.cooltemp.push(e.cooltemp),w.heattemp.push(e.heattemp),w.spacetemp.push(e.spacetemp)),w.fan.push(e.fan),w.fanstate.push(e.fanstate),w.mode.push(e.mode),w.state.push(e.state),O.push(new Date(e.timestamp)))})),v=S.length>0?null===(q=O[O.length-1])||void 0===q?void 0:q.toLocaleString():"No Data",O.length>1){if(_=Object(o.c)(5,t,a),N="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,N=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",h.x.lines=[],_.forEach(function(e){h.x.lines.push({value:e,class:"grid4"})}),c){for((V=JSON.parse(JSON.stringify(f.a))).name="Thermostat",V.graphData.columns=[O],V.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},V.axis.x.tick.format=N,V.axis.x.tick.values=_,V.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},V.axis.y.label="State, Mode, Fan, Fan State",V.axis.y.tick.values=[0,1,2,3],V.axis.y.tick.max=3,V.axis.y.tick.min=0,V.graphData.x="x",M=0;M<y.length;M++)j=y[M],L=Object(s.g)(j.sensedValue),V.sensedKeys.push(L),V.graphData.columns.push(w[""+L]);D.find(function(e){return e.name==V.name})&&(V.axis.y.tick.values=D.find(function(e){return e.name==V.name}).value,V.axis.y.min=V.axis.y.tick.values[0],V.axis.y.max=V.axis.y.tick.values[V.axis.y.tick.values.length-1]),x&&x.length&&(k=x.find(function(e){return e.graphName==V.name}))&&k.yAxisSettings&&("Fixed"==k.yAxisSettings?(delete V.axis.y.tick.values,V.axis.y.min=k.yAxisMin,V.axis.y.max=k.yAxisMax):"Floating"==k.yAxisSettings&&(delete V.axis.y.tick.values,delete V.axis.y.max,delete V.axis.y.min),V.yAxisSettings=k.yAxisSettings,V.yAxisFixedValues={max:k.yAxisMax,min:k.yAxisMin}),V.graphEquipment=this.fetchEquipmentFromPoints(V.name,V.sensedKeys),d.push(V)}else for(R=function(e){var t,a="Thermostat",n=JSON.parse(JSON.stringify(f.a));if(n.name=a,n.sensedKeys=["cooltemp","heattemp","spacetemp","fan","fanstate","mode","state"],t=[O,w.cooltemp,w.heattemp,w.spacetemp,w.fan,w.fanstate,w.mode,w.state],n.axis={x:{type:"timeseries",tick:{fit:!1,count:5,values:_,format:N}},y:{label:{text:"Temperature \xb0F",position:"outer-middle"},tick:{fit:!0,values:[0,20,40,60,80,100],count:6,format:function(e){return parseFloat(e).toFixed(1)}},max:100,min:0},y2:{show:!0,label:{text:"State, Mode, Fan, Fan State",position:"outer-middle"},tick:{fit:!0,values:[0,1,2,3],count:6,format:function(e){return parseFloat(e).toFixed(0)}},max:3,min:0}},D.find(function(e){return e.name==a})&&(n.axis.y.tick.values=D.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),x&&x.length){var i=x.find(function(e){return e.graphName==a});i&&i.yAxisSettings&&("Fixed"==i.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=i.yAxisMin,n.axis.y.max=i.yAxisMax):"Floating"==i.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=i.yAxisSettings,n.yAxisFixedValues={max:i.yAxisMax,min:i.yAxisMin})}n.graphData.x="x",n.graphData.columns=t,n.graphData.axes={"Fan 0: Auto 1: On":"y2","Fan State 1: On":"y2","Mode 0: Heat 1: Cool 2: Auto":"y2",state:"y2"},n.graphData.colors={"Cool setpoint":"yellow","Heat setpoint":"green","Space Temp":"blue","Fan 0: Auto 1: On":"pink","Fan State 1: On":"yellow","Mode 0: Heat 1: Cool 2: Auto":"magenta","State 1: Heat 2: Cool":"#06cfa4"},n.graphData.types={"Cool setpoint":"line","Heat setpoint":"line","Space Temp":"line","Fan 0: Auto 1: On":"step","Fan State 1: On":"step","Mode 0: Heat 1: Cool 2: Auto":"step","State 1: Heat 2: Cool":"step"},n.graphEquipment=F.fetchEquipmentFromPoints(a,n.sensedKeys),d.push(n)},F=this,M=0;M<1;M++)R(M);this.props.loadNextInsight(),Object(g.h)(E,this.callLiveUpdate),this.setState({grid:h,graphData:d,lastUpdatedAt:v,loading:!1},function(){i&&C.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.insightRelEquipment,d=c.showAlarmPoints;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c="";return d&&t.alarmStatus&&("active"==t.alarmStatus?c="alarm-graph":"ack"==t.alarmStatus?c="alarm-ack-graph":"clear"==t.alarmStatus&&(c="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+c,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/InsightControl/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2967:function(e,t,a){"use strict";var n=a(2),i=a.n(n),r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};var s=function(){return(s=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var l={Pixel:"Pixel",Percent:"Percent"},o={unit:l.Percent,value:.8};function u(e){return"number"===typeof e?{unit:l.Percent,value:100*e}:"string"===typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:l.Pixel,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:l.Percent,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),o):(console.warn("scrollThreshold should be string or number"),o)}var c=function(e){function t(t){var a=e.call(this,t)||this;return a.lastScrollTop=0,a.actionTriggered=!1,a.startY=0,a.currentY=0,a.dragging=!1,a.maxPullDownDistance=0,a.getScrollableTarget=function(){return a.props.scrollableTarget instanceof HTMLElement?a.props.scrollableTarget:"string"===typeof a.props.scrollableTarget?document.getElementById(a.props.scrollableTarget):(null===a.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},a.onStart=function(e){a.lastScrollTop||(a.dragging=!0,e instanceof MouseEvent?a.startY=e.pageY:e instanceof TouchEvent&&(a.startY=e.touches[0].pageY),a.currentY=a.startY,a._infScroll&&(a._infScroll.style.willChange="transform",a._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},a.onMove=function(e){a.dragging&&(e instanceof MouseEvent?a.currentY=e.pageY:e instanceof TouchEvent&&(a.currentY=e.touches[0].pageY),a.currentY<a.startY||(a.currentY-a.startY>=Number(a.props.pullDownToRefreshThreshold)&&a.setState({pullToRefreshThresholdBreached:!0}),a.currentY-a.startY>1.5*a.maxPullDownDistance||a._infScroll&&(a._infScroll.style.overflow="visible",a._infScroll.style.transform="translate3d(0px, "+(a.currentY-a.startY)+"px, 0px)")))},a.onEnd=function(){a.startY=0,a.currentY=0,a.dragging=!1,a.state.pullToRefreshThresholdBreached&&(a.props.refreshFunction&&a.props.refreshFunction(),a.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){a._infScroll&&(a._infScroll.style.overflow="auto",a._infScroll.style.transform="none",a._infScroll.style.willChange="unset")})},a.onScrollListener=function(e){"function"===typeof a.props.onScroll&&setTimeout(function(){return a.props.onScroll&&a.props.onScroll(e)},0);var t=a.props.height||a._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;a.actionTriggered||((a.props.inverse?a.isElementAtTop(t,a.props.scrollThreshold):a.isElementAtBottom(t,a.props.scrollThreshold))&&a.props.hasMore&&(a.actionTriggered=!0,a.setState({showLoader:!0}),a.props.next&&a.props.next()),a.lastScrollTop=t.scrollTop)},a.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},a.throttledOnScrollListener=function(e,t,a,n){var i,r=!1,s=0;function l(){i&&clearTimeout(i)}function o(){var o=this,u=Date.now()-s,c=arguments;function m(){s=Date.now(),a.apply(o,c)}r||(n&&!i&&m(),l(),void 0===n&&u>e?m():!0!==t&&(i=setTimeout(n?function(){i=void 0}:m,void 0===n?e-u:e)))}return"boolean"!==typeof t&&(n=a,a=t,t=void 0),o.cancel=function(){l(),r=!0},o}(150,a.onScrollListener).bind(a),a.onStart=a.onStart.bind(a),a.onMove=a.onMove.bind(a),a.onEnd=a.onEnd.bind(a),a}return function(e,t){function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}(t,e),t.prototype.componentDidMount=function(){if("undefined"===typeof this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"===typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!==typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.componentDidUpdate=function(e){this.props.dataLength!==e.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},t.getDerivedStateFromProps=function(e,t){return e.dataLength!==t.prevDataLength?s(s({},t),{prevDataLength:e.dataLength}):null},t.prototype.isElementAtTop=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===l.Pixel?e.scrollTop<=n.value+a-e.scrollHeight+1:e.scrollTop<=n.value/100+a-e.scrollHeight+1},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var a=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,n=u(t);return n.unit===l.Pixel?e.scrollTop+a>=e.scrollHeight-n.value:e.scrollTop+a>=n.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=s({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),a=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),n=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return i.a.createElement("div",{style:n,className:"infinite-scroll-component__outerdiv"},i.a.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&i.a.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},i.a.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!a&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(n.Component);t.a=c},2968:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(11),l=a(707),o=a(803),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(s.g)(e)&&Object(h.g)(Object(s.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,l,o,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,l=a.device,Object(m.a)(!0),r&&!e?[3,2]:(o=[],i&&i.length&&i.forEach(function(e){o.push({sensedValue:Object(s.g)(e.sensedValue),maximumExtremeValue:Object(s.g)(e.maximumExtremeValue),maximumNormalValue:Object(s.g)(e.maximumNormalValue),minimumExtremeValue:Object(s.g)(e.minimumExtremeValue),minimumNormalValue:Object(s.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(s.g)(e.ifMaximumExtremeValue)||"true"!=Object(s.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(s.g)(e.ifMaximumNormalValue)||"true"!=Object(s.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(s.g)(e.ifMinimumExtremeValue)||"true"!=Object(s.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(s.g)(e.ifMinimumNormalValue)||"true"!=Object(s.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(s.g)(l.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props.showAlarmPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props.liveGraphRange;if(n&&n.length&&l){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&("import_active_energy_Wh"==a?c.graphData.columns[n].push(+e[a]/1e3):c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(l.getTime()-c.graphData.columns[0][2].getTime())/6e4>o&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<l.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),o>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),c.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var g=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:g},function(){if(s){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,l,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(s.g)(i.moncontype),(l=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&l.value&&(n.axis.y.tick.values=l.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,l,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,l=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(s.g)(u.moncondevice),g=Object(s.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:l,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,l;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(s.g)(i.moncondevice),[4,Object(o.a)(t,r)];case 1:return l=u.sent(),this.setState({graphYAxisSettings:l}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(s.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(s.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(s.g)(r.relatedEquipment)})||i.push({value:Object(s.g)(r.relatedEquipment),label:Object(s.g)(r.relatedEquipmentLabel),space:Object(s.g)(r.relatedEquipmentSpaceLabel)})},l=0;l<t.length;l++)r(l);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,g=p.grid,f=p.graphData,v=p.lastUpdatedAt,x=p.graphYAxisSettings,y=[],c&&(y=u.filter(function(e){return Object(s.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(A=Object(s.g)(t.moncontype),E=Object(s.g)(t.topic),D=d.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!c||c&&y.length?[4,Object(l.g)(E,a,n,!1)]:[3,2]):[3,3];case 1:S=b.sent(),b.label=2;case 2:if(O=["x"],(w={i1relay_state:["State"],active_power_Watts:["Watts"],current_Amperes:["Amps"],frequency_Hz:["Freq"],import_active_energy_Wh:["Kilo Watt Hour"],power_factor:["Power Factor"],voltage_volts:["Volts"]}).i1relay_state.push(null),w.active_power_Watts.push(null),w.current_Amperes.push(null),w.frequency_Hz.push(null),w.import_active_energy_Wh.push(null),w.power_factor.push(null),w.voltage_volts.push(null),O.push(new Date(a)),S.length>0&&S.forEach(function(e){e&&(w.i1relay_state.push(e.i1relay_state||"0"),w.active_power_Watts.push(e.active_power_Watts||"0"),w.current_Amperes.push(e.current_Amperes||"0"),w.frequency_Hz.push(e.frequency_Hz||"0"),w.import_active_energy_Wh.push(""+ +e.import_active_energy_Wh/1e3||"0"),w.power_factor.push(e.power_factor||"0"),w.voltage_volts.push(e.voltage_volts||"0"),O.push(new Date(e.timestamp)))}),v=S.length>0?null===(q=O[O.length-1])||void 0===q?void 0:q.toLocaleString():"No Data",w.i1relay_state.push(null),w.active_power_Watts.push(null),w.current_Amperes.push(null),w.frequency_Hz.push(null),w.import_active_energy_Wh.push(null),w.power_factor.push(null),w.voltage_volts.push(null),O.push(new Date(n)),O.length>1){if(_=Object(o.c)(5,a,n),N="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,N=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",g.x.lines=[],_.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((V=JSON.parse(JSON.stringify(d.a))).name="Relay i1",V.graphData.columns=[O],V.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},V.axis.x.tick.format=N,V.axis.x.tick.values=_,V.graphData.x="x",M=0;M<y.length;M++)j=y[M],L=Object(s.g)(j.sensedValue),V.sensedKeys.push(L),V.graphData.columns.push(w[""+L]);D.find(function(e){return e.name==V.name})&&(V.axis.y.tick.values=D.find(function(e){return e.name==V.name}).value,V.axis.y.min=V.axis.y.tick.values[0],V.axis.y.max=V.axis.y.tick.values[V.axis.y.tick.values.length-1]),x&&x.length&&(k=x.find(function(e){return e.graphName==V.name}))&&k.yAxisSettings&&("Fixed"==k.yAxisSettings?(delete V.axis.y.tick.values,V.axis.y.min=k.yAxisMin,V.axis.y.max=k.yAxisMax):"Floating"==k.yAxisSettings&&(delete V.axis.y.tick.values,delete V.axis.y.max,delete V.axis.y.min),V.yAxisSettings=k.yAxisSettings,V.yAxisFixedValues={max:k.yAxisMax,min:k.yAxisMin}),V.graphEquipment=this.fetchEquipmentFromPoints(V.name,V.sensedKeys),f.push(V)}else for(R=function(e){var t=r[e],a=JSON.parse(JSON.stringify(d.a)),n=1,i=[];if(a.name=t,"Totalized Energy"==t?(a.sensedKeys=["import_active_energy_Wh"],i=[O,w.import_active_energy_Wh],a.axis.y.label="kWh",n=0):"Frequency and Voltage"==t?(a.sensedKeys=["frequency_Hz","voltage_volts"],i=[O,w.frequency_Hz,w.voltage_volts],a.axis.y.label="Hz/Volts"):"Current and Power"==t?(a.sensedKeys=["active_power_Watts","current_Amperes"],i=[O,w.active_power_Watts,w.current_Amperes],a.axis.y.label="Watts/Amps"):"State and Power Factor"==t&&(a.sensedKeys=["relay_state","power_factor"],i=[O,w.i1relay_state,w.power_factor],a.axis.y.label="",n=2),D.find(function(e){return e.name==t})&&(a.axis.y.tick.values=D.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),x&&x.length){var s=x.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=N,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=i,a.graphEquipment=F.fetchEquipmentFromPoints(t,a.sensedKeys),f.push(a)},F=this,M=0;M<r.length;M++)R(M);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:g,graphData:f,lastUpdatedAt:v,loading:!1},function(){i&&C.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,l=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.showAlarmPoints,d=c.insightRelEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/RelayControl/"+Object(s.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(s.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(s.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(s.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(s.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:l,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2969:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(707),l=a(1009),o=a(803),u=a(837),c=a(11),m=a(796),p=a(736),h=a(122),g=a(124),d=a(760),f=(a.n(d),a(857)),v=a(20),x=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),y=this&&this.__assign||function(){return(y=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},A=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},E=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return x(t,e),t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e=this;return A(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return b(this,void 0,void 0,function(){var e,t=this;return A(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(c.g)(e)&&Object(g.g)(Object(c.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return b(this,void 0,void 0,function(){var t,a,n,i,r,s,l,o,u,g,d,f,v,x=this;return A(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(h.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(m.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(s.moncondevice)],null)]);case 1:return o=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,g=new Date(u[0][1]),o=o.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:l,deviceAlarms:o},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],x=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),x.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],x,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=y({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=y({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.changeYAxisSettings=function(e,t){return b(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return A(this,function(o){switch(o.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(c.g)(i.moncontype),(s=f.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return o.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return b(i,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return b(this,void 0,void 0,function(){var i,r,s,l,u,m,p,h,g,d,f,x,y,b=this;return A(this,function(A){switch(A.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,l=i.device,u=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",u?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(c.g)(l.moncondevice),g=Object(c.g)(l.rdfsLabel)),f=p.find(function(t){return t.graphName==e}),x=Object(v.F)(12),f&&f.ontology&&(x=f.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(y).then(function(){b.fetchGraphYAxisSettings()})];case 1:return A.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return b(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return A(this,function(l){switch(l.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(c.g)(i.moncondevice),[4,Object(o.a)(t,r)];case 1:return s=l.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});r&&Object(c.g)(r.point)&&Object(c.g)(r.relatedEquipment)&&!(i&&i.length&&i.find(function(e){return e.value==Object(c.g)(r.relatedEquipment)}))&&i.push({value:Object(c.g)(r.relatedEquipment),label:Object(c.g)(r.relatedEquipmentLabel),space:Object(c.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return b(e,void 0,void 0,function(){var e,t,a,n,i,r,u,m,p,h,d,v,x,y,b,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C,G,K,H=this;return A(this,function(A){switch(A.label){case 0:return e=this.props,t=e.from,a=e.to,n=e.device,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,m=e.isEquipment,p=e.equipment,h=this.state,d=h.grid,v=h.lastUpdatedAt,x=h.graphYAxisSettings,y=[],b=[],m&&(b=u.filter(function(e){return Object(c.g)(e.relatedEquipment)==p.ontology})),n&&n.moncondevice?(E=Object(c.g)(n.moncontype),D=Object(c.g)(n.topic),S=Object(c.g)(n.firmwareVersion),w=Object(c.g)(n.csbCallibration)?parseInt(Object(c.g)(n.csbCallibration)):0,O=f.b.filter(function(e){return E.toLowerCase().indexOf(e.type.toLowerCase())>-1}),_=[],!m||m&&b.length?[4,Object(s.d)(D,t,a,!1)]:[3,2]):[3,3];case 1:_=A.sent(),A.label=2;case 2:if(P=["x"],(N={temp_celsius:["Temp"],relhumidity_pct:["Humidity"],altitude_m:["Alt."],equiCO2_ppm:["CO2"],tvoc_ppm:["TVOC"],gasResistance_kOhm:["Gas Res"],illuminance_lux:["Illuminance"],motion_sensed:["Motion"],num_BTdev:["Blth Dev."],pressure_hPa:["Pressure"]}).temp_celsius.push(null),N.relhumidity_pct.push(null),N.altitude_m.push(null),N.equiCO2_ppm.push(null),N.tvoc_ppm.push(null),N.gasResistance_kOhm.push(null),N.illuminance_lux.push(null),N.motion_sensed.push(null),N.num_BTdev.push(null),N.pressure_hPa.push(null),P.push(new Date(t)),_.length>0&&_.forEach(function(e){e&&(N.temp_celsius.push(Object(l.a)(e.temp_celsius,S||"",w)),N.relhumidity_pct.push(e.relhumidity_pct||"0"),N.altitude_m.push(e.altitude_m||"0"),N.equiCO2_ppm.push(e.equiCO2_ppm||"0"),N.tvoc_ppm.push(e.tvoc_ppm||"0"),N.pressure_hPa.push(e.pressure_hPa||"0"),N.gasResistance_kOhm.push(e.gasResistance_kOhm||"0"),N.illuminance_lux.push(e.illuminance_lux||"0"),N.motion_sensed.push(e.motion_sensed||"0"),N.num_BTdev.push(e.num_BTdev||"0"),P.push(new Date(e.timestamp)))}),v=_.length>0?null===(K=P[P.length-1])||void 0===K?void 0:K.toLocaleString():"No data",0===_.length&&(N.temp_celsius.push(null),N.relhumidity_pct.push(null),N.altitude_m.push(null),N.equiCO2_ppm.push(null),N.tvoc_ppm.push(null),N.gasResistance_kOhm.push(null),N.illuminance_lux.push(null),N.motion_sensed.push(null),N.num_BTdev.push(null),N.pressure_hPa.push(null),P.push(new Date(a))),P.length>1){if(V=Object(o.c)(5,t,a),j="",V.length>1?(L=((new Date).getTime()-V[0].getTime())/1e3,j=(L/=3600)>24?"%m-%d %H:%M":L<.3?"%H:%M:%S":"%H:%M"):j="%H:%M:%S",d.x.lines=[],V.forEach(function(e){d.x.lines.push({value:e,class:"grid4"})}),m){for((k=JSON.parse(JSON.stringify(f.a))).name="Ceiling Sensor",k.graphData.columns=[P],k.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},k.axis.x.tick.format=j,k.axis.x.tick.values=V,k.graphData.x="x",G=0;G<b.length;G++)R=b[G],F=Object(c.g)(R.sensedValue),k.sensedKeys.push(F),k.graphData.columns.push(N[""+F]);k.graphEquipment=this.fetchEquipmentFromPoints(k.name,k.sensedKeys),O.find(function(e){return e.name==k.name})&&(k.axis.y.tick.values=O.find(function(e){return e.name==k.name}).value,k.axis.y.min=k.axis.y.tick.values[0],k.axis.y.max=k.axis.y.tick.values[k.axis.y.tick.values.length-1]),x&&x.length&&(M=x.find(function(e){return e.graphName==k.name}))&&M.yAxisSettings&&("Fixed"==M.yAxisSettings?(delete k.axis.y.tick.values,k.axis.y.min=M.yAxisMin,k.axis.y.max=M.yAxisMax):"Floating"==M.yAxisSettings&&(delete k.axis.y.tick.values,delete k.axis.y.max,delete k.axis.y.min),k.yAxisSettings=M.yAxisSettings,k.yAxisFixedValues={max:M.yAxisMax,min:M.yAxisMin}),y.push(k)}else for(q=function(e){var t=r[e],a=JSON.parse(JSON.stringify(f.a)),n=0,i=[];if(a.name=t,"Temp & Humidity"==t?(a.axis.y.label="\xb0F / %",n=1,a.sensedKeys=["temp_celsius","relhumidity_pct"],i=[P,N.temp_celsius,N.relhumidity_pct]):"Pressure"==t?(a.axis.y.label="hPa",a.sensedKeys=["pressure_hPa"],i=[P,N.pressure_hPa]):"Illuminance"==t?(a.axis.y.label="Lux",a.sensedKeys=["illuminance_lux"],i=[P,N.illuminance_lux]):"Gas Resistance"==t?(a.axis.y.label="kOhm",a.sensedKeys=["gasResistance_kOhm"],i=[P,N.gasResistance_kOhm]):"Air Particles"==t?(a.axis.y.label="PPM",a.sensedKeys=["equiCO2_ppm","tvoc_ppm"],i=[P,N.equiCO2_ppm,N.tvoc_ppm]):"Other Parameters"==t&&(a.axis.y.label="",a.sensedKeys=["motion_sensed","num_BTdev"],i=[P,N.motion_sensed,N.num_BTdev]),O.find(function(e){return e.name==t})&&(a.axis.y.tick.values=O.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),x&&x.length){var s=x.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=j,a.axis.x.tick.values=V,a.graphData.x="x",a.graphData.columns=i,a.graphEquipment=C.fetchEquipmentFromPoints(t,a.sensedKeys),y.push(a)},C=this,G=0;G<r.length;G++)q(G);this.props.loadNextInsight(),Object(g.h)(D,this.callLiveUpdate),this.setState({grid:d,graphData:y,lastUpdatedAt:v,loading:!1},function(){i&&H.changeAlarmStatus(!0)})}A.label=3;case 3:return[2]}})})})},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props,o=s.device,u=s.showAlarmPoints,m=new Date,p=Object(c.g)(o.firmwareVersion),h=Object(c.g)(o.csbCallibration)?parseInt(Object(c.g)(o.csbCallibration)):0;e["@timestamp"]&&(m=new Date(e["@timestamp"]),m=new Date(m.setHours(m.getHours()+10)));var g=this.props.liveGraphRange;if(n&&n.length&&m){for(var d=0;d<n.length;d++){var f=n[d];if(f.graphData.columns&&f.graphData.columns.length){if(f.graphData.columns[0].push(m),e&&Object.keys(e).length)for(var v=Object.keys(e),x=function(t){var a=v[t],n=1;f.sensedKeys&&f.sensedKeys.length&&f.sensedKeys.find(function(e){return e==a})&&("temp_celsius"==a?f.graphData.columns[n].push(Object(l.a)(null===e||void 0===e?void 0:e.temp_celsius,p||"",h)):f.graphData.columns[n].push(e[a]),n++,f.graphData.columns[n].splice(1,1))},y=0;y<v.length;y++)x(y);(m.getTime()-f.graphData.columns[0][2].getTime())/6e4>g&&f.graphData.columns[0].splice(1,1),f.axis.x.tick.values[2]&&f.axis.x.tick.values[1].getTime()&&f.axis.x.tick.values[2].getTime()-f.axis.x.tick.values[1].getTime()<m.getTime()-f.axis.x.tick.values[f.axis.x.tick.values.length-1]&&(f.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),m.setSeconds(0),g>10&&m.setMinutes(m.getMinutes()-m.getMinutes()%5),f.axis.x.tick.values.push(m),i.x.lines.push({value:m,class:"grid4"}))}}var b=null===m||void 0===m?void 0:m.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:b},function(){if(u){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,o=t.enableYAxis,u=this.props,m=u.instance,p=u.buildingName,h=u.device,g=u.showAlarmPoints,d=u.insightRelEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,u,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||o)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),o&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CeilingSensor/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:g&&(null===(u=t.graphDataAlarmPoint.columns)||void 0===u?void 0:u.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=E},2970:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(707),l=a(803),o=a(124),u=a(760),c=(a.n(u),a(11)),m=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),p=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},h=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},g=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:{x:"x",columns:[]},grid:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{fit:!1,count:5,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,lastUpdatedAt:"No Data"},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return m(t,e),t.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){var e=this;return h(this,function(t){return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){e.state.loading||e.setState({loading:!0},function(){return e.setState({loading:!1})})}),this._fetchData(),[2]})})},t.prototype.componentWillUnmount=function(){return p(this,void 0,void 0,function(){var e,t=this;return h(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){t.state.loading||t.setState({loading:!0},function(){return t.setState({loading:!1})})}),Object(c.g)(e)&&Object(o.g)(Object(c.g)(e)),[2]})})},t.prototype.changeAlarmStatus=function(){},t.prototype.callLiveUpdate=function(e){var t,a=this.state,n=a.graphData,i=a.axis1,r=a.grid;e["@timestamp"]&&(t=new Date(e["@timestamp"]),t=new Date(t.setHours(t.getHours()+10)));var s=this.props.liveGraphRange;if(n.columns.length>1&&t){n.columns[0].splice(1,1),n.columns[0].push(t),n.columns[1].splice(1,1),n.columns[1].push(null===e||void 0===e?void 0:e.setpoint),n.columns[2].splice(1,1),n.columns[2].push(null===e||void 0===e?void 0:e.roomtemp),n.columns[3].splice(1,1),n.columns[3].push(null===e||void 0===e?void 0:e.fanspeed),n.columns[4].splice(1,1),n.columns[4].push(null===e||void 0===e?void 0:e.horizontalvans),n.columns[5].splice(1,1),n.columns[5].push(null===e||void 0===e?void 0:e.usermode),n.columns[6].splice(1,1),n.columns[6].push(null===e||void 0===e?void 0:e.verticalvans),n.columns[7].splice(1,1),n.columns[7].push(null===e||void 0===e?void 0:e.wifiSignal),(t.getTime()-n.columns[0][2].getTime())/6e4>s&&n.columns[0].splice(1,1),i.x.tick.values[2]&&i.x.tick.values[1].getTime()&&i.x.tick.values[2].getTime()-i.x.tick.values[1].getTime()<t.getTime()-i.x.tick.values[i.x.tick.values.length-1]&&(i.x.tick.values.splice(0,1),r.x.lines.splice(0,1),t.setSeconds(0),s>10&&t.setMinutes(t.getMinutes()-t.getMinutes()%5),i.x.tick.values.push(t),r.x.lines.push({value:t,class:"grid4"}));var l=null===t||void 0===t?void 0:t.toLocaleString();this.setState({grid:r,axis1:i,graphData:n,lastUpdatedAt:l})}},t.prototype._fetchData=function(){var e;return p(this,void 0,void 0,function(){var t,a,n,i,r,u,m,p,g,d,f,v,x,y,b,A,E,D,S,w,O,_;return h(this,function(h){switch(h.label){case 0:return t=this.props,a=t.device,n=t.from,i=t.to,r=this.state,u=r.grid,m=r.axis1,p=r.graphData,g=r.lastUpdatedAt,a&&a.moncondevice?(d=Object(c.g)(a.topic),[4,Object(s.e)(d,n,i,p.columns.length>1)]):[3,2];case 1:f=h.sent(),v=["setpoint"],y=["mode"],b=["fanspeed"],A=["horizontalvans"],E=["verticalvans"],D=["wifiSignal"],S=["x"],(x=["roomtemp"]).push(null),v.push(null),b.push(null),A.push(null),y.push(null),E.push(null),D.push(null),S.push(new Date(n)),f.length>0&&f.forEach(function(e){e&&(1!=isNaN(e.roomtemp)&&x.push(e.roomtemp),1!=isNaN(e.setpoint)&&v.push(e.setpoint),e.fanspeed?b.push(e.fanspeed):b.push("undefined"),e.horizontalvans?A.push(e.horizontalvans):A.push("undefined"),e.usermode?y.push(e.usermode):y.push("undefined"),e.verticalvans?E.push(e.verticalvans):E.push("undefined"),e.wifiSignal?D.push(e.wifiSignal):D.push("undefined"),S.push(new Date(e.timestamp)))}),g=f.length>0?null===(e=S[S.length-1])||void 0===e?void 0:e.toLocaleString():"No Data",x.push(null),v.push(null),b.push(null),A.push(null),y.push(null),E.push(null),D.push(null),S.push(new Date(i)),p={x:"x",columns:[S,v,x,b,A,y,E,D]},m.y.label="\xb0F",w=Object(l.c)(5,n,i),O="",w.length>1?(_=((new Date).getTime()-w[0].getTime())/1e3,O=(_/=3600)>24?"%m-%d %H:%M":_<.3?"%H:%M:%S":"%H:%M"):O="%H:%M:%S",u.x.lines=[],w.forEach(function(e){u.x.lines.push({value:e,class:"grid4"})}),m.y.tick.format=function(e){return parseFloat(e).toFixed(2)},m.y.tick.values=[0,20,40,60,80,100],m.y.max=100,m.y.min=0,m.x.tick.format=O,m.x.tick.values=w,this.props.loadNextInsight(),Object(o.h)(d,this.callLiveUpdate),this.setState({grid:u,axis1:m,graphData:p,loading:!1,lastUpdatedAt:g}),h.label=2;case 2:return[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData,i=e.axis1,s=e.grid,l=e.lastUpdatedAt,o=this.props,u=o.instance,m=o.buildingName,p=o.device,h=o.equipment;return"No Data"==l?n.createElement(n.Fragment,null):n.createElement("div",{className:"row col-md-12 device-graphs",id:"divGraphs"},n.createElement("br",null),n.createElement("h5",{className:"no-padding no-margin-color-textalign tooltipDashboard graphHeading"},n.createElement("a",{className:"col-md-8 sentence-break",onClick:function(){window.location.hash=u+"/"+m+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(c.g)(p.moncondevice)}},h.length>0&&h[0].rdfsLabel?h[0].rdfsLabel:"No equipment assigned"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Space: ",Object(c.g)(p.spaceRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(p.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(p.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Equipment: ",null===h||void 0===h?void 0:h.map(function(e,t){return e.rdfsLabel+(t<h.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(p.rdfsLabel)||"No device assigned"," ")),n.createElement("span",{className:"lastUpdated"},"Last: ",l)),t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(r.a,{data:a,size:{height:300},axis:i,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0},colors:{spaceTemp:"red",cooltemp:"blue",fan:"pink"}}))},t}(n.Component);t.a=g},2971:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(715),l=a(803),o=a(124),u=a(760),c=(a.n(u),a(11)),m=a(837),p=a(857),h=a(122),g=a(736),d=a(796),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(c.g)(e)&&Object(o.g)(Object(c.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,l,o,u,m,p,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(h.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(c.g)(e.sensedValue),maximumExtremeValue:Object(c.g)(e.maximumExtremeValue),maximumNormalValue:Object(c.g)(e.maximumNormalValue),minimumExtremeValue:Object(c.g)(e.minimumExtremeValue),minimumNormalValue:Object(c.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(c.g)(e.ifMaximumExtremeValue)||"true"!=Object(c.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(c.g)(e.ifMaximumNormalValue)||"true"!=Object(c.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(c.g)(e.ifMinimumExtremeValue)||"true"!=Object(c.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(c.g)(e.ifMinimumNormalValue)||"true"!=Object(c.g)(e.ifMinimumNormalValue))})}),[4,Object(d.e)(g.a.OperationalAlarm,n,!1,0,50,null,null,[Object(c.g)(s.moncondevice)],null)]);case 1:return o=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(u=t[0].graphData.columns,m=new Date(u[0][1]),o=o.filter(function(e){return new Date(e.timeofalarm)>m})),this.setState({alarmSensedPoints:l,deviceAlarms:o},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(p=[],f=0;f<t.length;f++)v=t[f],p.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:p}),y.label=3;case 3:return Object(h.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,u=s.graphData,c=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},c){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(c.minimumExtremeValue),v.push(c.minimumNormalValue),y.push(c.maximumNormalValue),b.push(c.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!c.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!c.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!c.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!c.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=c,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",u.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:u,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=m.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=new Date;e["@timestamp"]&&(s=new Date(e["@timestamp"]),s=new Date(s.setHours(s.getHours()+10)));var l=this.props,o=l.liveGraphRange,u=l.showAlarmPoints;if(n&&n.length&&s){for(var c=0;c<n.length;c++){var m=n[c];if(m.graphData.columns&&m.graphData.columns.length){if(m.graphData.columns[0].push(s),e&&Object.keys(e).length)for(var p=Object.keys(e),h=function(t){var a=p[t],n=1;m.sensedKeys&&m.sensedKeys.length&&m.sensedKeys.find(function(e){return e==a})&&(m.graphData.columns[n].push(e[a]),n++,m.graphData.columns[n].splice(1,1))},g=0;g<p.length;g++)h(g);(s.getTime()-m.graphData.columns[0][2].getTime())/6e4>o&&m.graphData.columns[0].splice(1,1),m.axis.x.tick.values[2]&&m.axis.x.tick.values[1].getTime()&&m.axis.x.tick.values[2].getTime()-m.axis.x.tick.values[1].getTime()<s.getTime()-m.axis.x.tick.values[m.axis.x.tick.values.length-1]&&(m.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),s.setSeconds(0),o>10&&s.setMinutes(s.getMinutes()-s.getMinutes()%5),m.axis.x.tick.values.push(s),i.x.lines.push({value:s,class:"grid4"}))}}var d=null===s||void 0===s?void 0:s.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:d},function(){if(u){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return b(this,function(o){switch(o.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(c.g)(i.moncontype),(s=p.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return o.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,o,u,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,o=i.device,u=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",u?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(c.g)(o.moncondevice),g=Object(c.g)(o.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(o){switch(o.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(c.g)(i.moncondevice),[4,Object(l.a)(t,r)];case 1:return s=o.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(c.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(c.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(c.g)(r.relatedEquipment)})||i.push({value:Object(c.g)(r.relatedEquipment),label:Object(c.g)(r.relatedEquipmentLabel),space:Object(c.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,m,h,g,d,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.devicePoints,r=e.isEquipment,u=e.equipment,m=e.showAlarmPoints,h=this.state,g=h.grid,d=h.lastUpdatedAt,f=h.graphYAxisSettings,v=[],x=[],r&&(x=i.filter(function(e){return Object(c.g)(e.relatedEquipment)==u.ontology})),t&&t.moncondevice?(y=Object(c.g)(t.moncontype),A=Object(c.g)(t.topic),E=p.b.filter(function(e){return y.toLowerCase().indexOf(e.type.toLowerCase())>-1}),D=[],!r||r&&x.length?[4,Object(s.j)(A,a,n,!1)]:[3,2]):[3,3];case 1:D=b.sent(),b.label=2;case 2:if(w=["x"],(S={Normal_Frequency:["Normal Freq"],Emergency_Frequency:["Emergency Freq"]}).Normal_Frequency.push(null),S.Emergency_Frequency.push(null),w.push(new Date(a)),D.length>0&&D.forEach(function(e){e&&(S.Normal_Frequency.push(e.Normal_Frequency||"0"),S.Emergency_Frequency.push(e.Emergency_Frequency||"0"),w.push(new Date(e.timestamp)))}),d=D.length>0?null===(M=w[w.length-1])||void 0===M?void 0:M.toLocaleString():"No Data",S.Normal_Frequency.push(null),S.Emergency_Frequency.push(null),w.push(new Date(n)),w.length>1){if(O=Object(l.c)(5,a,n),_="",O.length>1?(N=((new Date).getTime()-O[0].getTime())/1e3,_=(N/=3600)>24?"%m-%d %H:%M":N<.3?"%H:%M:%S":"%H:%M"):_="%H:%M:%S",g.x.lines=[],O.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),r){for((P=JSON.parse(JSON.stringify(p.a))).name="ATS Frequency",P.graphData.columns=[w],P.graphData.x="x",F=0;F<x.length;F++)V=x[F],j=Object(c.g)(V.sensedValue),P.sensedKeys.push(j),P.graphData.columns.push(S[""+j]);E.find(function(e){return e.name==P.name})&&(P.axis.y.tick.values=E.find(function(e){return e.name==P.name}).value,P.axis.y.min=P.axis.y.tick.values[0],P.axis.y.max=P.axis.y.tick.values[P.axis.y.tick.values.length-1]),f&&f.length&&(L=f.find(function(e){return e.graphName==P.name}))&&L.yAxisSettings&&("Fixed"==L.yAxisSettings?(delete P.axis.y.tick.values,P.axis.y.min=L.yAxisMin,P.axis.y.max=L.yAxisMax):"Floating"==L.yAxisSettings&&(delete P.axis.y.tick.values,delete P.axis.y.max,delete P.axis.y.min),P.yAxisSettings=L.yAxisSettings,P.yAxisFixedValues={max:L.yAxisMax,min:L.yAxisMin}),P.axis.y.label="Hz",P.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},P.axis.x.tick.format=_,P.axis.x.tick.values=O,P.graphEquipment=this.fetchEquipmentFromPoints(P.name,P.sensedKeys),v.push(P)}else for(k=function(e){var t,a="ATS Frequency",n=JSON.parse(JSON.stringify(p.a));if(n.name=a,n.axis.y.label="Hz",2,n.sensedKeys=["Normal_Frequency","Emergency_Frequency"],t=[w,S.Normal_Frequency,S.Emergency_Frequency],E.find(function(e){return e.name==a})&&(n.axis.y.tick.values=E.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),f&&f.length){var i=f.find(function(e){return e.graphName==a});i&&i.yAxisSettings&&("Fixed"==i.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=i.yAxisMin,n.axis.y.max=i.yAxisMax):"Floating"==i.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=i.yAxisSettings,n.yAxisFixedValues={max:i.yAxisMax,min:i.yAxisMin})}n.axis.y.tick.format=function(e){return parseFloat(e).toFixed(2)},n.axis.x.tick.format=_,n.axis.x.tick.values=O,n.graphData.x="x",n.graphData.columns=t,n.graphEquipment=R.fetchEquipmentFromPoints(a,n.sensedKeys),v.push(n)},R=this,F=0;F<1;F++)k(F);this.props.loadNextInsight(),Object(o.h)(A,this.callLiveUpdate),this.setState({grid:g,graphData:v,lastUpdatedAt:d,loading:!1},function(){m&&q.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,o=t.enableYAxis,u=this.props,m=u.instance,p=u.buildingName,h=u.device,g=u.insightRelEquipment,d=u.showAlarmPoints;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,u="";return d&&t.alarmStatus&&("active"==t.alarmStatus?u="alarm-graph":"ack"==t.alarmStatus?u="alarm-ack-graph":"clear"==t.alarmStatus&&(u="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+u,id:"divGraphs"},n.createElement("br",null),(d||o)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),o&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/ATS/"+Object(c.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(c.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(c.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(c.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(c.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2972:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(715),l=a(803),o=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,l,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(m.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(s.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props.showAlarmPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props.liveGraphRange;if(n&&n.length&&l){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(l.getTime()-c.graphData.columns[0][2].getTime())/6e4>o&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<l.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),o>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),c.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var g=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:g},function(){if(s){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(o.g)(i.moncontype),(s=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(o.g)(u.moncondevice),g=Object(o.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(o.g)(i.moncondevice),[4,Object(l.a)(t,r)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(o.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(o.g)(r.relatedEquipment)})||i.push({value:Object(o.g)(r.relatedEquipment),label:Object(o.g)(r.relatedEquipmentLabel),space:Object(o.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,g=p.grid,f=p.graphData,v=p.lastUpdatedAt,x=p.graphYAxisSettings,y=[],c&&(y=u.filter(function(e){return Object(o.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(A=Object(o.g)(t.moncontype),E=Object(o.g)(t.topic),D=d.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!c||c&&y.length?[4,Object(s.m)(E,a,n,!1)]:[3,2]):[3,3];case 1:S=b.sent(),b.label=2;case 2:if(O=["x"],(w={GenVAB_Volts:["VAB"],GenVBC_Volts:["VBC"],GenVCA_Volts:["VCA"],GenVAN_Volts:["VA"],GenVBN_Volts:["VB"],GenVCN_Volts:["VC"],BusVoltage_Volts:["Bus Voltage"],GenIA_Amps:["Gen IA"],GenIB_Amps:["Gen IB"],GenIC_Amps:["Gen IC"],GenKVA_A_KiloVA:["Gen kVA A"],GenKVA__B_KiloVA:["Gen kVA B"],GenKVA_C_KiloVA:["Gen kVA C"],GenKVA_Total_KiloVA:["Gen kVA Total"],Gen_A_kW:["Gen kW A"],Gen_B_kW:["Gen kW B"],Gen_C_kW:["Gen kW C"],Gen_Total_kW:["Gen kW Total"],GenPFLagging:["Gen Power Factor"],ActiveSpeedSource:["Act speed"],EngineSpeed_rpm:["Engine Speed"],EngineLoad_pct:["Engine Load"],CoolantTemp_F:["Coolant Temp"],OilPressure_psi:["Oil Press"],BatteryVoltage_DeciVolt:["Battery Volt"],FuelLevel:["Fuel Level"],ECUCoolantLevel:["ECU Coolant level"],CoolDownTimeRemaining_mins:["Cool Down Time Rem."],UnexpectedShutdown:["Unexp. Shutdown"],GlobalAlarm:["Global Alarm"],AutoRestartFailure:["Auto Restart Fail"],FuelLeakDetect:["Fuel Leak Det."],BatteryChargerFailure:["Battery Chg. Fail"],TransferFail:["Transfer Fail"],LowCoolantLevel:["Low Coolant level"],ECUShutdown:["ECU Shutdown"],EmergencyShutdown:["Emerg. Shut"],Overcrank:["Overcrank"],LossofECUComms:["Loss of ECU Comms"],GlobalSenderFail:["Global Sender Fail"],LowFuelLevel:["Low Fuel Level"],LowOilPressure:["Low Oil Press"],HighCoolantTemp:["High Coolant"]}).GenVAB_Volts.push(null),w.GenVBC_Volts.push(null),w.GenVCA_Volts.push(null),w.GenVAN_Volts.push(null),w.GenVBN_Volts.push(null),w.GenVCN_Volts.push(null),w.BusVoltage_Volts.push(null),w.GenIA_Amps.push(null),w.GenIB_Amps.push(null),w.GenIC_Amps.push(null),w.GenKVA_A_KiloVA.push(null),w.GenKVA__B_KiloVA.push(null),w.GenKVA_C_KiloVA.push(null),w.GenKVA_Total_KiloVA.push(null),w.Gen_A_kW.push(null),w.Gen_B_kW.push(null),w.Gen_C_kW.push(null),w.Gen_Total_kW.push(null),w.GenPFLagging.push(null),w.ActiveSpeedSource.push(null),w.EngineSpeed_rpm.push(null),w.EngineLoad_pct.push(null),w.CoolantTemp_F.push(null),w.OilPressure_psi.push(null),w.BatteryVoltage_DeciVolt.push(null),w.FuelLevel.push(null),w.ECUCoolantLevel.push(null),w.CoolDownTimeRemaining_mins.push(null),w.UnexpectedShutdown.push(null),w.GlobalAlarm.push(null),w.AutoRestartFailure.push(null),w.FuelLeakDetect.push(null),w.BatteryChargerFailure.push(null),w.TransferFail.push(null),w.LowCoolantLevel.push(null),w.ECUShutdown.push(null),w.EmergencyShutdown.push(null),w.Overcrank.push(null),w.LossofECUComms.push(null),w.GlobalSenderFail.push(null),w.LowFuelLevel.push(null),w.LowOilPressure.push(null),w.HighCoolantTemp.push(null),O.push(new Date(a)),S.length>0&&S.forEach(function(e){e&&(w.GenVAB_Volts.push(e.GenVAB_Volts||0),w.GenVBC_Volts.push(e.GenVBC_Volts||0),w.GenVCA_Volts.push(e.GenVCA_Volts||0),w.GenVAN_Volts.push(e.GenVAN_Volts||0),w.GenVBN_Volts.push(e.GenVBN_Volts||0),w.GenVCN_Volts.push(e.GenVCN_Volts||0),w.BusVoltage_Volts.push(e.BusVoltage_Volts||0),w.GenIA_Amps.push(e.GenIA_Amps||0),w.GenIB_Amps.push(e.GenIB_Amps||0),w.GenIC_Amps.push(e.GenIC_Amps||0),w.GenKVA_A_KiloVA.push(e.GenKVA_A_KiloVA||0),w.GenKVA__B_KiloVA.push(e.GenKVA__B_KiloVA||0),w.GenKVA_C_KiloVA.push(e.GenKVA_C_KiloVA||0),w.GenKVA_Total_KiloVA.push(e.GenKVA_Total_KiloVA||0),w.Gen_A_kW.push(e.Gen_A_kW||0),w.Gen_B_kW.push(e.Gen_B_kW||0),w.Gen_C_kW.push(e.Gen_C_kW||0),w.Gen_Total_kW.push(e.Gen_Total_kW||0),w.GenPFLagging.push(e.GenPFLagging||0),w.ActiveSpeedSource.push(e.ActiveSpeedSource||0),w.EngineSpeed_rpm.push(e.EngineSpeed_rpm||0),w.EngineLoad_pct.push(e.EngineLoad_pct||0),w.CoolantTemp_F.push(e.CoolantTemp_F||0),w.OilPressure_psi.push(e.OilPressure_psi||0),w.BatteryVoltage_DeciVolt.push(e.BatteryVoltage_DeciVolt||0),w.FuelLevel.push(e.FuelLevel||0),w.ECUCoolantLevel.push(e.ECUCoolantLevel||0),w.CoolDownTimeRemaining_mins.push(e.CoolDownTimeRemaining_mins||0),w.UnexpectedShutdown.push(e.UnexpectedShutdown||0),w.GlobalAlarm.push(e.GlobalAlarm||0),w.AutoRestartFailure.push(e.AutoRestartFailure||0),w.FuelLeakDetect.push(e.FuelLeakDetect||0),w.BatteryChargerFailure.push(e.BatteryChargerFailure||0),w.TransferFail.push(e.TransferFail||0),w.LowCoolantLevel.push(e.LowCoolantLevel||0),w.ECUShutdown.push(e.ECUShutdown||0),w.EmergencyShutdown.push(e.EmergencyShutdown||0),w.Overcrank.push(e.Overcrank||0),w.LossofECUComms.push(e.LossofECUComms||0),w.GlobalSenderFail.push(e.GlobalSenderFail||0),w.LowFuelLevel.push(e.LowFuelLevel||0),w.LowOilPressure.push(e.LowOilPressure||0),w.HighCoolantTemp.push(e.HighCoolantTemp||0),O.push(new Date(e.timestamp)))}),v=S.length>0?null===(q=O[O.length-1])||void 0===q?void 0:q.toLocaleString():"No Data",w.GenVAB_Volts.push(null),w.GenVBC_Volts.push(null),w.GenVCA_Volts.push(null),w.GenVAN_Volts.push(null),w.GenVBN_Volts.push(null),w.GenVCN_Volts.push(null),w.BusVoltage_Volts.push(null),w.GenIA_Amps.push(null),w.GenIB_Amps.push(null),w.GenIC_Amps.push(null),w.GenKVA_A_KiloVA.push(null),w.GenKVA__B_KiloVA.push(null),w.GenKVA_C_KiloVA.push(null),w.GenKVA_Total_KiloVA.push(null),w.Gen_A_kW.push(null),w.Gen_B_kW.push(null),w.Gen_C_kW.push(null),w.Gen_Total_kW.push(null),w.GenPFLagging.push(null),w.ActiveSpeedSource.push(null),w.EngineSpeed_rpm.push(null),w.EngineLoad_pct.push(null),w.CoolantTemp_F.push(null),w.OilPressure_psi.push(null),w.BatteryVoltage_DeciVolt.push(null),w.FuelLevel.push(null),w.ECUCoolantLevel.push(null),w.CoolDownTimeRemaining_mins.push(null),w.UnexpectedShutdown.push(null),w.GlobalAlarm.push(null),w.AutoRestartFailure.push(null),w.FuelLeakDetect.push(null),w.BatteryChargerFailure.push(null),w.TransferFail.push(null),w.LowCoolantLevel.push(null),w.ECUShutdown.push(null),w.EmergencyShutdown.push(null),w.Overcrank.push(null),w.LossofECUComms.push(null),w.GlobalSenderFail.push(null),w.LowFuelLevel.push(null),w.LowOilPressure.push(null),w.HighCoolantTemp.push(null),O.push(new Date(n)),O.length>1){if(_=Object(l.c)(5,a,n),N="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,N=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",g.x.lines=[],_.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((V=JSON.parse(JSON.stringify(d.a))).name="Generator",V.graphData.columns=[O],V.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},V.axis.x.tick.format=N,V.axis.x.tick.values=_,V.graphData.x="x",M=0;M<y.length;M++)j=y[M],L=Object(o.g)(j.sensedValue),V.sensedKeys.push(L),V.graphData.columns.push(w[""+L]);D.find(function(e){return e.name==V.name})&&(V.axis.y.tick.values=D.find(function(e){return e.name==V.name}).value,V.axis.y.min=V.axis.y.tick.values[0],V.axis.y.max=V.axis.y.tick.values[V.axis.y.tick.values.length-1]),x&&x.length&&(k=x.find(function(e){return e.graphName==V.name}))&&k.yAxisSettings&&("Fixed"==k.yAxisSettings?(delete V.axis.y.tick.values,V.axis.y.min=k.yAxisMin,V.axis.y.max=k.yAxisMax):"Floating"==k.yAxisSettings&&(delete V.axis.y.tick.values,delete V.axis.y.max,delete V.axis.y.min),V.yAxisSettings=k.yAxisSettings,V.yAxisFixedValues={max:k.yAxisMax,min:k.yAxisMin}),V.graphEquipment=this.fetchEquipmentFromPoints(V.name,V.sensedKeys),f.push(V)}else for(R=function(e){var t=r[e],a=JSON.parse(JSON.stringify(d.a)),n=0,i=[];if(a.name=t,"Voltages"==t?(a.axis.y.label="Volts",a.sensedKeys=["GenVAB_Volts","GenVBC_Volts","GenVCA_Volts","GenVAN_Volts","GenVBN_Volts","GenVCN_Volts","BusVoltage_Volts"],i=[O,w.GenVAB_Volts,w.GenVBC_Volts,w.GenVCA_Volts,w.GenVAN_Volts,w.GenVBN_Volts,w.GenVCN_Volts,w.BusVoltage_Volts]):"Currents"==t?(a.axis.y.label="Amps",n=1,a.sensedKeys=["GenIA_Amps","GenIB_Amps","GenIC_Amps"],i=[O,w.GenIA_Amps,w.GenIB_Amps,w.GenIC_Amps]):"Powers"==t?(a.axis.y.label="Watts",n=1,a.sensedKeys=["GenKVA_A_KiloVA","GenKVA__B_KiloVA","GenKVA_C_KiloVA","GenKVA_Total_KiloVA","Gen_A_kW","Gen_B_kW","Gen_C_kW","Gen_Total_kW"],i=[O,w.GenKVA_A_KiloVA,w.GenKVA__B_KiloVA,w.GenKVA_C_KiloVA,w.GenKVA_Total_KiloVA,w.Gen_A_kW,w.Gen_B_kW,w.Gen_C_kW,w.Gen_Total_kW]):"Power Factor"==t?(a.axis.y.label="",a.sensedKeys=["GenPFLagging"],i=[O,w.GenPFLagging]):"Other Parameters"==t?(a.axis.y.label="",a.sensedKeys=["ActiveSpeedSource","EngineSpeed_rpm","EngineLoad_pct","CoolantTemp_F","OilPressure_psi","BatteryVoltage_DeciVolt","FuelLevel","ECUCoolantLevel","CoolDownTimeRemaining_mins"],i=[O,w.ActiveSpeedSource,w.EngineSpeed_rpm,w.EngineLoad_pct,w.CoolantTemp_F,w.OilPressure_psi,w.BatteryVoltage_DeciVolt,w.FuelLevel,w.ECUCoolantLevel,w.CoolDownTimeRemaining_mins]):"Binary Parameters"==t&&(a.axis.y.label="",a.sensedKeys=["UnexpectedShutdown","GlobalAlarm","AutoRestartFailure","FuelLeakDetect","BatteryChargerFailure","TransferFail","LowCoolantLevel","ECUShutdown","EmergencyShutdown","Overcrank","LossofECUComms","GlobalSenderFail","LowFuelLevel","LowOilPressure","HighCoolantTemp"],i=[O,w.UnexpectedShutdown,w.GlobalAlarm,w.AutoRestartFailure,w.FuelLeakDetect,w.BatteryChargerFailure,w.TransferFail,w.LowCoolantLevel,w.ECUShutdown,w.EmergencyShutdown,w.Overcrank,w.LossofECUComms,w.GlobalSenderFail,w.LowFuelLevel,w.LowOilPressure,w.HighCoolantTemp]),D.find(function(e){return e.name==t})&&(a.axis.y.tick.values=D.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),x&&x.length){var s=x.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=N,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=i,a.graphEquipment=F.fetchEquipmentFromPoints(t,a.sensedKeys),f.push(a)},F=this,M=0;M<r.length;M++)R(M);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:g,graphData:f,lastUpdatedAt:v,loading:!1},function(){i&&C.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.showAlarmPoints,d=c.insightRelEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/Generator/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2973:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(715),l=a(803),o=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(o.g)(i.moncontype),(s=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(o.g)(u.moncondevice),g=Object(o.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(o.g)(i.moncondevice),[4,Object(l.a)(t,r)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(o.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(o.g)(r.relatedEquipment)})||i.push({value:Object(o.g)(r.relatedEquipment),label:Object(o.g)(r.relatedEquipmentLabel),space:Object(o.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,l,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(m.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(s.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props.showAlarmPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props.liveGraphRange;if(n&&n.length&&l){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(l.getTime()-c.graphData.columns[0][2].getTime())/6e4>o&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<l.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),o>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),c.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var g=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:g},function(){if(s){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,g=p.grid,f=p.lastUpdatedAt,v=p.graphYAxisSettings,x=[],y=[],c&&(y=u.filter(function(e){return Object(o.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(A=Object(o.g)(t.moncontype),E=Object(o.g)(t.topic),D=d.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!c||c&&y.length?[4,Object(s.k)(E,a,n,!1)]:[3,2]):[3,3];case 1:S=b.sent(),b.label=2;case 2:if(O=["x"],(w={register1:["Register"],t3frontRefrigerator1:["Front"],t4backRefrigerator1:["Back"],t5evapfanRefrigerator1:["Evaporator Fan"],t6comprinRefrigerator1:["Evaporator Coil"],t7comproutRefrigerator1:["Compressor Out"],t8probeRefrigerator1:["Solid"],t3frontRefrigerator2:["Front"],t4backRefrigerator2:["Back"],t5evapfanRefrigerator2:["Evaporator Fan"],t6comprinRefrigerator2:["Evaporator Coil"],t7comproutRefrigerator2:["Compressor Out"],t8probeRefrigerator2:["Solid"],t3frontRefrigerator3:["Front"],t4backRefrigerator3:["Back"],t5evapfanRefrigerator3:["Evaporator Fan"],t6comprinRefrigerator3:["Evaporator Coil"],t7comproutRefrigerator3:["Compressor Out"],t8probeRefrigerator3:["Solid"],t3frontRefrigerator4:["Front"],t4backRefrigerator4:["Back"],t5evapfanRefrigerator4:["Evaporator Fan"],t6comprinRefrigerator4:["Evaporator Coil"],t7comproutRefrigerator4:["Compressor Out"],t8probeRefrigerator4:["Solid"]}).register1.push(null),w.t3frontRefrigerator1.push(null),w.t4backRefrigerator1.push(null),w.t5evapfanRefrigerator1.push(null),w.t6comprinRefrigerator1.push(null),w.t7comproutRefrigerator1.push(null),w.t8probeRefrigerator1.push(null),w.t3frontRefrigerator2.push(null),w.t4backRefrigerator2.push(null),w.t5evapfanRefrigerator2.push(null),w.t6comprinRefrigerator2.push(null),w.t7comproutRefrigerator2.push(null),w.t8probeRefrigerator2.push(null),w.t3frontRefrigerator3.push(null),w.t4backRefrigerator3.push(null),w.t5evapfanRefrigerator3.push(null),w.t6comprinRefrigerator3.push(null),w.t7comproutRefrigerator3.push(null),w.t8probeRefrigerator3.push(null),w.t3frontRefrigerator4.push(null),w.t4backRefrigerator4.push(null),w.t5evapfanRefrigerator4.push(null),w.t6comprinRefrigerator4.push(null),w.t7comproutRefrigerator4.push(null),w.t8probeRefrigerator4.push(null),O.push(new Date(a)),S.length>0&&S.forEach(function(e){e&&(w.register1.push(""+e.register1||"0"),w.t3frontRefrigerator1.push(""+e.t3frontRefrigerator1||"0"),w.t4backRefrigerator1.push(""+e.t4backRefrigerator1||"0"),w.t5evapfanRefrigerator1.push(""+e.t5evapfanRefrigerator1||"0"),w.t6comprinRefrigerator1.push(""+e.t6comprinRefrigerator1||"0"),w.t7comproutRefrigerator1.push(""+e.t7comproutRefrigerator1||"0"),w.t8probeRefrigerator1.push(""+e.t8probeRefrigerator1||"0"),w.t3frontRefrigerator2.push(""+e.t3frontRefrigerator2||"0"),w.t4backRefrigerator2.push(""+e.t4backRefrigerator2||"0"),w.t5evapfanRefrigerator2.push(""+e.t5evapfanRefrigerator2||"0"),w.t6comprinRefrigerator2.push(""+e.t6comprinRefrigerator2||"0"),w.t7comproutRefrigerator2.push(""+e.t7comproutRefrigerator2||"0"),w.t8probeRefrigerator2.push(""+e.t8probeRefrigerator2||"0"),w.t3frontRefrigerator3.push(""+e.t3frontRefrigerator3||"0"),w.t4backRefrigerator3.push(""+e.t4backRefrigerator3||"0"),w.t5evapfanRefrigerator3.push(""+e.t5evapfanRefrigerator3||"0"),w.t6comprinRefrigerator3.push(""+e.t6comprinRefrigerator3||"0"),w.t7comproutRefrigerator3.push(""+e.t7comproutRefrigerator3||"0"),w.t8probeRefrigerator3.push(""+e.t8probeRefrigerator3||"0"),w.t3frontRefrigerator4.push(""+e.t3frontRefrigerator4||"0"),w.t4backRefrigerator4.push(""+e.t4backRefrigerator4||"0"),w.t5evapfanRefrigerator4.push(""+e.t5evapfanRefrigerator4||"0"),w.t6comprinRefrigerator4.push(""+e.t6comprinRefrigerator4||"0"),w.t7comproutRefrigerator4.push(""+e.t7comproutRefrigerator4||"0"),w.t8probeRefrigerator4.push(""+e.t8probeRefrigerator4||"0"),O.push(new Date(e.timestamp)))}),f=S.length>0?null===(q=O[O.length-1])||void 0===q?void 0:q.toLocaleString():"No Data",w.register1.push(null),w.t3frontRefrigerator1.push(null),w.t4backRefrigerator1.push(null),w.t5evapfanRefrigerator1.push(null),w.t6comprinRefrigerator1.push(null),w.t7comproutRefrigerator1.push(null),w.t8probeRefrigerator1.push(null),w.t3frontRefrigerator2.push(null),w.t4backRefrigerator2.push(null),w.t5evapfanRefrigerator2.push(null),w.t6comprinRefrigerator2.push(null),w.t7comproutRefrigerator2.push(null),w.t8probeRefrigerator2.push(null),w.t3frontRefrigerator3.push(null),w.t4backRefrigerator3.push(null),w.t5evapfanRefrigerator3.push(null),w.t6comprinRefrigerator3.push(null),w.t7comproutRefrigerator3.push(null),w.t8probeRefrigerator3.push(null),w.t3frontRefrigerator4.push(null),w.t4backRefrigerator4.push(null),w.t5evapfanRefrigerator4.push(null),w.t6comprinRefrigerator4.push(null),w.t7comproutRefrigerator4.push(null),w.t8probeRefrigerator4.push(null),O.push(new Date(n)),O.length>1){if(_=Object(l.c)(5,a,n),N="",_.length>1?(P=((new Date).getTime()-_[0].getTime())/1e3,N=(P/=3600)>24?"%m-%d %H:%M":P<.3?"%H:%M:%S":"%H:%M"):N="%H:%M:%S",g.x.lines=[],_.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((V=JSON.parse(JSON.stringify(d.a))).name="Temperatures",V.graphData.columns=[O],V.graphData.x="x",M=0;M<y.length;M++)j=y[M],L=Object(o.g)(j.sensedValue),V.sensedKeys.push(L),V.graphData.columns.push(w[""+L]);D.find(function(e){return e.name==V.name})&&(V.axis.y.tick.values=D.find(function(e){return e.name==V.name}).value,V.axis.y.min=V.axis.y.tick.values[0],V.axis.y.max=V.axis.y.tick.values[V.axis.y.tick.values.length-1]),v&&v.length&&(k=v.find(function(e){return e.graphName==V.name}))&&k.yAxisSettings&&("Fixed"==k.yAxisSettings?(delete V.axis.y.tick.values,V.axis.y.min=k.yAxisMin,V.axis.y.max=k.yAxisMax):"Floating"==k.yAxisSettings&&(delete V.axis.y.tick.values,delete V.axis.y.max,delete V.axis.y.min),V.yAxisSettings=k.yAxisSettings,V.yAxisFixedValues={max:k.yAxisMax,min:k.yAxisMin}),V.axis.y.label="\xb0F",V.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},V.axis.x.tick.format=N,V.axis.x.tick.values=_,V.graphEquipment=this.fetchEquipmentFromPoints(V.name,V.sensedKeys),x.push(V)}else for(R=function(e){var t=r[e],a=JSON.parse(JSON.stringify(d.a)),n=[];if(a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["t3frontRefrigerator1","t4backRefrigerator1","t5evapfanRefrigerator1","t6comprinRefrigerator1","t7comproutRefrigerator1","t8probeRefrigerator1"],n=[O,w.register1,w.t3frontRefrigerator1,w.t4backRefrigerator1,w.t5evapfanRefrigerator1,w.t6comprinRefrigerator1,w.t7comproutRefrigerator1,w.t8probeRefrigerator1]):"Refrigerator 2"==t?(a.sensedKeys=["t3frontRefrigerator2","t4backRefrigerator2","t5evapfanRefrigerator2","t6comprinRefrigerator2","t7comproutRefrigerator2","t8probeRefrigerator2"],n=[O,w.register1,w.t3frontRefrigerator2,w.t4backRefrigerator2,w.t5evapfanRefrigerator2,w.t6comprinRefrigerator2,w.t7comproutRefrigerator2,w.t8probeRefrigerator2]):"Refrigerator 3"==t?(a.sensedKeys=["t3frontRefrigerator3","t4backRefrigerator3","t5evapfanRefrigerator3","t6comprinRefrigerator3","t7comproutRefrigerator3","t8probeRefrigerator3"],n=[O,w.register1,w.t3frontRefrigerator3,w.t4backRefrigerator3,w.t5evapfanRefrigerator3,w.t6comprinRefrigerator3,w.t7comproutRefrigerator3,w.t8probeRefrigerator3]):"Refrigerator 2"==t&&(a.sensedKeys=["t3frontRefrigerator4","t4backRefrigerator4","t5evapfanRefrigerator4","t6comprinRefrigerator4","t7comproutRefrigerator4","t8probeRefrigerator4"],n=[O,w.register1,w.t3frontRefrigerator4,w.t4backRefrigerator4,w.t5evapfanRefrigerator4,w.t6comprinRefrigerator4,w.t7comproutRefrigerator4,w.t8probeRefrigerator4]),D.find(function(e){return e.name==t})&&(a.axis.y.tick.values=D.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),v&&v.length){var i=v.find(function(e){return e.graphName==t});i&&i.yAxisSettings&&("Fixed"==i.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=i.yAxisMin,a.axis.y.max=i.yAxisMax):"Floating"==i.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=i.yAxisSettings,a.yAxisFixedValues={max:i.yAxisMax,min:i.yAxisMin})}a.axis.y.label="\xb0F",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.x.tick.format=N,a.axis.x.tick.values=_,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=F.fetchEquipmentFromPoints(t,a.sensedKeys),x.push(a)},F=this,M=0;M<r.length;M++)R(M);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:g,graphData:x,lastUpdatedAt:f,loading:!1},function(){i&&C.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.showAlarmPoints,d=c.insightRelEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CBW406/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2974:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(715),l=a(803),o=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,l,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(m.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(s.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props.showAlarmPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props.liveGraphRange;if(n&&n.length&&l){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&(c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(l.getTime()-c.graphData.columns[0][2].getTime())/6e4>o&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<l.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),o>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),c.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var g=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:g},function(){if(s){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(o.g)(i.moncontype),(s=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(o.g)(u.moncondevice),g=Object(o.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(o.g)(i.moncondevice),[4,Object(l.a)(t,r)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(o.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(o.g)(r.relatedEquipment)})||i.push({value:Object(o.g)(r.relatedEquipment),label:Object(o.g)(r.relatedEquipmentLabel),space:Object(o.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C,G,K,H,T,Y,B=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,g=p.grid,f=p.graphData,v=p.lastUpdatedAt,x=p.graphYAxisSettings,y=[],c&&(y=u.filter(function(e){return Object(o.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(A=Object(o.g)(t.moncontype),E=Object(o.g)(t.topic),D=d.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!c||c&&y.length?[4,Object(s.l)(E,a,n,!1)]:[3,2]):[3,3];case 1:S=b.sent(),b.label=2;case 2:if(O=["x"],(w={a13comprcurrRefrigerator1:["Compressor Amps"],a14efmcurrRefrigerator1:["EFM Amps"],a15prRefrigerator1:["Compressor Outlet PSI"],a16doorRefrigerator1:["Door Contact"],a13comprcurrRefrigerator2:["Compressor Amps"],a14efmcurrRefrigerator2:["EFM Amps"],a15prRefrigerator2:["Compressor Outlet PSI"],a16doorRefrigerator2:["Door Contact"],register1:["Register"],serialNumber:["Serial Number"],minRecRefresh:["Refresh"],a13comprcurrRefrigerator3:["Compressor Amps"],a14efmcurrRefrigerator3:["EFM Amps"],a15prRefrigerator3:["Compressor Outlet PSI"],a16doorRefrigerator3:["Door Contact"],a13comprcurrRefrigerator4:["Compressor Amps"],a14efmcurrRefrigerator4:["EFM Amps"],a15prRefrigerator4:["Compressor Outlet PSI"],a16doorRefrigerator4:["Door Contact"],amalgamatedWattsRefrigerator1:["Amalgamated Watts"],amalgamatedWattsRefrigerator2:["Amalgamated Watts"],amalgamatedWattsRefrigerator3:["Amalgamated Watts"],amalgamatedWattsRefrigerator4:["Amalgamated Watts"]}).a13comprcurrRefrigerator1.push(null),w.a14efmcurrRefrigerator1.push(null),w.a15prRefrigerator1.push(null),w.a16doorRefrigerator1.push(null),w.a13comprcurrRefrigerator2.push(null),w.a14efmcurrRefrigerator2.push(null),w.a15prRefrigerator2.push(null),w.a16doorRefrigerator2.push(null),w.a13comprcurrRefrigerator3.push(null),w.a14efmcurrRefrigerator3.push(null),w.a15prRefrigerator3.push(null),w.a16doorRefrigerator3.push(null),w.a13comprcurrRefrigerator4.push(null),w.a14efmcurrRefrigerator4.push(null),w.a15prRefrigerator4.push(null),w.a16doorRefrigerator4.push(null),w.register1.push(null),w.serialNumber.push(null),w.minRecRefresh.push(null),w.amalgamatedWattsRefrigerator1.push(null),w.amalgamatedWattsRefrigerator2.push(null),w.amalgamatedWattsRefrigerator3.push(null),w.amalgamatedWattsRefrigerator4.push(null),O.push(new Date(a)),_=!1,N=!1,P=!1,V=!1,S.length>0&&S.forEach(function(e){e&&(w.a13comprcurrRefrigerator1.push(""+e.a13comprcurrRefrigerator1||null),w.a14efmcurrRefrigerator1.push(""+e.a14efmcurrRefrigerator1||null),w.a15prRefrigerator1.push(""+e.a15prRefrigerator1||null),w.a16doorRefrigerator1.push(""+e.a16doorRefrigerator1||null),w.a13comprcurrRefrigerator2.push(""+e.a13comprcurrRefrigerator2||null),w.a14efmcurrRefrigerator2.push(""+e.a14efmcurrRefrigerator2||null),w.a15prRefrigerator2.push(""+e.a15prRefrigerator2||null),w.a16doorRefrigerator2.push(""+e.a16doorRefrigerator2||null),w.a13comprcurrRefrigerator3.push(""+e.a13comprcurrRefrigerator3||null),w.a14efmcurrRefrigerator3.push(""+e.a14efmcurrRefrigerator3||null),w.a15prRefrigerator3.push(""+e.a15prRefrigerator3||null),w.a16doorRefrigerator3.push(""+e.a16doorRefrigerator3||null),w.a13comprcurrRefrigerator4.push(""+e.a13comprcurrRefrigerator4||null),w.a14efmcurrRefrigerator4.push(""+e.a14efmcurrRefrigerator4||null),w.a15prRefrigerator4.push(""+e.a15prRefrigerator4||null),w.a16doorRefrigerator4.push(""+e.a16doorRefrigerator4||null),w.register1.push(""+e.register1||null),w.serialNumber.push(""+e.serialNumber||null),w.minRecRefresh.push(""+e.minRecRefresh||null),w.amalgamatedWattsRefrigerator1.push(""+360*e.a13comprcurrRefrigerator1||"0"),w.amalgamatedWattsRefrigerator2.push(""+360*e.a13comprcurrRefrigerator2||"0"),w.amalgamatedWattsRefrigerator3.push(""+360*e.a13comprcurrRefrigerator3||"0"),w.amalgamatedWattsRefrigerator4.push(""+360*e.a13comprcurrRefrigerator4||"0"),O.push(new Date(e.timestamp)),_=e.a14efmcurrRefrigerator1<-5,N=e.a14efmcurrRefrigerator2<-5,P=e.a14efmcurrRefrigerator3<-5,V=e.a14efmcurrRefrigerator4<-5)}),v=S.length>0?null===(Y=O[O.length-1])||void 0===Y?void 0:Y.toLocaleString():"No Data",w.a13comprcurrRefrigerator1.push(null),w.a14efmcurrRefrigerator1.push(null),w.a15prRefrigerator1.push(null),w.a16doorRefrigerator1.push(null),w.a13comprcurrRefrigerator2.push(null),w.a14efmcurrRefrigerator2.push(null),w.a15prRefrigerator2.push(null),w.a16doorRefrigerator2.push(null),w.a13comprcurrRefrigerator3.push(null),w.a14efmcurrRefrigerator3.push(null),w.a15prRefrigerator3.push(null),w.a16doorRefrigerator3.push(null),w.a13comprcurrRefrigerator4.push(null),w.a14efmcurrRefrigerator4.push(null),w.a15prRefrigerator4.push(null),w.a16doorRefrigerator4.push(null),w.register1.push(null),w.serialNumber.push(null),w.minRecRefresh.push(null),w.amalgamatedWattsRefrigerator1.push(null),w.amalgamatedWattsRefrigerator2.push(null),w.amalgamatedWattsRefrigerator3.push(null),w.amalgamatedWattsRefrigerator4.push(null),O.push(new Date(n)),O.length>1){if(j=Object(l.c)(5,a,n),L="",j.length>1?(k=((new Date).getTime()-j[0].getTime())/1e3,L=(k/=3600)>24?"%m-%d %H:%M":k<.3?"%H:%M:%S":"%H:%M"):L="%H:%M:%S",g.x.lines=[],j.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((R=JSON.parse(JSON.stringify(d.a))).name="Analog Values",R.graphData.columns=[O],R.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},R.axis.x.tick.format=L,R.axis.x.tick.values=j,R.graphData.x="x",F="",T=0;T<y.length;T++)M=y[T],q=Object(o.g)(M.sensedValue),R.sensedKeys.push(q),R.graphData.columns.push(w[""+q]),F=q.substr(q.length-1);R.graphEquipment=this.fetchEquipmentFromPoints(R.name,R.sensedKeys),C="1"==F?_:"2"==F?_:"3"==F?P:"4"==F&&V,D.find(function(e){return e.name==R.name})&&(R.axis.y.tick.values=C?D.find(function(e){return e.name==R.name}).value2:D.find(function(e){return e.name==R.name}).value,R.axis.y.min=R.axis.y.tick.values[0],R.axis.y.max=R.axis.y.tick.values[R.axis.y.tick.values.length-1]),x&&x.length&&(G=x.find(function(e){return e.graphName==R.name}))&&G.yAxisSettings&&("Fixed"==G.yAxisSettings?(delete R.axis.y.tick.values,R.axis.y.min=G.yAxisMin,R.axis.y.max=G.yAxisMax):"Floating"==G.yAxisSettings&&(delete R.axis.y.tick.values,delete R.axis.y.max,delete R.axis.y.min),R.yAxisSettings=G.yAxisSettings,R.yAxisFixedValues={max:G.yAxisMax,min:G.yAxisMin}),R.axis.y.label="Amps,PSI",f.push(R)}else for(K=function(e){var t=r[e],a=JSON.parse(JSON.stringify(d.a)),n=[];if(a.name=t,"Refrigerator 1"==t?(a.sensedKeys=["a13comprcurrRefrigerator1","a14efmcurrRefrigerator1","a15prRefrigerator1","a16doorRefrigerator1"],n=[O,w.a13comprcurrRefrigerator1,w.a14efmcurrRefrigerator1,w.a15prRefrigerator1,w.a16doorRefrigerator1]):"Refrigerator 2"==t?(a.sensedKeys=["a13comprcurrRefrigerator2","a14efmcurrRefrigerator2","a15prRefrigerator2","a16doorRefrigerator2"],n=[O,w.a13comprcurrRefrigerator2,w.a14efmcurrRefrigerator2,w.a15prRefrigerator2,w.a16doorRefrigerator2]):"Refrigerator 3"==t?(a.sensedKeys=["a13comprcurrRefrigerator3","a14efmcurrRefrigerator3","a15prRefrigerator3","a16doorRefrigerator3"],n=[O,w.a13comprcurrRefrigerator3,w.a14efmcurrRefrigerator3,w.a15prRefrigerator3,w.a16doorRefrigerator3]):"Refrigerator 4"==t&&(a.sensedKeys=["a13comprcurrRefrigerator4","a14efmcurrRefrigerator4","a15prRefrigerator4","a16doorRefrigerator4"],n=[O,w.a13comprcurrRefrigerator4,w.a14efmcurrRefrigerator4,w.a15prRefrigerator4,w.a16doorRefrigerator4]),D.find(function(e){return e.name==t})){var i=!1;"Refrigerator 1"==t?i=_:"Refrigerator 2"==t?i=N:"Refrigerator 3"==t?i=P:"Refrigerator 4"==t&&(i=V),a.axis.y.tick.values=i?D.find(function(e){return e.name==t}).value2:D.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]}if(x&&x.length){var s=x.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.label="Amps,PSI",a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},a.axis.x.tick.format=L,a.axis.x.tick.values=j,a.graphData.x="x",a.graphData.columns=n,a.graphEquipment=H.fetchEquipmentFromPoints(t,a.sensedKeys),f.push(a)},H=this,T=0;T<r.length;T++)K(T);this.props.loadNextInsight(),Object(h.h)(E,this.callLiveUpdate),this.setState({grid:g,graphData:f,lastUpdatedAt:v,loading:!1},function(){i&&B.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.showAlarmPoints,g=c.device,d=c.insightRelEquipment,f=c.isEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c,v="";return h&&t.alarmStatus&&("active"==t.alarmStatus?v="alarm-graph":"ack"==t.alarmStatus?v="alarm-ack-graph":"clear"==t.alarmStatus&&(v="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+v,id:"divGraphs"},n.createElement("br",null),(h||u)&&n.createElement("div",{className:"alarm-limit-select"},h&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(g.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/CompressorControl/"+Object(o.g)(g.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},f?t.name:t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(g.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(g.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(g.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(g.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:h&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2975:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(707),l=a(11),o=a(803),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(l.g)(e)&&Object(h.g)(Object(l.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,o,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(m.a)(!0),r&&!e?[3,2]:(o=[],i&&i.length&&i.forEach(function(e){o.push({sensedValue:Object(l.g)(e.sensedValue),maximumExtremeValue:Object(l.g)(e.maximumExtremeValue),maximumNormalValue:Object(l.g)(e.maximumNormalValue),minimumExtremeValue:Object(l.g)(e.minimumExtremeValue),minimumNormalValue:Object(l.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(l.g)(e.ifMaximumExtremeValue)||"true"!=Object(l.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(l.g)(e.ifMaximumNormalValue)||"true"!=Object(l.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(l.g)(e.ifMinimumExtremeValue)||"true"!=Object(l.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(l.g)(e.ifMinimumNormalValue)||"true"!=Object(l.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(l.g)(s.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:o,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===o||void 0===o?void 0:o.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this.state,a=t.graphData,n=t.grid,i=new Date;e["@timestamp"]&&(i=new Date(e["@timestamp"]),i=new Date(i.setHours(i.getHours()+10)));var r=this.props.liveGraphRange,l=Object(s.a)(parseInt(null===e||void 0===e?void 0:e.v4relay_state));3==l.length?l="0"+l:2==l.length?l="00"+l:1==l.length&&(l="000"+l);var o=l[3],u=l[2],c=l[1],m=l[0];if(a&&a.length&&i){for(var p=0;p<a.length;p++){var h=a[p];if(h.graphData.columns&&h.graphData.columns.length){if(h.graphData.columns[0].push(i),e&&Object.keys(e).length)for(var g=Object.keys(e),d=function(t){var a=g[t],n=1;h.sensedKeys&&h.sensedKeys.length&&h.sensedKeys.find(function(e){return e==a})&&("v4relay_state"==a?(h.graphData.columns[8].splice(1,1),h.graphData.columns[8].push(o||"0"),h.graphData.columns[9].splice(1,1),h.graphData.columns[9].push(u||"0"),h.graphData.columns[10].splice(1,1),h.graphData.columns[10].push(c||"0"),h.graphData.columns[11].splice(1,1),h.graphData.columns[11].push(m||"0")):(h.graphData.columns[n].splice(1,1),h.graphData.columns[n].push(e[a]),n++))},f=0;f<g.length;f++)d(f);(i.getTime()-h.graphData.columns[0][2].getTime())/6e4>r&&h.graphData.columns[0].splice(1,1),h.axis.x.tick.values[2]&&h.axis.x.tick.values[1].getTime()&&h.axis.x.tick.values[2].getTime()-h.axis.x.tick.values[1].getTime()<i.getTime()-h.axis.x.tick.values[h.axis.x.tick.values.length-1]&&(h.axis.x.tick.values.splice(0,1),n.x.lines.splice(0,1),i.setSeconds(0),r>10&&i.setMinutes(i.getMinutes()-i.getMinutes()%5),h.axis.x.tick.values.push(i),n.x.lines.push({value:i,class:"grid4"}))}}var v=null===i||void 0===i?void 0:i.toLocaleString();this.setState({grid:n,graphData:a,lastUpdatedAt:v})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,o=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(l.g)(i.moncontype),(s=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){o.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(l.g)(u.moncondevice),g=Object(l.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(o.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(l.g)(i.moncondevice),[4,Object(o.a)(t,r)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(l.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(l.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(l.g)(r.relatedEquipment)})||i.push({value:Object(l.g)(r.relatedEquipment),label:Object(l.g)(r.relatedEquipmentLabel),space:Object(l.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C,G,K,H,T,Y,B,U,W,I,z=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.devicePoints,u=e.isEquipment,c=e.equipment,m=this.state,p=m.grid,g=m.graphData,f=m.lastUpdatedAt,v=m.graphYAxisSettings,x=[],u&&(x=r.filter(function(e){return Object(l.g)(e.relatedEquipment)==c.ontology})),t&&t.moncondevice?(y=Object(l.g)(t.moncontype),A=Object(l.g)(t.topic),E=Object(l.g)(t.moncondevice),D=d.b.filter(function(e){return y.toLowerCase().indexOf(e.type.toLowerCase())>-1}),S=[],!u||u&&x.length?[4,Object(s.h)(A,a,n,!1)]:[3,2]):[3,4];case 1:S=b.sent(),b.label=2;case 2:return[4,Object(s.z)(E)];case 3:if(w=b.sent(),O=[],w[0]?(_=w[0],N=Object(l.g)(_.relayNames),O=N.split(",")):(O.push("Relay 1"),O.push("Relay 2"),O.push("Relay 3"),O.push("Relay 4")),P={mAmps_relay1:[O[0]+" Amp"],mAmps_relay2:[O[1]+" Amp"],mAmps_relay3:[O[2]+" Amp"],mAmps_relay4:[O[3]+" Amp"],nominal_src_volts:["Nom. Source Volts"],power_Wt_relay1:[O[0]+" Watts"],power_Wt_relay2:[O[1]+" Watts"],power_Wt_relay3:[O[2]+" Watts"],Relay1_State:[O[0]+" State"],Relay2_State:[O[1]+" State"],Relay3_State:[O[2]+" State"],Relay4_State:[O[3]+" State"]},V=["x"],P.mAmps_relay1.push(null),P.mAmps_relay2.push(null),P.mAmps_relay3.push(null),P.mAmps_relay4.push(null),P.nominal_src_volts.push(null),P.power_Wt_relay1.push(null),P.power_Wt_relay2.push(null),P.power_Wt_relay3.push(null),P.Relay1_State.push(null),P.Relay2_State.push(null),P.Relay3_State.push(null),P.Relay4_State.push(null),V.push(new Date(a)),S.length>0)for(W=0;W<S.length;W++)(null===(j=S[W])||void 0===j?void 0:j.mAmps_relay1)&&(P.mAmps_relay1.push(j.mAmps_relay1||"0"),P.mAmps_relay2.push(j.mAmps_relay2||"0"),P.mAmps_relay3.push(j.mAmps_relay3||"0"),P.mAmps_relay4.push(j.mAmps_relay4||"0"),P.nominal_src_volts.push(j.nominal_src_volts||"0"),P.power_Wt_relay1.push(j.power_Wt_relay1||"0"),P.power_Wt_relay2.push(j.power_Wt_relay2||"0"),P.power_Wt_relay3.push(j.power_Wt_relay3||"0"),L=Object(s.a)(parseInt(j.v4relay_state)),V.push(new Date(j.timestamp)),3==L.length?L="0"+L:2==L.length?L="00"+L:1==L.length&&(L="000"+L),k=L[3],R=L[2],F=L[1],M=L[0],P.Relay1_State.push(k||"0"),P.Relay2_State.push(R||"0"),P.Relay3_State.push(F||"0"),P.Relay4_State.push(M||"0"));if(f=S.length>0?null===(I=V[V.length-1])||void 0===I?void 0:I.toLocaleString():"No Data",P.mAmps_relay1.push(null),P.mAmps_relay2.push(null),P.mAmps_relay3.push(null),P.mAmps_relay4.push(null),P.nominal_src_volts.push(null),P.power_Wt_relay1.push(null),P.power_Wt_relay2.push(null),P.power_Wt_relay3.push(null),P.Relay1_State.push(null),P.Relay2_State.push(null),P.Relay3_State.push(null),P.Relay4_State.push(null),V.push(new Date(n)),V.length>1){if(q=Object(o.c)(5,a,n),C="",q.length>1?(G=((new Date).getTime()-q[0].getTime())/1e3,C=(G/=3600)>24?"%m-%d %H:%M":G<.3?"%H:%M:%S":"%H:%M"):C="%H:%M:%S",p.x.lines=[],q.forEach(function(e){p.x.lines.push({value:e,class:"grid4"})}),u){for((K=JSON.parse(JSON.stringify(d.a))).name="Relay V4",K.graphData.columns=[V],K.axis.x.tick.format=C,K.axis.x.tick.values=q,K.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},K.graphData.x="x",W=0;W<x.length;W++)H=x[W],T=Object(l.g)(H.sensedValue),K.sensedKeys.push(T),"v4relay_state"==T?(K.graphData.columns.push(P.Relay1_State),K.graphData.columns.push(P.Relay2_State),K.graphData.columns.push(P.Relay3_State),K.graphData.columns.push(P.Relay4_State)):K.graphData.columns.push(P[""+T]);D.find(function(e){return e.name==K.name})&&(K.axis.y.tick.values=D.find(function(e){return e.name==K.name}).value,K.axis.y.min=K.axis.y.tick.values[0],K.axis.y.max=K.axis.y.tick.values[K.axis.y.tick.values.length-1]),v&&v.length&&(Y=v.find(function(e){return e.graphName==K.name}))&&Y.yAxisSettings&&("Fixed"==Y.yAxisSettings?(delete K.axis.y.tick.values,K.axis.y.min=Y.yAxisMin,K.axis.y.max=Y.yAxisMax):"Floating"==Y.yAxisSettings&&(delete K.axis.y.tick.values,delete K.axis.y.max,delete K.axis.y.min),K.yAxisSettings=Y.yAxisSettings,K.yAxisFixedValues={max:Y.yAxisMax,min:Y.yAxisMin}),K.graphEquipment=this.fetchEquipmentFromPoints(K.name,K.sensedKeys),g.push(K)}else for(B=function(e){var t,a="Relay V4",n=JSON.parse(JSON.stringify(d.a));if(n.name=a,n.axis.y.label="Amp, W, On/Off, Volts",n.sensedKeys=["mAmps_relay1","mAmps_relay2","mAmps_relay3","mAmps_relay4","power_Wt_relay1","power_Wt_relay2","power_Wt_relay3","v4relay_state","nominal_src_volts"],t=[V,P.mAmps_relay1,P.mAmps_relay2,P.mAmps_relay3,P.mAmps_relay4,P.power_Wt_relay1,P.power_Wt_relay2,P.power_Wt_relay3,P.Relay1_State,P.Relay2_State,P.Relay3_State,P.Relay4_State,P.nominal_src_volts],D.find(function(e){return e.name==a})&&(n.axis.y.tick.values=D.find(function(e){return e.name==a}).value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1]),v&&v.length){var i=v.find(function(e){return e.graphName==a});i&&i.yAxisSettings&&("Fixed"==i.yAxisSettings?(delete n.axis.y.tick.values,n.axis.y.min=i.yAxisMin,n.axis.y.max=i.yAxisMax):"Floating"==i.yAxisSettings&&(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min),n.yAxisSettings=i.yAxisSettings,n.yAxisFixedValues={max:i.yAxisMax,min:i.yAxisMin})}n.axis.y.tick.format=function(e){return parseFloat(e).toFixed(0)},n.axis.x.tick.format=C,n.axis.x.tick.values=q,n.graphData.x="x",n.graphData.columns=t,n.graphEquipment=U.fetchEquipmentFromPoints(a,n.sensedKeys),g.push(n)},U=this,W=0;W<1;W++)B(W);this.props.loadNextInsight(),Object(h.h)(A,this.callLiveUpdate),this.setState({grid:p,graphData:g,lastUpdatedAt:f,loading:!1},function(){i&&z.changeAlarmStatus(!0)})}b.label=4;case 4:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,o=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.insightRelEquipment,d=c.showAlarmPoints;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==o?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c="";return d&&t.alarmStatus&&("active"==t.alarmStatus?c="alarm-graph":"ack"==t.alarmStatus?c="alarm-ack-graph":"clear"==t.alarmStatus&&(c="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+c,id:"divGraphs"},n.createElement("br",null),(d||u)&&n.createElement("div",{className:"alarm-limit-select"},d&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/RelayControl/"+Object(l.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(l.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(l.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",g.map(function(e,t){return e.rdfsLabel+(t<g.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(l.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(l.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",o)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2976:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(772)),r=a.n(i),s=a(715),l=a(803),o=a(11),u=a(837),c=a(796),m=a(122),p=a(736),h=a(124),g=a(760),d=(a.n(g),a(857)),f=a(20),v=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),x=this&&this.__assign||function(){return(x=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},b=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},A=function(e){function t(t){var a=e.call(this,t)||this;return a.state={graphData:[],grid:{x:{lines:[{}]},y:{show:!0}},loading:!0,lastUpdatedAt:"No Data",deviceAlarms:[],alarmSensedPoints:[],enableYAxis:a.props.enableYAxis,graphYAxisSettings:[]},a._fetchData=a._fetchData.bind(a),a.callLiveUpdate=a.callLiveUpdate.bind(a),a}return v(t,e),t.prototype.componentDidMount=function(){return y(this,void 0,void 0,function(){var e=this;return b(this,function(t){switch(t.label){case 0:return window.addEventListener("ShowAlarms",function(){return e.changeAlarmStatus()}),window.addEventListener("reLoadGraph",function(){var t=e.state,a=t.graphData;!t.loading&&a&&a.length>0&&e.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return e.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),[4,this.fetchGraphYAxisSettings()];case 1:return t.sent(),this._fetchData(),[2]}})})},t.prototype.componentWillUnmount=function(){return y(this,void 0,void 0,function(){var e,t=this;return b(this,function(a){return e=this.props.device.topic,window.removeEventListener("ShowAlarms",function(e){return t.changeAlarmStatus()}),window.removeEventListener("reLoadGraph",function(){var e=t.state,a=e.graphData;!e.loading&&a&&a.length>0&&t.setState({graphData:a.map(function(e){return e.loading=!0,e})},function(){return t.setState({graphData:a.map(function(e){return e.loading=!1,e})})})}),Object(o.g)(e)&&Object(h.g)(Object(o.g)(e)),[2]})})},t.prototype.UNSAFE_componentWillReceiveProps=function(e,t){this.setState({enableYAxis:e.enableYAxis})},t.prototype.changeAlarmStatus=function(e){return y(this,void 0,void 0,function(){var t,a,n,i,r,s,l,u,h,g,d,f,v,x=this;return b(this,function(y){switch(y.label){case 0:return t=this.state.graphData,a=this.props,n=a.buildingName,i=a.devicePoints,r=a.showAlarmPoints,s=a.device,Object(m.a)(!0),r&&!e?[3,2]:(l=[],i&&i.length&&i.forEach(function(e){l.push({sensedValue:Object(o.g)(e.sensedValue),maximumExtremeValue:Object(o.g)(e.maximumExtremeValue),maximumNormalValue:Object(o.g)(e.maximumNormalValue),minimumExtremeValue:Object(o.g)(e.minimumExtremeValue),minimumNormalValue:Object(o.g)(e.minimumNormalValue),generateMaximumExtremeValue:!(!Object(o.g)(e.ifMaximumExtremeValue)||"true"!=Object(o.g)(e.ifMaximumExtremeValue)),generateMaximumNormalValue:!(!Object(o.g)(e.ifMaximumNormalValue)||"true"!=Object(o.g)(e.ifMaximumNormalValue)),generateMinimumExtremeValue:!(!Object(o.g)(e.ifMinimumExtremeValue)||"true"!=Object(o.g)(e.ifMinimumExtremeValue)),generateMinimumNormalValue:!(!Object(o.g)(e.ifMinimumNormalValue)||"true"!=Object(o.g)(e.ifMinimumNormalValue))})}),[4,Object(c.e)(p.a.OperationalAlarm,n,!1,0,50,null,null,[Object(o.g)(s.moncondevice)],null)]);case 1:return u=y.sent(),t&&t.length&&t[0]&&t[0].graphData&&t[0].graphData.columns.length>1&&(h=t[0].graphData.columns,g=new Date(h[0][1]),u=u.filter(function(e){return new Date(e.timeofalarm)>g})),this.setState({alarmSensedPoints:l,deviceAlarms:u},function(){var e=t[0].graphData.columns;if((null===l||void 0===l?void 0:l.length)>0&&e.length>1){for(var a=[],n=0;n<t.length;n++){var i=t[n],r=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:i.sensedKeys&&i.sensedKeys.length>0?i.sensedKeys[i.sensedKeys.length-1]:"";a.push(x.selectAlarmPoint(i,r,!1))}x.setState({graphData:a})}}),[3,3];case 2:for(d=[],f=0;f<t.length;f++)v=t[f],d.push(this.selectAlarmPoint(v,"",!1));this.setState({graphData:d}),y.label=3;case 3:return Object(m.a)(!1),[2]}})})},t.prototype.selectAlarmPoint=function(e,t,a){var n=this;return e&&e.graphData&&e.graphData.columns&&e.graphData.columns.length&&this.setState({loading:!0},function(){var i,r,s=n.state,l=s.alarmSensedPoints,o=s.deviceAlarms,c=s.graphData,m=l.find(function(e){return e.sensedValue===t}),p=e.sensedKeys&&e.sensedKeys.length&&o.length>0&&o.find(function(t){return e.sensedKeys.includes(t.sensedValueKey)});if(e.graphDataAlarmPoint={x:"x",columns:[],regions:{},colors:{}},m){for(var h=!0,g=0;g<e.sensedKeys.length;g++){var d=e.sensedKeys[g];if(t==d){h=!1;for(var f=["Low-Low"],v=["Low"],y=["High"],b=["High-High"],A=0;A<e.graphData.columns[0].length-1;A++)f.push(m.minimumExtremeValue),v.push(m.minimumNormalValue),y.push(m.maximumNormalValue),b.push(m.maximumExtremeValue);e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],f,v,e.graphData.columns[g+1],y,b],regions:{"Low-Low":[{style:"dashed"}],Low:[{style:"dashed"}],High:[{style:"dashed"}],"High-High":[{style:"dashed"}]},colors:(i={"Low-Low":"red",Low:"grey"},i[e.graphData.columns[g+1][0]]="#e3e3e3",i.High="grey",i["High-High"]="red",i)},e.graphDataAlarmPoint.columns&&e.graphDataAlarmPoint.columns.length&&e.graphDataAlarmPoint.regions&&e.graphDataAlarmPoint.colors&&(!m.generateMaximumExtremeValue&&e.graphDataAlarmPoint.columns[5]&&(e.graphDataAlarmPoint.columns.splice(5,1),delete e.graphDataAlarmPoint.regions["High-High"],delete e.graphDataAlarmPoint.colors["High-High"]),!m.generateMaximumNormalValue&&e.graphDataAlarmPoint.columns[4]&&(e.graphDataAlarmPoint.columns.splice(4,1),delete e.graphDataAlarmPoint.regions.High,delete e.graphDataAlarmPoint.colors.High),!m.generateMinimumExtremeValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions["Low-Low"],delete e.graphDataAlarmPoint.colors["Low-Low"]),!m.generateMinimumNormalValue&&e.graphDataAlarmPoint.columns[1]&&(e.graphDataAlarmPoint.columns.splice(1,1),delete e.graphDataAlarmPoint.regions.Low,delete e.graphDataAlarmPoint.colors.Low))}}h&&(e.graphDataAlarmPoint=e.graphData),e.selectedAlarmPoint=m,e.alarmStatus=p?!p.archived&&p.acknowledge?p.clearable?"clear":"ack":"active":"",c.forEach(function(t){t.name==e.name&&(t=x({},e))}),a?n.setState({graphData:c,loading:!1}):n.setState({loading:!1})}else{e.selectedAlarmPoint=u.a,e.selectedAlarmPoint.sensedValue=t;for(g=0;g<e.sensedKeys.length;g++){d=e.sensedKeys[g];t==d&&(e.graphDataAlarmPoint={x:"x",columns:[e.graphData.columns[0],e.graphData.columns[g+1]],colors:(r={},r[e.graphData.columns[g+1][0]]="#e3e3e3",r)})}if(a){var E=n.state.graphData;E.forEach(function(t){t.name==e.name&&(t=x({},e))}),n.setState({graphData:E,loading:!1})}else n.setState({loading:!1})}}),e},t.prototype.callLiveUpdate=function(e){var t=this,a=this.state,n=a.graphData,i=a.grid,r=a.alarmSensedPoints,s=this.props.showAlarmPoints,l=new Date;e["@timestamp"]&&(l=new Date(e["@timestamp"]),l=new Date(l.setHours(l.getHours()+10)));var o=this.props.liveGraphRange;if(n&&n.length&&l){for(var u=0;u<n.length;u++){var c=n[u];if(c.graphData.columns&&c.graphData.columns.length){if(c.graphData.columns[0].push(l),e&&Object.keys(e).length)for(var m=Object.keys(e),p=function(t){var a=m[t],n=1;c.sensedKeys&&c.sensedKeys.length&&c.sensedKeys.find(function(e){return e==a})&&("EnergySumNR"==a||"EnergyPosSumNR"==a?c.graphData.columns[n].push(parseFloat(e[""+a])/1e3):c.graphData.columns[n].push(e[a]),n++,c.graphData.columns[n].splice(1,1))},h=0;h<m.length;h++)p(h);(l.getTime()-c.graphData.columns[0][2].getTime())/6e4>o&&c.graphData.columns[0].splice(1,1),c.axis.x.tick.values[2]&&c.axis.x.tick.values[1].getTime()&&c.axis.x.tick.values[2].getTime()-c.axis.x.tick.values[1].getTime()<l.getTime()-c.axis.x.tick.values[c.axis.x.tick.values.length-1]&&(c.axis.x.tick.values.splice(0,1),i.x.lines.splice(0,1),l.setSeconds(0),o>10&&l.setMinutes(l.getMinutes()-l.getMinutes()%5),c.axis.x.tick.values.push(l),i.x.lines.push({value:l,class:"grid4"}))}}var g=null===l||void 0===l?void 0:l.toLocaleString();this.setState({grid:i,graphData:n,lastUpdatedAt:g},function(){if(s){for(var e=[],a=function(a){var i=n[a],s=i.sensedKeys&&i.sensedKeys.length&&r.length>0&&r.filter(function(e){return i.sensedKeys.includes(e.sensedValue)}),l=i.selectedAlarmPoint.sensedValue.length>1?i.selectedAlarmPoint.sensedValue:(null===s||void 0===s?void 0:s.length)>0?s[s.length-1].sensedValue:"";e.push(t.selectAlarmPoint(i,l,!1))},i=0;i<n.length;i++)a(i);t.setState({graphData:e})}})}},t.prototype.changeYAxisSettings=function(e,t){return y(this,void 0,void 0,function(){var a,n,i,r,s,l=this;return b(this,function(u){switch(u.label){case 0:return a=this.state.graphData,(n=a.find(function(t){return t.name==e})).yAxisSettings=t,"Floating"==t?(delete n.axis.y.tick.values,delete n.axis.y.max,delete n.axis.y.min):"Fixed"==t?(delete n.axis.y.tick.values,n.axis.y.max=n.yAxisFixedValues.max,n.axis.y.min=n.yAxisFixedValues.min):(i=this.props.device,r=Object(o.g)(i.moncontype),(s=d.b.find(function(t){return r.toLowerCase().indexOf(t.type.toLowerCase())>-1&&t.name==e}))&&s.value&&(n.axis.y.tick.values=s.value,n.axis.y.min=n.axis.y.tick.values[0],n.axis.y.max=n.axis.y.tick.values[n.axis.y.tick.values.length-1])),[4,this.updateYAxisSettingsDB(e,t,n.axis.y.min,n.axis.y.max)];case 1:return u.sent(),this.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){l.setState({graphData:a.map(function(t){return t.name==e&&(t.loading=!1),t})})}),[2]}})})},t.prototype.changeYaxisMinMax=function(e,t,a,n){var i=this,r=this.state.graphData,s=r.find(function(t){return t.name==e});a?(s.yAxisFixedValues.min=t,s.axis.y.min=t):(s.yAxisFixedValues.max=t,s.axis.y.max=t),n?this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!0),t})},function(){return y(i,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return delete s.axis.y.tick.values,[4,this.updateYAxisSettingsDB(e,"Fixed",s.axis.y.min,s.axis.y.max)];case 1:return t.sent(),this.setState({graphData:r.map(function(t){return t.name==e&&(t.loading=!1),t})}),[2]}})})}):this.setState({graphData:r})},t.prototype.updateYAxisSettingsDB=function(e,t,a,n){return y(this,void 0,void 0,function(){var i,r,s,u,c,m,p,h,g,d,v,x,y,A=this;return b(this,function(b){switch(b.label){case 0:return i=this.props,r=i.instance,s=i.buildingName,u=i.device,c=i.isEquipment,m=i.equipment,p=this.state.graphYAxisSettings,h="",g="",d="",c?(d="equipment",h=m.ontology,g=m.rdfsLabel):(d="device",h=Object(o.g)(u.moncondevice),g=Object(o.g)(u.rdfsLabel)),v=p.find(function(t){return t.graphName==e}),x=Object(f.F)(12),v&&v.ontology&&(x=v.ontology),y={instance:r,building:s,ontology:x,assetOntology:h,ontologyLabel:g,ontologyAssetType:d,graphName:e,yAxisMax:n,yAxisMin:a,yAxisSettings:t},[4,Object(l.b)(y).then(function(){A.fetchGraphYAxisSettings()})];case 1:return b.sent(),[2]}})})},t.prototype.fetchGraphYAxisSettings=function(){return y(this,void 0,void 0,function(){var e,t,a,n,i,r,s;return b(this,function(u){switch(u.label){case 0:return e=this.props,t=e.buildingName,a=e.isEquipment,n=e.equipment,i=e.device,r=a?n.ontology:Object(o.g)(i.moncondevice),[4,Object(l.a)(t,r)];case 1:return s=u.sent(),this.setState({graphYAxisSettings:s}),[2]}})})},t.prototype.fetchEquipmentFromPoints=function(e,t){var a=this.props.devicePoints,n=Object(),i=[];if(a&&a.length>0)for(var r=function(e){var n=t[e],r=a.find(function(e){return Object(o.g)(e.sensedValue).toLowerCase()==n.toLowerCase()});!r||!Object(o.g)(r.point)||i&&i.length&&i.find(function(e){return e.value==Object(o.g)(r.relatedEquipment)})||i.push({value:Object(o.g)(r.relatedEquipment),label:Object(o.g)(r.relatedEquipmentLabel),space:Object(o.g)(r.relatedEquipmentSpaceLabel)})},s=0;s<t.length;s++)r(s);return n.graph=e,n.pointEquip=i,n},t.prototype._fetchData=function(){var e=this;this.setState({loading:!0},function(){return y(e,void 0,void 0,function(){var e,t,a,n,i,r,u,c,m,p,g,f,v,x,y,A,E,D,S,w,O,_,N,P,V,j,L,k,R,F,M,q,C,G=this;return b(this,function(b){switch(b.label){case 0:return e=this.props,t=e.device,a=e.from,n=e.to,i=e.showAlarmPoints,r=e.graphsList,u=e.devicePoints,c=e.isEquipment,m=e.equipment,p=this.state,g=p.grid,f=p.graphData,v=p.lastUpdatedAt,x=p.graphYAxisSettings,y=[],c&&(y=u.filter(function(e){return Object(o.g)(e.relatedEquipment)==m.ontology})),t&&t.moncondevice?(A=Object(o.g)(t.moncontype),E=Object(o.g)(t.topic),D=d.b.filter(function(e){return A.toLowerCase().indexOf(e.type.toLowerCase())>-1}),(S=E?E.split(","):[]).length&&S[0]?(w=[],!c||c&&y.length?[4,Object(s.n)(S[0],a,n)]:[3,2]):[3,3]):[3,3];case 1:w=b.sent(),b.label=2;case 2:if(_=["x"],(O={EnergySum:["Enerygy Sum"],EnergyPosSum:["Energy POS SUM"],EnergySumNR:["Energy Sum NR"],EnergyPosSumNR:["Energy Pos Sum NR"],PowerSum:["Power Sum"],PowerA:["Power A"],PowerB:["Power B"],PowerC:["Power C"],VoltA:["Volts A"],VoltB:["Volts B"],VoltC:["Volts C"],VoltAvgLL:["Volts Avg LL"],VoltAB:["Volts AB"],VoltAC:["Volts AC"],VoltBC:["Volts BC"],Freq:["Frequency"]}).EnergySum.push(null),O.EnergyPosSum.push(null),O.EnergySumNR.push(null),O.EnergyPosSumNR.push(null),O.PowerSum.push(null),O.PowerA.push(null),O.PowerB.push(null),O.PowerC.push(null),O.VoltA.push(null),O.VoltB.push(null),O.VoltC.push(null),O.VoltAvgLL.push(null),O.VoltAB.push(null),O.VoltAC.push(null),O.VoltBC.push(null),O.Freq.push(null),_.push(new Date(a)),w.length>0&&w.forEach(function(e){e&&(O.EnergySum.push(e.EnergySum||"0"),O.EnergyPosSum.push(e.EnergyPosSum||"0"),O.EnergySumNR.push(""+ +e.EnergySumNR/1e3||"0"),O.EnergyPosSumNR.push(""+ +e.EnergyPosSumNR/1e3||"0"),O.PowerSum.push(e.PowerSum||"0"),O.PowerA.push(e.PowerA||"0"),O.PowerB.push(e.PowerB||"0"),O.PowerC.push(e.PowerC||"0"),O.VoltA.push(e.VoltA||"0"),O.VoltB.push(e.VoltB||"0"),O.VoltC.push(e.VoltC||"0"),O.VoltAvgLL.push(e.VoltAvgLL||"0"),O.VoltAB.push(e.VoltAB||"0"),O.VoltAC.push(e.VoltAC||"0"),O.VoltBC.push(e.VoltBC||"0"),O.Freq.push(e.Freq||"0"),_.push(new Date(e.timestamp)))}),v=w.length>0?null===(C=_[_.length-1])||void 0===C?void 0:C.toLocaleString():"No Data",O.EnergySum.push(null),O.EnergyPosSum.push(null),O.EnergySumNR.push(null),O.EnergyPosSumNR.push(null),O.PowerSum.push(null),O.PowerA.push(null),O.PowerB.push(null),O.PowerC.push(null),O.VoltA.push(null),O.VoltB.push(null),O.VoltC.push(null),O.VoltAvgLL.push(null),O.VoltAB.push(null),O.VoltAC.push(null),O.VoltBC.push(null),O.Freq.push(null),_.push(new Date(n)),_.length>1){if(N=Object(l.c)(5,a,n),P="",N.length>1?(V=((new Date).getTime()-N[0].getTime())/1e3,P=(V/=3600)>24?"%m-%d %H:%M":V<.3?"%H:%M:%S":"%H:%M"):P="%H:%M:%S",g.x.lines=[],N.forEach(function(e){g.x.lines.push({value:e,class:"grid4"})}),c){for((j=JSON.parse(JSON.stringify(d.a))).name="Wattnode",j.graphData.columns=[_],j.axis.y.tick.format=function(e){return parseFloat(e).toFixed(1)},j.axis.x.tick.format=P,j.axis.x.tick.values=N,j.graphData.x="x",q=0;q<y.length;q++)L=y[q],k=Object(o.g)(L.sensedValue),j.sensedKeys.push(k),j.graphData.columns.push(O[""+k]);D.find(function(e){return e.name==j.name})&&(j.axis.y.tick.values=D.find(function(e){return e.name==j.name}).value,j.axis.y.min=j.axis.y.tick.values[0],j.axis.y.max=j.axis.y.tick.values[j.axis.y.tick.values.length-1]),x&&x.length&&(R=x.find(function(e){return e.graphName==j.name}))&&R.yAxisSettings&&("Fixed"==R.yAxisSettings?(delete j.axis.y.tick.values,j.axis.y.min=R.yAxisMin,j.axis.y.max=R.yAxisMax):"Floating"==R.yAxisSettings&&(delete j.axis.y.tick.values,delete j.axis.y.max,delete j.axis.y.min),j.yAxisSettings=R.yAxisSettings,j.yAxisFixedValues={max:R.yAxisMax,min:R.yAxisMin}),j.graphEquipment=this.fetchEquipmentFromPoints(j.name,j.sensedKeys),f.push(j)}else for(F=function(e){var t=r[e],a=JSON.parse(JSON.stringify(d.a)),n=1,i=[];if(a.name=t,"Power"==t?(a.axis.y.label="Watts",a.sensedKeys=["PowerA","PowerB","PowerC","PowerSum"],i=[_,O.PowerA,O.PowerB,O.PowerC,O.PowerSum]):"Phase Voltage"==t?(n=0,a.axis.y.label="Volts",a.sensedKeys=["VoltAB","VoltBC","VoltAC"],i=[_,O.VoltAB,O.VoltBC,O.VoltAC]):"Voltage"==t?(n=0,a.axis.y.label="Volts",a.sensedKeys=["VoltA","VoltB","VoltC"],i=[_,O.VoltA,O.VoltB,O.VoltC]):"Frequency"==t?(a.axis.y.label="Hz",a.sensedKeys=["Freq"],i=[_,O.Freq]):"Energy Sum Resettable"==t?(a.axis.y.label="MWh",a.sensedKeys=["EnergySumNR"],i=[_,O.EnergySumNR]):"Positive Energy Sum Non-resettable"==t&&(a.axis.y.label="MWh",a.sensedKeys=["EnergyPosSumNR"],i=[_,O.EnergyPosSumNR]),D.find(function(e){return e.name==t})&&(a.axis.y.tick.values=D.find(function(e){return e.name==t}).value,a.axis.y.min=a.axis.y.tick.values[0],a.axis.y.max=a.axis.y.tick.values[a.axis.y.tick.values.length-1]),x&&x.length){var s=x.find(function(e){return e.graphName==t});s&&s.yAxisSettings&&("Fixed"==s.yAxisSettings?(delete a.axis.y.tick.values,a.axis.y.min=s.yAxisMin,a.axis.y.max=s.yAxisMax):"Floating"==s.yAxisSettings&&(delete a.axis.y.tick.values,delete a.axis.y.max,delete a.axis.y.min),a.yAxisSettings=s.yAxisSettings,a.yAxisFixedValues={max:s.yAxisMax,min:s.yAxisMin})}a.axis.y.tick.format=function(e){return parseFloat(e).toFixed(n)},a.axis.x.tick.format=P,a.axis.x.tick.values=N,a.graphData.x="x",a.graphData.columns=i,a.graphEquipment=M.fetchEquipmentFromPoints(t,a.sensedKeys),f.push(a)},M=this,q=0;q<r.length;q++)F(q);this.props.loadNextInsight(),Object(h.h)(S,this.callLiveUpdate),this.setState({grid:g,graphData:f,lastUpdatedAt:v,loading:!1},function(){i&&G.changeAlarmStatus(!0)})}b.label=3;case 3:return[2]}})})})},t.prototype.render=function(){var e=this,t=this.state,a=t.loading,i=t.graphData,s=t.grid,l=t.lastUpdatedAt,u=t.enableYAxis,c=this.props,m=c.instance,p=c.buildingName,h=c.device,g=c.showAlarmPoints,d=c.insightRelEquipment;return a?n.createElement("div",null,n.createElement("div",{className:"col-md-12 padding-5 margin-5"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})))):"No Data"==l?n.createElement(n.Fragment,null):n.createElement(n.Fragment,null,i&&i.length&&i.map(function(t){var a,i,c,f="";return g&&t.alarmStatus&&("active"==t.alarmStatus?f="alarm-graph":"ack"==t.alarmStatus?f="alarm-ack-graph":"clear"==t.alarmStatus&&(f="alarm-clear-ack-graph")),(null===(a=t.graphData.columns)||void 0===a?void 0:a.length)||(null===(i=t.graphDataAlarmPoint.columns)||void 0===i?void 0:i.length)?n.createElement("div",{className:"row col-md-12 m-0 device-graphs "+f,id:"divGraphs"},n.createElement("br",null),(g||u)&&n.createElement("div",{className:"alarm-limit-select"},g&&n.createElement(n.Fragment,null,"Limits For: "," ",t.sensedKeys&&t.sensedKeys.length?n.createElement("select",{className:"alarm-points-list",value:t.selectedAlarmPoint.sensedValue,onChange:function(a){e.selectAlarmPoint(t,a.target.value,!0)}},t.sensedKeys.map(function(e,t){return n.createElement("option",{key:t,value:e},e)})):n.createElement(n.Fragment,null,"No Alarm points created"),t.alarmStatus&&n.createElement("a",{href:"#"+m+"/"+p+"/Alarms/OperationalAlarms/Device/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},n.createElement("i",{className:"fa fa-info-circle select alarm-icon","aria-hidden":"true"}))),u&&n.createElement("div",{className:"pull-right"},"Y axis: "," ",n.createElement("select",{className:"alarm-points-list",value:t.yAxisSettings,onChange:function(a){e.changeYAxisSettings(t.name,a.target.value)}},n.createElement("option",{key:1,value:"Fixed"}," Fixed "),n.createElement("option",{key:2,value:"Floating"}," Floating "),n.createElement("option",{key:2,value:"Default"}," Default ")),"Fixed"==t.yAxisSettings&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ml-5"},"Min:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.min,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!0,!0)}}),n.createElement("span",{className:"ml-2"},"Max:")," ",n.createElement("input",{type:"number",className:"y-axis-input",value:t.yAxisFixedValues.max,onChange:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!1)},onBlur:function(a){e.changeYaxisMinMax(t.name,+a.target.value,!1,!0)}})))),n.createElement("h5",{className:" no-padding no-margin-color-textalign tooltipDashboard graphHeading "},n.createElement("a",{className:"col-md-5 sentence-break",href:"#"+m+"/"+p+"/Insights/Equipment/Graphs/WattNodeControl/"+Object(o.g)(h.moncondevice),target:"_blank",rel:"noreferrer noopener"},t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned"),n.createElement("span",{className:"col-md-3 sentence-break"},t.name),n.createElement("div",{className:"tooltiptextDashboard"},n.createElement("span",null,"Equipment: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.label}).join(","):"No equipment assigned to data point"," "),n.createElement("br",null),n.createElement("span",null,"Space: ",t.graphEquipment&&t.graphEquipment.pointEquip.length?t.graphEquipment.pointEquip.map(function(e){return e.space}).join(","):"No space for equipment"," "),n.createElement("br",null),n.createElement("span",null,"Floor: ",Object(o.g)(h.floorRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Zone: ",Object(o.g)(h.zoneRdfsLabel)," "),n.createElement("br",null),n.createElement("span",null,"Device Rel. Equip.: ",d.map(function(e,t){return e.rdfsLabel+(t<d.length-1?", ":" ")})," "),n.createElement("br",null),n.createElement("span",null,"Device: ",Object(o.g)(h.rdfsLabel)||"No device assigned"," "),n.createElement("br",null),n.createElement("span",null,"Device Space: ",Object(o.g)(h.spaceRdfsLabel)," ")),n.createElement("span",{className:"sentence-break lastUpdated"},"Last: ",l)),t.loading?n.createElement("div",{className:"row col-md-12 m-0 device-graphs",id:"divGraphs"},n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"}))):n.createElement(r.a,{data:g&&(null===(c=t.graphDataAlarmPoint.columns)||void 0===c?void 0:c.length)>1?t.graphDataAlarmPoint:t.graphData,size:{height:300},axis:t.axis,grid:s,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})):n.createElement(n.Fragment,null)}))},t}(n.Component);t.a=A},2977:function(e,t,a){"use strict";var n=a(2),i=(a.n(n),a(744)),r=a(1014),s=a(772),l=a.n(s),o=a(760),u=(a.n(o),a(715)),c=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),m=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function s(e){try{o(n.next(e))}catch(e){r(e)}}function l(e){try{o(n.throw(e))}catch(e){r(e)}}function o(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(s,l)}o((n=n.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},h=function(e){function t(t){var a=e.call(this,t)||this;return a.state={asisData:[],seasonList:[],graphData1:{x:"Date",columns:[],type:"bar"},grid1:{x:{lines:[{}]},y:{show:!0}},axis1:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphData2:{x:"Date",columns:[],type:"bar"},grid2:{x:{lines:[{}]},y:{show:!0}},axis2:{x:{type:"timeseries",tick:{count:30,format:"%m-%d"}},y:{label:"kWh",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}},y2:{show:!0,label:"$",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},loading:!0,selectedSeason:""},a._fetchData=a._fetchData.bind(a),a}return c(t,e),t.prototype.componentDidMount=function(){return m(this,void 0,void 0,function(){return p(this,function(e){return this._fetchData(),[2]})})},t.prototype.fetchVeifyDetail=function(e){return m(this,void 0,void 0,function(){return p(this,function(e){return[2]})})},t.prototype._fetchData=function(){return m(this,void 0,void 0,function(){var e,t,a=this;return p(this,function(n){switch(n.label){case 0:return e=this.props.buildingName,t=this.props.projectName,[4,Object(i.o)(e,"",t).then(function(e){return m(a,void 0,void 0,function(){var t,a,n,s,l,o,u,c,m,h,g,d,f,v,x=this;return p(this,function(p){switch(p.label){case 0:return e&&e[0]&&e[0].ontology?(t=[],0,0,0,0,a=[],n=e[0],[4,Object(i.l)(n.ontology)]):[3,7];case 1:if(!((s=p.sent())&&s.length>0))return[3,7];for((t=s.sort(function(e,t){return e.seasonSequence>t.seasonSequence?1:t.seasonSequence>e.seasonSequence?-1:0})).map(function(e){var t=e.analysisName+": "+(e.seasonType&&"both"==e.seasonType.toLocaleLowerCase().trim()?e.seasonType+": "+("cooling"==e.selectedAnalysis?"Cooling":"Heating"):e.seasonType);a.push({label:t,value:e.ontology})}),l=0;l<t.length;l++)o=t[l],o.totalConsumedEnergyASIS,o.totalConsumedEnergyECM,o.totalConsumedEnergyCostASIS,o.totalConsumedEnergyCostECM;return 0==n.measureAnalysis.length?n.measureAnalysis=[{staticSeasonName:"Summer",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Fall",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Winter",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value},{staticSeasonName:"Spring",selectedSeasonName:a[0].label,selectedSeasonOntology:a[0].value}]:n.measureAnalysis.length,u=[],c=[],t&&t.length>0?(m=[],h=[],(g=t.sort(function(e,t){return new Date(e.asisStartDate)>new Date(t.asisStartDate)?1:new Date(t.asisStartDate)>new Date(e.asisStartDate)?-1:0}))&&g.length>0?(d=g[0],[4,Object(i.k)(d.importDataASISOntology).then(function(e){u=e?e[0].fileData:[]})]):[3,6]):[3,7];case 2:return p.sent(),[4,Object(i.k)(d.importDataECMOntology).then(function(e){c=e?e[0].fileData:[]})];case 3:return p.sent(),[4,Object(r.c)(u,new Date(d.asisStartDate),new Date(d.asisEndDate),d.noaaStation.value,parseFloat(d.basepointCD),parseFloat(d.basepointHD),d.isMeasureFile)];case 4:return f=p.sent(),[4,Object(r.c)(c,new Date(d.ecmStartDate),new Date(d.ecmEndDate),d.noaaStation.value,parseFloat(d.basepointCD),parseFloat(d.basepointHD),d.isMeasureFile)];case 5:v=p.sent(),m.push.apply(m,f),h.push.apply(h,v),p.label=6;case 6:this.setState({seasonList:t,asisData:u},function(){x.energyConsumptionGraph()}),p.label=7;case 7:return[2]}})})}).catch(function(e){console.log(e)})];case 1:return n.sent(),[2]}})})},t.prototype.energyConsumptionGraph=function(){return m(this,void 0,void 0,function(){var e,t,a,n,i,r,s,l,o,c,m,h,g,d,f,v,x,y,b,A,E,D,S,w;return p(this,function(p){switch(p.label){case 0:e=this.state.asisData,t=this.state,a=t.graphData1,n=t.axis1,i=t.grid1,r=t.graphData2,s=t.axis2,l=t.grid2,o=new Date,c=new Date,o.setMonth(o.getMonth()-1),o.setHours(0,0,0,0),m=["ECM Energy Consumption (Metered)"],h=["Date"],g=["Asis Consumption (Projected)"],d=["Energy Saving"],f=["Energy Savings $ at 10.42 cents per unit"],v=["Tons CO2 emission reduction at 0.000709 tons per unit"],x=new Date(o),p.label=1;case 1:return x<=c?((y=new Date(x)).setHours(23,59,59,0),[4,Object(u.n)("michaels/5_125/wn_basicreg1",x,y,!1)]):[3,4];case 2:b=p.sent(),A=b[0],E=b[b.length-1],A&&E?m.push(""+(E.EnergyPosSum-A.EnergyPosSum)):m.push("0"),h.push(new Date(x)),p.label=3;case 3:return x.setDate(x.getDate()+1),[3,1];case 4:for(D=function(t){var a=new Date(h[t]),n=0;e.filter(function(e){if(+e.Date.split("/")[1]==a.getDate())return e}).forEach(function(e){n+=+e.ValueSum}),g.push(n),i.x.lines.push({value:a,class:"grid4"}),l.x.lines.push({value:a,class:"grid4"})},S=1;S<h.length-1;S++)D(S);for(S=1;S<g.length-1;S++)+g[S]&&+m[S]?(w=+g[S]-+m[S],d.push(w),f.push(.01042*w),v.push(709e-6*w)):(d.push(0),f.push(0));return a={x:"Date",columns:[h,m,g],type:"bar"},r={x:"Date",columns:[h,d,f],groups:[["Energy Saving"]],axes:{"Energy Savings $ at 10.42 cents per unit":"y"},type:"bar",types:{"Energy Savings $ at 10.42 cents per unit":"line"}},n.y.label="KwH",s.y.tick.values=[-2e3,-1e3,0,1e3,2e3],s.y.tick.max=2e3,s.y.tick.min=-2e3,s.y2.tick.values=[-40,-20,0,20,40],s.y2.tick.max=40,s.y2.tick.min=-40,this.setState({loading:!1,graphData1:a,axis1:n,grid1:i,graphData2:r,grid2:l}),[2]}})})},t.prototype.render=function(){var e=this.state,t=e.loading,a=e.graphData1,i=e.grid1,r=e.axis1,s=e.graphData2,o=e.axis2,u=e.grid2;return n.createElement(n.Fragment,null,n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(l.a,{data:a,size:{height:500},axis:r,grid:i,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})),n.createElement("div",{className:"row col-md-12 device-graphs mt-22 ",id:"divGraphs"},t?n.createElement("div",{className:"graph-box-loader"},n.createElement("div",{className:"loader center-object"})):n.createElement(l.a,{data:s,size:{height:500},axis:o,grid:u,legend:{position:"bottom"},point:{focus:{expand:{r:3}},r:0}})))},t}(n.Component);t.a=h},837:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n={sensedValue:"",maximumExtremeValue:"",minimumExtremeValue:"",maximumNormalValue:"",minimumNormalValue:"",generateMaximumExtremeValue:!0,generateMaximumNormalValue:!0,generateMinimumExtremeValue:!0,generateMinimumNormalValue:!0}},857:function(e,t,a){"use strict";a.d(t,"b",function(){return i}),a.d(t,"a",function(){return r});var n=a(837),i=[{name:"Temp & Humidity",type:"CeilingSensor",value:[0,20,40,60,80,100]},{name:"Pressure",type:"CeilingSensor",value:[0,400,800,1200]},{name:"Illuminance",type:"CeilingSensor",value:[0,40,80,120,160,200,240]},{name:"Gas Resistance",type:"CeilingSensor",value:[0,600,1200,1800,2400,3e3]},{name:"Air Particles",type:"CeilingSensor",value:[0,4e3,8e3,12e3,16e3]},{name:"Other Parameters",type:"CeilingSensor",value:[0,10,20,30,40,50]},{name:"Ceiling Sensor",type:"CeilingSensor",value:[0,4e3,8e3,12e3,16e3]},{name:"ATS Frequency",type:"ATS",value:[0,20,40,60,80]},{name:"Refrigerator 1",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 2",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 3",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 4",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Temperatures",type:"CBW406",value:[0,20,40,60,80,100]},{name:"Refrigerator 1",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 2",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 3",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Refrigerator 4",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Analog Values",type:"CBW418",value:[0,20,40,60,80,100],value2:[-20,-10,0,10,20]},{name:"Voltages",type:"Generator",value:[0,50,100,150,200,250]},{name:"Currents",type:"Generator",value:[0,10,20,30,40,50]},{name:"Powers",type:"Generator",value:[0,20,40,60,80,100]},{name:"Power Factor",type:"Generator",value:[-1,0,1]},{name:"Other Parameters",type:"Generator",value:[0,40,80,120,160,160]},{name:"Binary Parameters",type:"Generator",value:[-1,0,1]},{name:"Generator",type:"Generator",value:[-1,0,50,100,150,200,250]},{name:"Intesis",type:"Intesis",value:[0,20,40,60,80,100]},{name:"Totalized Energy",type:"RelayI1",value:[0,10,20,30,40,50]},{name:"Frequency and Voltage",type:"RelayI1",value:[0,50,100,150,200]},{name:"Current and Power",type:"RelayI1",value:[0,20,40,60,80,100]},{name:"State and Power Factor",type:"RelayI1",value:[-1,0,1,2]},{name:"Relay i1",type:"RelayI1",value:[-1,0,1,2,50,100,150,200]},{name:"Relay V4",type:"RelayV4",value:[0,50,100,150,200,250,300]},{name:"Thermostat",type:"Thermostat",value:[0,20,40,60,80,100]},{name:"Power",type:"Wattnode",value:[0,1e4,2e4,3e4,4e4]},{name:"Phase Voltage",type:"Wattnode",value:[0,50,100,150,200,250]},{name:"Voltage",type:"Wattnode",value:[0,50,100,150]},{name:"Frequency",type:"Wattnode",value:[0,20,40,60,80]},{name:"Energy Sum Resettable",type:"Wattnode",value:[0,40,80,120,160]},{name:"Positive Energy Sum Non-resettable",type:"Wattnode",value:[0,40,80,120,160]},{name:"Wattnode",type:"Wattnode",value:[0,1e4,2e4,3e4,4e4]}],r={name:"",graphData:{x:"x",columns:[]},axis:{x:{type:"timeseries",tick:{fit:!1,count:5,multiline:!0,format:"%m-%d/%H:%M:%S"}},y:{label:"\xb0F",tick:{fit:!0,count:6,format:function(e){return parseFloat(e).toFixed(2)}}}},graphDataAlarmPoint:{x:"x",columns:[]},graphEquipment:Object(),alarmStatus:"",selectedAlarmPoint:n.a,sensedKeys:[],yAxisSettings:"Default",yAxisFixedValues:{min:0,max:0},loading:!1}}});