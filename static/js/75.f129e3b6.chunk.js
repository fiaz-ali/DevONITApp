webpackJsonp([75],{605:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c,r,a=n(2),i=(n.n(a),n(802)),s=n(39),o=n(12),u=n(109),l=n(16),h=n(8),f=n(60),d=n(120),b=n(9),m=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function c(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(c.prototype=n.prototype,new c)}}(),p=this&&this.__awaiter||function(t,e,n,c){return new(n||(n=Promise))(function(r,a){function i(t){try{o(c.next(t))}catch(t){a(t)}}function s(t){try{o(c.throw(t))}catch(t){a(t)}}function o(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(i,s)}o((c=c.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){var n,c,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,c&&(r=2&a[0]?c.return:a[0]?c.throw||((r=c.return)&&r.call(c),0):c.next)&&!(r=r.call(c,a[1])).done)return r;switch(c=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,c=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],c=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function g(){var t=document.getElementById("chatMessagesContainer");t&&(t.scrollTop=t?t.scrollHeight:0)}var S=function(t){function e(e){var n=t.call(this,e)||this;return n.state={chatMessages:[],chatText:"",participants:[],tag:"",issue:""},c=n,n.s3=new s.b,n.fetchContactInfo=n.fetchContactInfo.bind(n),n}return m(e,t),e.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){var t,e,n,a,i;return v(this,function(s){switch(s.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,a=t.s,e&&n?[4,this.fetchContactInfo()]:[3,3];case 1:return s.sent(),[4,this.getAllMessages()];case 2:s.sent(),(i=document.querySelector("#messageBody")).scrollTop=i.scrollHeight-i.clientHeight,r=window.innerHeight-270,s.label=3;case 3:return a&&a._socket&&a._socket.on&&a._socket.on("new message",function(t){var e=c.state.chatMessages;(0==e.length||e.length>0&&JSON.stringify(e[e.length-1])!=JSON.stringify(t))&&c.state.tag==t.tag&&(e.push(t),c.setState({chatMessages:e},function(){c.saveAllMessages(),g()}))}),[2]}})})},e.prototype.fetchContactInfo=function(){return p(this,void 0,void 0,function(){var t,e,n,c,r,a,s,o=this;return v(this,function(l){switch(l.label){case 0:return t=this.props,e=t.buildingName,n=t.contactIDs,c=t.entityTitle,e&&n?(r=[],a="",s="",c&&"Contact"!=c?[4,Object(i.i)("",c).then(function(t){if(t.length>0){var e=t[0];r=Object(h.g)(e.chatName).split("-_-"),s=Object(h.g)(e.description)}})]:[3,2]):[3,5];case 1:return l.sent(),[3,3];case 2:r=n,l.label=3;case 3:return r=r.sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).slice(),[4,Object(u.m)("",r).then(function(t){t.length>0&&(a+="Chat-_-",a+=t.map(function(t){return Object(h.g)(t.contact)}).join("-_-"),o.setState({participants:t,tag:a,issue:s},function(){return p(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Object(i.w)(a)];case 1:return t.sent(),[2]}})})}))})];case 4:l.sent(),l.label=5;case 5:return[2]}})})},e.prototype.getAllMessages=function(){return p(this,void 0,void 0,function(){var t,e,n;return v(this,function(r){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.GetObject(s.a.CHAT,n+".json",function(t,e){if(t)console.log("Get Object Error Returned",t);else{var n=Object(o.c)(e.Body);if(n){var r=JSON.parse(n);r.length>c.state.chatMessages.length&&c.setState({chatMessages:r}),g()}}}),[2]})})},e.prototype.saveAllMessages=function(){return p(this,void 0,void 0,function(){var t,e,n;return v(this,function(c){return t=this.state,e=t.participants,n=t.tag,e&&e.length&&this.s3.PutObject(s.a.CHAT,n+".json",JSON.stringify(this.state.chatMessages)),[2]})})},e.prototype.handleChatInput=function(t){this.setState({chatText:t})},e.prototype.handleChatInputKeys=function(t){(13===t.which||"Enter"===t.key)&&t.target.value&&t.target.value.trim()&&(this.setState({chatText:t.target.value.trim()}),this.sendMessage())},e.prototype.sendMessage=function(){return p(this,void 0,void 0,function(){var t,e,n,r,a,s,o,u;return v(this,function(l){return t=this.props.entityTitle,this.state.chatText&&this.state.chatText.trim()&&(e=JSON.parse(b.a.getItem("user")),n=this.state,r=n.participants,a=n.tag,s=this.state.chatText,o={from:e.contact,fromName:e.name,messageText:s,tag:a,timestamp:(new Date).toString()},Object(d.c)(o),(u=this.state.chatMessages).push(o),this.setState({chatMessages:u,chatText:""},function(){Object(i.q)(t,"Chat-_-"+r.map(function(t){return""+t.contact.value}).sort(function(t,e){if(t&&e){var n=0;return t<e&&(n=-1),t>e&&(n=1),1*n}}).join("-_-")),c.saveAllMessages()}),g()),[2]})})},e.prototype.render=function(){var t=this,e=this.props.entityTitle,n=this.state,c=n.chatMessages,i=n.chatText,s=n.participants,o=n.issue,u=JSON.parse(b.a.getItem("user")),d=Object(f.b)(u,"task-ticket","write"),m=-1!=s.findIndex(function(t){return Object(h.g)(t.contact)==u.contact});return a.createElement(l.AppContext.Consumer,null,function(n){return a.createElement("div",{className:"container-fluid "},a.createElement("div",{className:"content"},a.createElement("div",{className:"chatHead"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"form-group"},a.createElement("label",{className:"heading"},e," -- ",s.map(function(t){return Object(h.g)(t.name)}).join(" -- "),""!=o?"--"+o:"")))),a.createElement("div",{id:"chatMessagesContainer",className:" padding-10 chatBody"},a.createElement("div",{className:"col-md-12"},a.createElement("div",{className:"card padding-10 scroll",id:"messageBody",style:{height:r,overflowX:"hidden",margin:"0px"}},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"row"},a.createElement("div",{className:"card col-md-12 col-xs-12 padding-10",style:{margin:"0px"}},0==c.length&&a.createElement("div",null," No messages found in this conversation. "),c.map(function(t,e){if(t&&t.from){var n=s.find(function(e){return e.contact.value==t.from});if(n&&n.name)return a.createElement("div",{key:e,className:"padding-10 chat-message "+(t.from==u.contact?"inbound-message":"outbound-message")},a.createElement("div",{className:"message-text padding-5",style:{overflowWrap:"break-word"}},t.messageText),a.createElement("div",{className:"sender-name"},a.createElement("label",null,a.createElement("b",null,n.name.value))),a.createElement("div",{className:"timestamp"},a.createElement("b",null,t.timestamp.ToEasternDateTime())))}}))))),m&&d&&a.createElement("footer",{className:"col-md-12 no-padding"},a.createElement("div",{className:"card",style:{margin:"0px"}},a.createElement("div",{className:"container-fluid"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-12 no-padding"},a.createElement("div",{className:"",style:{display:"inline-flex",padding:"0px",width:"100%"}},a.createElement("input",{type:"text",className:"form-control",placeholder:"Type your message here...",name:"chatBox",value:i,style:{height:"97px"},onChange:function(e){return t.handleChatInput(e.target.value)},onKeyPress:function(e){return t.handleChatInputKeys(e)}}),a.createElement("button",{type:"button",className:"btn pull-right btn-primary btn-fill chatButton",onClick:function(){t.sendMessage()}},a.createElement("i",{className:"fa fa-comment"}),"\xa0 Send ")))))))))))})},e}(a.Component);e.default=S},802:function(t,e,n){"use strict";e.n=function(){var t=JSON.parse(i.a.getItem("user"));return!(!t||t.workingStatus&&"Not Working"!=t.workingStatus)&&(!!document.getElementById("btnStatus")&&(document.getElementById("btnStatus").click(),!0))},e.l=function(){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Object(a.e)({},a.a.TASKS.GetTaskTypeList,c.b.TASK)];case 1:return[2,t.sent()]}})})},e.m=function(){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Object(a.e)({},a.a.TASKS.GetWorkTypeList,c.b.TASK)];case 1:return[2,t.sent()]}})})},e.h=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.e)({buildingName:t,getArchivedOnly:e},a.a.CHATS.GetChats,c.b.TASK)];case 1:return[2,n.sent()]}})})},e.f=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,chatName:e},a.a.CHATS.DeleteChat,c.b.TASK).then(function(){Object(r.b)("Chat Deleted Successfully.")}).catch(function(t){Object(r.a)("Error occured while deleting Chat.")})];case 1:return[2,n.sent()]}})})},e.q=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,chatName:e},a.a.TASKS.UpdateLastMessageOn,c.b.CHAT)];case 1:return[2,n.sent()]}})})},e.w=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({chatName:t},a.a.TASKS.UpdateUnreadCount,c.b.TASK)];case 1:return[2,e.sent()]}})})},e.p=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({buildingName:t,model:e,isEdit:n},a.a.TASKS.UpdateRootTask,c.b.TASK).then(function(){Object(r.b)("Task "+(n?"Updated":"Added")+" Successfully.")}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.i=function(t,e,n,r){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(a.e)({buildingName:t,taskNumber:e,contractTaskReference:r,isArchived:n},a.a.TASKS.GETTASKS,c.b.TASK,!0)];case 1:return[2,i.sent()]}})})},e.j=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,Object(a.e)({buildingName:t,parentTask:e,subTaskNumber:n},a.a.TASKS.GetSubTask,c.b.TASK)];case 1:return[2,r.sent()]}})})},e.s=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isDeleted:e},a.a.TASKS.UpdateRootTaskDeleteStatus,c.b.TASK).then(function(){Object(r.b)("Task Deleted Successfully.")}).catch(function(t){Object(r.a)("Error occured while deleting Task.")})];case 1:return[2,n.sent()]}})})},e.v=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({taskID:t,status:e},a.a.TASKS.UpdateTaskStatus,c.b.TASK).then(function(){n||Object(r.b)("Status Updated Successfully.")}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,i.sent()]}})})},e.u=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,startTime:e},a.a.TASKS.UpdateTaskStartTime,c.b.TASK).then(function(){Object(r.b)("Start Time Updated Successfully.")}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.d=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isArchived:e},a.a.TASKS.ArchiveTask,c.b.TASK).then(function(){Object(r.b)((e?"Archived":"Unarchived")+" Successfully.")}).catch(function(t){Object(r.a)("Error occured while Archiving Task.")})];case 1:return[2,n.sent()]}})})},e.c=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,note:e},a.a.TASKS.AddPauseNote,c.b.TASK).then(function(){}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.g=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({taskID:t},a.a.TASKS.DeletePauseNote,c.b.TASK).then(function(){}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,e.sent()]}})})},e.b=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,note:e},a.a.TASKS.AddNote,c.b.TASK).then(function(){Object(r.b)("Note Added Successfully.")}).catch(function(t){Object(r.a)("Error occured while saving Task.")})];case 1:return[2,n.sent()]}})})},e.a=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,isAcknowledged:e},a.a.TASKS.AcknowledgeRootTask,c.b.TASK).then(function(){Object(r.b)(e?"Acknowledged Successfully.":"Unacknowledged Successfully.")}).catch(function(t){Object(r.a)("Error occured while Acknowledging.")})];case 1:return[2,n.sent()]}})})},e.e=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.f)({taskID:t,checklistID:e},a.a.TASKS.AssignChecklist,c.b.TASK).then(function(){Object(r.b)("Checklist Assigned Successfully.")}).catch(function(t){Object(r.a)("Error occured while Assigning Checklist.")})];case 1:return[2,n.sent()]}})})},e.t=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({taskID:t,status:e},a.a.TASKS.UpdateTaskOrStageStatus,c.b.TASK).then(function(){n||Object(r.b)("Status Updated Successfully.")}).catch(function(t){Object(r.a)("Error occured while update Status.")})];case 1:return[2,i.sent()]}})})},e.r=function(t,e,n){return s(this,void 0,void 0,function(){return o(this,function(i){switch(i.label){case 0:return[4,Object(a.f)({email:t,roles:e,fileName:n},a.a.ONEDRIVE.UPDATEPERMISSION,c.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(r.a)("Error occured while update Permission.")})];case 1:return[2,i.sent()]}})})},e.o=function(t){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Object(a.f)({fileName:t},a.a.ONEDRIVE.REMOVEPERMISSION,c.b.TASK,"",!0).then(function(t){return t}).catch(function(t){Object(r.a)("Error occured while removing Permission.")})];case 1:return[2,e.sent()]}})})},e.k=function(t,e){return s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,Object(a.e)({buildingName:t,checklistID:e},a.a.TASKS.GetTaskHavingChecklist,c.b.TASK,!0)];case 1:return[2,n.sent()]}})})};var c=n(7),r=n(6),a=n(5),i=n(9),s=this&&this.__awaiter||function(t,e,n,c){return new(n||(n=Promise))(function(r,a){function i(t){try{o(c.next(t))}catch(t){a(t)}}function s(t){try{o(c.throw(t))}catch(t){a(t)}}function o(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(i,s)}o((c=c.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,c,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,c&&(r=2&a[0]?c.return:a[0]?c.throw||((r=c.return)&&r.call(c),0):c.next)&&!(r=r.call(c,a[1])).done)return r;switch(c=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,c=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],c=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}}});