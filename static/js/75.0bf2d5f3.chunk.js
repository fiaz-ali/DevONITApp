webpackJsonp([75],{1749:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=a(3),i=(a.n(s),a(101)),c=a(605),l=a(99),r=a(633),o=a(103),d=a(21),m=a(49),u=a(614),h=a(105),f=a(10),p=a(600),b=a(102),g=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),v=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,i){function c(e){try{r(n.next(e))}catch(e){i(e)}}function l(e){try{r(n.throw(e))}catch(e){i(e)}}function r(e){e.done?s(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(c,l)}r((n=n.apply(e,t||[])).next())})},N=this&&this.__generator||function(e,t){var a,n,s,i,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){c.label=i[1];break}if(6===i[0]&&c.label<s[1]){c.label=s[1],s=i;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(i);break}s[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],n=0}finally{a=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},C=function(e){function t(t){var a=e.call(this,t)||this;return a.state={_chats:[],sortOrder:1,chatToDelete:Object(),ChatToArchive:Object(),taskModalData:Object()},n=a,a.sortChats=a.sortChats.bind(a),a._fetchChats=a._fetchChats.bind(a),a.onDeleteChat=a.onDeleteChat.bind(a),a.deleteChat=a.deleteChat.bind(a),a.onArchiveChat=a.onArchiveChat.bind(a),a.archiveChat=a.archiveChat.bind(a),a.handlePerformanceDetail=a.handlePerformanceDetail.bind(a),a}return g(t,e),t.prototype.componentDidMount=function(){return v(this,void 0,void 0,function(){return N(this,function(e){switch(e.label){case 0:return this.props.buildingName?[4,this._fetchChats()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.componentWillReceiveProps=function(e){return v(this,void 0,void 0,function(){return N(this,function(t){switch(t.label){case 0:return e.buildingName?[4,this._fetchChats()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype._fetchChats=function(){return v(this,void 0,void 0,function(){var e=this;return N(this,function(t){switch(t.label){case 0:return Object(l.a)(!0),this.props.buildingName?[4,Object(o.l)(this.props.buildingName,this.props.isArchivePage).then(function(t){var a=[];t.map(function(e){var t=-1==Object(d.g)(e.assignedToName).indexOf(Object(d.g)(e.enteredByName))?Object(d.g)(e.assignedToName)+", "+Object(d.g)(e.enteredByName):Object(d.g)(e.assignedToName);a.push({chatName:Object(d.g)(e.chatName),lastMessage:Object(d.g)(e.lastMessage),participants:t,participantsUserName:Object(d.g)(e.assignedTo),taskID:Object(d.g)(e.task),type:Object(d.g)(e.type),unreadMessageCount:Object(d.g)(e.unreadMessageCount)?parseInt(Object(d.g)(e.unreadMessageCount)):0,action:Object(d.g)(e.action),issue:Object(d.g)(e.issue),building:Object(d.g)(e.building),buildingLabel:Object(d.g)(e.buildingLabel)})}),e.setState({_chats:a})}).catch(function(e){return e})]:[3,2];case 1:t.sent(),t.label=2;case 2:return Object(l.a)(!1),[2]}})})},t.prototype.sortChats=function(e,t){var a=this.state._chats,n=this.state.sortOrder,s=a.sort(function(a,s){if(a&&s){var i="",c="";switch(e){case"Last Message":a.lastMessage&&s.lastMessage&&(i=a.lastMessage,c=s.lastMessage,n=t||1);break;case"Participant":a.participants&&s.participants&&(i=a.participants,c=s.participants);break;case"Chat Name":a.action&&s.action?(i=a.action,c=s.action):a.issue&&s.issue&&(i=a.issue,c=s.issue)}var l=0;return i.toLocaleLowerCase()<c.toLocaleLowerCase()?l=-1:i.toLocaleLowerCase()>c.toLocaleLowerCase()&&(l=1),l*n}});this.setState({_chats:s,sortOrder:-1*n})},t.prototype.onDeleteChat=function(e){this.setState({chatToDelete:e},function(){document.getElementById("btnConfirm").click()})},t.prototype.deleteChat=function(){return v(this,void 0,void 0,function(){var e,t=this;return N(this,function(a){switch(a.label){case 0:return(e=this.state.chatToDelete)&&e.taskID?(Object(l.a)(!0),[4,Object(o.j)(e.taskID,e.chatName).then(function(){(new m.b).DeleteFile(m.a.CHAT(),"Chat-_-"+e.participants+".json"),t._fetchChats()})]):[3,2];case 1:a.sent(),Object(l.a)(!1),a.label=2;case 2:return[2]}})})},t.prototype.onArchiveChat=function(e){this.setState({ChatToArchive:e},function(){document.getElementById("btnConfirmArchive").click()})},t.prototype.archiveChat=function(){return v(this,void 0,void 0,function(){var e;return N(this,function(t){switch(t.label){case 0:return e=this.state.ChatToArchive,[4,Object(h.c)(e.taskID)];case 1:return t.sent(),[4,this._fetchChats()];case 2:return t.sent(),[2]}})})},t.prototype.handlePerformanceDetail=function(e){var t=this;e&&(Object(l.a)(!0),Object(o.n)("",e).then(function(e){return v(t,void 0,void 0,function(){var t;return N(this,function(a){return t=e[0],this.setState({taskModalData:t},function(){document.getElementById("btnTaskDetail").click()}),Object(l.a)(!1),[2]})})}))},t.prototype.render=function(){var e=this,t=this.state,a=t._chats,l=t.taskModalData,o=this.props,m=o.isArchivePage,h=o.instance,g=o.buildingName,v=JSON.parse(f.a.getItem("user")),N=Object(u.b)(v,"task-ticket","write");return s.createElement(i.a.Consumer,null,function(t){return s.createElement("div",{className:"content",id:"chats",style:{paddingTop:"0px"}},s.createElement("div",{className:"container-fluid"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-md-12 "},!m&&s.createElement("a",{className:"btn-sm btn-success pull-left custom-icon-btn",title:"Archived Chats",style:{marginTop:"0px"},onClick:function(e){window.location.hash=h+"/"+g+"/ArchivedChats"}},s.createElement("img",{className:"icon-img",style:{backgroundColor:"#B3A2C7"},src:"assets/img/archive.png"})),m&&s.createElement("button",{type:"button",className:"btn btn-secondary btn-fill pull-left",onClick:function(){window.location.hash=h+"/"+g+"/Chat"}},s.createElement("i",{className:"fa fa-angle-double-left"})," Back to Chats"),s.createElement("div",{className:"dropdown pull-right"},s.createElement(r.a,{filename:"ChatsList",data:Object(),ElementID:"ChatsList"})))),s.createElement("br",null),s.createElement("div",{className:"card padding-10",id:"ChatsList",style:{paddingTop:"0px"}},s.createElement("div",{className:"content",style:{paddingTop:"10px"}},s.createElement("div",{className:"dataCard"},s.createElement("div",{className:"row hidden-xs no-padding"},s.createElement("div",{className:"col-md-9 dataCard no-padding"},s.createElement("div",{className:"col-md-3 small grid-header-left",onClick:function(){return e.sortChats("Chat Name")}},s.createElement("i",{className:"fa fas fa-sort"}),"Chat Name"),s.createElement("div",{className:"col-md-3 small grid-header",onClick:function(){return e.sortChats("Participant")}},s.createElement("i",{className:"fa fas fa-sort"}),"Participants"),s.createElement("div",{className:"col-md-3 small grid-header",onClick:function(){return e.sortChats("Last Message")}},s.createElement("i",{className:"fa fas fa-sort"}),"Last Message"),s.createElement("div",{className:"col-md-3 small grid-header",onClick:function(){return e.sortChats("building")}},s.createElement("i",{className:"fa fas fa-sort"}),"Building")),s.createElement("div",{className:"col-md-3"},"\xa0")),a.map(function(a,i){if(a&&a.taskID){var l=[];return t.unreadMessages.map(function(e){e&&e.from}),s.createElement("div",{key:i,className:"row clickable"},s.createElement("div",{className:"col-md-9"},s.createElement("div",{className:"col-md-3 small trim-data",title:a.taskID.toString()},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Chat Name"),s.createElement("a",{onClick:function(){t&&t.unreadMessages&&setTimeout(function(){window.location.hash=n.props.instance+"/"+n.props.buildingName+"/ChatWindow/"+a.taskID+"/"+a.type},1e3)}},a.action?a.action:a.issue?a.issue:"",l.length>0&&s.createElement(s.Fragment,null,s.createElement("label",{style:{color:"#d2202a",marginLeft:30}},s.createElement("i",{className:"fa fas fa-comment"}),"\xa0",l.length)))),s.createElement("div",{className:"col-md-3 small trim-data",title:a.participants},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Participants"),a.participants),s.createElement("div",{className:"col-md-3 small trim-data",title:a.lastMessage?new Date(a.lastMessage).YYMMDDHHMM():""},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Last Message"),a.lastMessage?new Date(a.lastMessage).YYMMDDHHMM():""),s.createElement("button",{id:"btnConfirm",style:{display:"none"},"data-toggle":"modal","data-target":"#ConfirmDeleteDialog"},"."),s.createElement(c.a,{instance:e.props.instance,id:"ConfirmDeleteDialog",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmationText:"Are you sure to delete this Chat?",heading:"Confirm...",onConfirmButtonClick:function(){e.deleteChat()}}),s.createElement("div",{className:"col-md-3 small trim-data",title:a.buildingLabel},s.createElement("span",{className:"hidden visible-xs-inline headingText"},"Building"),a.buildingLabel?a.buildingLabel:"")),N&&s.createElement("div",{className:"col-md-3",style:{display:"inline-flex"}},s.createElement("button",{className:"btn btn-secondary active pull-right",onClick:function(t){e.handlePerformanceDetail(a.taskID)}},s.createElement("i",{className:"fa fa-info-circle"})," Detail "),!m&&s.createElement("button",{className:"btn btn-success active pull-right",title:"Archive",onClick:function(t){e.onArchiveChat(a)}},s.createElement("i",{className:"fa fa-archive"}),"Archive"),s.createElement("button",{className:"btn btn-danger active pull-right",onClick:function(t){e.onDeleteChat(a)}},s.createElement("i",{className:"fa fa-trash"})," Delete ")))}}),s.createElement("button",{id:"btnConfirmArchive",style:{display:"none"},"data-toggle":"modal","data-target":"#ConfirmArchiveDialog"},"."),s.createElement(c.a,{instance:e.props.instance,id:"ConfirmArchiveDialog",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes",confirmationText:"Are you sure to archive this Chat?",heading:"Confirm...",onConfirmButtonClick:function(){e.archiveChat()}}),s.createElement("button",{type:"button",id:"btnTaskDetail",className:"btn btn-dark pull-right",style:{display:"none"},"data-toggle":"modal","data-target":"#TaskDetail"}," ."),s.createElement(p.a,{id:"TaskDetail",heading:"",saveButtonText:"Done",onSaveButtonClick:function(){e.setState({taskModalData:Object()})},disableSaveButton:!1},s.createElement("div",{className:"img-thumbnail padding-10"},s.createElement("div",{className:"dataCard"},s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Task Number: "),s.createElement("div",{className:"col-md-8 "},Object(d.g)(l.taskNumber))),s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Task Description: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.description))),s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Work Assigned To: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.assignedToName))),""!=Object(d.g)(l.floorRdfsLabel)&&s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Floor: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.floorRdfsLabel))),""!=Object(d.g)(l.spaceRdfsLabel)&&s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Space: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.spaceRdfsLabel))),""!=Object(d.g)(l.equipRdfsLabel)&&s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Equipment: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.equipRdfsLabel))),s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Work Order #: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.workOrder))),s.createElement("div",{className:"col-md-12"},s.createElement("div",{className:"col-md-4 headingText"},"Building: "),s.createElement("div",{className:"col-md-8"},Object(d.g)(l.buildingName))),s.createElement("div",{className:"col-md-12 padding-10"},s.createElement(b.b,{to:"javascript:void(0)",target:"_blank",style:{marginLeft:17},onClick:function(t){t.preventDefault(),window.location.origin.indexOf("/localhost")>-1?window.open("http://localhost:3000/#"+e.props.instance+"/"+e.props.buildingName+"/NewTask/"+Object(d.g)(l.task),"_blank"):window.open("https://app.onitnetwork.com/#"+e.props.instance+"/"+e.props.buildingName+"/NewTask/"+Object(d.g)(l.task),"_blank")}},"View Task Detail  "))))))))))))})},t}(s.Component);t.default=C}});