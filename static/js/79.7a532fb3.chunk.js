webpackJsonp([79],{2671:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=(a.n(n),a(820)),r=a(673),o=a.n(r),s=a(702),l=a(117),c=a(855),d=a(723),u=a(19),m=a(762),f=a(761),p=a(11),h=a(735),y=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),b=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof a?e:new a(function(t){t(e)})}(e.value).then(o,s)}l((n=n.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){var a,n,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},g=new Date,T=new Date,O=function(e){function t(t){var a=e.call(this,t)||this;return a.state={verifyObj:Object(),verifyIPMVPList:[],WOList:[],phaseTemplateDetailList:[]},a.handleChange=a.handleChange.bind(a),a.plainLastModifiedHandler=a.plainLastModifiedHandler.bind(a),a.fetchVerify=a.fetchVerify.bind(a),a.fetchIPMVPVerify=a.fetchIPMVPVerify.bind(a),a.saveVerify=a.saveVerify.bind(a),a.handleVerifyObjChange=a.handleVerifyObjChange.bind(a),a._getWorkOrdersList=a._getWorkOrdersList.bind(a),a.savingToDateDateHandler=a.savingToDateDateHandler.bind(a),a.handleWorkflowChange=a.handleWorkflowChange.bind(a),a._getPhaseTemplateDetails=a._getPhaseTemplateDetails.bind(a),a.createWorkFlow=a.createWorkFlow.bind(a),a}return y(t,e),t.prototype.UNSAFE_componentWillMount=function(){return b(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.plainLastModifiedHandler(new Date),this.savingToDateDateHandler(new Date),[4,this._getWorkOrdersList()];case 1:return e.sent(),[4,this._getPhaseTemplateDetails()];case 2:return e.sent(),[2]}})})},t.prototype.componentDidMount=function(){return b(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.props.id?[4,this.fetchVerify()]:[3,2];case 1:return t.sent(),[3,5];case 2:return(e=this.state.verifyObj).verifyType=this.props.verifyType,e.verifyType!=i.c.Measure?[3,4]:[4,this.fetchIPMVPVerify()];case 3:t.sent(),t.label=4;case 4:e.plainLastModified=g?g.toString():"",this.setState({verifyObj:e}),t.label=5;case 5:return[2]}})})},t.prototype._getPhaseTemplateDetails=function(){return b(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return[4,Object(d.j)(this.props.buildingName).then(function(t){t.length>0&&t[0].ontology?e.setState({phaseTemplateDetailList:t}):e.setState({phaseTemplateDetailList:[]})})];case 1:return t.sent(),[2]}})})},t.prototype._getWorkOrdersList=function(){return b(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return Object(l.a)(!0),[4,Object(c.e)(this.props.buildingName).then(function(t){e.setState({WOList:t})}).catch(function(e){return e})];case 1:return t.sent(),Object(l.a)(!1),[2]}})})},t.prototype.fetchVerify=function(){return b(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return[4,Object(s.o)(this.props.buildingName,"",this.props.id).then(function(t){return b(e,void 0,void 0,function(){var e;return v(this,function(a){switch(a.label){case 0:return t&&t[0]&&t[0].ontology?(e=t[0],g=e.plainLastModified?new Date(e.plainLastModified):void 0,T=e.savingToDate?new Date(e.savingToDate):void 0,e.verifyType!=i.c.Measure?[3,2]:[4,this.fetchIPMVPVerify()]):[3,3];case 1:a.sent(),a.label=2;case 2:this.setState({verifyObj:e}),a.label=3;case 3:return[2]}})})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.fetchIPMVPVerify=function(){return b(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return[4,Object(s.o)(this.props.buildingName,i.c.IPMVP).then(function(t){t&&e.setState({verifyIPMVPList:t},function(){var t=localStorage.getItem("currentIPMVP");t&&e.handleVerifyObjChange("relatedIPMVP",t)})}).catch(function(e){return e})];case 1:return t.sent(),[2]}})})},t.prototype.createWorkFlow=function(e,t){return b(this,void 0,void 0,function(){var a,n,i,r,o,s,c,d,y,b,g,T,O,j,w,k,N;return v(this,function(E){switch(E.label){case 0:a=this.props.buildingName,Object(l.a)(!0),n=Object(),t._id&&t._id.length>0?n.ontology=Object(u.z)(7):n.ontology=t&&t?t.ontology:Object(u.z)(7),n.description=this.state.verifyObj.projectName+" "+e.description,n.module=e.module,n.status="Planned",n.phaseID=Object(u.x)(7).toString(),n.templateID=e.templateID,n.templateType=e.templateType,n.estimatedStartTime=e.estimatedStartTime,n.estimatedEndTime=e.estimatedEndTime,i=[],r=e.facilitatorAssigned,i[0]=Object(),i[0].label=r,i[0].value=r,n.facilitatorAssigned=i[0],n.stageTemplateOnology=[],n.stages=[],o=[],s=[],c=0,E.label=1;case 1:if(!(c<e.stageTemplates.length))return[3,7];if(!(e.stageTemplates.length>0&&e.stageTemplates[0].ontology))return[3,6];for(d=e.stageTemplates[c],y=Object(),b=Object(u.z)(7),g="",g+=Object(u.y)(),y.color=g,y.task=b,y.taskNumber=Object(u.x)(7).toString(),y.description=d.description,y.action=d.action,y.enteredBy=d.enteredBy,y.enteredByName=d.enteredByName,y.assignedTo=d.assignedTo,y.hasChat=!0,y.entryTimeStamp=d.entryTimeStamp,y.criticality=d.criticality,y.equipSubject=d.equipSubject,y.equipRdfsLabel=d.equipRdfsLabel,y.spaceSubject=d.spaceSubject,y.spaceRdfsLabel=d.spaceRdfsLabel,y.floor=d.floor,y.building=d.building,y.workOrder=d.workOrder,y.wfOntology=n.ontology,y.workflowType="IPMVP",y.status="Pending",y.acknowledged=!0,y.archived=!1,y.startTime="",y.workOrder=d.workOrder,y.note="",y.isSequence=!0,y.QRTag=d.QRTag,y.isQRTask=d.isQRTask,y.subTasks=[],y.redirectionLink=d.redirectionLink,y.isStage=!0,y.isActivated=!1,y.estimatedStartTime=new Date,T=0,N=0;N<d.subTasks.length;N++)O=d.subTasks[N],T+=parseInt(O.duration);j=y.subTasks.length>0?new Date(y.subTasks[0].estimatedStartTime):new Date,y.estimatedEndTime=new Date(j.setHours(j.getHours()+T)),w=function(e){var t,i,r,l,c,m,b,T,O,j,w,N,E;return v(this,function(v){switch(v.label){case 0:return[4,Object(h.c)(k.props.buildingName,[d.subTasks[e].ontology])];case 1:return t=v.sent(),i=d.subTasks[e],(r=Object()).subTask=Object(u.z)(7),r.taskNumber=Object(u.x)(7).toString(),r.color=g,[4,Object(f.d)(a,["TaskTemplate"],[i.ontology])];case 2:if((l=v.sent())&&l.length>0&&l[0].entityOntology)for(c=0;c<l.length;c++)m=Object(),b=l[c],m.docOntology=r.subTask+Object(u.D)()+c,m.building=Object(p.g)(b.building),m.documentType=Object(p.g)(b.documentType),m.enteredBy=Object(p.g)(b.enteredBy),m.entityOntology=[{label:r.subTask,value:r.subTask}],m.entityType="Task",m.entryTimeStamp=(new Date).toString(),m.rdfsLabel=Object(p.g)(b.rdfsLabel),m.s3FileName=Object(p.g)(b.s3FileName),s.push(m);for(r.description=i.description,r.action=i.action,r.asset=i.asset,r.enteredBy=i.enteredBy,r.enteredByName=i.enteredByName,r.assignedTo=i.assignedTo,r.assignedDepartment=i.assignedDepartment,r.hasChat=!0,r.entryTimeStamp=i.entryTimeStamp,r.criticality=i.criticality,r.equipSubject=y.equipSubject,r.equipRdfsLabel=y.equipRdfsLabel,r.spaceSubject=y.spaceSubject,r.spaceRdfsLabel=y.spaceRdfsLabel,r.building=y.building,r.workOrder=i.workOrder,r.status="Pending",r.acknowledged=!0,r.archived=!1,r.index=i.index,r.parentTask=y.task,r.note=i.note,r.relatedLink=i.relatedLink,r.duration=i.duration,r.durationUnit=i.durationUnit,r.workerDuration=i.workerDuration,r.workerDurationUnit=i.workerDurationUnit,r.fileName=i.fileName,r.oldFileName=i.oldFileName,r.startTime="",r.workType=i.workType,r.checklistID=i.checklistID,r.isQRTask=i.isQRTask,r.QRTag=i.QRTag,r.notifyViaEmail=i.notifyViaEmail,r.notifyViaSMS=i.notifyViaSMS,r.estimatedStartTime=y.estimatedStartTime,r.estimatedEndTime=y.estimatedEndTime,r.workflowType=i.workflowType,r.redirectionLink=i.redirectionLink,r.isStage=!0,r.isActivated=!1,r.acknowledged=!0,r.archived=!1,r.wfOntology=n.ontology,y.subTasks.push(r),T=t.filter(function(e){return e.taskOntology==i.ontology}),O=0;O<T.length;O++)j=T[O],(w=Object()).ontology=Object(u.z)(10),w.directive=j.directive,w.directiveType=j.directiveType,w.floorOntology=j.floorOntology,w.spaceOntology=j.spaceOntology,w.componentOntology=j.componentOntology,w.assetOntology=j.assetOntology,w.pointOntology=j.pointOntology,w.unit=j.unit,w.taskOntology=r.subTask,w.taskDescription=j.taskDescription,w.isTemplate=!1,w.objectTemplateReferenceID=j.ontology,w.isQrCodeVerified=!1,w.qrCode=j.qrCode,w.visibleObjectFormActions=[],o.push(w);for(N=function(e){var a=o[e],n=t.find(function(e){return e.ontology==a.objectTemplateReferenceID});if(n&&n.visibleObjectFormActions&&n.visibleObjectFormActions.length>0)for(var i=function(e){var i=n.visibleObjectFormActions[e];if(""!=i){var r=t.find(function(e){return e.ontology==i}),s=o.find(function(e){return e.objectTemplateReferenceID==r.ontology});-1==a.visibleObjectFormActions.findIndex(function(e){return e==s.ontology})&&a.visibleObjectFormActions.push(s.ontology)}},r=0;r<n.visibleObjectFormActions.length;r++)i(r)},E=0;E<o.length;E++)N(E);return[2]}})},k=this,N=0,E.label=2;case 2:return N<d.subTasks.length?[5,w(N)]:[3,5];case 3:E.sent(),E.label=4;case 4:return N++,[3,2];case 5:n&&n.stages&&n.stages.push(y),E.label=6;case 6:return c++,[3,1];case 7:return s.length>0&&s.map(function(e){Object(f.f)(e)}),[4,Object(h.e)(a,o)];case 8:return E.sent(),[4,Object(m.e)(a,n,!1,!0).then(function(e){}).catch(function(e){return e})];case 9:return E.sent(),Object(l.a)(!1),[2]}})})},t.prototype.saveVerify=function(){return b(this,void 0,void 0,function(){var e,t,a,n,i,r,o=this;return v(this,function(l){switch(l.label){case 0:return e=this.state.phaseTemplateDetailList,t=this.state.phaseTemplateDetailList,a=this.props,n=a.buildingName,i=a.instance,(r=this.state.verifyObj).ontology&&""!=r.ontology&&void 0!=r.ontology||(r.ontology=Object(u.z)(8)),r.buildingName=n,[4,Object(s.t)(r).then(function(a){return b(o,void 0,void 0,function(){var a,o,s;return v(this,function(l){switch(l.label){case 0:return r.workflowTemplate&&""!=r.workflowTemplate?(a=t&&t.find(function(e){return e.ontology==r.workflowTemplate}))&&a.ontology?[4,this.createWorkFlow(a,r)]:[3,2]:[3,4];case 1:l.sent(),l.label=2;case 2:return this.props.id?[3,4]:r.workflowTemplate&&""!=r.workflowTemplate?(o=e&&e.find(function(e){return e.ontology==r.workflowTemplate}),s=!o.uses||void 0==o.uses&&NaN==o.uses?"1":(o&&o.uses+1).toString(),[4,Object(d.o)(n,o.ontology,s).then(function(e){}).catch(function(e){return e})]):[3,4];case 3:l.sent(),l.label=4;case 4:return g=new Date,T=new Date,this.setState({verifyObj:Object()},function(){window.location.hash=i+"/"+n+"/VerifyIPMVP"}),[2]}})})}).catch(function(e){console.log(e)})];case 1:return l.sent(),[2]}})})},t.prototype.handleChange=function(e){var t=this.state.verifyObj,a=e.target.value;"percentComplete"==e.target.name&&(a&&a>100?a=100:a&&a<1&&(a=1)),t[e.target.name]=a,this.setState({verifyObj:t})},t.prototype.handleVerifyType=function(e){return b(this,void 0,void 0,function(){var t;return v(this,function(a){switch(a.label){case 0:return(t=this.state.verifyObj).verifyType=e,t.verifyType!=i.c.Measure?[3,2]:[4,this.fetchIPMVPVerify()];case 1:a.sent(),a.label=2;case 2:return this.setState({verifyObj:t}),[2]}})})},t.prototype.savingToDateDateHandler=function(e){var t=this.state.verifyObj;t.savingToDate=e.toString(),T=e,this.setState({verifyObj:t})},t.prototype.plainLastModifiedHandler=function(e){var t=this.state.verifyObj;t.plainLastModified=e.toString(),g=e,this.setState({verifyObj:t})},t.prototype.handleVerifyObjChange=function(e,t){var a=this.state.verifyObj;a[e]=t,this.setState({verifyObj:a})},t.prototype.handleWorkflowChange=function(e){var t=this.state.verifyObj,a=e.target.name;"checkbox"==e.target.type?t[""+a]=e.target.checked:t[""+a]=e.target.value,this.setState({verifyObj:t})},t.prototype.render=function(){var e=this,t=this.props,a=t.buildingName,r=t.instance,s=this.state,l=s.verifyObj,c=s.WOList,d=s.phaseTemplateDetailList,u=s.verifyIPMVPList,m=l.projectName&&l.projectName.length>0&&l.verifyType&&l.verifyType.length>0&&l.valuationImprovement&&l.valuationImprovement.length>0&&(l.verifyType!=i.c.Measure||l.percentComplete)&&(l.verifyType!=i.c.Measure||l.relatedIPMVP)&&!0;return n.createElement("div",{className:"content"},n.createElement("div",{className:"container-fluid"},n.createElement("div",{className:"card"},n.createElement("div",{className:"container-fluid"},n.createElement("div",{className:"content"},l.verifyType==i.c.Measure&&n.createElement("h4",{className:"title"},"Verify Project Creation: Measure"),l.verifyType==i.c.IPMVP&&n.createElement("h4",{className:"title"},"Verify Project Creation: IPMVP"),n.createElement("hr",null),l.verifyType&&n.createElement("div",{className:"row"},l.verifyType==i.c.Measure&&n.createElement("div",{className:"row padding-5"},n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"relatedIPMVP"},"Related IPMVP:")),n.createElement("div",{className:"col-md-8"},n.createElement("select",{className:"form-control "+(l.relatedIPMVP?"":"addFieldValidate"),id:"relatedIPMVP",name:"relatedIPMVP",value:l.relatedIPMVP,onChange:function(t){return e.handleVerifyObjChange("relatedIPMVP",t.target.value)}},n.createElement("option",{value:""},"Select Related IPMVP"),u&&u.length>0&&u.map(function(e){return n.createElement("option",{value:e._id},e.projectName)}))))),n.createElement("div",{className:"row padding-5"},n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"projectName"},l.verifyType+" Workflow Template:")),n.createElement("div",{className:"col-md-8"},n.createElement("select",{className:"form-control",id:"workflowTemplate",name:"workflowTemplate",value:l.workflowTemplate,onChange:this.handleWorkflowChange},n.createElement("option",{value:""},"Select Workflow Template"),d&&d.length>0&&d.map(function(e){return e.templateType==l.verifyType&&l.verifyType?n.createElement("option",{value:e&&e.ontology},e&&e.description):""})))),n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"projectName"},"Project Name:")),n.createElement("div",{className:"col-md-8"},n.createElement("input",{id:"projectName",name:"projectName",type:"text",className:"form-control "+(l.projectName?"":"addFieldValidate"),value:l.projectName,onChange:function(t){return e.handleChange(t)}})))),n.createElement("div",{className:"row padding-5"},n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"valuationImprovement"},"Valuation Improvement:")),n.createElement("div",{className:"col-md-8"},n.createElement("input",{id:"valuationImprovement",name:"valuationImprovement",type:"number",className:"form-control "+(l.valuationImprovement?"":"addFieldValidate"),value:l.valuationImprovement,onChange:function(t){return e.handleChange(t)}}))),n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"projectName"},"Last Modified:")),n.createElement("div",{className:"col-md-8"},n.createElement(o.a,{id:"plainLastModified",className:"form-control",selected:g,onChange:function(t){return e.plainLastModifiedHandler(t)},showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"MMMM d, yyyy h:mm aa",timeCaption:"time",customInput:n.createElement("input",{type:"text",className:"",name:"notificationExpireDate",placeholder:"Start Time","aria-label":"","aria-describedby":"button-addon4",value:l&&l.plainLastModified&&l.plainLastModified.ToEasternDateTime()})})))),n.createElement("div",{className:"row padding-5"},n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"projectName"},"Project #:")),n.createElement("div",{className:"col-md-8"},n.createElement("select",{className:"form-control b-long-col-background",id:"relatedWO",name:"projectNumber",value:l.projectNumber,onChange:function(t){return e.handleVerifyObjChange(t.target.name,t.target.value)}},n.createElement("option",{value:""},"Select Project #"),c&&c.length>0&&c.map(function(e,t){return n.createElement("option",{value:e.value,key:t},e.value," ")})))),n.createElement("div",{className:"col-md-6"},n.createElement("div",{className:"col-md-4"},n.createElement("label",{htmlFor:"savingToDate"},"Saving To Date:")),n.createElement("div",{className:"col-md-8"},n.createElement(o.a,{id:"savingToDate",className:"form-control",selected:T,onChange:function(t){return e.savingToDateDateHandler(t)},showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,dateFormat:"MMMM d, yyyy h:mm aa",timeCaption:"time",customInput:n.createElement("input",{type:"text",className:"",name:"savingToDate",placeholder:"Start Time","aria-label":"","aria-describedby":"button-addon4",value:l&&l.savingToDate&&l.savingToDate.ToEasternDateTime()})})))),n.createElement("div",{className:"padding-10",style:{marginLeft:0}},n.createElement("div",{className:"pull-right",style:{padding:"10px 0px"}},n.createElement("button",{disabled:!m,className:"btn btn-fill btn-success margin-5",onClick:function(){e.saveVerify()}}," ",n.createElement("i",{className:"fa fa-save"}),"Save"),n.createElement("button",{className:"btn btn-fill btn-danger margin-5",onClick:function(){window.location.hash=r+"/"+a+"/Verify"+l.verifyType}},n.createElement("i",{className:"fa fa-close"})," Cancel")))))))))},t}(n.Component);t.default=O}});